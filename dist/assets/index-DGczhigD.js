function MS(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const a in r)if(a!=="default"&&!(a in t)){const u=Object.getOwnPropertyDescriptor(r,a);u&&Object.defineProperty(t,a,u.get?u:{enumerable:!0,get:()=>r[a]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const u of a)if(u.type==="childList")for(const h of u.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&r(h)}).observe(document,{childList:!0,subtree:!0});function n(a){const u={};return a.integrity&&(u.integrity=a.integrity),a.referrerPolicy&&(u.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?u.credentials="include":a.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function r(a){if(a.ep)return;a.ep=!0;const u=n(a);fetch(a.href,u)}})();var ex=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function h_(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Av={exports:{}},wd={},Rv={exports:{}},Tt={};var tx;function OS(){if(tx)return Tt;tx=1;var t=Symbol.for("react.element"),e=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),u=Symbol.for("react.provider"),h=Symbol.for("react.context"),m=Symbol.for("react.forward_ref"),y=Symbol.for("react.suspense"),x=Symbol.for("react.memo"),k=Symbol.for("react.lazy"),T=Symbol.iterator;function S($){return $===null||typeof $!="object"?null:($=T&&$[T]||$["@@iterator"],typeof $=="function"?$:null)}var R={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},O=Object.assign,D={};function q($,ee,Pe){this.props=$,this.context=ee,this.refs=D,this.updater=Pe||R}q.prototype.isReactComponent={},q.prototype.setState=function($,ee){if(typeof $!="object"&&typeof $!="function"&&$!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,$,ee,"setState")},q.prototype.forceUpdate=function($){this.updater.enqueueForceUpdate(this,$,"forceUpdate")};function he(){}he.prototype=q.prototype;function ce($,ee,Pe){this.props=$,this.context=ee,this.refs=D,this.updater=Pe||R}var C=ce.prototype=new he;C.constructor=ce,O(C,q.prototype),C.isPureReactComponent=!0;var le=Array.isArray,c=Object.prototype.hasOwnProperty,re={current:null},xe={key:!0,ref:!0,__self:!0,__source:!0};function je($,ee,Pe){var Ee,G={},ae=null,Ue=null;if(ee!=null)for(Ee in ee.ref!==void 0&&(Ue=ee.ref),ee.key!==void 0&&(ae=""+ee.key),ee)c.call(ee,Ee)&&!xe.hasOwnProperty(Ee)&&(G[Ee]=ee[Ee]);var qe=arguments.length-2;if(qe===1)G.children=Pe;else if(1<qe){for(var et=Array(qe),ot=0;ot<qe;ot++)et[ot]=arguments[ot+2];G.children=et}if($&&$.defaultProps)for(Ee in qe=$.defaultProps,qe)G[Ee]===void 0&&(G[Ee]=qe[Ee]);return{$$typeof:t,type:$,key:ae,ref:Ue,props:G,_owner:re.current}}function Fe($,ee){return{$$typeof:t,type:$.type,key:ee,ref:$.ref,props:$.props,_owner:$._owner}}function Ze($){return typeof $=="object"&&$!==null&&$.$$typeof===t}function st($){var ee={"=":"=0",":":"=2"};return"$"+$.replace(/[=:]/g,function(Pe){return ee[Pe]})}var Re=/\/+/g;function Ae($,ee){return typeof $=="object"&&$!==null&&$.key!=null?st(""+$.key):ee.toString(36)}function ue($,ee,Pe,Ee,G){var ae=typeof $;(ae==="undefined"||ae==="boolean")&&($=null);var Ue=!1;if($===null)Ue=!0;else switch(ae){case"string":case"number":Ue=!0;break;case"object":switch($.$$typeof){case t:case e:Ue=!0}}if(Ue)return Ue=$,G=G(Ue),$=Ee===""?"."+Ae(Ue,0):Ee,le(G)?(Pe="",$!=null&&(Pe=$.replace(Re,"$&/")+"/"),ue(G,ee,Pe,"",function(ot){return ot})):G!=null&&(Ze(G)&&(G=Fe(G,Pe+(!G.key||Ue&&Ue.key===G.key?"":(""+G.key).replace(Re,"$&/")+"/")+$)),ee.push(G)),1;if(Ue=0,Ee=Ee===""?".":Ee+":",le($))for(var qe=0;qe<$.length;qe++){ae=$[qe];var et=Ee+Ae(ae,qe);Ue+=ue(ae,ee,Pe,et,G)}else if(et=S($),typeof et=="function")for($=et.call($),qe=0;!(ae=$.next()).done;)ae=ae.value,et=Ee+Ae(ae,qe++),Ue+=ue(ae,ee,Pe,et,G);else if(ae==="object")throw ee=String($),Error("Objects are not valid as a React child (found: "+(ee==="[object Object]"?"object with keys {"+Object.keys($).join(", ")+"}":ee)+"). If you meant to render a collection of children, use an array instead.");return Ue}function pe($,ee,Pe){if($==null)return $;var Ee=[],G=0;return ue($,Ee,"","",function(ae){return ee.call(Pe,ae,G++)}),Ee}function $e($){if($._status===-1){var ee=$._result;ee=ee(),ee.then(function(Pe){($._status===0||$._status===-1)&&($._status=1,$._result=Pe)},function(Pe){($._status===0||$._status===-1)&&($._status=2,$._result=Pe)}),$._status===-1&&($._status=0,$._result=ee)}if($._status===1)return $._result.default;throw $._result}var Y={current:null},J={transition:null},Se={ReactCurrentDispatcher:Y,ReactCurrentBatchConfig:J,ReactCurrentOwner:re};function de(){throw Error("act(...) is not supported in production builds of React.")}return Tt.Children={map:pe,forEach:function($,ee,Pe){pe($,function(){ee.apply(this,arguments)},Pe)},count:function($){var ee=0;return pe($,function(){ee++}),ee},toArray:function($){return pe($,function(ee){return ee})||[]},only:function($){if(!Ze($))throw Error("React.Children.only expected to receive a single React element child.");return $}},Tt.Component=q,Tt.Fragment=n,Tt.Profiler=a,Tt.PureComponent=ce,Tt.StrictMode=r,Tt.Suspense=y,Tt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Se,Tt.act=de,Tt.cloneElement=function($,ee,Pe){if($==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+$+".");var Ee=O({},$.props),G=$.key,ae=$.ref,Ue=$._owner;if(ee!=null){if(ee.ref!==void 0&&(ae=ee.ref,Ue=re.current),ee.key!==void 0&&(G=""+ee.key),$.type&&$.type.defaultProps)var qe=$.type.defaultProps;for(et in ee)c.call(ee,et)&&!xe.hasOwnProperty(et)&&(Ee[et]=ee[et]===void 0&&qe!==void 0?qe[et]:ee[et])}var et=arguments.length-2;if(et===1)Ee.children=Pe;else if(1<et){qe=Array(et);for(var ot=0;ot<et;ot++)qe[ot]=arguments[ot+2];Ee.children=qe}return{$$typeof:t,type:$.type,key:G,ref:ae,props:Ee,_owner:Ue}},Tt.createContext=function($){return $={$$typeof:h,_currentValue:$,_currentValue2:$,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},$.Provider={$$typeof:u,_context:$},$.Consumer=$},Tt.createElement=je,Tt.createFactory=function($){var ee=je.bind(null,$);return ee.type=$,ee},Tt.createRef=function(){return{current:null}},Tt.forwardRef=function($){return{$$typeof:m,render:$}},Tt.isValidElement=Ze,Tt.lazy=function($){return{$$typeof:k,_payload:{_status:-1,_result:$},_init:$e}},Tt.memo=function($,ee){return{$$typeof:x,type:$,compare:ee===void 0?null:ee}},Tt.startTransition=function($){var ee=J.transition;J.transition={};try{$()}finally{J.transition=ee}},Tt.unstable_act=de,Tt.useCallback=function($,ee){return Y.current.useCallback($,ee)},Tt.useContext=function($){return Y.current.useContext($)},Tt.useDebugValue=function(){},Tt.useDeferredValue=function($){return Y.current.useDeferredValue($)},Tt.useEffect=function($,ee){return Y.current.useEffect($,ee)},Tt.useId=function(){return Y.current.useId()},Tt.useImperativeHandle=function($,ee,Pe){return Y.current.useImperativeHandle($,ee,Pe)},Tt.useInsertionEffect=function($,ee){return Y.current.useInsertionEffect($,ee)},Tt.useLayoutEffect=function($,ee){return Y.current.useLayoutEffect($,ee)},Tt.useMemo=function($,ee){return Y.current.useMemo($,ee)},Tt.useReducer=function($,ee,Pe){return Y.current.useReducer($,ee,Pe)},Tt.useRef=function($){return Y.current.useRef($)},Tt.useState=function($){return Y.current.useState($)},Tt.useSyncExternalStore=function($,ee,Pe){return Y.current.useSyncExternalStore($,ee,Pe)},Tt.useTransition=function(){return Y.current.useTransition()},Tt.version="18.3.1",Tt}var nx;function Um(){return nx||(nx=1,Rv.exports=OS()),Rv.exports}var sx;function LS(){if(sx)return wd;sx=1;var t=Um(),e=Symbol.for("react.element"),n=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,a=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,u={key:!0,ref:!0,__self:!0,__source:!0};function h(m,y,x){var k,T={},S=null,R=null;x!==void 0&&(S=""+x),y.key!==void 0&&(S=""+y.key),y.ref!==void 0&&(R=y.ref);for(k in y)r.call(y,k)&&!u.hasOwnProperty(k)&&(T[k]=y[k]);if(m&&m.defaultProps)for(k in y=m.defaultProps,y)T[k]===void 0&&(T[k]=y[k]);return{$$typeof:e,type:m,key:S,ref:R,props:T,_owner:a.current}}return wd.Fragment=n,wd.jsx=h,wd.jsxs=h,wd}var rx;function DS(){return rx||(rx=1,Av.exports=LS()),Av.exports}var d=DS(),j=Um();const p_=h_(j),FS=MS({__proto__:null,default:p_},[j]);var Op={},$v={exports:{}},wr={},Mv={exports:{}},Ov={};var ix;function US(){return ix||(ix=1,(function(t){function e(J,Se){var de=J.length;J.push(Se);e:for(;0<de;){var $=de-1>>>1,ee=J[$];if(0<a(ee,Se))J[$]=Se,J[de]=ee,de=$;else break e}}function n(J){return J.length===0?null:J[0]}function r(J){if(J.length===0)return null;var Se=J[0],de=J.pop();if(de!==Se){J[0]=de;e:for(var $=0,ee=J.length,Pe=ee>>>1;$<Pe;){var Ee=2*($+1)-1,G=J[Ee],ae=Ee+1,Ue=J[ae];if(0>a(G,de))ae<ee&&0>a(Ue,G)?(J[$]=Ue,J[ae]=de,$=ae):(J[$]=G,J[Ee]=de,$=Ee);else if(ae<ee&&0>a(Ue,de))J[$]=Ue,J[ae]=de,$=ae;else break e}}return Se}function a(J,Se){var de=J.sortIndex-Se.sortIndex;return de!==0?de:J.id-Se.id}if(typeof performance=="object"&&typeof performance.now=="function"){var u=performance;t.unstable_now=function(){return u.now()}}else{var h=Date,m=h.now();t.unstable_now=function(){return h.now()-m}}var y=[],x=[],k=1,T=null,S=3,R=!1,O=!1,D=!1,q=typeof setTimeout=="function"?setTimeout:null,he=typeof clearTimeout=="function"?clearTimeout:null,ce=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function C(J){for(var Se=n(x);Se!==null;){if(Se.callback===null)r(x);else if(Se.startTime<=J)r(x),Se.sortIndex=Se.expirationTime,e(y,Se);else break;Se=n(x)}}function le(J){if(D=!1,C(J),!O)if(n(y)!==null)O=!0,$e(c);else{var Se=n(x);Se!==null&&Y(le,Se.startTime-J)}}function c(J,Se){O=!1,D&&(D=!1,he(je),je=-1),R=!0;var de=S;try{for(C(Se),T=n(y);T!==null&&(!(T.expirationTime>Se)||J&&!st());){var $=T.callback;if(typeof $=="function"){T.callback=null,S=T.priorityLevel;var ee=$(T.expirationTime<=Se);Se=t.unstable_now(),typeof ee=="function"?T.callback=ee:T===n(y)&&r(y),C(Se)}else r(y);T=n(y)}if(T!==null)var Pe=!0;else{var Ee=n(x);Ee!==null&&Y(le,Ee.startTime-Se),Pe=!1}return Pe}finally{T=null,S=de,R=!1}}var re=!1,xe=null,je=-1,Fe=5,Ze=-1;function st(){return!(t.unstable_now()-Ze<Fe)}function Re(){if(xe!==null){var J=t.unstable_now();Ze=J;var Se=!0;try{Se=xe(!0,J)}finally{Se?Ae():(re=!1,xe=null)}}else re=!1}var Ae;if(typeof ce=="function")Ae=function(){ce(Re)};else if(typeof MessageChannel<"u"){var ue=new MessageChannel,pe=ue.port2;ue.port1.onmessage=Re,Ae=function(){pe.postMessage(null)}}else Ae=function(){q(Re,0)};function $e(J){xe=J,re||(re=!0,Ae())}function Y(J,Se){je=q(function(){J(t.unstable_now())},Se)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(J){J.callback=null},t.unstable_continueExecution=function(){O||R||(O=!0,$e(c))},t.unstable_forceFrameRate=function(J){0>J||125<J?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Fe=0<J?Math.floor(1e3/J):5},t.unstable_getCurrentPriorityLevel=function(){return S},t.unstable_getFirstCallbackNode=function(){return n(y)},t.unstable_next=function(J){switch(S){case 1:case 2:case 3:var Se=3;break;default:Se=S}var de=S;S=Se;try{return J()}finally{S=de}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(J,Se){switch(J){case 1:case 2:case 3:case 4:case 5:break;default:J=3}var de=S;S=J;try{return Se()}finally{S=de}},t.unstable_scheduleCallback=function(J,Se,de){var $=t.unstable_now();switch(typeof de=="object"&&de!==null?(de=de.delay,de=typeof de=="number"&&0<de?$+de:$):de=$,J){case 1:var ee=-1;break;case 2:ee=250;break;case 5:ee=1073741823;break;case 4:ee=1e4;break;default:ee=5e3}return ee=de+ee,J={id:k++,callback:Se,priorityLevel:J,startTime:de,expirationTime:ee,sortIndex:-1},de>$?(J.sortIndex=de,e(x,J),n(y)===null&&J===n(x)&&(D?(he(je),je=-1):D=!0,Y(le,de-$))):(J.sortIndex=ee,e(y,J),O||R||(O=!0,$e(c))),J},t.unstable_shouldYield=st,t.unstable_wrapCallback=function(J){var Se=S;return function(){var de=S;S=Se;try{return J.apply(this,arguments)}finally{S=de}}}})(Ov)),Ov}var ox;function BS(){return ox||(ox=1,Mv.exports=US()),Mv.exports}var ax;function zS(){if(ax)return wr;ax=1;var t=Um(),e=BS();function n(s){for(var i="https://reactjs.org/docs/error-decoder.html?invariant="+s,l=1;l<arguments.length;l++)i+="&args[]="+encodeURIComponent(arguments[l]);return"Minified React error #"+s+"; visit "+i+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var r=new Set,a={};function u(s,i){h(s,i),h(s+"Capture",i)}function h(s,i){for(a[s]=i,s=0;s<i.length;s++)r.add(i[s])}var m=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),y=Object.prototype.hasOwnProperty,x=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,k={},T={};function S(s){return y.call(T,s)?!0:y.call(k,s)?!1:x.test(s)?T[s]=!0:(k[s]=!0,!1)}function R(s,i,l,p){if(l!==null&&l.type===0)return!1;switch(typeof i){case"function":case"symbol":return!0;case"boolean":return p?!1:l!==null?!l.acceptsBooleans:(s=s.toLowerCase().slice(0,5),s!=="data-"&&s!=="aria-");default:return!1}}function O(s,i,l,p){if(i===null||typeof i>"u"||R(s,i,l,p))return!0;if(p)return!1;if(l!==null)switch(l.type){case 3:return!i;case 4:return i===!1;case 5:return isNaN(i);case 6:return isNaN(i)||1>i}return!1}function D(s,i,l,p,v,w,N){this.acceptsBooleans=i===2||i===3||i===4,this.attributeName=p,this.attributeNamespace=v,this.mustUseProperty=l,this.propertyName=s,this.type=i,this.sanitizeURL=w,this.removeEmptyString=N}var q={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(s){q[s]=new D(s,0,!1,s,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(s){var i=s[0];q[i]=new D(i,1,!1,s[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(s){q[s]=new D(s,2,!1,s.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(s){q[s]=new D(s,2,!1,s,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(s){q[s]=new D(s,3,!1,s.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(s){q[s]=new D(s,3,!0,s,null,!1,!1)}),["capture","download"].forEach(function(s){q[s]=new D(s,4,!1,s,null,!1,!1)}),["cols","rows","size","span"].forEach(function(s){q[s]=new D(s,6,!1,s,null,!1,!1)}),["rowSpan","start"].forEach(function(s){q[s]=new D(s,5,!1,s.toLowerCase(),null,!1,!1)});var he=/[\-:]([a-z])/g;function ce(s){return s[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(s){var i=s.replace(he,ce);q[i]=new D(i,1,!1,s,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(s){var i=s.replace(he,ce);q[i]=new D(i,1,!1,s,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(s){var i=s.replace(he,ce);q[i]=new D(i,1,!1,s,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(s){q[s]=new D(s,1,!1,s.toLowerCase(),null,!1,!1)}),q.xlinkHref=new D("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(s){q[s]=new D(s,1,!1,s.toLowerCase(),null,!0,!0)});function C(s,i,l,p){var v=q.hasOwnProperty(i)?q[i]:null;(v!==null?v.type!==0:p||!(2<i.length)||i[0]!=="o"&&i[0]!=="O"||i[1]!=="n"&&i[1]!=="N")&&(O(i,l,v,p)&&(l=null),p||v===null?S(i)&&(l===null?s.removeAttribute(i):s.setAttribute(i,""+l)):v.mustUseProperty?s[v.propertyName]=l===null?v.type===3?!1:"":l:(i=v.attributeName,p=v.attributeNamespace,l===null?s.removeAttribute(i):(v=v.type,l=v===3||v===4&&l===!0?"":""+l,p?s.setAttributeNS(p,i,l):s.setAttribute(i,l))))}var le=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,c=Symbol.for("react.element"),re=Symbol.for("react.portal"),xe=Symbol.for("react.fragment"),je=Symbol.for("react.strict_mode"),Fe=Symbol.for("react.profiler"),Ze=Symbol.for("react.provider"),st=Symbol.for("react.context"),Re=Symbol.for("react.forward_ref"),Ae=Symbol.for("react.suspense"),ue=Symbol.for("react.suspense_list"),pe=Symbol.for("react.memo"),$e=Symbol.for("react.lazy"),Y=Symbol.for("react.offscreen"),J=Symbol.iterator;function Se(s){return s===null||typeof s!="object"?null:(s=J&&s[J]||s["@@iterator"],typeof s=="function"?s:null)}var de=Object.assign,$;function ee(s){if($===void 0)try{throw Error()}catch(l){var i=l.stack.trim().match(/\n( *(at )?)/);$=i&&i[1]||""}return`
`+$+s}var Pe=!1;function Ee(s,i){if(!s||Pe)return"";Pe=!0;var l=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(i)if(i=function(){throw Error()},Object.defineProperty(i.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(i,[])}catch(Q){var p=Q}Reflect.construct(s,[],i)}else{try{i.call()}catch(Q){p=Q}s.call(i.prototype)}else{try{throw Error()}catch(Q){p=Q}s()}}catch(Q){if(Q&&p&&typeof Q.stack=="string"){for(var v=Q.stack.split(`
`),w=p.stack.split(`
`),N=v.length-1,M=w.length-1;1<=N&&0<=M&&v[N]!==w[M];)M--;for(;1<=N&&0<=M;N--,M--)if(v[N]!==w[M]){if(N!==1||M!==1)do if(N--,M--,0>M||v[N]!==w[M]){var F=`
`+v[N].replace(" at new "," at ");return s.displayName&&F.includes("<anonymous>")&&(F=F.replace("<anonymous>",s.displayName)),F}while(1<=N&&0<=M);break}}}finally{Pe=!1,Error.prepareStackTrace=l}return(s=s?s.displayName||s.name:"")?ee(s):""}function G(s){switch(s.tag){case 5:return ee(s.type);case 16:return ee("Lazy");case 13:return ee("Suspense");case 19:return ee("SuspenseList");case 0:case 2:case 15:return s=Ee(s.type,!1),s;case 11:return s=Ee(s.type.render,!1),s;case 1:return s=Ee(s.type,!0),s;default:return""}}function ae(s){if(s==null)return null;if(typeof s=="function")return s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case xe:return"Fragment";case re:return"Portal";case Fe:return"Profiler";case je:return"StrictMode";case Ae:return"Suspense";case ue:return"SuspenseList"}if(typeof s=="object")switch(s.$$typeof){case st:return(s.displayName||"Context")+".Consumer";case Ze:return(s._context.displayName||"Context")+".Provider";case Re:var i=s.render;return s=s.displayName,s||(s=i.displayName||i.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case pe:return i=s.displayName||null,i!==null?i:ae(s.type)||"Memo";case $e:i=s._payload,s=s._init;try{return ae(s(i))}catch{}}return null}function Ue(s){var i=s.type;switch(s.tag){case 24:return"Cache";case 9:return(i.displayName||"Context")+".Consumer";case 10:return(i._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return s=i.render,s=s.displayName||s.name||"",i.displayName||(s!==""?"ForwardRef("+s+")":"ForwardRef");case 7:return"Fragment";case 5:return i;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return ae(i);case 8:return i===je?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i}return null}function qe(s){switch(typeof s){case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function et(s){var i=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(i==="checkbox"||i==="radio")}function ot(s){var i=et(s)?"checked":"value",l=Object.getOwnPropertyDescriptor(s.constructor.prototype,i),p=""+s[i];if(!s.hasOwnProperty(i)&&typeof l<"u"&&typeof l.get=="function"&&typeof l.set=="function"){var v=l.get,w=l.set;return Object.defineProperty(s,i,{configurable:!0,get:function(){return v.call(this)},set:function(N){p=""+N,w.call(this,N)}}),Object.defineProperty(s,i,{enumerable:l.enumerable}),{getValue:function(){return p},setValue:function(N){p=""+N},stopTracking:function(){s._valueTracker=null,delete s[i]}}}}function bt(s){s._valueTracker||(s._valueTracker=ot(s))}function nn(s){if(!s)return!1;var i=s._valueTracker;if(!i)return!0;var l=i.getValue(),p="";return s&&(p=et(s)?s.checked?"true":"false":s.value),s=p,s!==l?(i.setValue(s),!0):!1}function hn(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}function Dt(s,i){var l=i.checked;return de({},i,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:l??s._wrapperState.initialChecked})}function Mn(s,i){var l=i.defaultValue==null?"":i.defaultValue,p=i.checked!=null?i.checked:i.defaultChecked;l=qe(i.value!=null?i.value:l),s._wrapperState={initialChecked:p,initialValue:l,controlled:i.type==="checkbox"||i.type==="radio"?i.checked!=null:i.value!=null}}function Be(s,i){i=i.checked,i!=null&&C(s,"checked",i,!1)}function Pt(s,i){Be(s,i);var l=qe(i.value),p=i.type;if(l!=null)p==="number"?(l===0&&s.value===""||s.value!=l)&&(s.value=""+l):s.value!==""+l&&(s.value=""+l);else if(p==="submit"||p==="reset"){s.removeAttribute("value");return}i.hasOwnProperty("value")?On(s,i.type,l):i.hasOwnProperty("defaultValue")&&On(s,i.type,qe(i.defaultValue)),i.checked==null&&i.defaultChecked!=null&&(s.defaultChecked=!!i.defaultChecked)}function Wt(s,i,l){if(i.hasOwnProperty("value")||i.hasOwnProperty("defaultValue")){var p=i.type;if(!(p!=="submit"&&p!=="reset"||i.value!==void 0&&i.value!==null))return;i=""+s._wrapperState.initialValue,l||i===s.value||(s.value=i),s.defaultValue=i}l=s.name,l!==""&&(s.name=""),s.defaultChecked=!!s._wrapperState.initialChecked,l!==""&&(s.name=l)}function On(s,i,l){(i!=="number"||hn(s.ownerDocument)!==s)&&(l==null?s.defaultValue=""+s._wrapperState.initialValue:s.defaultValue!==""+l&&(s.defaultValue=""+l))}var sn=Array.isArray;function qt(s,i,l,p){if(s=s.options,i){i={};for(var v=0;v<l.length;v++)i["$"+l[v]]=!0;for(l=0;l<s.length;l++)v=i.hasOwnProperty("$"+s[l].value),s[l].selected!==v&&(s[l].selected=v),v&&p&&(s[l].defaultSelected=!0)}else{for(l=""+qe(l),i=null,v=0;v<s.length;v++){if(s[v].value===l){s[v].selected=!0,p&&(s[v].defaultSelected=!0);return}i!==null||s[v].disabled||(i=s[v])}i!==null&&(i.selected=!0)}}function ln(s,i){if(i.dangerouslySetInnerHTML!=null)throw Error(n(91));return de({},i,{value:void 0,defaultValue:void 0,children:""+s._wrapperState.initialValue})}function zn(s,i){var l=i.value;if(l==null){if(l=i.children,i=i.defaultValue,l!=null){if(i!=null)throw Error(n(92));if(sn(l)){if(1<l.length)throw Error(n(93));l=l[0]}i=l}i==null&&(i=""),l=i}s._wrapperState={initialValue:qe(l)}}function Wn(s,i){var l=qe(i.value),p=qe(i.defaultValue);l!=null&&(l=""+l,l!==s.value&&(s.value=l),i.defaultValue==null&&s.defaultValue!==l&&(s.defaultValue=l)),p!=null&&(s.defaultValue=""+p)}function Ts(s){var i=s.textContent;i===s._wrapperState.initialValue&&i!==""&&i!==null&&(s.value=i)}function qn(s){switch(s){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function cn(s,i){return s==null||s==="http://www.w3.org/1999/xhtml"?qn(i):s==="http://www.w3.org/2000/svg"&&i==="foreignObject"?"http://www.w3.org/1999/xhtml":s}var Ln,ns=(function(s){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(i,l,p,v){MSApp.execUnsafeLocalFunction(function(){return s(i,l,p,v)})}:s})(function(s,i){if(s.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in s)s.innerHTML=i;else{for(Ln=Ln||document.createElement("div"),Ln.innerHTML="<svg>"+i.valueOf().toString()+"</svg>",i=Ln.firstChild;s.firstChild;)s.removeChild(s.firstChild);for(;i.firstChild;)s.appendChild(i.firstChild)}});function ne(s,i){if(i){var l=s.firstChild;if(l&&l===s.lastChild&&l.nodeType===3){l.nodeValue=i;return}}s.textContent=i}var at={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},yt=["Webkit","ms","Moz","O"];Object.keys(at).forEach(function(s){yt.forEach(function(i){i=i+s.charAt(0).toUpperCase()+s.substring(1),at[i]=at[s]})});function Ft(s,i,l){return i==null||typeof i=="boolean"||i===""?"":l||typeof i!="number"||i===0||at.hasOwnProperty(s)&&at[s]?(""+i).trim():i+"px"}function Lt(s,i){s=s.style;for(var l in i)if(i.hasOwnProperty(l)){var p=l.indexOf("--")===0,v=Ft(l,i[l],p);l==="float"&&(l="cssFloat"),p?s.setProperty(l,v):s[l]=v}}var En=de({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Yt(s,i){if(i){if(En[s]&&(i.children!=null||i.dangerouslySetInnerHTML!=null))throw Error(n(137,s));if(i.dangerouslySetInnerHTML!=null){if(i.children!=null)throw Error(n(60));if(typeof i.dangerouslySetInnerHTML!="object"||!("__html"in i.dangerouslySetInnerHTML))throw Error(n(61))}if(i.style!=null&&typeof i.style!="object")throw Error(n(62))}}function Qt(s,i){if(s.indexOf("-")===-1)return typeof i.is=="string";switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Xt=null;function Tn(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var gs=null,Vn=null,Sn=null;function Is(s){if(s=ja(s)){if(typeof gs!="function")throw Error(n(280));var i=s.stateNode;i&&(i=Pl(i),gs(s.stateNode,s.type,i))}}function vs(s){Vn?Sn?Sn.push(s):Sn=[s]:Vn=s}function Hn(){if(Vn){var s=Vn,i=Sn;if(Sn=Vn=null,Is(s),i)for(s=0;s<i.length;s++)Is(i[s])}}function Kn(s,i){return s(i)}function Hs(){}var ys=!1;function K(s,i,l){if(ys)return s(i,l);ys=!0;try{return Kn(s,i,l)}finally{ys=!1,(Vn!==null||Sn!==null)&&(Hs(),Hn())}}function yn(s,i){var l=s.stateNode;if(l===null)return null;var p=Pl(l);if(p===null)return null;l=p[i];e:switch(i){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(p=!p.disabled)||(s=s.type,p=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!p;break e;default:s=!1}if(s)return null;if(l&&typeof l!="function")throw Error(n(231,i,typeof l));return l}var Jt=!1;if(m)try{var An={};Object.defineProperty(An,"passive",{get:function(){Jt=!0}}),window.addEventListener("test",An,An),window.removeEventListener("test",An,An)}catch{Jt=!1}function Ne(s,i,l,p,v,w,N,M,F){var Q=Array.prototype.slice.call(arguments,3);try{i.apply(l,Q)}catch(ve){this.onError(ve)}}var In=!1,At=null,W=!1,ie=null,se={onError:function(s){In=!0,At=s}};function ke(s,i,l,p,v,w,N,M,F){In=!1,At=null,Ne.apply(se,arguments)}function Qe(s,i,l,p,v,w,N,M,F){if(ke.apply(this,arguments),In){if(In){var Q=At;In=!1,At=null}else throw Error(n(198));W||(W=!0,ie=Q)}}function ge(s){var i=s,l=s;if(s.alternate)for(;i.return;)i=i.return;else{s=i;do i=s,(i.flags&4098)!==0&&(l=i.return),s=i.return;while(s)}return i.tag===3?l:null}function Bt(s){if(s.tag===13){var i=s.memoizedState;if(i===null&&(s=s.alternate,s!==null&&(i=s.memoizedState)),i!==null)return i.dehydrated}return null}function Nt(s){if(ge(s)!==s)throw Error(n(188))}function Rt(s){var i=s.alternate;if(!i){if(i=ge(s),i===null)throw Error(n(188));return i!==s?null:s}for(var l=s,p=i;;){var v=l.return;if(v===null)break;var w=v.alternate;if(w===null){if(p=v.return,p!==null){l=p;continue}break}if(v.child===w.child){for(w=v.child;w;){if(w===l)return Nt(v),s;if(w===p)return Nt(v),i;w=w.sibling}throw Error(n(188))}if(l.return!==p.return)l=v,p=w;else{for(var N=!1,M=v.child;M;){if(M===l){N=!0,l=v,p=w;break}if(M===p){N=!0,p=v,l=w;break}M=M.sibling}if(!N){for(M=w.child;M;){if(M===l){N=!0,l=w,p=v;break}if(M===p){N=!0,p=w,l=v;break}M=M.sibling}if(!N)throw Error(n(189))}}if(l.alternate!==p)throw Error(n(190))}if(l.tag!==3)throw Error(n(188));return l.stateNode.current===l?s:i}function lt(s){return s=Rt(s),s!==null?nt(s):null}function nt(s){if(s.tag===5||s.tag===6)return s;for(s=s.child;s!==null;){var i=nt(s);if(i!==null)return i;s=s.sibling}return null}var ut=e.unstable_scheduleCallback,Ct=e.unstable_cancelCallback,kt=e.unstable_shouldYield,Vt=e.unstable_requestPaint,$t=e.unstable_now,Xn=e.unstable_getCurrentPriorityLevel,wn=e.unstable_ImmediatePriority,ss=e.unstable_UserBlockingPriority,Dn=e.unstable_NormalPriority,jn=e.unstable_LowPriority,ws=e.unstable_IdlePriority,rs=null,Kt=null;function rn(s){if(Kt&&typeof Kt.onCommitFiberRoot=="function")try{Kt.onCommitFiberRoot(rs,s,void 0,(s.current.flags&128)===128)}catch{}}var z=Math.clz32?Math.clz32:tt,Z=Math.log,X=Math.LN2;function tt(s){return s>>>=0,s===0?32:31-(Z(s)/X|0)|0}var Ye=64,V=4194304;function ye(s){switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return s&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return s}}function Ie(s,i){var l=s.pendingLanes;if(l===0)return 0;var p=0,v=s.suspendedLanes,w=s.pingedLanes,N=l&268435455;if(N!==0){var M=N&~v;M!==0?p=ye(M):(w&=N,w!==0&&(p=ye(w)))}else N=l&~v,N!==0?p=ye(N):w!==0&&(p=ye(w));if(p===0)return 0;if(i!==0&&i!==p&&(i&v)===0&&(v=p&-p,w=i&-i,v>=w||v===16&&(w&4194240)!==0))return i;if((p&4)!==0&&(p|=l&16),i=s.entangledLanes,i!==0)for(s=s.entanglements,i&=p;0<i;)l=31-z(i),v=1<<l,p|=s[l],i&=~v;return p}function Me(s,i){switch(s){case 1:case 2:case 4:return i+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function He(s,i){for(var l=s.suspendedLanes,p=s.pingedLanes,v=s.expirationTimes,w=s.pendingLanes;0<w;){var N=31-z(w),M=1<<N,F=v[N];F===-1?((M&l)===0||(M&p)!==0)&&(v[N]=Me(M,i)):F<=i&&(s.expiredLanes|=M),w&=~M}}function Zt(s){return s=s.pendingLanes&-1073741825,s!==0?s:s&1073741824?1073741824:0}function zt(){var s=Ye;return Ye<<=1,(Ye&4194240)===0&&(Ye=64),s}function Ls(s){for(var i=[],l=0;31>l;l++)i.push(s);return i}function br(s,i,l){s.pendingLanes|=i,i!==536870912&&(s.suspendedLanes=0,s.pingedLanes=0),s=s.eventTimes,i=31-z(i),s[i]=l}function Hr(s,i){var l=s.pendingLanes&~i;s.pendingLanes=i,s.suspendedLanes=0,s.pingedLanes=0,s.expiredLanes&=i,s.mutableReadLanes&=i,s.entangledLanes&=i,i=s.entanglements;var p=s.eventTimes;for(s=s.expirationTimes;0<l;){var v=31-z(l),w=1<<v;i[v]=0,p[v]=-1,s[v]=-1,l&=~w}}function Cr(s,i){var l=s.entangledLanes|=i;for(s=s.entanglements;l;){var p=31-z(l),v=1<<p;v&i|s[p]&i&&(s[p]|=i),l&=~v}}var Mt=0;function li(s){return s&=-s,1<s?4<s?(s&268435455)!==0?16:536870912:4:1}var pa,Pi,ma,ga,va,po=!1,ci=[],kr=null,ar=null,lr=null,cr=new Map,Kr=new Map,Sr=[],ya="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function wa(s,i){switch(s){case"focusin":case"focusout":kr=null;break;case"dragenter":case"dragleave":ar=null;break;case"mouseover":case"mouseout":lr=null;break;case"pointerover":case"pointerout":cr.delete(i.pointerId);break;case"gotpointercapture":case"lostpointercapture":Kr.delete(i.pointerId)}}function ui(s,i,l,p,v,w){return s===null||s.nativeEvent!==w?(s={blockedOn:i,domEventName:l,eventSystemFlags:p,nativeEvent:w,targetContainers:[v]},i!==null&&(i=ja(i),i!==null&&Pi(i)),s):(s.eventSystemFlags|=p,i=s.targetContainers,v!==null&&i.indexOf(v)===-1&&i.push(v),s)}function A(s,i,l,p,v){switch(i){case"focusin":return kr=ui(kr,s,i,l,p,v),!0;case"dragenter":return ar=ui(ar,s,i,l,p,v),!0;case"mouseover":return lr=ui(lr,s,i,l,p,v),!0;case"pointerover":var w=v.pointerId;return cr.set(w,ui(cr.get(w)||null,s,i,l,p,v)),!0;case"gotpointercapture":return w=v.pointerId,Kr.set(w,ui(Kr.get(w)||null,s,i,l,p,v)),!0}return!1}function B(s){var i=Oi(s.target);if(i!==null){var l=ge(i);if(l!==null){if(i=l.tag,i===13){if(i=Bt(l),i!==null){s.blockedOn=i,va(s.priority,function(){ma(l)});return}}else if(i===3&&l.stateNode.current.memoizedState.isDehydrated){s.blockedOn=l.tag===3?l.stateNode.containerInfo:null;return}}}s.blockedOn=null}function te(s){if(s.blockedOn!==null)return!1;for(var i=s.targetContainers;0<i.length;){var l=St(s.domEventName,s.eventSystemFlags,i[0],s.nativeEvent);if(l===null){l=s.nativeEvent;var p=new l.constructor(l.type,l);Xt=p,l.target.dispatchEvent(p),Xt=null}else return i=ja(l),i!==null&&Pi(i),s.blockedOn=l,!1;i.shift()}return!0}function fe(s,i,l){te(s)&&l.delete(i)}function Oe(){po=!1,kr!==null&&te(kr)&&(kr=null),ar!==null&&te(ar)&&(ar=null),lr!==null&&te(lr)&&(lr=null),cr.forEach(fe),Kr.forEach(fe)}function dt(s,i){s.blockedOn===i&&(s.blockedOn=null,po||(po=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,Oe)))}function xn(s){function i(v){return dt(v,s)}if(0<ci.length){dt(ci[0],s);for(var l=1;l<ci.length;l++){var p=ci[l];p.blockedOn===s&&(p.blockedOn=null)}}for(kr!==null&&dt(kr,s),ar!==null&&dt(ar,s),lr!==null&&dt(lr,s),cr.forEach(i),Kr.forEach(i),l=0;l<Sr.length;l++)p=Sr[l],p.blockedOn===s&&(p.blockedOn=null);for(;0<Sr.length&&(l=Sr[0],l.blockedOn===null);)B(l),l.blockedOn===null&&Sr.shift()}var is=le.ReactCurrentBatchConfig,Fn=!0;function ft(s,i,l,p){var v=Mt,w=is.transition;is.transition=null;try{Mt=1,en(s,i,l,p)}finally{Mt=v,is.transition=w}}function pn(s,i,l,p){var v=Mt,w=is.transition;is.transition=null;try{Mt=4,en(s,i,l,p)}finally{Mt=v,is.transition=w}}function en(s,i,l,p){if(Fn){var v=St(s,i,l,p);if(v===null)ou(s,i,p,Nn,l),wa(s,p);else if(A(v,s,i,l,p))p.stopPropagation();else if(wa(s,p),i&4&&-1<ya.indexOf(s)){for(;v!==null;){var w=ja(v);if(w!==null&&pa(w),w=St(s,i,l,p),w===null&&ou(s,i,p,Nn,l),w===v)break;v=w}v!==null&&p.stopPropagation()}else ou(s,i,p,null,l)}}var Nn=null;function St(s,i,l,p){if(Nn=null,s=Tn(p),s=Oi(s),s!==null)if(i=ge(s),i===null)s=null;else if(l=i.tag,l===13){if(s=Bt(i),s!==null)return s;s=null}else if(l===3){if(i.stateNode.current.memoizedState.isDehydrated)return i.tag===3?i.stateNode.containerInfo:null;s=null}else i!==s&&(s=null);return Nn=s,null}function tn(s){switch(s){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Xn()){case wn:return 1;case ss:return 4;case Dn:case jn:return 16;case ws:return 536870912;default:return 16}default:return 16}}var js=null,Ai=null,gl=null;function pf(){if(gl)return gl;var s,i=Ai,l=i.length,p,v="value"in js?js.value:js.textContent,w=v.length;for(s=0;s<l&&i[s]===v[s];s++);var N=l-s;for(p=1;p<=N&&i[l-p]===v[w-p];p++);return gl=v.slice(s,1<p?1-p:void 0)}function xa(s){var i=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&i===13&&(s=13)):s=i,s===10&&(s=13),32<=s||s===13?s:0}function mo(){return!0}function vl(){return!1}function Ds(s){function i(l,p,v,w,N){this._reactName=l,this._targetInst=v,this.type=p,this.nativeEvent=w,this.target=N,this.currentTarget=null;for(var M in s)s.hasOwnProperty(M)&&(l=s[M],this[M]=l?l(w):w[M]);return this.isDefaultPrevented=(w.defaultPrevented!=null?w.defaultPrevented:w.returnValue===!1)?mo:vl,this.isPropagationStopped=vl,this}return de(i.prototype,{preventDefault:function(){this.defaultPrevented=!0;var l=this.nativeEvent;l&&(l.preventDefault?l.preventDefault():typeof l.returnValue!="unknown"&&(l.returnValue=!1),this.isDefaultPrevented=mo)},stopPropagation:function(){var l=this.nativeEvent;l&&(l.stopPropagation?l.stopPropagation():typeof l.cancelBubble!="unknown"&&(l.cancelBubble=!0),this.isPropagationStopped=mo)},persist:function(){},isPersistent:mo}),i}var Ri={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},yl=Ds(Ri),go=de({},Ri,{view:0,detail:0}),mf=Ds(go),wl,xl,$i,_a=de({},go,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:bl,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==$i&&($i&&s.type==="mousemove"?(wl=s.screenX-$i.screenX,xl=s.screenY-$i.screenY):xl=wl=0,$i=s),wl)},movementY:function(s){return"movementY"in s?s.movementY:xl}}),Vc=Ds(_a),gf=de({},_a,{dataTransfer:0}),_l=Ds(gf),hg=de({},go,{relatedTarget:0}),Hc=Ds(hg),pg=de({},Ri,{animationName:0,elapsedTime:0,pseudoElement:0}),mg=Ds(pg),gg=de({},Ri,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),vg=Ds(gg),yg=de({},Ri,{data:0}),vf=Ds(yg),wg={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},yf={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},wf={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function xf(s){var i=this.nativeEvent;return i.getModifierState?i.getModifierState(s):(s=wf[s])?!!i[s]:!1}function bl(){return xf}var xg=de({},go,{key:function(s){if(s.key){var i=wg[s.key]||s.key;if(i!=="Unidentified")return i}return s.type==="keypress"?(s=xa(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?yf[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:bl,charCode:function(s){return s.type==="keypress"?xa(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?xa(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),_g=Ds(xg),_f=de({},_a,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),bf=Ds(_f),Cf=de({},go,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:bl}),kf=Ds(Cf),bg=de({},Ri,{propertyName:0,elapsedTime:0,pseudoElement:0}),Sf=Ds(bg),Cl=de({},_a,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),Nf=Ds(Cl),Cg=[9,13,27,32],Kc=m&&"CompositionEvent"in window,vo=null;m&&"documentMode"in document&&(vo=document.documentMode);var Ef=m&&"TextEvent"in window&&!vo,Gc=m&&(!Kc||vo&&8<vo&&11>=vo),Qc=" ",Tf=!1;function If(s,i){switch(s){case"keyup":return Cg.indexOf(i.keyCode)!==-1;case"keydown":return i.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function jf(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var yo=!1;function kg(s,i){switch(s){case"compositionend":return jf(i);case"keypress":return i.which!==32?null:(Tf=!0,Qc);case"textInput":return s=i.data,s===Qc&&Tf?null:s;default:return null}}function Sg(s,i){if(yo)return s==="compositionend"||!Kc&&If(s,i)?(s=pf(),gl=Ai=js=null,yo=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(i.ctrlKey||i.altKey||i.metaKey)||i.ctrlKey&&i.altKey){if(i.char&&1<i.char.length)return i.char;if(i.which)return String.fromCharCode(i.which)}return null;case"compositionend":return Gc&&i.locale!=="ko"?null:i.data;default:return null}}var Ng={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Pf(s){var i=s&&s.nodeName&&s.nodeName.toLowerCase();return i==="input"?!!Ng[s.type]:i==="textarea"}function Af(s,i,l,p){vs(p),i=Tl(i,"onChange"),0<i.length&&(l=new yl("onChange","change",null,l,p),s.push({event:l,listeners:i}))}var ba=null,Ca=null;function Rf(s){Xf(s,0)}function kl(s){var i=Co(s);if(nn(i))return s}function Eg(s,i){if(s==="change")return i}var $f=!1;if(m){var Yc;if(m){var Xc="oninput"in document;if(!Xc){var Mf=document.createElement("div");Mf.setAttribute("oninput","return;"),Xc=typeof Mf.oninput=="function"}Yc=Xc}else Yc=!1;$f=Yc&&(!document.documentMode||9<document.documentMode)}function Jc(){ba&&(ba.detachEvent("onpropertychange",Mi),Ca=ba=null)}function Mi(s){if(s.propertyName==="value"&&kl(Ca)){var i=[];Af(i,Ca,s,Tn(s)),K(Rf,i)}}function Of(s,i,l){s==="focusin"?(Jc(),ba=i,Ca=l,ba.attachEvent("onpropertychange",Mi)):s==="focusout"&&Jc()}function Lf(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return kl(Ca)}function Tg(s,i){if(s==="click")return kl(i)}function di(s,i){if(s==="input"||s==="change")return kl(i)}function Ks(s,i){return s===i&&(s!==0||1/s===1/i)||s!==s&&i!==i}var ur=typeof Object.is=="function"?Object.is:Ks;function ka(s,i){if(ur(s,i))return!0;if(typeof s!="object"||s===null||typeof i!="object"||i===null)return!1;var l=Object.keys(s),p=Object.keys(i);if(l.length!==p.length)return!1;for(p=0;p<l.length;p++){var v=l[p];if(!y.call(i,v)||!ur(s[v],i[v]))return!1}return!0}function Df(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function Ff(s,i){var l=Df(s);s=0;for(var p;l;){if(l.nodeType===3){if(p=s+l.textContent.length,s<=i&&p>=i)return{node:l,offset:i-s};s=p}e:{for(;l;){if(l.nextSibling){l=l.nextSibling;break e}l=l.parentNode}l=void 0}l=Df(l)}}function Uf(s,i){return s&&i?s===i?!0:s&&s.nodeType===3?!1:i&&i.nodeType===3?Uf(s,i.parentNode):"contains"in s?s.contains(i):s.compareDocumentPosition?!!(s.compareDocumentPosition(i)&16):!1:!1}function Bf(){for(var s=window,i=hn();i instanceof s.HTMLIFrameElement;){try{var l=typeof i.contentWindow.location.href=="string"}catch{l=!1}if(l)s=i.contentWindow;else break;i=hn(s.document)}return i}function Zc(s){var i=s&&s.nodeName&&s.nodeName.toLowerCase();return i&&(i==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||i==="textarea"||s.contentEditable==="true")}function Ig(s){var i=Bf(),l=s.focusedElem,p=s.selectionRange;if(i!==l&&l&&l.ownerDocument&&Uf(l.ownerDocument.documentElement,l)){if(p!==null&&Zc(l)){if(i=p.start,s=p.end,s===void 0&&(s=i),"selectionStart"in l)l.selectionStart=i,l.selectionEnd=Math.min(s,l.value.length);else if(s=(i=l.ownerDocument||document)&&i.defaultView||window,s.getSelection){s=s.getSelection();var v=l.textContent.length,w=Math.min(p.start,v);p=p.end===void 0?w:Math.min(p.end,v),!s.extend&&w>p&&(v=p,p=w,w=v),v=Ff(l,w);var N=Ff(l,p);v&&N&&(s.rangeCount!==1||s.anchorNode!==v.node||s.anchorOffset!==v.offset||s.focusNode!==N.node||s.focusOffset!==N.offset)&&(i=i.createRange(),i.setStart(v.node,v.offset),s.removeAllRanges(),w>p?(s.addRange(i),s.extend(N.node,N.offset)):(i.setEnd(N.node,N.offset),s.addRange(i)))}}for(i=[],s=l;s=s.parentNode;)s.nodeType===1&&i.push({element:s,left:s.scrollLeft,top:s.scrollTop});for(typeof l.focus=="function"&&l.focus(),l=0;l<i.length;l++)s=i[l],s.element.scrollLeft=s.left,s.element.scrollTop=s.top}}var jg=m&&"documentMode"in document&&11>=document.documentMode,wo=null,eu=null,Sa=null,tu=!1;function zf(s,i,l){var p=l.window===l?l.document:l.nodeType===9?l:l.ownerDocument;tu||wo==null||wo!==hn(p)||(p=wo,"selectionStart"in p&&Zc(p)?p={start:p.selectionStart,end:p.selectionEnd}:(p=(p.ownerDocument&&p.ownerDocument.defaultView||window).getSelection(),p={anchorNode:p.anchorNode,anchorOffset:p.anchorOffset,focusNode:p.focusNode,focusOffset:p.focusOffset}),Sa&&ka(Sa,p)||(Sa=p,p=Tl(eu,"onSelect"),0<p.length&&(i=new yl("onSelect","select",null,i,l),s.push({event:i,listeners:p}),i.target=wo)))}function Sl(s,i){var l={};return l[s.toLowerCase()]=i.toLowerCase(),l["Webkit"+s]="webkit"+i,l["Moz"+s]="moz"+i,l}var xo={animationend:Sl("Animation","AnimationEnd"),animationiteration:Sl("Animation","AnimationIteration"),animationstart:Sl("Animation","AnimationStart"),transitionend:Sl("Transition","TransitionEnd")},nu={},Wf={};m&&(Wf=document.createElement("div").style,"AnimationEvent"in window||(delete xo.animationend.animation,delete xo.animationiteration.animation,delete xo.animationstart.animation),"TransitionEvent"in window||delete xo.transitionend.transition);function Nl(s){if(nu[s])return nu[s];if(!xo[s])return s;var i=xo[s],l;for(l in i)if(i.hasOwnProperty(l)&&l in Wf)return nu[s]=i[l];return s}var qf=Nl("animationend"),Vf=Nl("animationiteration"),Hf=Nl("animationstart"),Kf=Nl("transitionend"),Gf=new Map,Qf="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function fi(s,i){Gf.set(s,i),u(i,[s])}for(var su=0;su<Qf.length;su++){var ru=Qf[su],Pg=ru.toLowerCase(),Ag=ru[0].toUpperCase()+ru.slice(1);fi(Pg,"on"+Ag)}fi(qf,"onAnimationEnd"),fi(Vf,"onAnimationIteration"),fi(Hf,"onAnimationStart"),fi("dblclick","onDoubleClick"),fi("focusin","onFocus"),fi("focusout","onBlur"),fi(Kf,"onTransitionEnd"),h("onMouseEnter",["mouseout","mouseover"]),h("onMouseLeave",["mouseout","mouseover"]),h("onPointerEnter",["pointerout","pointerover"]),h("onPointerLeave",["pointerout","pointerover"]),u("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),u("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),u("onBeforeInput",["compositionend","keypress","textInput","paste"]),u("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Na="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Rg=new Set("cancel close invalid load scroll toggle".split(" ").concat(Na));function Yf(s,i,l){var p=s.type||"unknown-event";s.currentTarget=l,Qe(p,i,void 0,s),s.currentTarget=null}function Xf(s,i){i=(i&4)!==0;for(var l=0;l<s.length;l++){var p=s[l],v=p.event;p=p.listeners;e:{var w=void 0;if(i)for(var N=p.length-1;0<=N;N--){var M=p[N],F=M.instance,Q=M.currentTarget;if(M=M.listener,F!==w&&v.isPropagationStopped())break e;Yf(v,M,Q),w=F}else for(N=0;N<p.length;N++){if(M=p[N],F=M.instance,Q=M.currentTarget,M=M.listener,F!==w&&v.isPropagationStopped())break e;Yf(v,M,Q),w=F}}}if(W)throw s=ie,W=!1,ie=null,s}function mn(s,i){var l=i[fu];l===void 0&&(l=i[fu]=new Set);var p=s+"__bubble";l.has(p)||(Jf(i,s,2,!1),l.add(p))}function iu(s,i,l){var p=0;i&&(p|=4),Jf(l,s,p,i)}var El="_reactListening"+Math.random().toString(36).slice(2);function Ea(s){if(!s[El]){s[El]=!0,r.forEach(function(l){l!=="selectionchange"&&(Rg.has(l)||iu(l,!1,s),iu(l,!0,s))});var i=s.nodeType===9?s:s.ownerDocument;i===null||i[El]||(i[El]=!0,iu("selectionchange",!1,i))}}function Jf(s,i,l,p){switch(tn(i)){case 1:var v=ft;break;case 4:v=pn;break;default:v=en}l=v.bind(null,i,l,s),v=void 0,!Jt||i!=="touchstart"&&i!=="touchmove"&&i!=="wheel"||(v=!0),p?v!==void 0?s.addEventListener(i,l,{capture:!0,passive:v}):s.addEventListener(i,l,!0):v!==void 0?s.addEventListener(i,l,{passive:v}):s.addEventListener(i,l,!1)}function ou(s,i,l,p,v){var w=p;if((i&1)===0&&(i&2)===0&&p!==null)e:for(;;){if(p===null)return;var N=p.tag;if(N===3||N===4){var M=p.stateNode.containerInfo;if(M===v||M.nodeType===8&&M.parentNode===v)break;if(N===4)for(N=p.return;N!==null;){var F=N.tag;if((F===3||F===4)&&(F=N.stateNode.containerInfo,F===v||F.nodeType===8&&F.parentNode===v))return;N=N.return}for(;M!==null;){if(N=Oi(M),N===null)return;if(F=N.tag,F===5||F===6){p=w=N;continue e}M=M.parentNode}}p=p.return}K(function(){var Q=w,ve=Tn(l),be=[];e:{var me=Gf.get(s);if(me!==void 0){var De=yl,Ve=s;switch(s){case"keypress":if(xa(l)===0)break e;case"keydown":case"keyup":De=_g;break;case"focusin":Ve="focus",De=Hc;break;case"focusout":Ve="blur",De=Hc;break;case"beforeblur":case"afterblur":De=Hc;break;case"click":if(l.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":De=Vc;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":De=_l;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":De=kf;break;case qf:case Vf:case Hf:De=mg;break;case Kf:De=Sf;break;case"scroll":De=mf;break;case"wheel":De=Nf;break;case"copy":case"cut":case"paste":De=vg;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":De=bf}var Xe=(i&4)!==0,$n=!Xe&&s==="scroll",f=Xe?me!==null?me+"Capture":null:me;Xe=[];for(var E=Q,H;E!==null;){H=E;var _e=H.stateNode;if(H.tag===5&&_e!==null&&(H=_e,f!==null&&(_e=yn(E,f),_e!=null&&Xe.push(Ta(E,_e,H)))),$n)break;E=E.return}0<Xe.length&&(me=new De(me,Ve,null,l,ve),be.push({event:me,listeners:Xe}))}}if((i&7)===0){e:{if(me=s==="mouseover"||s==="pointerover",De=s==="mouseout"||s==="pointerout",me&&l!==Xt&&(Ve=l.relatedTarget||l.fromElement)&&(Oi(Ve)||Ve[Gr]))break e;if((De||me)&&(me=ve.window===ve?ve:(me=ve.ownerDocument)?me.defaultView||me.parentWindow:window,De?(Ve=l.relatedTarget||l.toElement,De=Q,Ve=Ve?Oi(Ve):null,Ve!==null&&($n=ge(Ve),Ve!==$n||Ve.tag!==5&&Ve.tag!==6)&&(Ve=null)):(De=null,Ve=Q),De!==Ve)){if(Xe=Vc,_e="onMouseLeave",f="onMouseEnter",E="mouse",(s==="pointerout"||s==="pointerover")&&(Xe=bf,_e="onPointerLeave",f="onPointerEnter",E="pointer"),$n=De==null?me:Co(De),H=Ve==null?me:Co(Ve),me=new Xe(_e,E+"leave",De,l,ve),me.target=$n,me.relatedTarget=H,_e=null,Oi(ve)===Q&&(Xe=new Xe(f,E+"enter",Ve,l,ve),Xe.target=H,Xe.relatedTarget=$n,_e=Xe),$n=_e,De&&Ve)t:{for(Xe=De,f=Ve,E=0,H=Xe;H;H=_o(H))E++;for(H=0,_e=f;_e;_e=_o(_e))H++;for(;0<E-H;)Xe=_o(Xe),E--;for(;0<H-E;)f=_o(f),H--;for(;E--;){if(Xe===f||f!==null&&Xe===f.alternate)break t;Xe=_o(Xe),f=_o(f)}Xe=null}else Xe=null;De!==null&&Zf(be,me,De,Xe,!1),Ve!==null&&$n!==null&&Zf(be,$n,Ve,Xe,!0)}}e:{if(me=Q?Co(Q):window,De=me.nodeName&&me.nodeName.toLowerCase(),De==="select"||De==="input"&&me.type==="file")var Je=Eg;else if(Pf(me))if($f)Je=di;else{Je=Lf;var I=Of}else(De=me.nodeName)&&De.toLowerCase()==="input"&&(me.type==="checkbox"||me.type==="radio")&&(Je=Tg);if(Je&&(Je=Je(s,Q))){Af(be,Je,l,ve);break e}I&&I(s,me,Q),s==="focusout"&&(I=me._wrapperState)&&I.controlled&&me.type==="number"&&On(me,"number",me.value)}switch(I=Q?Co(Q):window,s){case"focusin":(Pf(I)||I.contentEditable==="true")&&(wo=I,eu=Q,Sa=null);break;case"focusout":Sa=eu=wo=null;break;case"mousedown":tu=!0;break;case"contextmenu":case"mouseup":case"dragend":tu=!1,zf(be,l,ve);break;case"selectionchange":if(jg)break;case"keydown":case"keyup":zf(be,l,ve)}var rt;if(Kc)e:{switch(s){case"compositionstart":var ht="onCompositionStart";break e;case"compositionend":ht="onCompositionEnd";break e;case"compositionupdate":ht="onCompositionUpdate";break e}ht=void 0}else yo?If(s,l)&&(ht="onCompositionEnd"):s==="keydown"&&l.keyCode===229&&(ht="onCompositionStart");ht&&(Gc&&l.locale!=="ko"&&(yo||ht!=="onCompositionStart"?ht==="onCompositionEnd"&&yo&&(rt=pf()):(js=ve,Ai="value"in js?js.value:js.textContent,yo=!0)),I=Tl(Q,ht),0<I.length&&(ht=new vf(ht,s,null,l,ve),be.push({event:ht,listeners:I}),rt?ht.data=rt:(rt=jf(l),rt!==null&&(ht.data=rt)))),(rt=Ef?kg(s,l):Sg(s,l))&&(Q=Tl(Q,"onBeforeInput"),0<Q.length&&(ve=new vf("onBeforeInput","beforeinput",null,l,ve),be.push({event:ve,listeners:Q}),ve.data=rt))}Xf(be,i)})}function Ta(s,i,l){return{instance:s,listener:i,currentTarget:l}}function Tl(s,i){for(var l=i+"Capture",p=[];s!==null;){var v=s,w=v.stateNode;v.tag===5&&w!==null&&(v=w,w=yn(s,l),w!=null&&p.unshift(Ta(s,w,v)),w=yn(s,i),w!=null&&p.push(Ta(s,w,v))),s=s.return}return p}function _o(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5);return s||null}function Zf(s,i,l,p,v){for(var w=i._reactName,N=[];l!==null&&l!==p;){var M=l,F=M.alternate,Q=M.stateNode;if(F!==null&&F===p)break;M.tag===5&&Q!==null&&(M=Q,v?(F=yn(l,w),F!=null&&N.unshift(Ta(l,F,M))):v||(F=yn(l,w),F!=null&&N.push(Ta(l,F,M)))),l=l.return}N.length!==0&&s.push({event:i,listeners:N})}var $g=/\r\n?/g,Mg=/\u0000|\uFFFD/g;function eh(s){return(typeof s=="string"?s:""+s).replace($g,`
`).replace(Mg,"")}function Il(s,i,l){if(i=eh(i),eh(s)!==i&&l)throw Error(n(425))}function jl(){}var au=null,lu=null;function cu(s,i){return s==="textarea"||s==="noscript"||typeof i.children=="string"||typeof i.children=="number"||typeof i.dangerouslySetInnerHTML=="object"&&i.dangerouslySetInnerHTML!==null&&i.dangerouslySetInnerHTML.__html!=null}var uu=typeof setTimeout=="function"?setTimeout:void 0,Og=typeof clearTimeout=="function"?clearTimeout:void 0,th=typeof Promise=="function"?Promise:void 0,Lg=typeof queueMicrotask=="function"?queueMicrotask:typeof th<"u"?function(s){return th.resolve(null).then(s).catch(Dg)}:uu;function Dg(s){setTimeout(function(){throw s})}function du(s,i){var l=i,p=0;do{var v=l.nextSibling;if(s.removeChild(l),v&&v.nodeType===8)if(l=v.data,l==="/$"){if(p===0){s.removeChild(v),xn(i);return}p--}else l!=="$"&&l!=="$?"&&l!=="$!"||p++;l=v}while(l);xn(i)}function hi(s){for(;s!=null;s=s.nextSibling){var i=s.nodeType;if(i===1||i===3)break;if(i===8){if(i=s.data,i==="$"||i==="$!"||i==="$?")break;if(i==="/$")return null}}return s}function nh(s){s=s.previousSibling;for(var i=0;s;){if(s.nodeType===8){var l=s.data;if(l==="$"||l==="$!"||l==="$?"){if(i===0)return s;i--}else l==="/$"&&i++}s=s.previousSibling}return null}var bo=Math.random().toString(36).slice(2),Mr="__reactFiber$"+bo,Ia="__reactProps$"+bo,Gr="__reactContainer$"+bo,fu="__reactEvents$"+bo,Fg="__reactListeners$"+bo,Ug="__reactHandles$"+bo;function Oi(s){var i=s[Mr];if(i)return i;for(var l=s.parentNode;l;){if(i=l[Gr]||l[Mr]){if(l=i.alternate,i.child!==null||l!==null&&l.child!==null)for(s=nh(s);s!==null;){if(l=s[Mr])return l;s=nh(s)}return i}s=l,l=s.parentNode}return null}function ja(s){return s=s[Mr]||s[Gr],!s||s.tag!==5&&s.tag!==6&&s.tag!==13&&s.tag!==3?null:s}function Co(s){if(s.tag===5||s.tag===6)return s.stateNode;throw Error(n(33))}function Pl(s){return s[Ia]||null}var hu=[],ko=-1;function pi(s){return{current:s}}function gn(s){0>ko||(s.current=hu[ko],hu[ko]=null,ko--)}function un(s,i){ko++,hu[ko]=s.current,s.current=i}var mi={},xs=pi(mi),Fs=pi(!1),Li=mi;function So(s,i){var l=s.type.contextTypes;if(!l)return mi;var p=s.stateNode;if(p&&p.__reactInternalMemoizedUnmaskedChildContext===i)return p.__reactInternalMemoizedMaskedChildContext;var v={},w;for(w in l)v[w]=i[w];return p&&(s=s.stateNode,s.__reactInternalMemoizedUnmaskedChildContext=i,s.__reactInternalMemoizedMaskedChildContext=v),v}function Us(s){return s=s.childContextTypes,s!=null}function Al(){gn(Fs),gn(xs)}function sh(s,i,l){if(xs.current!==mi)throw Error(n(168));un(xs,i),un(Fs,l)}function rh(s,i,l){var p=s.stateNode;if(i=i.childContextTypes,typeof p.getChildContext!="function")return l;p=p.getChildContext();for(var v in p)if(!(v in i))throw Error(n(108,Ue(s)||"Unknown",v));return de({},l,p)}function Rl(s){return s=(s=s.stateNode)&&s.__reactInternalMemoizedMergedChildContext||mi,Li=xs.current,un(xs,s),un(Fs,Fs.current),!0}function ih(s,i,l){var p=s.stateNode;if(!p)throw Error(n(169));l?(s=rh(s,i,Li),p.__reactInternalMemoizedMergedChildContext=s,gn(Fs),gn(xs),un(xs,s)):gn(Fs),un(Fs,l)}var Qr=null,$l=!1,pu=!1;function oh(s){Qr===null?Qr=[s]:Qr.push(s)}function Bg(s){$l=!0,oh(s)}function gi(){if(!pu&&Qr!==null){pu=!0;var s=0,i=Mt;try{var l=Qr;for(Mt=1;s<l.length;s++){var p=l[s];do p=p(!0);while(p!==null)}Qr=null,$l=!1}catch(v){throw Qr!==null&&(Qr=Qr.slice(s+1)),ut(wn,gi),v}finally{Mt=i,pu=!1}}return null}var No=[],Eo=0,Ml=null,Ol=0,dr=[],fr=0,Di=null,Yr=1,Xr="";function Fi(s,i){No[Eo++]=Ol,No[Eo++]=Ml,Ml=s,Ol=i}function ah(s,i,l){dr[fr++]=Yr,dr[fr++]=Xr,dr[fr++]=Di,Di=s;var p=Yr;s=Xr;var v=32-z(p)-1;p&=~(1<<v),l+=1;var w=32-z(i)+v;if(30<w){var N=v-v%5;w=(p&(1<<N)-1).toString(32),p>>=N,v-=N,Yr=1<<32-z(i)+v|l<<v|p,Xr=w+s}else Yr=1<<w|l<<v|p,Xr=s}function mu(s){s.return!==null&&(Fi(s,1),ah(s,1,0))}function gu(s){for(;s===Ml;)Ml=No[--Eo],No[Eo]=null,Ol=No[--Eo],No[Eo]=null;for(;s===Di;)Di=dr[--fr],dr[fr]=null,Xr=dr[--fr],dr[fr]=null,Yr=dr[--fr],dr[fr]=null}var Gs=null,Qs=null,_n=!1,Nr=null;function lh(s,i){var l=vr(5,null,null,0);l.elementType="DELETED",l.stateNode=i,l.return=s,i=s.deletions,i===null?(s.deletions=[l],s.flags|=16):i.push(l)}function ch(s,i){switch(s.tag){case 5:var l=s.type;return i=i.nodeType!==1||l.toLowerCase()!==i.nodeName.toLowerCase()?null:i,i!==null?(s.stateNode=i,Gs=s,Qs=hi(i.firstChild),!0):!1;case 6:return i=s.pendingProps===""||i.nodeType!==3?null:i,i!==null?(s.stateNode=i,Gs=s,Qs=null,!0):!1;case 13:return i=i.nodeType!==8?null:i,i!==null?(l=Di!==null?{id:Yr,overflow:Xr}:null,s.memoizedState={dehydrated:i,treeContext:l,retryLane:1073741824},l=vr(18,null,null,0),l.stateNode=i,l.return=s,s.child=l,Gs=s,Qs=null,!0):!1;default:return!1}}function vu(s){return(s.mode&1)!==0&&(s.flags&128)===0}function yu(s){if(_n){var i=Qs;if(i){var l=i;if(!ch(s,i)){if(vu(s))throw Error(n(418));i=hi(l.nextSibling);var p=Gs;i&&ch(s,i)?lh(p,l):(s.flags=s.flags&-4097|2,_n=!1,Gs=s)}}else{if(vu(s))throw Error(n(418));s.flags=s.flags&-4097|2,_n=!1,Gs=s}}}function uh(s){for(s=s.return;s!==null&&s.tag!==5&&s.tag!==3&&s.tag!==13;)s=s.return;Gs=s}function Ll(s){if(s!==Gs)return!1;if(!_n)return uh(s),_n=!0,!1;var i;if((i=s.tag!==3)&&!(i=s.tag!==5)&&(i=s.type,i=i!=="head"&&i!=="body"&&!cu(s.type,s.memoizedProps)),i&&(i=Qs)){if(vu(s))throw dh(),Error(n(418));for(;i;)lh(s,i),i=hi(i.nextSibling)}if(uh(s),s.tag===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(n(317));e:{for(s=s.nextSibling,i=0;s;){if(s.nodeType===8){var l=s.data;if(l==="/$"){if(i===0){Qs=hi(s.nextSibling);break e}i--}else l!=="$"&&l!=="$!"&&l!=="$?"||i++}s=s.nextSibling}Qs=null}}else Qs=Gs?hi(s.stateNode.nextSibling):null;return!0}function dh(){for(var s=Qs;s;)s=hi(s.nextSibling)}function To(){Qs=Gs=null,_n=!1}function wu(s){Nr===null?Nr=[s]:Nr.push(s)}var zg=le.ReactCurrentBatchConfig;function Pa(s,i,l){if(s=l.ref,s!==null&&typeof s!="function"&&typeof s!="object"){if(l._owner){if(l=l._owner,l){if(l.tag!==1)throw Error(n(309));var p=l.stateNode}if(!p)throw Error(n(147,s));var v=p,w=""+s;return i!==null&&i.ref!==null&&typeof i.ref=="function"&&i.ref._stringRef===w?i.ref:(i=function(N){var M=v.refs;N===null?delete M[w]:M[w]=N},i._stringRef=w,i)}if(typeof s!="string")throw Error(n(284));if(!l._owner)throw Error(n(290,s))}return s}function Dl(s,i){throw s=Object.prototype.toString.call(i),Error(n(31,s==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":s))}function fh(s){var i=s._init;return i(s._payload)}function hh(s){function i(f,E){if(s){var H=f.deletions;H===null?(f.deletions=[E],f.flags|=16):H.push(E)}}function l(f,E){if(!s)return null;for(;E!==null;)i(f,E),E=E.sibling;return null}function p(f,E){for(f=new Map;E!==null;)E.key!==null?f.set(E.key,E):f.set(E.index,E),E=E.sibling;return f}function v(f,E){return f=Ni(f,E),f.index=0,f.sibling=null,f}function w(f,E,H){return f.index=H,s?(H=f.alternate,H!==null?(H=H.index,H<E?(f.flags|=2,E):H):(f.flags|=2,E)):(f.flags|=1048576,E)}function N(f){return s&&f.alternate===null&&(f.flags|=2),f}function M(f,E,H,_e){return E===null||E.tag!==6?(E=ud(H,f.mode,_e),E.return=f,E):(E=v(E,H),E.return=f,E)}function F(f,E,H,_e){var Je=H.type;return Je===xe?ve(f,E,H.props.children,_e,H.key):E!==null&&(E.elementType===Je||typeof Je=="object"&&Je!==null&&Je.$$typeof===$e&&fh(Je)===E.type)?(_e=v(E,H.props),_e.ref=Pa(f,E,H),_e.return=f,_e):(_e=ic(H.type,H.key,H.props,null,f.mode,_e),_e.ref=Pa(f,E,H),_e.return=f,_e)}function Q(f,E,H,_e){return E===null||E.tag!==4||E.stateNode.containerInfo!==H.containerInfo||E.stateNode.implementation!==H.implementation?(E=dd(H,f.mode,_e),E.return=f,E):(E=v(E,H.children||[]),E.return=f,E)}function ve(f,E,H,_e,Je){return E===null||E.tag!==7?(E=Hi(H,f.mode,_e,Je),E.return=f,E):(E=v(E,H),E.return=f,E)}function be(f,E,H){if(typeof E=="string"&&E!==""||typeof E=="number")return E=ud(""+E,f.mode,H),E.return=f,E;if(typeof E=="object"&&E!==null){switch(E.$$typeof){case c:return H=ic(E.type,E.key,E.props,null,f.mode,H),H.ref=Pa(f,null,E),H.return=f,H;case re:return E=dd(E,f.mode,H),E.return=f,E;case $e:var _e=E._init;return be(f,_e(E._payload),H)}if(sn(E)||Se(E))return E=Hi(E,f.mode,H,null),E.return=f,E;Dl(f,E)}return null}function me(f,E,H,_e){var Je=E!==null?E.key:null;if(typeof H=="string"&&H!==""||typeof H=="number")return Je!==null?null:M(f,E,""+H,_e);if(typeof H=="object"&&H!==null){switch(H.$$typeof){case c:return H.key===Je?F(f,E,H,_e):null;case re:return H.key===Je?Q(f,E,H,_e):null;case $e:return Je=H._init,me(f,E,Je(H._payload),_e)}if(sn(H)||Se(H))return Je!==null?null:ve(f,E,H,_e,null);Dl(f,H)}return null}function De(f,E,H,_e,Je){if(typeof _e=="string"&&_e!==""||typeof _e=="number")return f=f.get(H)||null,M(E,f,""+_e,Je);if(typeof _e=="object"&&_e!==null){switch(_e.$$typeof){case c:return f=f.get(_e.key===null?H:_e.key)||null,F(E,f,_e,Je);case re:return f=f.get(_e.key===null?H:_e.key)||null,Q(E,f,_e,Je);case $e:var I=_e._init;return De(f,E,H,I(_e._payload),Je)}if(sn(_e)||Se(_e))return f=f.get(H)||null,ve(E,f,_e,Je,null);Dl(E,_e)}return null}function Ve(f,E,H,_e){for(var Je=null,I=null,rt=E,ht=E=0,L=null;rt!==null&&ht<H.length;ht++){rt.index>ht?(L=rt,rt=null):L=rt.sibling;var wt=me(f,rt,H[ht],_e);if(wt===null){rt===null&&(rt=L);break}s&&rt&&wt.alternate===null&&i(f,rt),E=w(wt,E,ht),I===null?Je=wt:I.sibling=wt,I=wt,rt=L}if(ht===H.length)return l(f,rt),_n&&Fi(f,ht),Je;if(rt===null){for(;ht<H.length;ht++)rt=be(f,H[ht],_e),rt!==null&&(E=w(rt,E,ht),I===null?Je=rt:I.sibling=rt,I=rt);return _n&&Fi(f,ht),Je}for(rt=p(f,rt);ht<H.length;ht++)L=De(rt,f,ht,H[ht],_e),L!==null&&(s&&L.alternate!==null&&rt.delete(L.key===null?ht:L.key),E=w(L,E,ht),I===null?Je=L:I.sibling=L,I=L);return s&&rt.forEach(function(Ei){return i(f,Ei)}),_n&&Fi(f,ht),Je}function Xe(f,E,H,_e){var Je=Se(H);if(typeof Je!="function")throw Error(n(150));if(H=Je.call(H),H==null)throw Error(n(151));for(var I=Je=null,rt=E,ht=E=0,L=null,wt=H.next();rt!==null&&!wt.done;ht++,wt=H.next()){rt.index>ht?(L=rt,rt=null):L=rt.sibling;var Ei=me(f,rt,wt.value,_e);if(Ei===null){rt===null&&(rt=L);break}s&&rt&&Ei.alternate===null&&i(f,rt),E=w(Ei,E,ht),I===null?Je=Ei:I.sibling=Ei,I=Ei,rt=L}if(wt.done)return l(f,rt),_n&&Fi(f,ht),Je;if(rt===null){for(;!wt.done;ht++,wt=H.next())wt=be(f,wt.value,_e),wt!==null&&(E=w(wt,E,ht),I===null?Je=wt:I.sibling=wt,I=wt);return _n&&Fi(f,ht),Je}for(rt=p(f,rt);!wt.done;ht++,wt=H.next())wt=De(rt,f,ht,wt.value,_e),wt!==null&&(s&&wt.alternate!==null&&rt.delete(wt.key===null?ht:wt.key),E=w(wt,E,ht),I===null?Je=wt:I.sibling=wt,I=wt);return s&&rt.forEach(function(wv){return i(f,wv)}),_n&&Fi(f,ht),Je}function $n(f,E,H,_e){if(typeof H=="object"&&H!==null&&H.type===xe&&H.key===null&&(H=H.props.children),typeof H=="object"&&H!==null){switch(H.$$typeof){case c:e:{for(var Je=H.key,I=E;I!==null;){if(I.key===Je){if(Je=H.type,Je===xe){if(I.tag===7){l(f,I.sibling),E=v(I,H.props.children),E.return=f,f=E;break e}}else if(I.elementType===Je||typeof Je=="object"&&Je!==null&&Je.$$typeof===$e&&fh(Je)===I.type){l(f,I.sibling),E=v(I,H.props),E.ref=Pa(f,I,H),E.return=f,f=E;break e}l(f,I);break}else i(f,I);I=I.sibling}H.type===xe?(E=Hi(H.props.children,f.mode,_e,H.key),E.return=f,f=E):(_e=ic(H.type,H.key,H.props,null,f.mode,_e),_e.ref=Pa(f,E,H),_e.return=f,f=_e)}return N(f);case re:e:{for(I=H.key;E!==null;){if(E.key===I)if(E.tag===4&&E.stateNode.containerInfo===H.containerInfo&&E.stateNode.implementation===H.implementation){l(f,E.sibling),E=v(E,H.children||[]),E.return=f,f=E;break e}else{l(f,E);break}else i(f,E);E=E.sibling}E=dd(H,f.mode,_e),E.return=f,f=E}return N(f);case $e:return I=H._init,$n(f,E,I(H._payload),_e)}if(sn(H))return Ve(f,E,H,_e);if(Se(H))return Xe(f,E,H,_e);Dl(f,H)}return typeof H=="string"&&H!==""||typeof H=="number"?(H=""+H,E!==null&&E.tag===6?(l(f,E.sibling),E=v(E,H),E.return=f,f=E):(l(f,E),E=ud(H,f.mode,_e),E.return=f,f=E),N(f)):l(f,E)}return $n}var Io=hh(!0),ph=hh(!1),Fl=pi(null),Ul=null,jo=null,xu=null;function _u(){xu=jo=Ul=null}function bu(s){var i=Fl.current;gn(Fl),s._currentValue=i}function Cu(s,i,l){for(;s!==null;){var p=s.alternate;if((s.childLanes&i)!==i?(s.childLanes|=i,p!==null&&(p.childLanes|=i)):p!==null&&(p.childLanes&i)!==i&&(p.childLanes|=i),s===l)break;s=s.return}}function Po(s,i){Ul=s,xu=jo=null,s=s.dependencies,s!==null&&s.firstContext!==null&&((s.lanes&i)!==0&&(Bs=!0),s.firstContext=null)}function hr(s){var i=s._currentValue;if(xu!==s)if(s={context:s,memoizedValue:i,next:null},jo===null){if(Ul===null)throw Error(n(308));jo=s,Ul.dependencies={lanes:0,firstContext:s}}else jo=jo.next=s;return i}var Ui=null;function ku(s){Ui===null?Ui=[s]:Ui.push(s)}function mh(s,i,l,p){var v=i.interleaved;return v===null?(l.next=l,ku(i)):(l.next=v.next,v.next=l),i.interleaved=l,Jr(s,p)}function Jr(s,i){s.lanes|=i;var l=s.alternate;for(l!==null&&(l.lanes|=i),l=s,s=s.return;s!==null;)s.childLanes|=i,l=s.alternate,l!==null&&(l.childLanes|=i),l=s,s=s.return;return l.tag===3?l.stateNode:null}var vi=!1;function Su(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function gh(s,i){s=s.updateQueue,i.updateQueue===s&&(i.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,effects:s.effects})}function Or(s,i){return{eventTime:s,lane:i,tag:0,payload:null,callback:null,next:null}}function Ys(s,i,l){var p=s.updateQueue;if(p===null)return null;if(p=p.shared,(Ut&2)!==0){var v=p.pending;return v===null?i.next=i:(i.next=v.next,v.next=i),p.pending=i,Jr(s,l)}return v=p.interleaved,v===null?(i.next=i,ku(p)):(i.next=v.next,v.next=i),p.interleaved=i,Jr(s,l)}function Aa(s,i,l){if(i=i.updateQueue,i!==null&&(i=i.shared,(l&4194240)!==0)){var p=i.lanes;p&=s.pendingLanes,l|=p,i.lanes=l,Cr(s,l)}}function Nu(s,i){var l=s.updateQueue,p=s.alternate;if(p!==null&&(p=p.updateQueue,l===p)){var v=null,w=null;if(l=l.firstBaseUpdate,l!==null){do{var N={eventTime:l.eventTime,lane:l.lane,tag:l.tag,payload:l.payload,callback:l.callback,next:null};w===null?v=w=N:w=w.next=N,l=l.next}while(l!==null);w===null?v=w=i:w=w.next=i}else v=w=i;l={baseState:p.baseState,firstBaseUpdate:v,lastBaseUpdate:w,shared:p.shared,effects:p.effects},s.updateQueue=l;return}s=l.lastBaseUpdate,s===null?l.firstBaseUpdate=i:s.next=i,l.lastBaseUpdate=i}function Bi(s,i,l,p){var v=s.updateQueue;vi=!1;var w=v.firstBaseUpdate,N=v.lastBaseUpdate,M=v.shared.pending;if(M!==null){v.shared.pending=null;var F=M,Q=F.next;F.next=null,N===null?w=Q:N.next=Q,N=F;var ve=s.alternate;ve!==null&&(ve=ve.updateQueue,M=ve.lastBaseUpdate,M!==N&&(M===null?ve.firstBaseUpdate=Q:M.next=Q,ve.lastBaseUpdate=F))}if(w!==null){var be=v.baseState;N=0,ve=Q=F=null,M=w;do{var me=M.lane,De=M.eventTime;if((p&me)===me){ve!==null&&(ve=ve.next={eventTime:De,lane:0,tag:M.tag,payload:M.payload,callback:M.callback,next:null});e:{var Ve=s,Xe=M;switch(me=i,De=l,Xe.tag){case 1:if(Ve=Xe.payload,typeof Ve=="function"){be=Ve.call(De,be,me);break e}be=Ve;break e;case 3:Ve.flags=Ve.flags&-65537|128;case 0:if(Ve=Xe.payload,me=typeof Ve=="function"?Ve.call(De,be,me):Ve,me==null)break e;be=de({},be,me);break e;case 2:vi=!0}}M.callback!==null&&M.lane!==0&&(s.flags|=64,me=v.effects,me===null?v.effects=[M]:me.push(M))}else De={eventTime:De,lane:me,tag:M.tag,payload:M.payload,callback:M.callback,next:null},ve===null?(Q=ve=De,F=be):ve=ve.next=De,N|=me;if(M=M.next,M===null){if(M=v.shared.pending,M===null)break;me=M,M=me.next,me.next=null,v.lastBaseUpdate=me,v.shared.pending=null}}while(!0);if(ve===null&&(F=be),v.baseState=F,v.firstBaseUpdate=Q,v.lastBaseUpdate=ve,i=v.shared.interleaved,i!==null){v=i;do N|=v.lane,v=v.next;while(v!==i)}else w===null&&(v.shared.lanes=0);qi|=N,s.lanes=N,s.memoizedState=be}}function vh(s,i,l){if(s=i.effects,i.effects=null,s!==null)for(i=0;i<s.length;i++){var p=s[i],v=p.callback;if(v!==null){if(p.callback=null,p=l,typeof v!="function")throw Error(n(191,v));v.call(p)}}}var Ao={},os=pi(Ao),yi=pi(Ao),as=pi(Ao);function pr(s){if(s===Ao)throw Error(n(174));return s}function Ra(s,i){switch(un(as,i),un(yi,s),un(os,Ao),s=i.nodeType,s){case 9:case 11:i=(i=i.documentElement)?i.namespaceURI:cn(null,"");break;default:s=s===8?i.parentNode:i,i=s.namespaceURI||null,s=s.tagName,i=cn(i,s)}gn(os),un(os,i)}function zi(){gn(os),gn(yi),gn(as)}function yh(s){pr(as.current);var i=pr(os.current),l=cn(i,s.type);i!==l&&(un(yi,s),un(os,l))}function Eu(s){yi.current===s&&(gn(os),gn(yi))}var bn=pi(0);function Ro(s){for(var i=s;i!==null;){if(i.tag===13){var l=i.memoizedState;if(l!==null&&(l=l.dehydrated,l===null||l.data==="$?"||l.data==="$!"))return i}else if(i.tag===19&&i.memoizedProps.revealOrder!==void 0){if((i.flags&128)!==0)return i}else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===s)break;for(;i.sibling===null;){if(i.return===null||i.return===s)return null;i=i.return}i.sibling.return=i.return,i=i.sibling}return null}var $a=[];function Bl(){for(var s=0;s<$a.length;s++)$a[s]._workInProgressVersionPrimary=null;$a.length=0}var zl=le.ReactCurrentDispatcher,Tu=le.ReactCurrentBatchConfig,Wi=0,vn=null,Gn=null,Jn=null,$o=!1,Ma=!1,Oa=0,wh=0;function ls(){throw Error(n(321))}function Wl(s,i){if(i===null)return!1;for(var l=0;l<i.length&&l<s.length;l++)if(!ur(s[l],i[l]))return!1;return!0}function Mo(s,i,l,p,v,w){if(Wi=w,vn=i,i.memoizedState=null,i.updateQueue=null,i.lanes=0,zl.current=s===null||s.memoizedState===null?Hg:Kg,s=l(p,v),Ma){w=0;do{if(Ma=!1,Oa=0,25<=w)throw Error(n(301));w+=1,Jn=Gn=null,i.updateQueue=null,zl.current=Gg,s=l(p,v)}while(Ma)}if(zl.current=Vl,i=Gn!==null&&Gn.next!==null,Wi=0,Jn=Gn=vn=null,$o=!1,i)throw Error(n(300));return s}function Iu(){var s=Oa!==0;return Oa=0,s}function Lr(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Jn===null?vn.memoizedState=Jn=s:Jn=Jn.next=s,Jn}function mr(){if(Gn===null){var s=vn.alternate;s=s!==null?s.memoizedState:null}else s=Gn.next;var i=Jn===null?vn.memoizedState:Jn.next;if(i!==null)Jn=i,Gn=s;else{if(s===null)throw Error(n(310));Gn=s,s={memoizedState:Gn.memoizedState,baseState:Gn.baseState,baseQueue:Gn.baseQueue,queue:Gn.queue,next:null},Jn===null?vn.memoizedState=Jn=s:Jn=Jn.next=s}return Jn}function La(s,i){return typeof i=="function"?i(s):i}function ju(s){var i=mr(),l=i.queue;if(l===null)throw Error(n(311));l.lastRenderedReducer=s;var p=Gn,v=p.baseQueue,w=l.pending;if(w!==null){if(v!==null){var N=v.next;v.next=w.next,w.next=N}p.baseQueue=v=w,l.pending=null}if(v!==null){w=v.next,p=p.baseState;var M=N=null,F=null,Q=w;do{var ve=Q.lane;if((Wi&ve)===ve)F!==null&&(F=F.next={lane:0,action:Q.action,hasEagerState:Q.hasEagerState,eagerState:Q.eagerState,next:null}),p=Q.hasEagerState?Q.eagerState:s(p,Q.action);else{var be={lane:ve,action:Q.action,hasEagerState:Q.hasEagerState,eagerState:Q.eagerState,next:null};F===null?(M=F=be,N=p):F=F.next=be,vn.lanes|=ve,qi|=ve}Q=Q.next}while(Q!==null&&Q!==w);F===null?N=p:F.next=M,ur(p,i.memoizedState)||(Bs=!0),i.memoizedState=p,i.baseState=N,i.baseQueue=F,l.lastRenderedState=p}if(s=l.interleaved,s!==null){v=s;do w=v.lane,vn.lanes|=w,qi|=w,v=v.next;while(v!==s)}else v===null&&(l.lanes=0);return[i.memoizedState,l.dispatch]}function Pu(s){var i=mr(),l=i.queue;if(l===null)throw Error(n(311));l.lastRenderedReducer=s;var p=l.dispatch,v=l.pending,w=i.memoizedState;if(v!==null){l.pending=null;var N=v=v.next;do w=s(w,N.action),N=N.next;while(N!==v);ur(w,i.memoizedState)||(Bs=!0),i.memoizedState=w,i.baseQueue===null&&(i.baseState=w),l.lastRenderedState=w}return[w,p]}function xh(){}function _h(s,i){var l=vn,p=mr(),v=i(),w=!ur(p.memoizedState,v);if(w&&(p.memoizedState=v,Bs=!0),p=p.queue,Au(kh.bind(null,l,p,s),[s]),p.getSnapshot!==i||w||Jn!==null&&Jn.memoizedState.tag&1){if(l.flags|=2048,Da(9,Ch.bind(null,l,p,v,i),void 0,null),Zn===null)throw Error(n(349));(Wi&30)!==0||bh(l,i,v)}return v}function bh(s,i,l){s.flags|=16384,s={getSnapshot:i,value:l},i=vn.updateQueue,i===null?(i={lastEffect:null,stores:null},vn.updateQueue=i,i.stores=[s]):(l=i.stores,l===null?i.stores=[s]:l.push(s))}function Ch(s,i,l,p){i.value=l,i.getSnapshot=p,Sh(i)&&Nh(s)}function kh(s,i,l){return l(function(){Sh(i)&&Nh(s)})}function Sh(s){var i=s.getSnapshot;s=s.value;try{var l=i();return!ur(s,l)}catch{return!0}}function Nh(s){var i=Jr(s,1);i!==null&&jr(i,s,1,-1)}function Eh(s){var i=Lr();return typeof s=="function"&&(s=s()),i.memoizedState=i.baseState=s,s={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:La,lastRenderedState:s},i.queue=s,s=s.dispatch=Vg.bind(null,vn,s),[i.memoizedState,s]}function Da(s,i,l,p){return s={tag:s,create:i,destroy:l,deps:p,next:null},i=vn.updateQueue,i===null?(i={lastEffect:null,stores:null},vn.updateQueue=i,i.lastEffect=s.next=s):(l=i.lastEffect,l===null?i.lastEffect=s.next=s:(p=l.next,l.next=s,s.next=p,i.lastEffect=s)),s}function Th(){return mr().memoizedState}function Fa(s,i,l,p){var v=Lr();vn.flags|=s,v.memoizedState=Da(1|i,l,void 0,p===void 0?null:p)}function ql(s,i,l,p){var v=mr();p=p===void 0?null:p;var w=void 0;if(Gn!==null){var N=Gn.memoizedState;if(w=N.destroy,p!==null&&Wl(p,N.deps)){v.memoizedState=Da(i,l,w,p);return}}vn.flags|=s,v.memoizedState=Da(1|i,l,w,p)}function Ih(s,i){return Fa(8390656,8,s,i)}function Au(s,i){return ql(2048,8,s,i)}function jh(s,i){return ql(4,2,s,i)}function Ph(s,i){return ql(4,4,s,i)}function Ru(s,i){if(typeof i=="function")return s=s(),i(s),function(){i(null)};if(i!=null)return s=s(),i.current=s,function(){i.current=null}}function Ah(s,i,l){return l=l!=null?l.concat([s]):null,ql(4,4,Ru.bind(null,i,s),l)}function $u(){}function Rh(s,i){var l=mr();i=i===void 0?null:i;var p=l.memoizedState;return p!==null&&i!==null&&Wl(i,p[1])?p[0]:(l.memoizedState=[s,i],s)}function $h(s,i){var l=mr();i=i===void 0?null:i;var p=l.memoizedState;return p!==null&&i!==null&&Wl(i,p[1])?p[0]:(s=s(),l.memoizedState=[s,i],s)}function Mh(s,i,l){return(Wi&21)===0?(s.baseState&&(s.baseState=!1,Bs=!0),s.memoizedState=l):(ur(l,i)||(l=zt(),vn.lanes|=l,qi|=l,s.baseState=!0),i)}function Wg(s,i){var l=Mt;Mt=l!==0&&4>l?l:4,s(!0);var p=Tu.transition;Tu.transition={};try{s(!1),i()}finally{Mt=l,Tu.transition=p}}function Oh(){return mr().memoizedState}function qg(s,i,l){var p=bi(s);if(l={lane:p,action:l,hasEagerState:!1,eagerState:null,next:null},Lh(s))Dh(i,l);else if(l=mh(s,i,l,p),l!==null){var v=Ps();jr(l,s,p,v),Fh(l,i,p)}}function Vg(s,i,l){var p=bi(s),v={lane:p,action:l,hasEagerState:!1,eagerState:null,next:null};if(Lh(s))Dh(i,v);else{var w=s.alternate;if(s.lanes===0&&(w===null||w.lanes===0)&&(w=i.lastRenderedReducer,w!==null))try{var N=i.lastRenderedState,M=w(N,l);if(v.hasEagerState=!0,v.eagerState=M,ur(M,N)){var F=i.interleaved;F===null?(v.next=v,ku(i)):(v.next=F.next,F.next=v),i.interleaved=v;return}}catch{}finally{}l=mh(s,i,v,p),l!==null&&(v=Ps(),jr(l,s,p,v),Fh(l,i,p))}}function Lh(s){var i=s.alternate;return s===vn||i!==null&&i===vn}function Dh(s,i){Ma=$o=!0;var l=s.pending;l===null?i.next=i:(i.next=l.next,l.next=i),s.pending=i}function Fh(s,i,l){if((l&4194240)!==0){var p=i.lanes;p&=s.pendingLanes,l|=p,i.lanes=l,Cr(s,l)}}var Vl={readContext:hr,useCallback:ls,useContext:ls,useEffect:ls,useImperativeHandle:ls,useInsertionEffect:ls,useLayoutEffect:ls,useMemo:ls,useReducer:ls,useRef:ls,useState:ls,useDebugValue:ls,useDeferredValue:ls,useTransition:ls,useMutableSource:ls,useSyncExternalStore:ls,useId:ls,unstable_isNewReconciler:!1},Hg={readContext:hr,useCallback:function(s,i){return Lr().memoizedState=[s,i===void 0?null:i],s},useContext:hr,useEffect:Ih,useImperativeHandle:function(s,i,l){return l=l!=null?l.concat([s]):null,Fa(4194308,4,Ru.bind(null,i,s),l)},useLayoutEffect:function(s,i){return Fa(4194308,4,s,i)},useInsertionEffect:function(s,i){return Fa(4,2,s,i)},useMemo:function(s,i){var l=Lr();return i=i===void 0?null:i,s=s(),l.memoizedState=[s,i],s},useReducer:function(s,i,l){var p=Lr();return i=l!==void 0?l(i):i,p.memoizedState=p.baseState=i,s={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:i},p.queue=s,s=s.dispatch=qg.bind(null,vn,s),[p.memoizedState,s]},useRef:function(s){var i=Lr();return s={current:s},i.memoizedState=s},useState:Eh,useDebugValue:$u,useDeferredValue:function(s){return Lr().memoizedState=s},useTransition:function(){var s=Eh(!1),i=s[0];return s=Wg.bind(null,s[1]),Lr().memoizedState=s,[i,s]},useMutableSource:function(){},useSyncExternalStore:function(s,i,l){var p=vn,v=Lr();if(_n){if(l===void 0)throw Error(n(407));l=l()}else{if(l=i(),Zn===null)throw Error(n(349));(Wi&30)!==0||bh(p,i,l)}v.memoizedState=l;var w={value:l,getSnapshot:i};return v.queue=w,Ih(kh.bind(null,p,w,s),[s]),p.flags|=2048,Da(9,Ch.bind(null,p,w,l,i),void 0,null),l},useId:function(){var s=Lr(),i=Zn.identifierPrefix;if(_n){var l=Xr,p=Yr;l=(p&~(1<<32-z(p)-1)).toString(32)+l,i=":"+i+"R"+l,l=Oa++,0<l&&(i+="H"+l.toString(32)),i+=":"}else l=wh++,i=":"+i+"r"+l.toString(32)+":";return s.memoizedState=i},unstable_isNewReconciler:!1},Kg={readContext:hr,useCallback:Rh,useContext:hr,useEffect:Au,useImperativeHandle:Ah,useInsertionEffect:jh,useLayoutEffect:Ph,useMemo:$h,useReducer:ju,useRef:Th,useState:function(){return ju(La)},useDebugValue:$u,useDeferredValue:function(s){var i=mr();return Mh(i,Gn.memoizedState,s)},useTransition:function(){var s=ju(La)[0],i=mr().memoizedState;return[s,i]},useMutableSource:xh,useSyncExternalStore:_h,useId:Oh,unstable_isNewReconciler:!1},Gg={readContext:hr,useCallback:Rh,useContext:hr,useEffect:Au,useImperativeHandle:Ah,useInsertionEffect:jh,useLayoutEffect:Ph,useMemo:$h,useReducer:Pu,useRef:Th,useState:function(){return Pu(La)},useDebugValue:$u,useDeferredValue:function(s){var i=mr();return Gn===null?i.memoizedState=s:Mh(i,Gn.memoizedState,s)},useTransition:function(){var s=Pu(La)[0],i=mr().memoizedState;return[s,i]},useMutableSource:xh,useSyncExternalStore:_h,useId:Oh,unstable_isNewReconciler:!1};function Er(s,i){if(s&&s.defaultProps){i=de({},i),s=s.defaultProps;for(var l in s)i[l]===void 0&&(i[l]=s[l]);return i}return i}function Mu(s,i,l,p){i=s.memoizedState,l=l(p,i),l=l==null?i:de({},i,l),s.memoizedState=l,s.lanes===0&&(s.updateQueue.baseState=l)}var Hl={isMounted:function(s){return(s=s._reactInternals)?ge(s)===s:!1},enqueueSetState:function(s,i,l){s=s._reactInternals;var p=Ps(),v=bi(s),w=Or(p,v);w.payload=i,l!=null&&(w.callback=l),i=Ys(s,w,v),i!==null&&(jr(i,s,v,p),Aa(i,s,v))},enqueueReplaceState:function(s,i,l){s=s._reactInternals;var p=Ps(),v=bi(s),w=Or(p,v);w.tag=1,w.payload=i,l!=null&&(w.callback=l),i=Ys(s,w,v),i!==null&&(jr(i,s,v,p),Aa(i,s,v))},enqueueForceUpdate:function(s,i){s=s._reactInternals;var l=Ps(),p=bi(s),v=Or(l,p);v.tag=2,i!=null&&(v.callback=i),i=Ys(s,v,p),i!==null&&(jr(i,s,p,l),Aa(i,s,p))}};function Uh(s,i,l,p,v,w,N){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(p,w,N):i.prototype&&i.prototype.isPureReactComponent?!ka(l,p)||!ka(v,w):!0}function Bh(s,i,l){var p=!1,v=mi,w=i.contextType;return typeof w=="object"&&w!==null?w=hr(w):(v=Us(i)?Li:xs.current,p=i.contextTypes,w=(p=p!=null)?So(s,v):mi),i=new i(l,w),s.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,i.updater=Hl,s.stateNode=i,i._reactInternals=s,p&&(s=s.stateNode,s.__reactInternalMemoizedUnmaskedChildContext=v,s.__reactInternalMemoizedMaskedChildContext=w),i}function zh(s,i,l,p){s=i.state,typeof i.componentWillReceiveProps=="function"&&i.componentWillReceiveProps(l,p),typeof i.UNSAFE_componentWillReceiveProps=="function"&&i.UNSAFE_componentWillReceiveProps(l,p),i.state!==s&&Hl.enqueueReplaceState(i,i.state,null)}function Ou(s,i,l,p){var v=s.stateNode;v.props=l,v.state=s.memoizedState,v.refs={},Su(s);var w=i.contextType;typeof w=="object"&&w!==null?v.context=hr(w):(w=Us(i)?Li:xs.current,v.context=So(s,w)),v.state=s.memoizedState,w=i.getDerivedStateFromProps,typeof w=="function"&&(Mu(s,i,w,l),v.state=s.memoizedState),typeof i.getDerivedStateFromProps=="function"||typeof v.getSnapshotBeforeUpdate=="function"||typeof v.UNSAFE_componentWillMount!="function"&&typeof v.componentWillMount!="function"||(i=v.state,typeof v.componentWillMount=="function"&&v.componentWillMount(),typeof v.UNSAFE_componentWillMount=="function"&&v.UNSAFE_componentWillMount(),i!==v.state&&Hl.enqueueReplaceState(v,v.state,null),Bi(s,l,v,p),v.state=s.memoizedState),typeof v.componentDidMount=="function"&&(s.flags|=4194308)}function Oo(s,i){try{var l="",p=i;do l+=G(p),p=p.return;while(p);var v=l}catch(w){v=`
Error generating stack: `+w.message+`
`+w.stack}return{value:s,source:i,stack:v,digest:null}}function Lu(s,i,l){return{value:s,source:null,stack:l??null,digest:i??null}}function Du(s,i){try{console.error(i.value)}catch(l){setTimeout(function(){throw l})}}var Qg=typeof WeakMap=="function"?WeakMap:Map;function Wh(s,i,l){l=Or(-1,l),l.tag=3,l.payload={element:null};var p=i.value;return l.callback=function(){Zl||(Zl=!0,td=p),Du(s,i)},l}function qh(s,i,l){l=Or(-1,l),l.tag=3;var p=s.type.getDerivedStateFromError;if(typeof p=="function"){var v=i.value;l.payload=function(){return p(v)},l.callback=function(){Du(s,i)}}var w=s.stateNode;return w!==null&&typeof w.componentDidCatch=="function"&&(l.callback=function(){Du(s,i),typeof p!="function"&&(xi===null?xi=new Set([this]):xi.add(this));var N=i.stack;this.componentDidCatch(i.value,{componentStack:N!==null?N:""})}),l}function Fu(s,i,l){var p=s.pingCache;if(p===null){p=s.pingCache=new Qg;var v=new Set;p.set(i,v)}else v=p.get(i),v===void 0&&(v=new Set,p.set(i,v));v.has(l)||(v.add(l),s=lv.bind(null,s,i,l),i.then(s,s))}function Uu(s){do{var i;if((i=s.tag===13)&&(i=s.memoizedState,i=i!==null?i.dehydrated!==null:!0),i)return s;s=s.return}while(s!==null);return null}function Vh(s,i,l,p,v){return(s.mode&1)===0?(s===i?s.flags|=65536:(s.flags|=128,l.flags|=131072,l.flags&=-52805,l.tag===1&&(l.alternate===null?l.tag=17:(i=Or(-1,1),i.tag=2,Ys(l,i,1))),l.lanes|=1),s):(s.flags|=65536,s.lanes=v,s)}var Yg=le.ReactCurrentOwner,Bs=!1;function _s(s,i,l,p){i.child=s===null?ph(i,null,l,p):Io(i,s.child,l,p)}function Hh(s,i,l,p,v){l=l.render;var w=i.ref;return Po(i,v),p=Mo(s,i,l,p,w,v),l=Iu(),s!==null&&!Bs?(i.updateQueue=s.updateQueue,i.flags&=-2053,s.lanes&=~v,Zr(s,i,v)):(_n&&l&&mu(i),i.flags|=1,_s(s,i,p,v),i.child)}function Kh(s,i,l,p,v){if(s===null){var w=l.type;return typeof w=="function"&&!cd(w)&&w.defaultProps===void 0&&l.compare===null&&l.defaultProps===void 0?(i.tag=15,i.type=w,Gh(s,i,w,p,v)):(s=ic(l.type,null,p,i,i.mode,v),s.ref=i.ref,s.return=i,i.child=s)}if(w=s.child,(s.lanes&v)===0){var N=w.memoizedProps;if(l=l.compare,l=l!==null?l:ka,l(N,p)&&s.ref===i.ref)return Zr(s,i,v)}return i.flags|=1,s=Ni(w,p),s.ref=i.ref,s.return=i,i.child=s}function Gh(s,i,l,p,v){if(s!==null){var w=s.memoizedProps;if(ka(w,p)&&s.ref===i.ref)if(Bs=!1,i.pendingProps=p=w,(s.lanes&v)!==0)(s.flags&131072)!==0&&(Bs=!0);else return i.lanes=s.lanes,Zr(s,i,v)}return Bu(s,i,l,p,v)}function Qh(s,i,l){var p=i.pendingProps,v=p.children,w=s!==null?s.memoizedState:null;if(p.mode==="hidden")if((i.mode&1)===0)i.memoizedState={baseLanes:0,cachePool:null,transitions:null},un(Do,Xs),Xs|=l;else{if((l&1073741824)===0)return s=w!==null?w.baseLanes|l:l,i.lanes=i.childLanes=1073741824,i.memoizedState={baseLanes:s,cachePool:null,transitions:null},i.updateQueue=null,un(Do,Xs),Xs|=s,null;i.memoizedState={baseLanes:0,cachePool:null,transitions:null},p=w!==null?w.baseLanes:l,un(Do,Xs),Xs|=p}else w!==null?(p=w.baseLanes|l,i.memoizedState=null):p=l,un(Do,Xs),Xs|=p;return _s(s,i,v,l),i.child}function Yh(s,i){var l=i.ref;(s===null&&l!==null||s!==null&&s.ref!==l)&&(i.flags|=512,i.flags|=2097152)}function Bu(s,i,l,p,v){var w=Us(l)?Li:xs.current;return w=So(i,w),Po(i,v),l=Mo(s,i,l,p,w,v),p=Iu(),s!==null&&!Bs?(i.updateQueue=s.updateQueue,i.flags&=-2053,s.lanes&=~v,Zr(s,i,v)):(_n&&p&&mu(i),i.flags|=1,_s(s,i,l,v),i.child)}function Xh(s,i,l,p,v){if(Us(l)){var w=!0;Rl(i)}else w=!1;if(Po(i,v),i.stateNode===null)Gl(s,i),Bh(i,l,p),Ou(i,l,p,v),p=!0;else if(s===null){var N=i.stateNode,M=i.memoizedProps;N.props=M;var F=N.context,Q=l.contextType;typeof Q=="object"&&Q!==null?Q=hr(Q):(Q=Us(l)?Li:xs.current,Q=So(i,Q));var ve=l.getDerivedStateFromProps,be=typeof ve=="function"||typeof N.getSnapshotBeforeUpdate=="function";be||typeof N.UNSAFE_componentWillReceiveProps!="function"&&typeof N.componentWillReceiveProps!="function"||(M!==p||F!==Q)&&zh(i,N,p,Q),vi=!1;var me=i.memoizedState;N.state=me,Bi(i,p,N,v),F=i.memoizedState,M!==p||me!==F||Fs.current||vi?(typeof ve=="function"&&(Mu(i,l,ve,p),F=i.memoizedState),(M=vi||Uh(i,l,M,p,me,F,Q))?(be||typeof N.UNSAFE_componentWillMount!="function"&&typeof N.componentWillMount!="function"||(typeof N.componentWillMount=="function"&&N.componentWillMount(),typeof N.UNSAFE_componentWillMount=="function"&&N.UNSAFE_componentWillMount()),typeof N.componentDidMount=="function"&&(i.flags|=4194308)):(typeof N.componentDidMount=="function"&&(i.flags|=4194308),i.memoizedProps=p,i.memoizedState=F),N.props=p,N.state=F,N.context=Q,p=M):(typeof N.componentDidMount=="function"&&(i.flags|=4194308),p=!1)}else{N=i.stateNode,gh(s,i),M=i.memoizedProps,Q=i.type===i.elementType?M:Er(i.type,M),N.props=Q,be=i.pendingProps,me=N.context,F=l.contextType,typeof F=="object"&&F!==null?F=hr(F):(F=Us(l)?Li:xs.current,F=So(i,F));var De=l.getDerivedStateFromProps;(ve=typeof De=="function"||typeof N.getSnapshotBeforeUpdate=="function")||typeof N.UNSAFE_componentWillReceiveProps!="function"&&typeof N.componentWillReceiveProps!="function"||(M!==be||me!==F)&&zh(i,N,p,F),vi=!1,me=i.memoizedState,N.state=me,Bi(i,p,N,v);var Ve=i.memoizedState;M!==be||me!==Ve||Fs.current||vi?(typeof De=="function"&&(Mu(i,l,De,p),Ve=i.memoizedState),(Q=vi||Uh(i,l,Q,p,me,Ve,F)||!1)?(ve||typeof N.UNSAFE_componentWillUpdate!="function"&&typeof N.componentWillUpdate!="function"||(typeof N.componentWillUpdate=="function"&&N.componentWillUpdate(p,Ve,F),typeof N.UNSAFE_componentWillUpdate=="function"&&N.UNSAFE_componentWillUpdate(p,Ve,F)),typeof N.componentDidUpdate=="function"&&(i.flags|=4),typeof N.getSnapshotBeforeUpdate=="function"&&(i.flags|=1024)):(typeof N.componentDidUpdate!="function"||M===s.memoizedProps&&me===s.memoizedState||(i.flags|=4),typeof N.getSnapshotBeforeUpdate!="function"||M===s.memoizedProps&&me===s.memoizedState||(i.flags|=1024),i.memoizedProps=p,i.memoizedState=Ve),N.props=p,N.state=Ve,N.context=F,p=Q):(typeof N.componentDidUpdate!="function"||M===s.memoizedProps&&me===s.memoizedState||(i.flags|=4),typeof N.getSnapshotBeforeUpdate!="function"||M===s.memoizedProps&&me===s.memoizedState||(i.flags|=1024),p=!1)}return zu(s,i,l,p,w,v)}function zu(s,i,l,p,v,w){Yh(s,i);var N=(i.flags&128)!==0;if(!p&&!N)return v&&ih(i,l,!1),Zr(s,i,w);p=i.stateNode,Yg.current=i;var M=N&&typeof l.getDerivedStateFromError!="function"?null:p.render();return i.flags|=1,s!==null&&N?(i.child=Io(i,s.child,null,w),i.child=Io(i,null,M,w)):_s(s,i,M,w),i.memoizedState=p.state,v&&ih(i,l,!0),i.child}function Jh(s){var i=s.stateNode;i.pendingContext?sh(s,i.pendingContext,i.pendingContext!==i.context):i.context&&sh(s,i.context,!1),Ra(s,i.containerInfo)}function Zh(s,i,l,p,v){return To(),wu(v),i.flags|=256,_s(s,i,l,p),i.child}var Wu={dehydrated:null,treeContext:null,retryLane:0};function qu(s){return{baseLanes:s,cachePool:null,transitions:null}}function ep(s,i,l){var p=i.pendingProps,v=bn.current,w=!1,N=(i.flags&128)!==0,M;if((M=N)||(M=s!==null&&s.memoizedState===null?!1:(v&2)!==0),M?(w=!0,i.flags&=-129):(s===null||s.memoizedState!==null)&&(v|=1),un(bn,v&1),s===null)return yu(i),s=i.memoizedState,s!==null&&(s=s.dehydrated,s!==null)?((i.mode&1)===0?i.lanes=1:s.data==="$!"?i.lanes=8:i.lanes=1073741824,null):(N=p.children,s=p.fallback,w?(p=i.mode,w=i.child,N={mode:"hidden",children:N},(p&1)===0&&w!==null?(w.childLanes=0,w.pendingProps=N):w=oc(N,p,0,null),s=Hi(s,p,l,null),w.return=i,s.return=i,w.sibling=s,i.child=w,i.child.memoizedState=qu(l),i.memoizedState=Wu,s):Vu(i,N));if(v=s.memoizedState,v!==null&&(M=v.dehydrated,M!==null))return Xg(s,i,N,p,M,v,l);if(w){w=p.fallback,N=i.mode,v=s.child,M=v.sibling;var F={mode:"hidden",children:p.children};return(N&1)===0&&i.child!==v?(p=i.child,p.childLanes=0,p.pendingProps=F,i.deletions=null):(p=Ni(v,F),p.subtreeFlags=v.subtreeFlags&14680064),M!==null?w=Ni(M,w):(w=Hi(w,N,l,null),w.flags|=2),w.return=i,p.return=i,p.sibling=w,i.child=p,p=w,w=i.child,N=s.child.memoizedState,N=N===null?qu(l):{baseLanes:N.baseLanes|l,cachePool:null,transitions:N.transitions},w.memoizedState=N,w.childLanes=s.childLanes&~l,i.memoizedState=Wu,p}return w=s.child,s=w.sibling,p=Ni(w,{mode:"visible",children:p.children}),(i.mode&1)===0&&(p.lanes=l),p.return=i,p.sibling=null,s!==null&&(l=i.deletions,l===null?(i.deletions=[s],i.flags|=16):l.push(s)),i.child=p,i.memoizedState=null,p}function Vu(s,i){return i=oc({mode:"visible",children:i},s.mode,0,null),i.return=s,s.child=i}function Kl(s,i,l,p){return p!==null&&wu(p),Io(i,s.child,null,l),s=Vu(i,i.pendingProps.children),s.flags|=2,i.memoizedState=null,s}function Xg(s,i,l,p,v,w,N){if(l)return i.flags&256?(i.flags&=-257,p=Lu(Error(n(422))),Kl(s,i,N,p)):i.memoizedState!==null?(i.child=s.child,i.flags|=128,null):(w=p.fallback,v=i.mode,p=oc({mode:"visible",children:p.children},v,0,null),w=Hi(w,v,N,null),w.flags|=2,p.return=i,w.return=i,p.sibling=w,i.child=p,(i.mode&1)!==0&&Io(i,s.child,null,N),i.child.memoizedState=qu(N),i.memoizedState=Wu,w);if((i.mode&1)===0)return Kl(s,i,N,null);if(v.data==="$!"){if(p=v.nextSibling&&v.nextSibling.dataset,p)var M=p.dgst;return p=M,w=Error(n(419)),p=Lu(w,p,void 0),Kl(s,i,N,p)}if(M=(N&s.childLanes)!==0,Bs||M){if(p=Zn,p!==null){switch(N&-N){case 4:v=2;break;case 16:v=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:v=32;break;case 536870912:v=268435456;break;default:v=0}v=(v&(p.suspendedLanes|N))!==0?0:v,v!==0&&v!==w.retryLane&&(w.retryLane=v,Jr(s,v),jr(p,s,v,-1))}return ld(),p=Lu(Error(n(421))),Kl(s,i,N,p)}return v.data==="$?"?(i.flags|=128,i.child=s.child,i=cv.bind(null,s),v._reactRetry=i,null):(s=w.treeContext,Qs=hi(v.nextSibling),Gs=i,_n=!0,Nr=null,s!==null&&(dr[fr++]=Yr,dr[fr++]=Xr,dr[fr++]=Di,Yr=s.id,Xr=s.overflow,Di=i),i=Vu(i,p.children),i.flags|=4096,i)}function tp(s,i,l){s.lanes|=i;var p=s.alternate;p!==null&&(p.lanes|=i),Cu(s.return,i,l)}function Hu(s,i,l,p,v){var w=s.memoizedState;w===null?s.memoizedState={isBackwards:i,rendering:null,renderingStartTime:0,last:p,tail:l,tailMode:v}:(w.isBackwards=i,w.rendering=null,w.renderingStartTime=0,w.last=p,w.tail=l,w.tailMode=v)}function np(s,i,l){var p=i.pendingProps,v=p.revealOrder,w=p.tail;if(_s(s,i,p.children,l),p=bn.current,(p&2)!==0)p=p&1|2,i.flags|=128;else{if(s!==null&&(s.flags&128)!==0)e:for(s=i.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&tp(s,l,i);else if(s.tag===19)tp(s,l,i);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===i)break e;for(;s.sibling===null;){if(s.return===null||s.return===i)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}p&=1}if(un(bn,p),(i.mode&1)===0)i.memoizedState=null;else switch(v){case"forwards":for(l=i.child,v=null;l!==null;)s=l.alternate,s!==null&&Ro(s)===null&&(v=l),l=l.sibling;l=v,l===null?(v=i.child,i.child=null):(v=l.sibling,l.sibling=null),Hu(i,!1,v,l,w);break;case"backwards":for(l=null,v=i.child,i.child=null;v!==null;){if(s=v.alternate,s!==null&&Ro(s)===null){i.child=v;break}s=v.sibling,v.sibling=l,l=v,v=s}Hu(i,!0,l,null,w);break;case"together":Hu(i,!1,null,null,void 0);break;default:i.memoizedState=null}return i.child}function Gl(s,i){(i.mode&1)===0&&s!==null&&(s.alternate=null,i.alternate=null,i.flags|=2)}function Zr(s,i,l){if(s!==null&&(i.dependencies=s.dependencies),qi|=i.lanes,(l&i.childLanes)===0)return null;if(s!==null&&i.child!==s.child)throw Error(n(153));if(i.child!==null){for(s=i.child,l=Ni(s,s.pendingProps),i.child=l,l.return=i;s.sibling!==null;)s=s.sibling,l=l.sibling=Ni(s,s.pendingProps),l.return=i;l.sibling=null}return i.child}function Jg(s,i,l){switch(i.tag){case 3:Jh(i),To();break;case 5:yh(i);break;case 1:Us(i.type)&&Rl(i);break;case 4:Ra(i,i.stateNode.containerInfo);break;case 10:var p=i.type._context,v=i.memoizedProps.value;un(Fl,p._currentValue),p._currentValue=v;break;case 13:if(p=i.memoizedState,p!==null)return p.dehydrated!==null?(un(bn,bn.current&1),i.flags|=128,null):(l&i.child.childLanes)!==0?ep(s,i,l):(un(bn,bn.current&1),s=Zr(s,i,l),s!==null?s.sibling:null);un(bn,bn.current&1);break;case 19:if(p=(l&i.childLanes)!==0,(s.flags&128)!==0){if(p)return np(s,i,l);i.flags|=128}if(v=i.memoizedState,v!==null&&(v.rendering=null,v.tail=null,v.lastEffect=null),un(bn,bn.current),p)break;return null;case 22:case 23:return i.lanes=0,Qh(s,i,l)}return Zr(s,i,l)}var sp,Ku,rp,ip;sp=function(s,i){for(var l=i.child;l!==null;){if(l.tag===5||l.tag===6)s.appendChild(l.stateNode);else if(l.tag!==4&&l.child!==null){l.child.return=l,l=l.child;continue}if(l===i)break;for(;l.sibling===null;){if(l.return===null||l.return===i)return;l=l.return}l.sibling.return=l.return,l=l.sibling}},Ku=function(){},rp=function(s,i,l,p){var v=s.memoizedProps;if(v!==p){s=i.stateNode,pr(os.current);var w=null;switch(l){case"input":v=Dt(s,v),p=Dt(s,p),w=[];break;case"select":v=de({},v,{value:void 0}),p=de({},p,{value:void 0}),w=[];break;case"textarea":v=ln(s,v),p=ln(s,p),w=[];break;default:typeof v.onClick!="function"&&typeof p.onClick=="function"&&(s.onclick=jl)}Yt(l,p);var N;l=null;for(Q in v)if(!p.hasOwnProperty(Q)&&v.hasOwnProperty(Q)&&v[Q]!=null)if(Q==="style"){var M=v[Q];for(N in M)M.hasOwnProperty(N)&&(l||(l={}),l[N]="")}else Q!=="dangerouslySetInnerHTML"&&Q!=="children"&&Q!=="suppressContentEditableWarning"&&Q!=="suppressHydrationWarning"&&Q!=="autoFocus"&&(a.hasOwnProperty(Q)?w||(w=[]):(w=w||[]).push(Q,null));for(Q in p){var F=p[Q];if(M=v?.[Q],p.hasOwnProperty(Q)&&F!==M&&(F!=null||M!=null))if(Q==="style")if(M){for(N in M)!M.hasOwnProperty(N)||F&&F.hasOwnProperty(N)||(l||(l={}),l[N]="");for(N in F)F.hasOwnProperty(N)&&M[N]!==F[N]&&(l||(l={}),l[N]=F[N])}else l||(w||(w=[]),w.push(Q,l)),l=F;else Q==="dangerouslySetInnerHTML"?(F=F?F.__html:void 0,M=M?M.__html:void 0,F!=null&&M!==F&&(w=w||[]).push(Q,F)):Q==="children"?typeof F!="string"&&typeof F!="number"||(w=w||[]).push(Q,""+F):Q!=="suppressContentEditableWarning"&&Q!=="suppressHydrationWarning"&&(a.hasOwnProperty(Q)?(F!=null&&Q==="onScroll"&&mn("scroll",s),w||M===F||(w=[])):(w=w||[]).push(Q,F))}l&&(w=w||[]).push("style",l);var Q=w;(i.updateQueue=Q)&&(i.flags|=4)}},ip=function(s,i,l,p){l!==p&&(i.flags|=4)};function Ua(s,i){if(!_n)switch(s.tailMode){case"hidden":i=s.tail;for(var l=null;i!==null;)i.alternate!==null&&(l=i),i=i.sibling;l===null?s.tail=null:l.sibling=null;break;case"collapsed":l=s.tail;for(var p=null;l!==null;)l.alternate!==null&&(p=l),l=l.sibling;p===null?i||s.tail===null?s.tail=null:s.tail.sibling=null:p.sibling=null}}function bs(s){var i=s.alternate!==null&&s.alternate.child===s.child,l=0,p=0;if(i)for(var v=s.child;v!==null;)l|=v.lanes|v.childLanes,p|=v.subtreeFlags&14680064,p|=v.flags&14680064,v.return=s,v=v.sibling;else for(v=s.child;v!==null;)l|=v.lanes|v.childLanes,p|=v.subtreeFlags,p|=v.flags,v.return=s,v=v.sibling;return s.subtreeFlags|=p,s.childLanes=l,i}function Zg(s,i,l){var p=i.pendingProps;switch(gu(i),i.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return bs(i),null;case 1:return Us(i.type)&&Al(),bs(i),null;case 3:return p=i.stateNode,zi(),gn(Fs),gn(xs),Bl(),p.pendingContext&&(p.context=p.pendingContext,p.pendingContext=null),(s===null||s.child===null)&&(Ll(i)?i.flags|=4:s===null||s.memoizedState.isDehydrated&&(i.flags&256)===0||(i.flags|=1024,Nr!==null&&(sd(Nr),Nr=null))),Ku(s,i),bs(i),null;case 5:Eu(i);var v=pr(as.current);if(l=i.type,s!==null&&i.stateNode!=null)rp(s,i,l,p,v),s.ref!==i.ref&&(i.flags|=512,i.flags|=2097152);else{if(!p){if(i.stateNode===null)throw Error(n(166));return bs(i),null}if(s=pr(os.current),Ll(i)){p=i.stateNode,l=i.type;var w=i.memoizedProps;switch(p[Mr]=i,p[Ia]=w,s=(i.mode&1)!==0,l){case"dialog":mn("cancel",p),mn("close",p);break;case"iframe":case"object":case"embed":mn("load",p);break;case"video":case"audio":for(v=0;v<Na.length;v++)mn(Na[v],p);break;case"source":mn("error",p);break;case"img":case"image":case"link":mn("error",p),mn("load",p);break;case"details":mn("toggle",p);break;case"input":Mn(p,w),mn("invalid",p);break;case"select":p._wrapperState={wasMultiple:!!w.multiple},mn("invalid",p);break;case"textarea":zn(p,w),mn("invalid",p)}Yt(l,w),v=null;for(var N in w)if(w.hasOwnProperty(N)){var M=w[N];N==="children"?typeof M=="string"?p.textContent!==M&&(w.suppressHydrationWarning!==!0&&Il(p.textContent,M,s),v=["children",M]):typeof M=="number"&&p.textContent!==""+M&&(w.suppressHydrationWarning!==!0&&Il(p.textContent,M,s),v=["children",""+M]):a.hasOwnProperty(N)&&M!=null&&N==="onScroll"&&mn("scroll",p)}switch(l){case"input":bt(p),Wt(p,w,!0);break;case"textarea":bt(p),Ts(p);break;case"select":case"option":break;default:typeof w.onClick=="function"&&(p.onclick=jl)}p=v,i.updateQueue=p,p!==null&&(i.flags|=4)}else{N=v.nodeType===9?v:v.ownerDocument,s==="http://www.w3.org/1999/xhtml"&&(s=qn(l)),s==="http://www.w3.org/1999/xhtml"?l==="script"?(s=N.createElement("div"),s.innerHTML="<script><\/script>",s=s.removeChild(s.firstChild)):typeof p.is=="string"?s=N.createElement(l,{is:p.is}):(s=N.createElement(l),l==="select"&&(N=s,p.multiple?N.multiple=!0:p.size&&(N.size=p.size))):s=N.createElementNS(s,l),s[Mr]=i,s[Ia]=p,sp(s,i,!1,!1),i.stateNode=s;e:{switch(N=Qt(l,p),l){case"dialog":mn("cancel",s),mn("close",s),v=p;break;case"iframe":case"object":case"embed":mn("load",s),v=p;break;case"video":case"audio":for(v=0;v<Na.length;v++)mn(Na[v],s);v=p;break;case"source":mn("error",s),v=p;break;case"img":case"image":case"link":mn("error",s),mn("load",s),v=p;break;case"details":mn("toggle",s),v=p;break;case"input":Mn(s,p),v=Dt(s,p),mn("invalid",s);break;case"option":v=p;break;case"select":s._wrapperState={wasMultiple:!!p.multiple},v=de({},p,{value:void 0}),mn("invalid",s);break;case"textarea":zn(s,p),v=ln(s,p),mn("invalid",s);break;default:v=p}Yt(l,v),M=v;for(w in M)if(M.hasOwnProperty(w)){var F=M[w];w==="style"?Lt(s,F):w==="dangerouslySetInnerHTML"?(F=F?F.__html:void 0,F!=null&&ns(s,F)):w==="children"?typeof F=="string"?(l!=="textarea"||F!=="")&&ne(s,F):typeof F=="number"&&ne(s,""+F):w!=="suppressContentEditableWarning"&&w!=="suppressHydrationWarning"&&w!=="autoFocus"&&(a.hasOwnProperty(w)?F!=null&&w==="onScroll"&&mn("scroll",s):F!=null&&C(s,w,F,N))}switch(l){case"input":bt(s),Wt(s,p,!1);break;case"textarea":bt(s),Ts(s);break;case"option":p.value!=null&&s.setAttribute("value",""+qe(p.value));break;case"select":s.multiple=!!p.multiple,w=p.value,w!=null?qt(s,!!p.multiple,w,!1):p.defaultValue!=null&&qt(s,!!p.multiple,p.defaultValue,!0);break;default:typeof v.onClick=="function"&&(s.onclick=jl)}switch(l){case"button":case"input":case"select":case"textarea":p=!!p.autoFocus;break e;case"img":p=!0;break e;default:p=!1}}p&&(i.flags|=4)}i.ref!==null&&(i.flags|=512,i.flags|=2097152)}return bs(i),null;case 6:if(s&&i.stateNode!=null)ip(s,i,s.memoizedProps,p);else{if(typeof p!="string"&&i.stateNode===null)throw Error(n(166));if(l=pr(as.current),pr(os.current),Ll(i)){if(p=i.stateNode,l=i.memoizedProps,p[Mr]=i,(w=p.nodeValue!==l)&&(s=Gs,s!==null))switch(s.tag){case 3:Il(p.nodeValue,l,(s.mode&1)!==0);break;case 5:s.memoizedProps.suppressHydrationWarning!==!0&&Il(p.nodeValue,l,(s.mode&1)!==0)}w&&(i.flags|=4)}else p=(l.nodeType===9?l:l.ownerDocument).createTextNode(p),p[Mr]=i,i.stateNode=p}return bs(i),null;case 13:if(gn(bn),p=i.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(_n&&Qs!==null&&(i.mode&1)!==0&&(i.flags&128)===0)dh(),To(),i.flags|=98560,w=!1;else if(w=Ll(i),p!==null&&p.dehydrated!==null){if(s===null){if(!w)throw Error(n(318));if(w=i.memoizedState,w=w!==null?w.dehydrated:null,!w)throw Error(n(317));w[Mr]=i}else To(),(i.flags&128)===0&&(i.memoizedState=null),i.flags|=4;bs(i),w=!1}else Nr!==null&&(sd(Nr),Nr=null),w=!0;if(!w)return i.flags&65536?i:null}return(i.flags&128)!==0?(i.lanes=l,i):(p=p!==null,p!==(s!==null&&s.memoizedState!==null)&&p&&(i.child.flags|=8192,(i.mode&1)!==0&&(s===null||(bn.current&1)!==0?Qn===0&&(Qn=3):ld())),i.updateQueue!==null&&(i.flags|=4),bs(i),null);case 4:return zi(),Ku(s,i),s===null&&Ea(i.stateNode.containerInfo),bs(i),null;case 10:return bu(i.type._context),bs(i),null;case 17:return Us(i.type)&&Al(),bs(i),null;case 19:if(gn(bn),w=i.memoizedState,w===null)return bs(i),null;if(p=(i.flags&128)!==0,N=w.rendering,N===null)if(p)Ua(w,!1);else{if(Qn!==0||s!==null&&(s.flags&128)!==0)for(s=i.child;s!==null;){if(N=Ro(s),N!==null){for(i.flags|=128,Ua(w,!1),p=N.updateQueue,p!==null&&(i.updateQueue=p,i.flags|=4),i.subtreeFlags=0,p=l,l=i.child;l!==null;)w=l,s=p,w.flags&=14680066,N=w.alternate,N===null?(w.childLanes=0,w.lanes=s,w.child=null,w.subtreeFlags=0,w.memoizedProps=null,w.memoizedState=null,w.updateQueue=null,w.dependencies=null,w.stateNode=null):(w.childLanes=N.childLanes,w.lanes=N.lanes,w.child=N.child,w.subtreeFlags=0,w.deletions=null,w.memoizedProps=N.memoizedProps,w.memoizedState=N.memoizedState,w.updateQueue=N.updateQueue,w.type=N.type,s=N.dependencies,w.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),l=l.sibling;return un(bn,bn.current&1|2),i.child}s=s.sibling}w.tail!==null&&$t()>Fo&&(i.flags|=128,p=!0,Ua(w,!1),i.lanes=4194304)}else{if(!p)if(s=Ro(N),s!==null){if(i.flags|=128,p=!0,l=s.updateQueue,l!==null&&(i.updateQueue=l,i.flags|=4),Ua(w,!0),w.tail===null&&w.tailMode==="hidden"&&!N.alternate&&!_n)return bs(i),null}else 2*$t()-w.renderingStartTime>Fo&&l!==1073741824&&(i.flags|=128,p=!0,Ua(w,!1),i.lanes=4194304);w.isBackwards?(N.sibling=i.child,i.child=N):(l=w.last,l!==null?l.sibling=N:i.child=N,w.last=N)}return w.tail!==null?(i=w.tail,w.rendering=i,w.tail=i.sibling,w.renderingStartTime=$t(),i.sibling=null,l=bn.current,un(bn,p?l&1|2:l&1),i):(bs(i),null);case 22:case 23:return od(),p=i.memoizedState!==null,s!==null&&s.memoizedState!==null!==p&&(i.flags|=8192),p&&(i.mode&1)!==0?(Xs&1073741824)!==0&&(bs(i),i.subtreeFlags&6&&(i.flags|=8192)):bs(i),null;case 24:return null;case 25:return null}throw Error(n(156,i.tag))}function ev(s,i){switch(gu(i),i.tag){case 1:return Us(i.type)&&Al(),s=i.flags,s&65536?(i.flags=s&-65537|128,i):null;case 3:return zi(),gn(Fs),gn(xs),Bl(),s=i.flags,(s&65536)!==0&&(s&128)===0?(i.flags=s&-65537|128,i):null;case 5:return Eu(i),null;case 13:if(gn(bn),s=i.memoizedState,s!==null&&s.dehydrated!==null){if(i.alternate===null)throw Error(n(340));To()}return s=i.flags,s&65536?(i.flags=s&-65537|128,i):null;case 19:return gn(bn),null;case 4:return zi(),null;case 10:return bu(i.type._context),null;case 22:case 23:return od(),null;case 24:return null;default:return null}}var Ql=!1,Cs=!1,tv=typeof WeakSet=="function"?WeakSet:Set,ze=null;function Lo(s,i){var l=s.ref;if(l!==null)if(typeof l=="function")try{l(null)}catch(p){Pn(s,i,p)}else l.current=null}function Gu(s,i,l){try{l()}catch(p){Pn(s,i,p)}}var op=!1;function nv(s,i){if(au=Fn,s=Bf(),Zc(s)){if("selectionStart"in s)var l={start:s.selectionStart,end:s.selectionEnd};else e:{l=(l=s.ownerDocument)&&l.defaultView||window;var p=l.getSelection&&l.getSelection();if(p&&p.rangeCount!==0){l=p.anchorNode;var v=p.anchorOffset,w=p.focusNode;p=p.focusOffset;try{l.nodeType,w.nodeType}catch{l=null;break e}var N=0,M=-1,F=-1,Q=0,ve=0,be=s,me=null;t:for(;;){for(var De;be!==l||v!==0&&be.nodeType!==3||(M=N+v),be!==w||p!==0&&be.nodeType!==3||(F=N+p),be.nodeType===3&&(N+=be.nodeValue.length),(De=be.firstChild)!==null;)me=be,be=De;for(;;){if(be===s)break t;if(me===l&&++Q===v&&(M=N),me===w&&++ve===p&&(F=N),(De=be.nextSibling)!==null)break;be=me,me=be.parentNode}be=De}l=M===-1||F===-1?null:{start:M,end:F}}else l=null}l=l||{start:0,end:0}}else l=null;for(lu={focusedElem:s,selectionRange:l},Fn=!1,ze=i;ze!==null;)if(i=ze,s=i.child,(i.subtreeFlags&1028)!==0&&s!==null)s.return=i,ze=s;else for(;ze!==null;){i=ze;try{var Ve=i.alternate;if((i.flags&1024)!==0)switch(i.tag){case 0:case 11:case 15:break;case 1:if(Ve!==null){var Xe=Ve.memoizedProps,$n=Ve.memoizedState,f=i.stateNode,E=f.getSnapshotBeforeUpdate(i.elementType===i.type?Xe:Er(i.type,Xe),$n);f.__reactInternalSnapshotBeforeUpdate=E}break;case 3:var H=i.stateNode.containerInfo;H.nodeType===1?H.textContent="":H.nodeType===9&&H.documentElement&&H.removeChild(H.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(n(163))}}catch(_e){Pn(i,i.return,_e)}if(s=i.sibling,s!==null){s.return=i.return,ze=s;break}ze=i.return}return Ve=op,op=!1,Ve}function Ba(s,i,l){var p=i.updateQueue;if(p=p!==null?p.lastEffect:null,p!==null){var v=p=p.next;do{if((v.tag&s)===s){var w=v.destroy;v.destroy=void 0,w!==void 0&&Gu(i,l,w)}v=v.next}while(v!==p)}}function Yl(s,i){if(i=i.updateQueue,i=i!==null?i.lastEffect:null,i!==null){var l=i=i.next;do{if((l.tag&s)===s){var p=l.create;l.destroy=p()}l=l.next}while(l!==i)}}function Qu(s){var i=s.ref;if(i!==null){var l=s.stateNode;switch(s.tag){case 5:s=l;break;default:s=l}typeof i=="function"?i(s):i.current=s}}function ap(s){var i=s.alternate;i!==null&&(s.alternate=null,ap(i)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(i=s.stateNode,i!==null&&(delete i[Mr],delete i[Ia],delete i[fu],delete i[Fg],delete i[Ug])),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}function lp(s){return s.tag===5||s.tag===3||s.tag===4}function cp(s){e:for(;;){for(;s.sibling===null;){if(s.return===null||lp(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.flags&2||s.child===null||s.tag===4)continue e;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function Yu(s,i,l){var p=s.tag;if(p===5||p===6)s=s.stateNode,i?l.nodeType===8?l.parentNode.insertBefore(s,i):l.insertBefore(s,i):(l.nodeType===8?(i=l.parentNode,i.insertBefore(s,l)):(i=l,i.appendChild(s)),l=l._reactRootContainer,l!=null||i.onclick!==null||(i.onclick=jl));else if(p!==4&&(s=s.child,s!==null))for(Yu(s,i,l),s=s.sibling;s!==null;)Yu(s,i,l),s=s.sibling}function Xu(s,i,l){var p=s.tag;if(p===5||p===6)s=s.stateNode,i?l.insertBefore(s,i):l.appendChild(s);else if(p!==4&&(s=s.child,s!==null))for(Xu(s,i,l),s=s.sibling;s!==null;)Xu(s,i,l),s=s.sibling}var cs=null,Tr=!1;function wi(s,i,l){for(l=l.child;l!==null;)up(s,i,l),l=l.sibling}function up(s,i,l){if(Kt&&typeof Kt.onCommitFiberUnmount=="function")try{Kt.onCommitFiberUnmount(rs,l)}catch{}switch(l.tag){case 5:Cs||Lo(l,i);case 6:var p=cs,v=Tr;cs=null,wi(s,i,l),cs=p,Tr=v,cs!==null&&(Tr?(s=cs,l=l.stateNode,s.nodeType===8?s.parentNode.removeChild(l):s.removeChild(l)):cs.removeChild(l.stateNode));break;case 18:cs!==null&&(Tr?(s=cs,l=l.stateNode,s.nodeType===8?du(s.parentNode,l):s.nodeType===1&&du(s,l),xn(s)):du(cs,l.stateNode));break;case 4:p=cs,v=Tr,cs=l.stateNode.containerInfo,Tr=!0,wi(s,i,l),cs=p,Tr=v;break;case 0:case 11:case 14:case 15:if(!Cs&&(p=l.updateQueue,p!==null&&(p=p.lastEffect,p!==null))){v=p=p.next;do{var w=v,N=w.destroy;w=w.tag,N!==void 0&&((w&2)!==0||(w&4)!==0)&&Gu(l,i,N),v=v.next}while(v!==p)}wi(s,i,l);break;case 1:if(!Cs&&(Lo(l,i),p=l.stateNode,typeof p.componentWillUnmount=="function"))try{p.props=l.memoizedProps,p.state=l.memoizedState,p.componentWillUnmount()}catch(M){Pn(l,i,M)}wi(s,i,l);break;case 21:wi(s,i,l);break;case 22:l.mode&1?(Cs=(p=Cs)||l.memoizedState!==null,wi(s,i,l),Cs=p):wi(s,i,l);break;default:wi(s,i,l)}}function dp(s){var i=s.updateQueue;if(i!==null){s.updateQueue=null;var l=s.stateNode;l===null&&(l=s.stateNode=new tv),i.forEach(function(p){var v=uv.bind(null,s,p);l.has(p)||(l.add(p),p.then(v,v))})}}function Ir(s,i){var l=i.deletions;if(l!==null)for(var p=0;p<l.length;p++){var v=l[p];try{var w=s,N=i,M=N;e:for(;M!==null;){switch(M.tag){case 5:cs=M.stateNode,Tr=!1;break e;case 3:cs=M.stateNode.containerInfo,Tr=!0;break e;case 4:cs=M.stateNode.containerInfo,Tr=!0;break e}M=M.return}if(cs===null)throw Error(n(160));up(w,N,v),cs=null,Tr=!1;var F=v.alternate;F!==null&&(F.return=null),v.return=null}catch(Q){Pn(v,i,Q)}}if(i.subtreeFlags&12854)for(i=i.child;i!==null;)fp(i,s),i=i.sibling}function fp(s,i){var l=s.alternate,p=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:if(Ir(i,s),Dr(s),p&4){try{Ba(3,s,s.return),Yl(3,s)}catch(Xe){Pn(s,s.return,Xe)}try{Ba(5,s,s.return)}catch(Xe){Pn(s,s.return,Xe)}}break;case 1:Ir(i,s),Dr(s),p&512&&l!==null&&Lo(l,l.return);break;case 5:if(Ir(i,s),Dr(s),p&512&&l!==null&&Lo(l,l.return),s.flags&32){var v=s.stateNode;try{ne(v,"")}catch(Xe){Pn(s,s.return,Xe)}}if(p&4&&(v=s.stateNode,v!=null)){var w=s.memoizedProps,N=l!==null?l.memoizedProps:w,M=s.type,F=s.updateQueue;if(s.updateQueue=null,F!==null)try{M==="input"&&w.type==="radio"&&w.name!=null&&Be(v,w),Qt(M,N);var Q=Qt(M,w);for(N=0;N<F.length;N+=2){var ve=F[N],be=F[N+1];ve==="style"?Lt(v,be):ve==="dangerouslySetInnerHTML"?ns(v,be):ve==="children"?ne(v,be):C(v,ve,be,Q)}switch(M){case"input":Pt(v,w);break;case"textarea":Wn(v,w);break;case"select":var me=v._wrapperState.wasMultiple;v._wrapperState.wasMultiple=!!w.multiple;var De=w.value;De!=null?qt(v,!!w.multiple,De,!1):me!==!!w.multiple&&(w.defaultValue!=null?qt(v,!!w.multiple,w.defaultValue,!0):qt(v,!!w.multiple,w.multiple?[]:"",!1))}v[Ia]=w}catch(Xe){Pn(s,s.return,Xe)}}break;case 6:if(Ir(i,s),Dr(s),p&4){if(s.stateNode===null)throw Error(n(162));v=s.stateNode,w=s.memoizedProps;try{v.nodeValue=w}catch(Xe){Pn(s,s.return,Xe)}}break;case 3:if(Ir(i,s),Dr(s),p&4&&l!==null&&l.memoizedState.isDehydrated)try{xn(i.containerInfo)}catch(Xe){Pn(s,s.return,Xe)}break;case 4:Ir(i,s),Dr(s);break;case 13:Ir(i,s),Dr(s),v=s.child,v.flags&8192&&(w=v.memoizedState!==null,v.stateNode.isHidden=w,!w||v.alternate!==null&&v.alternate.memoizedState!==null||(ed=$t())),p&4&&dp(s);break;case 22:if(ve=l!==null&&l.memoizedState!==null,s.mode&1?(Cs=(Q=Cs)||ve,Ir(i,s),Cs=Q):Ir(i,s),Dr(s),p&8192){if(Q=s.memoizedState!==null,(s.stateNode.isHidden=Q)&&!ve&&(s.mode&1)!==0)for(ze=s,ve=s.child;ve!==null;){for(be=ze=ve;ze!==null;){switch(me=ze,De=me.child,me.tag){case 0:case 11:case 14:case 15:Ba(4,me,me.return);break;case 1:Lo(me,me.return);var Ve=me.stateNode;if(typeof Ve.componentWillUnmount=="function"){p=me,l=me.return;try{i=p,Ve.props=i.memoizedProps,Ve.state=i.memoizedState,Ve.componentWillUnmount()}catch(Xe){Pn(p,l,Xe)}}break;case 5:Lo(me,me.return);break;case 22:if(me.memoizedState!==null){mp(be);continue}}De!==null?(De.return=me,ze=De):mp(be)}ve=ve.sibling}e:for(ve=null,be=s;;){if(be.tag===5){if(ve===null){ve=be;try{v=be.stateNode,Q?(w=v.style,typeof w.setProperty=="function"?w.setProperty("display","none","important"):w.display="none"):(M=be.stateNode,F=be.memoizedProps.style,N=F!=null&&F.hasOwnProperty("display")?F.display:null,M.style.display=Ft("display",N))}catch(Xe){Pn(s,s.return,Xe)}}}else if(be.tag===6){if(ve===null)try{be.stateNode.nodeValue=Q?"":be.memoizedProps}catch(Xe){Pn(s,s.return,Xe)}}else if((be.tag!==22&&be.tag!==23||be.memoizedState===null||be===s)&&be.child!==null){be.child.return=be,be=be.child;continue}if(be===s)break e;for(;be.sibling===null;){if(be.return===null||be.return===s)break e;ve===be&&(ve=null),be=be.return}ve===be&&(ve=null),be.sibling.return=be.return,be=be.sibling}}break;case 19:Ir(i,s),Dr(s),p&4&&dp(s);break;case 21:break;default:Ir(i,s),Dr(s)}}function Dr(s){var i=s.flags;if(i&2){try{e:{for(var l=s.return;l!==null;){if(lp(l)){var p=l;break e}l=l.return}throw Error(n(160))}switch(p.tag){case 5:var v=p.stateNode;p.flags&32&&(ne(v,""),p.flags&=-33);var w=cp(s);Xu(s,w,v);break;case 3:case 4:var N=p.stateNode.containerInfo,M=cp(s);Yu(s,M,N);break;default:throw Error(n(161))}}catch(F){Pn(s,s.return,F)}s.flags&=-3}i&4096&&(s.flags&=-4097)}function sv(s,i,l){ze=s,hp(s)}function hp(s,i,l){for(var p=(s.mode&1)!==0;ze!==null;){var v=ze,w=v.child;if(v.tag===22&&p){var N=v.memoizedState!==null||Ql;if(!N){var M=v.alternate,F=M!==null&&M.memoizedState!==null||Cs;M=Ql;var Q=Cs;if(Ql=N,(Cs=F)&&!Q)for(ze=v;ze!==null;)N=ze,F=N.child,N.tag===22&&N.memoizedState!==null?gp(v):F!==null?(F.return=N,ze=F):gp(v);for(;w!==null;)ze=w,hp(w),w=w.sibling;ze=v,Ql=M,Cs=Q}pp(s)}else(v.subtreeFlags&8772)!==0&&w!==null?(w.return=v,ze=w):pp(s)}}function pp(s){for(;ze!==null;){var i=ze;if((i.flags&8772)!==0){var l=i.alternate;try{if((i.flags&8772)!==0)switch(i.tag){case 0:case 11:case 15:Cs||Yl(5,i);break;case 1:var p=i.stateNode;if(i.flags&4&&!Cs)if(l===null)p.componentDidMount();else{var v=i.elementType===i.type?l.memoizedProps:Er(i.type,l.memoizedProps);p.componentDidUpdate(v,l.memoizedState,p.__reactInternalSnapshotBeforeUpdate)}var w=i.updateQueue;w!==null&&vh(i,w,p);break;case 3:var N=i.updateQueue;if(N!==null){if(l=null,i.child!==null)switch(i.child.tag){case 5:l=i.child.stateNode;break;case 1:l=i.child.stateNode}vh(i,N,l)}break;case 5:var M=i.stateNode;if(l===null&&i.flags&4){l=M;var F=i.memoizedProps;switch(i.type){case"button":case"input":case"select":case"textarea":F.autoFocus&&l.focus();break;case"img":F.src&&(l.src=F.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(i.memoizedState===null){var Q=i.alternate;if(Q!==null){var ve=Q.memoizedState;if(ve!==null){var be=ve.dehydrated;be!==null&&xn(be)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(n(163))}Cs||i.flags&512&&Qu(i)}catch(me){Pn(i,i.return,me)}}if(i===s){ze=null;break}if(l=i.sibling,l!==null){l.return=i.return,ze=l;break}ze=i.return}}function mp(s){for(;ze!==null;){var i=ze;if(i===s){ze=null;break}var l=i.sibling;if(l!==null){l.return=i.return,ze=l;break}ze=i.return}}function gp(s){for(;ze!==null;){var i=ze;try{switch(i.tag){case 0:case 11:case 15:var l=i.return;try{Yl(4,i)}catch(F){Pn(i,l,F)}break;case 1:var p=i.stateNode;if(typeof p.componentDidMount=="function"){var v=i.return;try{p.componentDidMount()}catch(F){Pn(i,v,F)}}var w=i.return;try{Qu(i)}catch(F){Pn(i,w,F)}break;case 5:var N=i.return;try{Qu(i)}catch(F){Pn(i,N,F)}}}catch(F){Pn(i,i.return,F)}if(i===s){ze=null;break}var M=i.sibling;if(M!==null){M.return=i.return,ze=M;break}ze=i.return}}var rv=Math.ceil,Xl=le.ReactCurrentDispatcher,Ju=le.ReactCurrentOwner,gr=le.ReactCurrentBatchConfig,Ut=0,Zn=null,Rn=null,us=0,Xs=0,Do=pi(0),Qn=0,za=null,qi=0,Jl=0,Zu=0,Wa=null,zs=null,ed=0,Fo=1/0,ei=null,Zl=!1,td=null,xi=null,ec=!1,_i=null,tc=0,qa=0,nd=null,Va=-1,nc=0;function Ps(){return(Ut&6)!==0?$t():Va!==-1?Va:Va=$t()}function bi(s){return(s.mode&1)===0?1:(Ut&2)!==0&&us!==0?us&-us:zg.transition!==null?(nc===0&&(nc=zt()),nc):(s=Mt,s!==0||(s=window.event,s=s===void 0?16:tn(s.type)),s)}function jr(s,i,l,p){if(50<qa)throw qa=0,nd=null,Error(n(185));br(s,l,p),((Ut&2)===0||s!==Zn)&&(s===Zn&&((Ut&2)===0&&(Jl|=l),Qn===4&&Ci(s,us)),As(s,p),l===1&&Ut===0&&(i.mode&1)===0&&(Fo=$t()+500,$l&&gi()))}function As(s,i){var l=s.callbackNode;He(s,i);var p=Ie(s,s===Zn?us:0);if(p===0)l!==null&&Ct(l),s.callbackNode=null,s.callbackPriority=0;else if(i=p&-p,s.callbackPriority!==i){if(l!=null&&Ct(l),i===1)s.tag===0?Bg(rd.bind(null,s)):oh(rd.bind(null,s)),Lg(function(){(Ut&6)===0&&gi()}),l=null;else{switch(li(p)){case 1:l=wn;break;case 4:l=ss;break;case 16:l=Dn;break;case 536870912:l=ws;break;default:l=Dn}l=Sp(l,vp.bind(null,s))}s.callbackPriority=i,s.callbackNode=l}}function vp(s,i){if(Va=-1,nc=0,(Ut&6)!==0)throw Error(n(327));var l=s.callbackNode;if(Uo()&&s.callbackNode!==l)return null;var p=Ie(s,s===Zn?us:0);if(p===0)return null;if((p&30)!==0||(p&s.expiredLanes)!==0||i)i=rc(s,p);else{i=p;var v=Ut;Ut|=2;var w=ad();(Zn!==s||us!==i)&&(ei=null,Fo=$t()+500,Si(s,i));do try{ov();break}catch(M){wp(s,M)}while(!0);_u(),Xl.current=w,Ut=v,Rn!==null?i=0:(Zn=null,us=0,i=Qn)}if(i!==0){if(i===2&&(v=Zt(s),v!==0&&(p=v,i=sc(s,v))),i===1)throw l=za,Si(s,0),Ci(s,p),As(s,$t()),l;if(i===6)Ci(s,p);else{if(v=s.current.alternate,(p&30)===0&&!yp(v)&&(i=rc(s,p),i===2&&(w=Zt(s),w!==0&&(p=w,i=sc(s,w))),i===1))throw l=za,Si(s,0),Ci(s,p),As(s,$t()),l;switch(s.finishedWork=v,s.finishedLanes=p,i){case 0:case 1:throw Error(n(345));case 2:Vi(s,zs,ei);break;case 3:if(Ci(s,p),(p&130023424)===p&&(i=ed+500-$t(),10<i)){if(Ie(s,0)!==0)break;if(v=s.suspendedLanes,(v&p)!==p){Ps(),s.pingedLanes|=s.suspendedLanes&v;break}s.timeoutHandle=uu(Vi.bind(null,s,zs,ei),i);break}Vi(s,zs,ei);break;case 4:if(Ci(s,p),(p&4194240)===p)break;for(i=s.eventTimes,v=-1;0<p;){var N=31-z(p);w=1<<N,N=i[N],N>v&&(v=N),p&=~w}if(p=v,p=$t()-p,p=(120>p?120:480>p?480:1080>p?1080:1920>p?1920:3e3>p?3e3:4320>p?4320:1960*rv(p/1960))-p,10<p){s.timeoutHandle=uu(Vi.bind(null,s,zs,ei),p);break}Vi(s,zs,ei);break;case 5:Vi(s,zs,ei);break;default:throw Error(n(329))}}}return As(s,$t()),s.callbackNode===l?vp.bind(null,s):null}function sc(s,i){var l=Wa;return s.current.memoizedState.isDehydrated&&(Si(s,i).flags|=256),s=rc(s,i),s!==2&&(i=zs,zs=l,i!==null&&sd(i)),s}function sd(s){zs===null?zs=s:zs.push.apply(zs,s)}function yp(s){for(var i=s;;){if(i.flags&16384){var l=i.updateQueue;if(l!==null&&(l=l.stores,l!==null))for(var p=0;p<l.length;p++){var v=l[p],w=v.getSnapshot;v=v.value;try{if(!ur(w(),v))return!1}catch{return!1}}}if(l=i.child,i.subtreeFlags&16384&&l!==null)l.return=i,i=l;else{if(i===s)break;for(;i.sibling===null;){if(i.return===null||i.return===s)return!0;i=i.return}i.sibling.return=i.return,i=i.sibling}}return!0}function Ci(s,i){for(i&=~Zu,i&=~Jl,s.suspendedLanes|=i,s.pingedLanes&=~i,s=s.expirationTimes;0<i;){var l=31-z(i),p=1<<l;s[l]=-1,i&=~p}}function rd(s){if((Ut&6)!==0)throw Error(n(327));Uo();var i=Ie(s,0);if((i&1)===0)return As(s,$t()),null;var l=rc(s,i);if(s.tag!==0&&l===2){var p=Zt(s);p!==0&&(i=p,l=sc(s,p))}if(l===1)throw l=za,Si(s,0),Ci(s,i),As(s,$t()),l;if(l===6)throw Error(n(345));return s.finishedWork=s.current.alternate,s.finishedLanes=i,Vi(s,zs,ei),As(s,$t()),null}function id(s,i){var l=Ut;Ut|=1;try{return s(i)}finally{Ut=l,Ut===0&&(Fo=$t()+500,$l&&gi())}}function ki(s){_i!==null&&_i.tag===0&&(Ut&6)===0&&Uo();var i=Ut;Ut|=1;var l=gr.transition,p=Mt;try{if(gr.transition=null,Mt=1,s)return s()}finally{Mt=p,gr.transition=l,Ut=i,(Ut&6)===0&&gi()}}function od(){Xs=Do.current,gn(Do)}function Si(s,i){s.finishedWork=null,s.finishedLanes=0;var l=s.timeoutHandle;if(l!==-1&&(s.timeoutHandle=-1,Og(l)),Rn!==null)for(l=Rn.return;l!==null;){var p=l;switch(gu(p),p.tag){case 1:p=p.type.childContextTypes,p!=null&&Al();break;case 3:zi(),gn(Fs),gn(xs),Bl();break;case 5:Eu(p);break;case 4:zi();break;case 13:gn(bn);break;case 19:gn(bn);break;case 10:bu(p.type._context);break;case 22:case 23:od()}l=l.return}if(Zn=s,Rn=s=Ni(s.current,null),us=Xs=i,Qn=0,za=null,Zu=Jl=qi=0,zs=Wa=null,Ui!==null){for(i=0;i<Ui.length;i++)if(l=Ui[i],p=l.interleaved,p!==null){l.interleaved=null;var v=p.next,w=l.pending;if(w!==null){var N=w.next;w.next=v,p.next=N}l.pending=p}Ui=null}return s}function wp(s,i){do{var l=Rn;try{if(_u(),zl.current=Vl,$o){for(var p=vn.memoizedState;p!==null;){var v=p.queue;v!==null&&(v.pending=null),p=p.next}$o=!1}if(Wi=0,Jn=Gn=vn=null,Ma=!1,Oa=0,Ju.current=null,l===null||l.return===null){Qn=1,za=i,Rn=null;break}e:{var w=s,N=l.return,M=l,F=i;if(i=us,M.flags|=32768,F!==null&&typeof F=="object"&&typeof F.then=="function"){var Q=F,ve=M,be=ve.tag;if((ve.mode&1)===0&&(be===0||be===11||be===15)){var me=ve.alternate;me?(ve.updateQueue=me.updateQueue,ve.memoizedState=me.memoizedState,ve.lanes=me.lanes):(ve.updateQueue=null,ve.memoizedState=null)}var De=Uu(N);if(De!==null){De.flags&=-257,Vh(De,N,M,w,i),De.mode&1&&Fu(w,Q,i),i=De,F=Q;var Ve=i.updateQueue;if(Ve===null){var Xe=new Set;Xe.add(F),i.updateQueue=Xe}else Ve.add(F);break e}else{if((i&1)===0){Fu(w,Q,i),ld();break e}F=Error(n(426))}}else if(_n&&M.mode&1){var $n=Uu(N);if($n!==null){($n.flags&65536)===0&&($n.flags|=256),Vh($n,N,M,w,i),wu(Oo(F,M));break e}}w=F=Oo(F,M),Qn!==4&&(Qn=2),Wa===null?Wa=[w]:Wa.push(w),w=N;do{switch(w.tag){case 3:w.flags|=65536,i&=-i,w.lanes|=i;var f=Wh(w,F,i);Nu(w,f);break e;case 1:M=F;var E=w.type,H=w.stateNode;if((w.flags&128)===0&&(typeof E.getDerivedStateFromError=="function"||H!==null&&typeof H.componentDidCatch=="function"&&(xi===null||!xi.has(H)))){w.flags|=65536,i&=-i,w.lanes|=i;var _e=qh(w,M,i);Nu(w,_e);break e}}w=w.return}while(w!==null)}_p(l)}catch(Je){i=Je,Rn===l&&l!==null&&(Rn=l=l.return);continue}break}while(!0)}function ad(){var s=Xl.current;return Xl.current=Vl,s===null?Vl:s}function ld(){(Qn===0||Qn===3||Qn===2)&&(Qn=4),Zn===null||(qi&268435455)===0&&(Jl&268435455)===0||Ci(Zn,us)}function rc(s,i){var l=Ut;Ut|=2;var p=ad();(Zn!==s||us!==i)&&(ei=null,Si(s,i));do try{iv();break}catch(v){wp(s,v)}while(!0);if(_u(),Ut=l,Xl.current=p,Rn!==null)throw Error(n(261));return Zn=null,us=0,Qn}function iv(){for(;Rn!==null;)xp(Rn)}function ov(){for(;Rn!==null&&!kt();)xp(Rn)}function xp(s){var i=kp(s.alternate,s,Xs);s.memoizedProps=s.pendingProps,i===null?_p(s):Rn=i,Ju.current=null}function _p(s){var i=s;do{var l=i.alternate;if(s=i.return,(i.flags&32768)===0){if(l=Zg(l,i,Xs),l!==null){Rn=l;return}}else{if(l=ev(l,i),l!==null){l.flags&=32767,Rn=l;return}if(s!==null)s.flags|=32768,s.subtreeFlags=0,s.deletions=null;else{Qn=6,Rn=null;return}}if(i=i.sibling,i!==null){Rn=i;return}Rn=i=s}while(i!==null);Qn===0&&(Qn=5)}function Vi(s,i,l){var p=Mt,v=gr.transition;try{gr.transition=null,Mt=1,av(s,i,l,p)}finally{gr.transition=v,Mt=p}return null}function av(s,i,l,p){do Uo();while(_i!==null);if((Ut&6)!==0)throw Error(n(327));l=s.finishedWork;var v=s.finishedLanes;if(l===null)return null;if(s.finishedWork=null,s.finishedLanes=0,l===s.current)throw Error(n(177));s.callbackNode=null,s.callbackPriority=0;var w=l.lanes|l.childLanes;if(Hr(s,w),s===Zn&&(Rn=Zn=null,us=0),(l.subtreeFlags&2064)===0&&(l.flags&2064)===0||ec||(ec=!0,Sp(Dn,function(){return Uo(),null})),w=(l.flags&15990)!==0,(l.subtreeFlags&15990)!==0||w){w=gr.transition,gr.transition=null;var N=Mt;Mt=1;var M=Ut;Ut|=4,Ju.current=null,nv(s,l),fp(l,s),Ig(lu),Fn=!!au,lu=au=null,s.current=l,sv(l),Vt(),Ut=M,Mt=N,gr.transition=w}else s.current=l;if(ec&&(ec=!1,_i=s,tc=v),w=s.pendingLanes,w===0&&(xi=null),rn(l.stateNode),As(s,$t()),i!==null)for(p=s.onRecoverableError,l=0;l<i.length;l++)v=i[l],p(v.value,{componentStack:v.stack,digest:v.digest});if(Zl)throw Zl=!1,s=td,td=null,s;return(tc&1)!==0&&s.tag!==0&&Uo(),w=s.pendingLanes,(w&1)!==0?s===nd?qa++:(qa=0,nd=s):qa=0,gi(),null}function Uo(){if(_i!==null){var s=li(tc),i=gr.transition,l=Mt;try{if(gr.transition=null,Mt=16>s?16:s,_i===null)var p=!1;else{if(s=_i,_i=null,tc=0,(Ut&6)!==0)throw Error(n(331));var v=Ut;for(Ut|=4,ze=s.current;ze!==null;){var w=ze,N=w.child;if((ze.flags&16)!==0){var M=w.deletions;if(M!==null){for(var F=0;F<M.length;F++){var Q=M[F];for(ze=Q;ze!==null;){var ve=ze;switch(ve.tag){case 0:case 11:case 15:Ba(8,ve,w)}var be=ve.child;if(be!==null)be.return=ve,ze=be;else for(;ze!==null;){ve=ze;var me=ve.sibling,De=ve.return;if(ap(ve),ve===Q){ze=null;break}if(me!==null){me.return=De,ze=me;break}ze=De}}}var Ve=w.alternate;if(Ve!==null){var Xe=Ve.child;if(Xe!==null){Ve.child=null;do{var $n=Xe.sibling;Xe.sibling=null,Xe=$n}while(Xe!==null)}}ze=w}}if((w.subtreeFlags&2064)!==0&&N!==null)N.return=w,ze=N;else e:for(;ze!==null;){if(w=ze,(w.flags&2048)!==0)switch(w.tag){case 0:case 11:case 15:Ba(9,w,w.return)}var f=w.sibling;if(f!==null){f.return=w.return,ze=f;break e}ze=w.return}}var E=s.current;for(ze=E;ze!==null;){N=ze;var H=N.child;if((N.subtreeFlags&2064)!==0&&H!==null)H.return=N,ze=H;else e:for(N=E;ze!==null;){if(M=ze,(M.flags&2048)!==0)try{switch(M.tag){case 0:case 11:case 15:Yl(9,M)}}catch(Je){Pn(M,M.return,Je)}if(M===N){ze=null;break e}var _e=M.sibling;if(_e!==null){_e.return=M.return,ze=_e;break e}ze=M.return}}if(Ut=v,gi(),Kt&&typeof Kt.onPostCommitFiberRoot=="function")try{Kt.onPostCommitFiberRoot(rs,s)}catch{}p=!0}return p}finally{Mt=l,gr.transition=i}}return!1}function bp(s,i,l){i=Oo(l,i),i=Wh(s,i,1),s=Ys(s,i,1),i=Ps(),s!==null&&(br(s,1,i),As(s,i))}function Pn(s,i,l){if(s.tag===3)bp(s,s,l);else for(;i!==null;){if(i.tag===3){bp(i,s,l);break}else if(i.tag===1){var p=i.stateNode;if(typeof i.type.getDerivedStateFromError=="function"||typeof p.componentDidCatch=="function"&&(xi===null||!xi.has(p))){s=Oo(l,s),s=qh(i,s,1),i=Ys(i,s,1),s=Ps(),i!==null&&(br(i,1,s),As(i,s));break}}i=i.return}}function lv(s,i,l){var p=s.pingCache;p!==null&&p.delete(i),i=Ps(),s.pingedLanes|=s.suspendedLanes&l,Zn===s&&(us&l)===l&&(Qn===4||Qn===3&&(us&130023424)===us&&500>$t()-ed?Si(s,0):Zu|=l),As(s,i)}function Cp(s,i){i===0&&((s.mode&1)===0?i=1:(i=V,V<<=1,(V&130023424)===0&&(V=4194304)));var l=Ps();s=Jr(s,i),s!==null&&(br(s,i,l),As(s,l))}function cv(s){var i=s.memoizedState,l=0;i!==null&&(l=i.retryLane),Cp(s,l)}function uv(s,i){var l=0;switch(s.tag){case 13:var p=s.stateNode,v=s.memoizedState;v!==null&&(l=v.retryLane);break;case 19:p=s.stateNode;break;default:throw Error(n(314))}p!==null&&p.delete(i),Cp(s,l)}var kp;kp=function(s,i,l){if(s!==null)if(s.memoizedProps!==i.pendingProps||Fs.current)Bs=!0;else{if((s.lanes&l)===0&&(i.flags&128)===0)return Bs=!1,Jg(s,i,l);Bs=(s.flags&131072)!==0}else Bs=!1,_n&&(i.flags&1048576)!==0&&ah(i,Ol,i.index);switch(i.lanes=0,i.tag){case 2:var p=i.type;Gl(s,i),s=i.pendingProps;var v=So(i,xs.current);Po(i,l),v=Mo(null,i,p,s,v,l);var w=Iu();return i.flags|=1,typeof v=="object"&&v!==null&&typeof v.render=="function"&&v.$$typeof===void 0?(i.tag=1,i.memoizedState=null,i.updateQueue=null,Us(p)?(w=!0,Rl(i)):w=!1,i.memoizedState=v.state!==null&&v.state!==void 0?v.state:null,Su(i),v.updater=Hl,i.stateNode=v,v._reactInternals=i,Ou(i,p,s,l),i=zu(null,i,p,!0,w,l)):(i.tag=0,_n&&w&&mu(i),_s(null,i,v,l),i=i.child),i;case 16:p=i.elementType;e:{switch(Gl(s,i),s=i.pendingProps,v=p._init,p=v(p._payload),i.type=p,v=i.tag=fv(p),s=Er(p,s),v){case 0:i=Bu(null,i,p,s,l);break e;case 1:i=Xh(null,i,p,s,l);break e;case 11:i=Hh(null,i,p,s,l);break e;case 14:i=Kh(null,i,p,Er(p.type,s),l);break e}throw Error(n(306,p,""))}return i;case 0:return p=i.type,v=i.pendingProps,v=i.elementType===p?v:Er(p,v),Bu(s,i,p,v,l);case 1:return p=i.type,v=i.pendingProps,v=i.elementType===p?v:Er(p,v),Xh(s,i,p,v,l);case 3:e:{if(Jh(i),s===null)throw Error(n(387));p=i.pendingProps,w=i.memoizedState,v=w.element,gh(s,i),Bi(i,p,null,l);var N=i.memoizedState;if(p=N.element,w.isDehydrated)if(w={element:p,isDehydrated:!1,cache:N.cache,pendingSuspenseBoundaries:N.pendingSuspenseBoundaries,transitions:N.transitions},i.updateQueue.baseState=w,i.memoizedState=w,i.flags&256){v=Oo(Error(n(423)),i),i=Zh(s,i,p,l,v);break e}else if(p!==v){v=Oo(Error(n(424)),i),i=Zh(s,i,p,l,v);break e}else for(Qs=hi(i.stateNode.containerInfo.firstChild),Gs=i,_n=!0,Nr=null,l=ph(i,null,p,l),i.child=l;l;)l.flags=l.flags&-3|4096,l=l.sibling;else{if(To(),p===v){i=Zr(s,i,l);break e}_s(s,i,p,l)}i=i.child}return i;case 5:return yh(i),s===null&&yu(i),p=i.type,v=i.pendingProps,w=s!==null?s.memoizedProps:null,N=v.children,cu(p,v)?N=null:w!==null&&cu(p,w)&&(i.flags|=32),Yh(s,i),_s(s,i,N,l),i.child;case 6:return s===null&&yu(i),null;case 13:return ep(s,i,l);case 4:return Ra(i,i.stateNode.containerInfo),p=i.pendingProps,s===null?i.child=Io(i,null,p,l):_s(s,i,p,l),i.child;case 11:return p=i.type,v=i.pendingProps,v=i.elementType===p?v:Er(p,v),Hh(s,i,p,v,l);case 7:return _s(s,i,i.pendingProps,l),i.child;case 8:return _s(s,i,i.pendingProps.children,l),i.child;case 12:return _s(s,i,i.pendingProps.children,l),i.child;case 10:e:{if(p=i.type._context,v=i.pendingProps,w=i.memoizedProps,N=v.value,un(Fl,p._currentValue),p._currentValue=N,w!==null)if(ur(w.value,N)){if(w.children===v.children&&!Fs.current){i=Zr(s,i,l);break e}}else for(w=i.child,w!==null&&(w.return=i);w!==null;){var M=w.dependencies;if(M!==null){N=w.child;for(var F=M.firstContext;F!==null;){if(F.context===p){if(w.tag===1){F=Or(-1,l&-l),F.tag=2;var Q=w.updateQueue;if(Q!==null){Q=Q.shared;var ve=Q.pending;ve===null?F.next=F:(F.next=ve.next,ve.next=F),Q.pending=F}}w.lanes|=l,F=w.alternate,F!==null&&(F.lanes|=l),Cu(w.return,l,i),M.lanes|=l;break}F=F.next}}else if(w.tag===10)N=w.type===i.type?null:w.child;else if(w.tag===18){if(N=w.return,N===null)throw Error(n(341));N.lanes|=l,M=N.alternate,M!==null&&(M.lanes|=l),Cu(N,l,i),N=w.sibling}else N=w.child;if(N!==null)N.return=w;else for(N=w;N!==null;){if(N===i){N=null;break}if(w=N.sibling,w!==null){w.return=N.return,N=w;break}N=N.return}w=N}_s(s,i,v.children,l),i=i.child}return i;case 9:return v=i.type,p=i.pendingProps.children,Po(i,l),v=hr(v),p=p(v),i.flags|=1,_s(s,i,p,l),i.child;case 14:return p=i.type,v=Er(p,i.pendingProps),v=Er(p.type,v),Kh(s,i,p,v,l);case 15:return Gh(s,i,i.type,i.pendingProps,l);case 17:return p=i.type,v=i.pendingProps,v=i.elementType===p?v:Er(p,v),Gl(s,i),i.tag=1,Us(p)?(s=!0,Rl(i)):s=!1,Po(i,l),Bh(i,p,v),Ou(i,p,v,l),zu(null,i,p,!0,s,l);case 19:return np(s,i,l);case 22:return Qh(s,i,l)}throw Error(n(156,i.tag))};function Sp(s,i){return ut(s,i)}function dv(s,i,l,p){this.tag=s,this.key=l,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=i,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=p,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function vr(s,i,l,p){return new dv(s,i,l,p)}function cd(s){return s=s.prototype,!(!s||!s.isReactComponent)}function fv(s){if(typeof s=="function")return cd(s)?1:0;if(s!=null){if(s=s.$$typeof,s===Re)return 11;if(s===pe)return 14}return 2}function Ni(s,i){var l=s.alternate;return l===null?(l=vr(s.tag,i,s.key,s.mode),l.elementType=s.elementType,l.type=s.type,l.stateNode=s.stateNode,l.alternate=s,s.alternate=l):(l.pendingProps=i,l.type=s.type,l.flags=0,l.subtreeFlags=0,l.deletions=null),l.flags=s.flags&14680064,l.childLanes=s.childLanes,l.lanes=s.lanes,l.child=s.child,l.memoizedProps=s.memoizedProps,l.memoizedState=s.memoizedState,l.updateQueue=s.updateQueue,i=s.dependencies,l.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext},l.sibling=s.sibling,l.index=s.index,l.ref=s.ref,l}function ic(s,i,l,p,v,w){var N=2;if(p=s,typeof s=="function")cd(s)&&(N=1);else if(typeof s=="string")N=5;else e:switch(s){case xe:return Hi(l.children,v,w,i);case je:N=8,v|=8;break;case Fe:return s=vr(12,l,i,v|2),s.elementType=Fe,s.lanes=w,s;case Ae:return s=vr(13,l,i,v),s.elementType=Ae,s.lanes=w,s;case ue:return s=vr(19,l,i,v),s.elementType=ue,s.lanes=w,s;case Y:return oc(l,v,w,i);default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case Ze:N=10;break e;case st:N=9;break e;case Re:N=11;break e;case pe:N=14;break e;case $e:N=16,p=null;break e}throw Error(n(130,s==null?s:typeof s,""))}return i=vr(N,l,i,v),i.elementType=s,i.type=p,i.lanes=w,i}function Hi(s,i,l,p){return s=vr(7,s,p,i),s.lanes=l,s}function oc(s,i,l,p){return s=vr(22,s,p,i),s.elementType=Y,s.lanes=l,s.stateNode={isHidden:!1},s}function ud(s,i,l){return s=vr(6,s,null,i),s.lanes=l,s}function dd(s,i,l){return i=vr(4,s.children!==null?s.children:[],s.key,i),i.lanes=l,i.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},i}function hv(s,i,l,p,v){this.tag=i,this.containerInfo=s,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Ls(0),this.expirationTimes=Ls(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ls(0),this.identifierPrefix=p,this.onRecoverableError=v,this.mutableSourceEagerHydrationData=null}function fd(s,i,l,p,v,w,N,M,F){return s=new hv(s,i,l,M,F),i===1?(i=1,w===!0&&(i|=8)):i=0,w=vr(3,null,null,i),s.current=w,w.stateNode=s,w.memoizedState={element:p,isDehydrated:l,cache:null,transitions:null,pendingSuspenseBoundaries:null},Su(w),s}function pv(s,i,l){var p=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:re,key:p==null?null:""+p,children:s,containerInfo:i,implementation:l}}function Np(s){if(!s)return mi;s=s._reactInternals;e:{if(ge(s)!==s||s.tag!==1)throw Error(n(170));var i=s;do{switch(i.tag){case 3:i=i.stateNode.context;break e;case 1:if(Us(i.type)){i=i.stateNode.__reactInternalMemoizedMergedChildContext;break e}}i=i.return}while(i!==null);throw Error(n(171))}if(s.tag===1){var l=s.type;if(Us(l))return rh(s,l,i)}return i}function Ep(s,i,l,p,v,w,N,M,F){return s=fd(l,p,!0,s,v,w,N,M,F),s.context=Np(null),l=s.current,p=Ps(),v=bi(l),w=Or(p,v),w.callback=i??null,Ys(l,w,v),s.current.lanes=v,br(s,v,p),As(s,p),s}function ac(s,i,l,p){var v=i.current,w=Ps(),N=bi(v);return l=Np(l),i.context===null?i.context=l:i.pendingContext=l,i=Or(w,N),i.payload={element:s},p=p===void 0?null:p,p!==null&&(i.callback=p),s=Ys(v,i,N),s!==null&&(jr(s,v,N,w),Aa(s,v,N)),N}function lc(s){if(s=s.current,!s.child)return null;switch(s.child.tag){case 5:return s.child.stateNode;default:return s.child.stateNode}}function Tp(s,i){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var l=s.retryLane;s.retryLane=l!==0&&l<i?l:i}}function hd(s,i){Tp(s,i),(s=s.alternate)&&Tp(s,i)}function mv(){return null}var Ip=typeof reportError=="function"?reportError:function(s){console.error(s)};function pd(s){this._internalRoot=s}cc.prototype.render=pd.prototype.render=function(s){var i=this._internalRoot;if(i===null)throw Error(n(409));ac(s,i,null,null)},cc.prototype.unmount=pd.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var i=s.containerInfo;ki(function(){ac(null,s,null,null)}),i[Gr]=null}};function cc(s){this._internalRoot=s}cc.prototype.unstable_scheduleHydration=function(s){if(s){var i=ga();s={blockedOn:null,target:s,priority:i};for(var l=0;l<Sr.length&&i!==0&&i<Sr[l].priority;l++);Sr.splice(l,0,s),l===0&&B(s)}};function md(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function uc(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11&&(s.nodeType!==8||s.nodeValue!==" react-mount-point-unstable "))}function jp(){}function gv(s,i,l,p,v){if(v){if(typeof p=="function"){var w=p;p=function(){var Q=lc(N);w.call(Q)}}var N=Ep(i,p,s,0,null,!1,!1,"",jp);return s._reactRootContainer=N,s[Gr]=N.current,Ea(s.nodeType===8?s.parentNode:s),ki(),N}for(;v=s.lastChild;)s.removeChild(v);if(typeof p=="function"){var M=p;p=function(){var Q=lc(F);M.call(Q)}}var F=fd(s,0,!1,null,null,!1,!1,"",jp);return s._reactRootContainer=F,s[Gr]=F.current,Ea(s.nodeType===8?s.parentNode:s),ki(function(){ac(i,F,l,p)}),F}function dc(s,i,l,p,v){var w=l._reactRootContainer;if(w){var N=w;if(typeof v=="function"){var M=v;v=function(){var F=lc(N);M.call(F)}}ac(i,N,s,v)}else N=gv(l,i,s,v,p);return lc(N)}pa=function(s){switch(s.tag){case 3:var i=s.stateNode;if(i.current.memoizedState.isDehydrated){var l=ye(i.pendingLanes);l!==0&&(Cr(i,l|1),As(i,$t()),(Ut&6)===0&&(Fo=$t()+500,gi()))}break;case 13:ki(function(){var p=Jr(s,1);if(p!==null){var v=Ps();jr(p,s,1,v)}}),hd(s,1)}},Pi=function(s){if(s.tag===13){var i=Jr(s,134217728);if(i!==null){var l=Ps();jr(i,s,134217728,l)}hd(s,134217728)}},ma=function(s){if(s.tag===13){var i=bi(s),l=Jr(s,i);if(l!==null){var p=Ps();jr(l,s,i,p)}hd(s,i)}},ga=function(){return Mt},va=function(s,i){var l=Mt;try{return Mt=s,i()}finally{Mt=l}},gs=function(s,i,l){switch(i){case"input":if(Pt(s,l),i=l.name,l.type==="radio"&&i!=null){for(l=s;l.parentNode;)l=l.parentNode;for(l=l.querySelectorAll("input[name="+JSON.stringify(""+i)+'][type="radio"]'),i=0;i<l.length;i++){var p=l[i];if(p!==s&&p.form===s.form){var v=Pl(p);if(!v)throw Error(n(90));nn(p),Pt(p,v)}}}break;case"textarea":Wn(s,l);break;case"select":i=l.value,i!=null&&qt(s,!!l.multiple,i,!1)}},Kn=id,Hs=ki;var vv={usingClientEntryPoint:!1,Events:[ja,Co,Pl,vs,Hn,id]},Ha={findFiberByHostInstance:Oi,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},yv={bundleType:Ha.bundleType,version:Ha.version,rendererPackageName:Ha.rendererPackageName,rendererConfig:Ha.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:le.ReactCurrentDispatcher,findHostInstanceByFiber:function(s){return s=lt(s),s===null?null:s.stateNode},findFiberByHostInstance:Ha.findFiberByHostInstance||mv,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var fc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!fc.isDisabled&&fc.supportsFiber)try{rs=fc.inject(yv),Kt=fc}catch{}}return wr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=vv,wr.createPortal=function(s,i){var l=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!md(i))throw Error(n(200));return pv(s,i,null,l)},wr.createRoot=function(s,i){if(!md(s))throw Error(n(299));var l=!1,p="",v=Ip;return i!=null&&(i.unstable_strictMode===!0&&(l=!0),i.identifierPrefix!==void 0&&(p=i.identifierPrefix),i.onRecoverableError!==void 0&&(v=i.onRecoverableError)),i=fd(s,1,!1,null,null,l,!1,p,v),s[Gr]=i.current,Ea(s.nodeType===8?s.parentNode:s),new pd(i)},wr.findDOMNode=function(s){if(s==null)return null;if(s.nodeType===1)return s;var i=s._reactInternals;if(i===void 0)throw typeof s.render=="function"?Error(n(188)):(s=Object.keys(s).join(","),Error(n(268,s)));return s=lt(i),s=s===null?null:s.stateNode,s},wr.flushSync=function(s){return ki(s)},wr.hydrate=function(s,i,l){if(!uc(i))throw Error(n(200));return dc(null,s,i,!0,l)},wr.hydrateRoot=function(s,i,l){if(!md(s))throw Error(n(405));var p=l!=null&&l.hydratedSources||null,v=!1,w="",N=Ip;if(l!=null&&(l.unstable_strictMode===!0&&(v=!0),l.identifierPrefix!==void 0&&(w=l.identifierPrefix),l.onRecoverableError!==void 0&&(N=l.onRecoverableError)),i=Ep(i,null,s,1,l??null,v,!1,w,N),s[Gr]=i.current,Ea(s),p)for(s=0;s<p.length;s++)l=p[s],v=l._getVersion,v=v(l._source),i.mutableSourceEagerHydrationData==null?i.mutableSourceEagerHydrationData=[l,v]:i.mutableSourceEagerHydrationData.push(l,v);return new cc(i)},wr.render=function(s,i,l){if(!uc(i))throw Error(n(200));return dc(null,s,i,!1,l)},wr.unmountComponentAtNode=function(s){if(!uc(s))throw Error(n(40));return s._reactRootContainer?(ki(function(){dc(null,null,s,!1,function(){s._reactRootContainer=null,s[Gr]=null})}),!0):!1},wr.unstable_batchedUpdates=id,wr.unstable_renderSubtreeIntoContainer=function(s,i,l,p){if(!uc(l))throw Error(n(200));if(s==null||s._reactInternals===void 0)throw Error(n(38));return dc(s,i,l,!1,p)},wr.version="18.3.1-next-f1338f8080-20240426",wr}var lx;function WS(){if(lx)return $v.exports;lx=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),$v.exports=zS(),$v.exports}var cx;function qS(){if(cx)return Op;cx=1;var t=WS();return Op.createRoot=t.createRoot,Op.hydrateRoot=t.hydrateRoot,Op}var VS=qS();const HS=h_(VS);var Mc=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(t){return this.listeners.add(t),this.onSubscribe(),()=>{this.listeners.delete(t),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},KS={setTimeout:(t,e)=>setTimeout(t,e),clearTimeout:t=>clearTimeout(t),setInterval:(t,e)=>setInterval(t,e),clearInterval:t=>clearInterval(t)},GS=class{#e=KS;#t=!1;setTimeoutProvider(t){this.#e=t}setTimeout(t,e){return this.#e.setTimeout(t,e)}clearTimeout(t){this.#e.clearTimeout(t)}setInterval(t,e){return this.#e.setInterval(t,e)}clearInterval(t){this.#e.clearInterval(t)}},Ja=new GS;function QS(t){setTimeout(t,0)}var rl=typeof window>"u"||"Deno"in globalThis;function er(){}function YS(t,e){return typeof t=="function"?t(e):t}function d0(t){return typeof t=="number"&&t>=0&&t!==1/0}function m_(t,e){return Math.max(t+(e||0)-Date.now(),0)}function ta(t,e){return typeof t=="function"?t(e):t}function Fr(t,e){return typeof t=="function"?t(e):t}function ux(t,e){const{type:n="all",exact:r,fetchStatus:a,predicate:u,queryKey:h,stale:m}=t;if(h){if(r){if(e.queryHash!==J0(h,e.options))return!1}else if(!Od(e.queryKey,h))return!1}if(n!=="all"){const y=e.isActive();if(n==="active"&&!y||n==="inactive"&&y)return!1}return!(typeof m=="boolean"&&e.isStale()!==m||a&&a!==e.state.fetchStatus||u&&!u(e))}function dx(t,e){const{exact:n,status:r,predicate:a,mutationKey:u}=t;if(u){if(!e.options.mutationKey)return!1;if(n){if(il(e.options.mutationKey)!==il(u))return!1}else if(!Od(e.options.mutationKey,u))return!1}return!(r&&e.state.status!==r||a&&!a(e))}function J0(t,e){return(e?.queryKeyHashFn||il)(t)}function il(t){return JSON.stringify(t,(e,n)=>f0(n)?Object.keys(n).sort().reduce((r,a)=>(r[a]=n[a],r),{}):n)}function Od(t,e){return t===e?!0:typeof t!=typeof e?!1:t&&e&&typeof t=="object"&&typeof e=="object"?Object.keys(e).every(n=>Od(t[n],e[n])):!1}var XS=Object.prototype.hasOwnProperty;function g_(t,e){if(t===e)return t;const n=fx(t)&&fx(e);if(!n&&!(f0(t)&&f0(e)))return e;const a=(n?t:Object.keys(t)).length,u=n?e:Object.keys(e),h=u.length,m=n?new Array(h):{};let y=0;for(let x=0;x<h;x++){const k=n?x:u[x],T=t[k],S=e[k];if(T===S){m[k]=T,(n?x<a:XS.call(t,k))&&y++;continue}if(T===null||S===null||typeof T!="object"||typeof S!="object"){m[k]=S;continue}const R=g_(T,S);m[k]=R,R===T&&y++}return a===h&&y===a?t:m}function om(t,e){if(!e||Object.keys(t).length!==Object.keys(e).length)return!1;for(const n in t)if(t[n]!==e[n])return!1;return!0}function fx(t){return Array.isArray(t)&&t.length===Object.keys(t).length}function f0(t){if(!hx(t))return!1;const e=t.constructor;if(e===void 0)return!0;const n=e.prototype;return!(!hx(n)||!n.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(t)!==Object.prototype)}function hx(t){return Object.prototype.toString.call(t)==="[object Object]"}function JS(t){return new Promise(e=>{Ja.setTimeout(e,t)})}function h0(t,e,n){return typeof n.structuralSharing=="function"?n.structuralSharing(t,e):n.structuralSharing!==!1?g_(t,e):e}function ZS(t,e,n=0){const r=[...t,e];return n&&r.length>n?r.slice(1):r}function eN(t,e,n=0){const r=[e,...t];return n&&r.length>n?r.slice(0,-1):r}var Z0=Symbol();function v_(t,e){return!t.queryFn&&e?.initialPromise?()=>e.initialPromise:!t.queryFn||t.queryFn===Z0?()=>Promise.reject(new Error(`Missing queryFn: '${t.queryHash}'`)):t.queryFn}function y_(t,e){return typeof t=="function"?t(...e):!!t}var tN=class extends Mc{#e;#t;#n;constructor(){super(),this.#n=t=>{if(!rl&&window.addEventListener){const e=()=>t();return window.addEventListener("visibilitychange",e,!1),()=>{window.removeEventListener("visibilitychange",e)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(t){this.#n=t,this.#t?.(),this.#t=t(e=>{typeof e=="boolean"?this.setFocused(e):this.onFocus()})}setFocused(t){this.#e!==t&&(this.#e=t,this.onFocus())}onFocus(){const t=this.isFocused();this.listeners.forEach(e=>{e(t)})}isFocused(){return typeof this.#e=="boolean"?this.#e:globalThis.document?.visibilityState!=="hidden"}},ey=new tN;function p0(){let t,e;const n=new Promise((a,u)=>{t=a,e=u});n.status="pending",n.catch(()=>{});function r(a){Object.assign(n,a),delete n.resolve,delete n.reject}return n.resolve=a=>{r({status:"fulfilled",value:a}),t(a)},n.reject=a=>{r({status:"rejected",reason:a}),e(a)},n}var nN=QS;function sN(){let t=[],e=0,n=m=>{m()},r=m=>{m()},a=nN;const u=m=>{e?t.push(m):a(()=>{n(m)})},h=()=>{const m=t;t=[],m.length&&a(()=>{r(()=>{m.forEach(y=>{n(y)})})})};return{batch:m=>{let y;e++;try{y=m()}finally{e--,e||h()}return y},batchCalls:m=>(...y)=>{u(()=>{m(...y)})},schedule:u,setNotifyFunction:m=>{n=m},setBatchNotifyFunction:m=>{r=m},setScheduler:m=>{a=m}}}var fs=sN(),rN=class extends Mc{#e=!0;#t;#n;constructor(){super(),this.#n=t=>{if(!rl&&window.addEventListener){const e=()=>t(!0),n=()=>t(!1);return window.addEventListener("online",e,!1),window.addEventListener("offline",n,!1),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",n)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(t){this.#n=t,this.#t?.(),this.#t=t(this.setOnline.bind(this))}setOnline(t){this.#e!==t&&(this.#e=t,this.listeners.forEach(n=>{n(t)}))}isOnline(){return this.#e}},am=new rN;function iN(t){return Math.min(1e3*2**t,3e4)}function w_(t){return(t??"online")==="online"?am.isOnline():!0}var m0=class extends Error{constructor(t){super("CancelledError"),this.revert=t?.revert,this.silent=t?.silent}};function x_(t){let e=!1,n=0,r;const a=p0(),u=()=>a.status!=="pending",h=D=>{if(!u()){const q=new m0(D);S(q),t.onCancel?.(q)}},m=()=>{e=!0},y=()=>{e=!1},x=()=>ey.isFocused()&&(t.networkMode==="always"||am.isOnline())&&t.canRun(),k=()=>w_(t.networkMode)&&t.canRun(),T=D=>{u()||(r?.(),a.resolve(D))},S=D=>{u()||(r?.(),a.reject(D))},R=()=>new Promise(D=>{r=q=>{(u()||x())&&D(q)},t.onPause?.()}).then(()=>{r=void 0,u()||t.onContinue?.()}),O=()=>{if(u())return;let D;const q=n===0?t.initialPromise:void 0;try{D=q??t.fn()}catch(he){D=Promise.reject(he)}Promise.resolve(D).then(T).catch(he=>{if(u())return;const ce=t.retry??(rl?0:3),C=t.retryDelay??iN,le=typeof C=="function"?C(n,he):C,c=ce===!0||typeof ce=="number"&&n<ce||typeof ce=="function"&&ce(n,he);if(e||!c){S(he);return}n++,t.onFail?.(n,he),JS(le).then(()=>x()?void 0:R()).then(()=>{e?S(he):O()})})};return{promise:a,status:()=>a.status,cancel:h,continue:()=>(r?.(),a),cancelRetry:m,continueRetry:y,canStart:k,start:()=>(k()?O():R().then(O),a)}}var __=class{#e;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),d0(this.gcTime)&&(this.#e=Ja.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(t){this.gcTime=Math.max(this.gcTime||0,t??(rl?1/0:300*1e3))}clearGcTimeout(){this.#e&&(Ja.clearTimeout(this.#e),this.#e=void 0)}},oN=class extends __{#e;#t;#n;#r;#s;#o;#a;constructor(t){super(),this.#a=!1,this.#o=t.defaultOptions,this.setOptions(t.options),this.observers=[],this.#r=t.client,this.#n=this.#r.getQueryCache(),this.queryKey=t.queryKey,this.queryHash=t.queryHash,this.#e=mx(this.options),this.state=t.state??this.#e,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#s?.promise}setOptions(t){if(this.options={...this.#o,...t},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const e=mx(this.options);e.data!==void 0&&(this.setState(px(e.data,e.dataUpdatedAt)),this.#e=e)}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#n.remove(this)}setData(t,e){const n=h0(this.state.data,t,this.options);return this.#i({data:n,type:"success",dataUpdatedAt:e?.updatedAt,manual:e?.manual}),n}setState(t,e){this.#i({type:"setState",state:t,setStateOptions:e})}cancel(t){const e=this.#s?.promise;return this.#s?.cancel(t),e?e.then(er).catch(er):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#e)}isActive(){return this.observers.some(t=>Fr(t.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===Z0||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(t=>ta(t.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(t=>t.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(t=0){return this.state.data===void 0?!0:t==="static"?!1:this.state.isInvalidated?!0:!m_(this.state.dataUpdatedAt,t)}onFocus(){this.observers.find(e=>e.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#s?.continue()}onOnline(){this.observers.find(e=>e.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#s?.continue()}addObserver(t){this.observers.includes(t)||(this.observers.push(t),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",query:this,observer:t}))}removeObserver(t){this.observers.includes(t)&&(this.observers=this.observers.filter(e=>e!==t),this.observers.length||(this.#s&&(this.#a?this.#s.cancel({revert:!0}):this.#s.cancelRetry()),this.scheduleGc()),this.#n.notify({type:"observerRemoved",query:this,observer:t}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#i({type:"invalidate"})}async fetch(t,e){if(this.state.fetchStatus!=="idle"&&this.#s?.status()!=="rejected"){if(this.state.data!==void 0&&e?.cancelRefetch)this.cancel({silent:!0});else if(this.#s)return this.#s.continueRetry(),this.#s.promise}if(t&&this.setOptions(t),!this.options.queryFn){const m=this.observers.find(y=>y.options.queryFn);m&&this.setOptions(m.options)}const n=new AbortController,r=m=>{Object.defineProperty(m,"signal",{enumerable:!0,get:()=>(this.#a=!0,n.signal)})},a=()=>{const m=v_(this.options,e),x=(()=>{const k={client:this.#r,queryKey:this.queryKey,meta:this.meta};return r(k),k})();return this.#a=!1,this.options.persister?this.options.persister(m,x,this):m(x)},h=(()=>{const m={fetchOptions:e,options:this.options,queryKey:this.queryKey,client:this.#r,state:this.state,fetchFn:a};return r(m),m})();this.options.behavior?.onFetch(h,this),this.#t=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==h.fetchOptions?.meta)&&this.#i({type:"fetch",meta:h.fetchOptions?.meta}),this.#s=x_({initialPromise:e?.initialPromise,fn:h.fetchFn,onCancel:m=>{m instanceof m0&&m.revert&&this.setState({...this.#t,fetchStatus:"idle"}),n.abort()},onFail:(m,y)=>{this.#i({type:"failed",failureCount:m,error:y})},onPause:()=>{this.#i({type:"pause"})},onContinue:()=>{this.#i({type:"continue"})},retry:h.options.retry,retryDelay:h.options.retryDelay,networkMode:h.options.networkMode,canRun:()=>!0});try{const m=await this.#s.start();if(m===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(m),this.#n.config.onSuccess?.(m,this),this.#n.config.onSettled?.(m,this.state.error,this),m}catch(m){if(m instanceof m0){if(m.silent)return this.#s.promise;if(m.revert){if(this.state.data===void 0)throw m;return this.state.data}}throw this.#i({type:"error",error:m}),this.#n.config.onError?.(m,this),this.#n.config.onSettled?.(this.state.data,m,this),m}finally{this.scheduleGc()}}#i(t){const e=n=>{switch(t.type){case"failed":return{...n,fetchFailureCount:t.failureCount,fetchFailureReason:t.error};case"pause":return{...n,fetchStatus:"paused"};case"continue":return{...n,fetchStatus:"fetching"};case"fetch":return{...n,...b_(n.data,this.options),fetchMeta:t.meta??null};case"success":const r={...n,...px(t.data,t.dataUpdatedAt),dataUpdateCount:n.dataUpdateCount+1,...!t.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return this.#t=t.manual?r:void 0,r;case"error":const a=t.error;return{...n,error:a,errorUpdateCount:n.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:n.fetchFailureCount+1,fetchFailureReason:a,fetchStatus:"idle",status:"error"};case"invalidate":return{...n,isInvalidated:!0};case"setState":return{...n,...t.state}}};this.state=e(this.state),fs.batch(()=>{this.observers.forEach(n=>{n.onQueryUpdate()}),this.#n.notify({query:this,type:"updated",action:t})})}};function b_(t,e){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:w_(e.networkMode)?"fetching":"paused",...t===void 0&&{error:null,status:"pending"}}}function px(t,e){return{data:t,dataUpdatedAt:e??Date.now(),error:null,isInvalidated:!1,status:"success"}}function mx(t){const e=typeof t.initialData=="function"?t.initialData():t.initialData,n=e!==void 0,r=n?typeof t.initialDataUpdatedAt=="function"?t.initialDataUpdatedAt():t.initialDataUpdatedAt:0;return{data:e,dataUpdateCount:0,dataUpdatedAt:n?r??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:n?"success":"pending",fetchStatus:"idle"}}var aN=class extends Mc{constructor(t,e){super(),this.options=e,this.#e=t,this.#i=null,this.#a=p0(),this.bindMethods(),this.setOptions(e)}#e;#t=void 0;#n=void 0;#r=void 0;#s;#o;#a;#i;#m;#f;#h;#c;#u;#l;#p=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.#t.addObserver(this),gx(this.#t,this.options)?this.#d():this.updateResult(),this.#w())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return g0(this.#t,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return g0(this.#t,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#x(),this.#_(),this.#t.removeObserver(this)}setOptions(t){const e=this.options,n=this.#t;if(this.options=this.#e.defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof Fr(this.options.enabled,this.#t)!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#b(),this.#t.setOptions(this.options),e._defaulted&&!om(this.options,e)&&this.#e.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#t,observer:this});const r=this.hasListeners();r&&vx(this.#t,n,this.options,e)&&this.#d(),this.updateResult(),r&&(this.#t!==n||Fr(this.options.enabled,this.#t)!==Fr(e.enabled,this.#t)||ta(this.options.staleTime,this.#t)!==ta(e.staleTime,this.#t))&&this.#g();const a=this.#v();r&&(this.#t!==n||Fr(this.options.enabled,this.#t)!==Fr(e.enabled,this.#t)||a!==this.#l)&&this.#y(a)}getOptimisticResult(t){const e=this.#e.getQueryCache().build(this.#e,t),n=this.createResult(e,t);return cN(this,n)&&(this.#r=n,this.#o=this.options,this.#s=this.#t.state),n}getCurrentResult(){return this.#r}trackResult(t,e){return new Proxy(t,{get:(n,r)=>(this.trackProp(r),e?.(r),r==="promise"&&(this.trackProp("data"),!this.options.experimental_prefetchInRender&&this.#a.status==="pending"&&this.#a.reject(new Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(n,r))})}trackProp(t){this.#p.add(t)}getCurrentQuery(){return this.#t}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const e=this.#e.defaultQueryOptions(t),n=this.#e.getQueryCache().build(this.#e,e);return n.fetch().then(()=>this.createResult(n,e))}fetch(t){return this.#d({...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#r))}#d(t){this.#b();let e=this.#t.fetch(this.options,t);return t?.throwOnError||(e=e.catch(er)),e}#g(){this.#x();const t=ta(this.options.staleTime,this.#t);if(rl||this.#r.isStale||!d0(t))return;const n=m_(this.#r.dataUpdatedAt,t)+1;this.#c=Ja.setTimeout(()=>{this.#r.isStale||this.updateResult()},n)}#v(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.#t):this.options.refetchInterval)??!1}#y(t){this.#_(),this.#l=t,!(rl||Fr(this.options.enabled,this.#t)===!1||!d0(this.#l)||this.#l===0)&&(this.#u=Ja.setInterval(()=>{(this.options.refetchIntervalInBackground||ey.isFocused())&&this.#d()},this.#l))}#w(){this.#g(),this.#y(this.#v())}#x(){this.#c&&(Ja.clearTimeout(this.#c),this.#c=void 0)}#_(){this.#u&&(Ja.clearInterval(this.#u),this.#u=void 0)}createResult(t,e){const n=this.#t,r=this.options,a=this.#r,u=this.#s,h=this.#o,y=t!==n?t.state:this.#n,{state:x}=t;let k={...x},T=!1,S;if(e._optimisticResults){const je=this.hasListeners(),Fe=!je&&gx(t,e),Ze=je&&vx(t,n,e,r);(Fe||Ze)&&(k={...k,...b_(x.data,t.options)}),e._optimisticResults==="isRestoring"&&(k.fetchStatus="idle")}let{error:R,errorUpdatedAt:O,status:D}=k;S=k.data;let q=!1;if(e.placeholderData!==void 0&&S===void 0&&D==="pending"){let je;a?.isPlaceholderData&&e.placeholderData===h?.placeholderData?(je=a.data,q=!0):je=typeof e.placeholderData=="function"?e.placeholderData(this.#h?.state.data,this.#h):e.placeholderData,je!==void 0&&(D="success",S=h0(a?.data,je,e),T=!0)}if(e.select&&S!==void 0&&!q)if(a&&S===u?.data&&e.select===this.#m)S=this.#f;else try{this.#m=e.select,S=e.select(S),S=h0(a?.data,S,e),this.#f=S,this.#i=null}catch(je){this.#i=je}this.#i&&(R=this.#i,S=this.#f,O=Date.now(),D="error");const he=k.fetchStatus==="fetching",ce=D==="pending",C=D==="error",le=ce&&he,c=S!==void 0,xe={status:D,fetchStatus:k.fetchStatus,isPending:ce,isSuccess:D==="success",isError:C,isInitialLoading:le,isLoading:le,data:S,dataUpdatedAt:k.dataUpdatedAt,error:R,errorUpdatedAt:O,failureCount:k.fetchFailureCount,failureReason:k.fetchFailureReason,errorUpdateCount:k.errorUpdateCount,isFetched:k.dataUpdateCount>0||k.errorUpdateCount>0,isFetchedAfterMount:k.dataUpdateCount>y.dataUpdateCount||k.errorUpdateCount>y.errorUpdateCount,isFetching:he,isRefetching:he&&!ce,isLoadingError:C&&!c,isPaused:k.fetchStatus==="paused",isPlaceholderData:T,isRefetchError:C&&c,isStale:ty(t,e),refetch:this.refetch,promise:this.#a,isEnabled:Fr(e.enabled,t)!==!1};if(this.options.experimental_prefetchInRender){const je=st=>{xe.status==="error"?st.reject(xe.error):xe.data!==void 0&&st.resolve(xe.data)},Fe=()=>{const st=this.#a=xe.promise=p0();je(st)},Ze=this.#a;switch(Ze.status){case"pending":t.queryHash===n.queryHash&&je(Ze);break;case"fulfilled":(xe.status==="error"||xe.data!==Ze.value)&&Fe();break;case"rejected":(xe.status!=="error"||xe.error!==Ze.reason)&&Fe();break}}return xe}updateResult(){const t=this.#r,e=this.createResult(this.#t,this.options);if(this.#s=this.#t.state,this.#o=this.options,this.#s.data!==void 0&&(this.#h=this.#t),om(e,t))return;this.#r=e;const n=()=>{if(!t)return!0;const{notifyOnChangeProps:r}=this.options,a=typeof r=="function"?r():r;if(a==="all"||!a&&!this.#p.size)return!0;const u=new Set(a??this.#p);return this.options.throwOnError&&u.add("error"),Object.keys(this.#r).some(h=>{const m=h;return this.#r[m]!==t[m]&&u.has(m)})};this.#C({listeners:n()})}#b(){const t=this.#e.getQueryCache().build(this.#e,this.options);if(t===this.#t)return;const e=this.#t;this.#t=t,this.#n=t.state,this.hasListeners()&&(e?.removeObserver(this),t.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#w()}#C(t){fs.batch(()=>{t.listeners&&this.listeners.forEach(e=>{e(this.#r)}),this.#e.getQueryCache().notify({query:this.#t,type:"observerResultsUpdated"})})}};function lN(t,e){return Fr(e.enabled,t)!==!1&&t.state.data===void 0&&!(t.state.status==="error"&&e.retryOnMount===!1)}function gx(t,e){return lN(t,e)||t.state.data!==void 0&&g0(t,e,e.refetchOnMount)}function g0(t,e,n){if(Fr(e.enabled,t)!==!1&&ta(e.staleTime,t)!=="static"){const r=typeof n=="function"?n(t):n;return r==="always"||r!==!1&&ty(t,e)}return!1}function vx(t,e,n,r){return(t!==e||Fr(r.enabled,t)===!1)&&(!n.suspense||t.state.status!=="error")&&ty(t,n)}function ty(t,e){return Fr(e.enabled,t)!==!1&&t.isStaleByTime(ta(e.staleTime,t))}function cN(t,e){return!om(t.getCurrentResult(),e)}function yx(t){return{onFetch:(e,n)=>{const r=e.options,a=e.fetchOptions?.meta?.fetchMore?.direction,u=e.state.data?.pages||[],h=e.state.data?.pageParams||[];let m={pages:[],pageParams:[]},y=0;const x=async()=>{let k=!1;const T=O=>{Object.defineProperty(O,"signal",{enumerable:!0,get:()=>(e.signal.aborted?k=!0:e.signal.addEventListener("abort",()=>{k=!0}),e.signal)})},S=v_(e.options,e.fetchOptions),R=async(O,D,q)=>{if(k)return Promise.reject();if(D==null&&O.pages.length)return Promise.resolve(O);const ce=(()=>{const re={client:e.client,queryKey:e.queryKey,pageParam:D,direction:q?"backward":"forward",meta:e.options.meta};return T(re),re})(),C=await S(ce),{maxPages:le}=e.options,c=q?eN:ZS;return{pages:c(O.pages,C,le),pageParams:c(O.pageParams,D,le)}};if(a&&u.length){const O=a==="backward",D=O?uN:wx,q={pages:u,pageParams:h},he=D(r,q);m=await R(q,he,O)}else{const O=t??u.length;do{const D=y===0?h[0]??r.initialPageParam:wx(r,m);if(y>0&&D==null)break;m=await R(m,D),y++}while(y<O)}return m};e.options.persister?e.fetchFn=()=>e.options.persister?.(x,{client:e.client,queryKey:e.queryKey,meta:e.options.meta,signal:e.signal},n):e.fetchFn=x}}}function wx(t,{pages:e,pageParams:n}){const r=e.length-1;return e.length>0?t.getNextPageParam(e[r],e,n[r],n):void 0}function uN(t,{pages:e,pageParams:n}){return e.length>0?t.getPreviousPageParam?.(e[0],e,n[0],n):void 0}var dN=class extends __{#e;#t;#n;#r;constructor(t){super(),this.#e=t.client,this.mutationId=t.mutationId,this.#n=t.mutationCache,this.#t=[],this.state=t.state||C_(),this.setOptions(t.options),this.scheduleGc()}setOptions(t){this.options=t,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(t){this.#t.includes(t)||(this.#t.push(t),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",mutation:this,observer:t}))}removeObserver(t){this.#t=this.#t.filter(e=>e!==t),this.scheduleGc(),this.#n.notify({type:"observerRemoved",mutation:this,observer:t})}optionalRemove(){this.#t.length||(this.state.status==="pending"?this.scheduleGc():this.#n.remove(this))}continue(){return this.#r?.continue()??this.execute(this.state.variables)}async execute(t){const e=()=>{this.#s({type:"continue"})},n={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};this.#r=x_({fn:()=>this.options.mutationFn?this.options.mutationFn(t,n):Promise.reject(new Error("No mutationFn found")),onFail:(u,h)=>{this.#s({type:"failed",failureCount:u,error:h})},onPause:()=>{this.#s({type:"pause"})},onContinue:e,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#n.canRun(this)});const r=this.state.status==="pending",a=!this.#r.canStart();try{if(r)e();else{this.#s({type:"pending",variables:t,isPaused:a}),await this.#n.config.onMutate?.(t,this,n);const h=await this.options.onMutate?.(t,n);h!==this.state.context&&this.#s({type:"pending",context:h,variables:t,isPaused:a})}const u=await this.#r.start();return await this.#n.config.onSuccess?.(u,t,this.state.context,this,n),await this.options.onSuccess?.(u,t,this.state.context,n),await this.#n.config.onSettled?.(u,null,this.state.variables,this.state.context,this,n),await this.options.onSettled?.(u,null,t,this.state.context,n),this.#s({type:"success",data:u}),u}catch(u){try{throw await this.#n.config.onError?.(u,t,this.state.context,this,n),await this.options.onError?.(u,t,this.state.context,n),await this.#n.config.onSettled?.(void 0,u,this.state.variables,this.state.context,this,n),await this.options.onSettled?.(void 0,u,t,this.state.context,n),u}finally{this.#s({type:"error",error:u})}}finally{this.#n.runNext(this)}}#s(t){const e=n=>{switch(t.type){case"failed":return{...n,failureCount:t.failureCount,failureReason:t.error};case"pause":return{...n,isPaused:!0};case"continue":return{...n,isPaused:!1};case"pending":return{...n,context:t.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:t.isPaused,status:"pending",variables:t.variables,submittedAt:Date.now()};case"success":return{...n,data:t.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...n,data:void 0,error:t.error,failureCount:n.failureCount+1,failureReason:t.error,isPaused:!1,status:"error"}}};this.state=e(this.state),fs.batch(()=>{this.#t.forEach(n=>{n.onMutationUpdate(t)}),this.#n.notify({mutation:this,type:"updated",action:t})})}};function C_(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var fN=class extends Mc{constructor(t={}){super(),this.config=t,this.#e=new Set,this.#t=new Map,this.#n=0}#e;#t;#n;build(t,e,n){const r=new dN({client:t,mutationCache:this,mutationId:++this.#n,options:t.defaultMutationOptions(e),state:n});return this.add(r),r}add(t){this.#e.add(t);const e=Lp(t);if(typeof e=="string"){const n=this.#t.get(e);n?n.push(t):this.#t.set(e,[t])}this.notify({type:"added",mutation:t})}remove(t){if(this.#e.delete(t)){const e=Lp(t);if(typeof e=="string"){const n=this.#t.get(e);if(n)if(n.length>1){const r=n.indexOf(t);r!==-1&&n.splice(r,1)}else n[0]===t&&this.#t.delete(e)}}this.notify({type:"removed",mutation:t})}canRun(t){const e=Lp(t);if(typeof e=="string"){const r=this.#t.get(e)?.find(a=>a.state.status==="pending");return!r||r===t}else return!0}runNext(t){const e=Lp(t);return typeof e=="string"?this.#t.get(e)?.find(r=>r!==t&&r.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){fs.batch(()=>{this.#e.forEach(t=>{this.notify({type:"removed",mutation:t})}),this.#e.clear(),this.#t.clear()})}getAll(){return Array.from(this.#e)}find(t){const e={exact:!0,...t};return this.getAll().find(n=>dx(e,n))}findAll(t={}){return this.getAll().filter(e=>dx(t,e))}notify(t){fs.batch(()=>{this.listeners.forEach(e=>{e(t)})})}resumePausedMutations(){const t=this.getAll().filter(e=>e.state.isPaused);return fs.batch(()=>Promise.all(t.map(e=>e.continue().catch(er))))}};function Lp(t){return t.options.scope?.id}var hN=class extends Mc{#e;#t=void 0;#n;#r;constructor(e,n){super(),this.#e=e,this.setOptions(n),this.bindMethods(),this.#s()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){const n=this.options;this.options=this.#e.defaultMutationOptions(e),om(this.options,n)||this.#e.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#n,observer:this}),n?.mutationKey&&this.options.mutationKey&&il(n.mutationKey)!==il(this.options.mutationKey)?this.reset():this.#n?.state.status==="pending"&&this.#n.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#n?.removeObserver(this)}onMutationUpdate(e){this.#s(),this.#o(e)}getCurrentResult(){return this.#t}reset(){this.#n?.removeObserver(this),this.#n=void 0,this.#s(),this.#o()}mutate(e,n){return this.#r=n,this.#n?.removeObserver(this),this.#n=this.#e.getMutationCache().build(this.#e,this.options),this.#n.addObserver(this),this.#n.execute(e)}#s(){const e=this.#n?.state??C_();this.#t={...e,isPending:e.status==="pending",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset}}#o(e){fs.batch(()=>{if(this.#r&&this.hasListeners()){const n=this.#t.variables,r=this.#t.context,a={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};e?.type==="success"?(this.#r.onSuccess?.(e.data,n,r,a),this.#r.onSettled?.(e.data,null,n,r,a)):e?.type==="error"&&(this.#r.onError?.(e.error,n,r,a),this.#r.onSettled?.(void 0,e.error,n,r,a))}this.listeners.forEach(n=>{n(this.#t)})})}},pN=class extends Mc{constructor(t={}){super(),this.config=t,this.#e=new Map}#e;build(t,e,n){const r=e.queryKey,a=e.queryHash??J0(r,e);let u=this.get(a);return u||(u=new oN({client:t,queryKey:r,queryHash:a,options:t.defaultQueryOptions(e),state:n,defaultOptions:t.getQueryDefaults(r)}),this.add(u)),u}add(t){this.#e.has(t.queryHash)||(this.#e.set(t.queryHash,t),this.notify({type:"added",query:t}))}remove(t){const e=this.#e.get(t.queryHash);e&&(t.destroy(),e===t&&this.#e.delete(t.queryHash),this.notify({type:"removed",query:t}))}clear(){fs.batch(()=>{this.getAll().forEach(t=>{this.remove(t)})})}get(t){return this.#e.get(t)}getAll(){return[...this.#e.values()]}find(t){const e={exact:!0,...t};return this.getAll().find(n=>ux(e,n))}findAll(t={}){const e=this.getAll();return Object.keys(t).length>0?e.filter(n=>ux(t,n)):e}notify(t){fs.batch(()=>{this.listeners.forEach(e=>{e(t)})})}onFocus(){fs.batch(()=>{this.getAll().forEach(t=>{t.onFocus()})})}onOnline(){fs.batch(()=>{this.getAll().forEach(t=>{t.onOnline()})})}},mN=class{#e;#t;#n;#r;#s;#o;#a;#i;constructor(t={}){this.#e=t.queryCache||new pN,this.#t=t.mutationCache||new fN,this.#n=t.defaultOptions||{},this.#r=new Map,this.#s=new Map,this.#o=0}mount(){this.#o++,this.#o===1&&(this.#a=ey.subscribe(async t=>{t&&(await this.resumePausedMutations(),this.#e.onFocus())}),this.#i=am.subscribe(async t=>{t&&(await this.resumePausedMutations(),this.#e.onOnline())}))}unmount(){this.#o--,this.#o===0&&(this.#a?.(),this.#a=void 0,this.#i?.(),this.#i=void 0)}isFetching(t){return this.#e.findAll({...t,fetchStatus:"fetching"}).length}isMutating(t){return this.#t.findAll({...t,status:"pending"}).length}getQueryData(t){const e=this.defaultQueryOptions({queryKey:t});return this.#e.get(e.queryHash)?.state.data}ensureQueryData(t){const e=this.defaultQueryOptions(t),n=this.#e.build(this,e),r=n.state.data;return r===void 0?this.fetchQuery(t):(t.revalidateIfStale&&n.isStaleByTime(ta(e.staleTime,n))&&this.prefetchQuery(e),Promise.resolve(r))}getQueriesData(t){return this.#e.findAll(t).map(({queryKey:e,state:n})=>{const r=n.data;return[e,r]})}setQueryData(t,e,n){const r=this.defaultQueryOptions({queryKey:t}),u=this.#e.get(r.queryHash)?.state.data,h=YS(e,u);if(h!==void 0)return this.#e.build(this,r).setData(h,{...n,manual:!0})}setQueriesData(t,e,n){return fs.batch(()=>this.#e.findAll(t).map(({queryKey:r})=>[r,this.setQueryData(r,e,n)]))}getQueryState(t){const e=this.defaultQueryOptions({queryKey:t});return this.#e.get(e.queryHash)?.state}removeQueries(t){const e=this.#e;fs.batch(()=>{e.findAll(t).forEach(n=>{e.remove(n)})})}resetQueries(t,e){const n=this.#e;return fs.batch(()=>(n.findAll(t).forEach(r=>{r.reset()}),this.refetchQueries({type:"active",...t},e)))}cancelQueries(t,e={}){const n={revert:!0,...e},r=fs.batch(()=>this.#e.findAll(t).map(a=>a.cancel(n)));return Promise.all(r).then(er).catch(er)}invalidateQueries(t,e={}){return fs.batch(()=>(this.#e.findAll(t).forEach(n=>{n.invalidate()}),t?.refetchType==="none"?Promise.resolve():this.refetchQueries({...t,type:t?.refetchType??t?.type??"active"},e)))}refetchQueries(t,e={}){const n={...e,cancelRefetch:e.cancelRefetch??!0},r=fs.batch(()=>this.#e.findAll(t).filter(a=>!a.isDisabled()&&!a.isStatic()).map(a=>{let u=a.fetch(void 0,n);return n.throwOnError||(u=u.catch(er)),a.state.fetchStatus==="paused"?Promise.resolve():u}));return Promise.all(r).then(er)}fetchQuery(t){const e=this.defaultQueryOptions(t);e.retry===void 0&&(e.retry=!1);const n=this.#e.build(this,e);return n.isStaleByTime(ta(e.staleTime,n))?n.fetch(e):Promise.resolve(n.state.data)}prefetchQuery(t){return this.fetchQuery(t).then(er).catch(er)}fetchInfiniteQuery(t){return t.behavior=yx(t.pages),this.fetchQuery(t)}prefetchInfiniteQuery(t){return this.fetchInfiniteQuery(t).then(er).catch(er)}ensureInfiniteQueryData(t){return t.behavior=yx(t.pages),this.ensureQueryData(t)}resumePausedMutations(){return am.isOnline()?this.#t.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#e}getMutationCache(){return this.#t}getDefaultOptions(){return this.#n}setDefaultOptions(t){this.#n=t}setQueryDefaults(t,e){this.#r.set(il(t),{queryKey:t,defaultOptions:e})}getQueryDefaults(t){const e=[...this.#r.values()],n={};return e.forEach(r=>{Od(t,r.queryKey)&&Object.assign(n,r.defaultOptions)}),n}setMutationDefaults(t,e){this.#s.set(il(t),{mutationKey:t,defaultOptions:e})}getMutationDefaults(t){const e=[...this.#s.values()],n={};return e.forEach(r=>{Od(t,r.mutationKey)&&Object.assign(n,r.defaultOptions)}),n}defaultQueryOptions(t){if(t._defaulted)return t;const e={...this.#n.queries,...this.getQueryDefaults(t.queryKey),...t,_defaulted:!0};return e.queryHash||(e.queryHash=J0(e.queryKey,e)),e.refetchOnReconnect===void 0&&(e.refetchOnReconnect=e.networkMode!=="always"),e.throwOnError===void 0&&(e.throwOnError=!!e.suspense),!e.networkMode&&e.persister&&(e.networkMode="offlineFirst"),e.queryFn===Z0&&(e.enabled=!1),e}defaultMutationOptions(t){return t?._defaulted?t:{...this.#n.mutations,...t?.mutationKey&&this.getMutationDefaults(t.mutationKey),...t,_defaulted:!0}}clear(){this.#e.clear(),this.#t.clear()}},k_=j.createContext(void 0),Bm=t=>{const e=j.useContext(k_);if(!e)throw new Error("No QueryClient set, use QueryClientProvider to set one");return e},gN=({client:t,children:e})=>(j.useEffect(()=>(t.mount(),()=>{t.unmount()}),[t]),d.jsx(k_.Provider,{value:t,children:e})),S_=j.createContext(!1),vN=()=>j.useContext(S_);S_.Provider;function yN(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}var wN=j.createContext(yN()),xN=()=>j.useContext(wN),_N=(t,e)=>{(t.suspense||t.throwOnError||t.experimental_prefetchInRender)&&(e.isReset()||(t.retryOnMount=!1))},bN=t=>{j.useEffect(()=>{t.clearReset()},[t])},CN=({result:t,errorResetBoundary:e,throwOnError:n,query:r,suspense:a})=>t.isError&&!e.isReset()&&!t.isFetching&&r&&(a&&t.data===void 0||y_(n,[t.error,r])),kN=t=>{if(t.suspense){const n=a=>a==="static"?a:Math.max(a??1e3,1e3),r=t.staleTime;t.staleTime=typeof r=="function"?(...a)=>n(r(...a)):n(r),typeof t.gcTime=="number"&&(t.gcTime=Math.max(t.gcTime,1e3))}},SN=(t,e)=>t.isLoading&&t.isFetching&&!e,NN=(t,e)=>t?.suspense&&e.isPending,xx=(t,e,n)=>e.fetchOptimistic(t).catch(()=>{n.clearReset()});function EN(t,e,n){const r=vN(),a=xN(),u=Bm(),h=u.defaultQueryOptions(t);u.getDefaultOptions().queries?._experimental_beforeQuery?.(h),h._optimisticResults=r?"isRestoring":"optimistic",kN(h),_N(h,a),bN(a);const m=!u.getQueryCache().get(h.queryHash),[y]=j.useState(()=>new e(u,h)),x=y.getOptimisticResult(h),k=!r&&t.subscribed!==!1;if(j.useSyncExternalStore(j.useCallback(T=>{const S=k?y.subscribe(fs.batchCalls(T)):er;return y.updateResult(),S},[y,k]),()=>y.getCurrentResult(),()=>y.getCurrentResult()),j.useEffect(()=>{y.setOptions(h)},[h,y]),NN(h,x))throw xx(h,y,a);if(CN({result:x,errorResetBoundary:a,throwOnError:h.throwOnError,query:u.getQueryCache().get(h.queryHash),suspense:h.suspense}))throw x.error;return u.getDefaultOptions().queries?._experimental_afterQuery?.(h,x),h.experimental_prefetchInRender&&!rl&&SN(x,r)&&(m?xx(h,y,a):u.getQueryCache().get(h.queryHash)?.promise)?.catch(er).finally(()=>{y.updateResult()}),h.notifyOnChangeProps?x:y.trackResult(x)}function Ld(t,e){return EN(t,aN)}function Qp(t,e){const n=Bm(),[r]=j.useState(()=>new hN(n,t));j.useEffect(()=>{r.setOptions(t)},[r,t]);const a=j.useSyncExternalStore(j.useCallback(h=>r.subscribe(fs.batchCalls(h)),[r]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),u=j.useCallback((h,m)=>{r.mutate(h,m).catch(er)},[r]);if(a.error&&y_(r.options.throwOnError,[a.error]))throw a.error;return{...a,mutate:u,mutateAsync:a.mutate}}function TN(t,e){if(t instanceof RegExp)return{keys:!1,pattern:t};var n,r,a,u,h=[],m="",y=t.split("/");for(y[0]||y.shift();a=y.shift();)n=a[0],n==="*"?(h.push(n),m+=a[1]==="?"?"(?:/(.*))?":"/(.*)"):n===":"?(r=a.indexOf("?",1),u=a.indexOf(".",1),h.push(a.substring(1,~r?r:~u?u:a.length)),m+=~r&&!~u?"(?:/([^/]+?))?":"/([^/]+?)",~u&&(m+=(~r?"?":"")+"\\"+a.substring(u))):m+="/"+a;return{keys:h,pattern:new RegExp("^"+m+(e?"(?=$|/)":"/?$"),"i")}}var Lv={exports:{}},Dv={};var _x;function IN(){if(_x)return Dv;_x=1;var t=Um();function e(T,S){return T===S&&(T!==0||1/T===1/S)||T!==T&&S!==S}var n=typeof Object.is=="function"?Object.is:e,r=t.useState,a=t.useEffect,u=t.useLayoutEffect,h=t.useDebugValue;function m(T,S){var R=S(),O=r({inst:{value:R,getSnapshot:S}}),D=O[0].inst,q=O[1];return u(function(){D.value=R,D.getSnapshot=S,y(D)&&q({inst:D})},[T,R,S]),a(function(){return y(D)&&q({inst:D}),T(function(){y(D)&&q({inst:D})})},[T]),h(R),R}function y(T){var S=T.getSnapshot;T=T.value;try{var R=S();return!n(T,R)}catch{return!0}}function x(T,S){return S()}var k=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?x:m;return Dv.useSyncExternalStore=t.useSyncExternalStore!==void 0?t.useSyncExternalStore:k,Dv}var bx;function jN(){return bx||(bx=1,Lv.exports=IN()),Lv.exports}var PN=jN();const AN=FS.useInsertionEffect,RN=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",$N=RN?j.useLayoutEffect:j.useEffect,MN=AN||$N,N_=t=>{const e=j.useRef([t,(...n)=>e[0](...n)]).current;return MN(()=>{e[0]=t}),e[1]},ON="popstate",ny="pushState",sy="replaceState",LN="hashchange",Cx=[ON,ny,sy,LN],DN=t=>{for(const e of Cx)addEventListener(e,t);return()=>{for(const e of Cx)removeEventListener(e,t)}},E_=(t,e)=>PN.useSyncExternalStore(DN,t,e),kx=()=>location.search,FN=({ssrSearch:t}={})=>E_(kx,t!=null?()=>t:kx),Sx=()=>location.pathname,UN=({ssrPath:t}={})=>E_(Sx,t!=null?()=>t:Sx),BN=(t,{replace:e=!1,state:n=null}={})=>history[e?sy:ny](n,"",t),zN=(t={})=>[UN(t),BN],Nx=Symbol.for("wouter_v3");if(typeof history<"u"&&typeof window[Nx]>"u"){for(const t of[ny,sy]){const e=history[t];history[t]=function(){const n=e.apply(this,arguments),r=new Event(t);return r.arguments=arguments,dispatchEvent(r),n}}Object.defineProperty(window,Nx,{value:!0})}const WN=(t,e)=>e.toLowerCase().indexOf(t.toLowerCase())?"~"+e:e.slice(t.length)||"/",T_=(t="")=>t==="/"?"":t,qN=(t,e)=>t[0]==="~"?t.slice(1):T_(e)+t,VN=(t="",e)=>WN(Ex(T_(t)),Ex(e)),Ex=t=>{try{return decodeURI(t)}catch{return t}},I_={hook:zN,searchHook:FN,parser:TN,base:"",ssrPath:void 0,ssrSearch:void 0,ssrContext:void 0,hrefs:t=>t},j_=j.createContext(I_),Zd=()=>j.useContext(j_),P_={},A_=j.createContext(P_),HN=()=>j.useContext(A_),zm=t=>{const[e,n]=t.hook(t);return[VN(t.base,e),N_((r,a)=>n(qN(r,t.base),a))]},ua=()=>zm(Zd()),R_=(t,e,n,r)=>{const{pattern:a,keys:u}=e instanceof RegExp?{keys:!1,pattern:e}:t(e||"*",r),h=a.exec(n)||[],[m,...y]=h;return m!==void 0?[!0,(()=>{const x=u!==!1?Object.fromEntries(u.map((T,S)=>[T,y[S]])):h.groups;let k={...y};return x&&Object.assign(k,x),k})(),...r?[m]:[]]:[!1,null]},KN=({children:t,...e})=>{const n=Zd(),r=e.hook?I_:n;let a=r;const[u,h]=e.ssrPath?.split("?")??[];h&&(e.ssrSearch=h,e.ssrPath=u),e.hrefs=e.hrefs??e.hook?.hrefs,e.searchHook=e.searchHook??e.hook?.searchHook;let m=j.useRef({}),y=m.current,x=y;for(let k in r){const T=k==="base"?r[k]+(e[k]||""):e[k]||r[k];y===x&&T!==x[k]&&(m.current=x={...x}),x[k]=T,(T!==r[k]||T!==a[k])&&(a=x)}return j.createElement(j_.Provider,{value:a,children:t})},Tx=({children:t,component:e},n)=>e?j.createElement(e,{params:n}):typeof t=="function"?t(n):t,GN=t=>{let e=j.useRef(P_);const n=e.current;return e.current=Object.keys(t).length!==Object.keys(n).length||Object.entries(t).some(([r,a])=>a!==n[r])?t:n},Zs=({path:t,nest:e,match:n,...r})=>{const a=Zd(),[u]=zm(a),[h,m,y]=n??R_(a.parser,t,u,e),x=GN({...HN(),...m});if(!h)return null;const k=y?j.createElement(KN,{base:y},Tx(r,x)):Tx(r,x);return j.createElement(A_.Provider,{value:x,children:k})},Ix=j.forwardRef((t,e)=>{const n=Zd(),[r,a]=zm(n),{to:u="",href:h=u,onClick:m,asChild:y,children:x,className:k,replace:T,state:S,...R}=t,O=N_(q=>{q.ctrlKey||q.metaKey||q.altKey||q.shiftKey||q.button!==0||(m?.(q),q.defaultPrevented||(q.preventDefault(),a(h,t)))}),D=n.hrefs(h[0]==="~"?h.slice(1):n.base+h,n);return y&&j.isValidElement(x)?j.cloneElement(x,{onClick:O,href:D}):j.createElement("a",{...R,onClick:O,href:D,className:k?.call?k(r===h):k,children:x,ref:e})}),$_=t=>Array.isArray(t)?t.flatMap(e=>$_(e&&e.type===j.Fragment?e.props.children:e)):[t],QN=({children:t,location:e})=>{const n=Zd(),[r]=zm(n);for(const a of $_(t)){let u=0;if(j.isValidElement(a)&&(u=R_(n.parser,a.props.path,e||r,a.props.nest))[0])return j.cloneElement(a,{match:u})}return null};const YN=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),M_=(...t)=>t.filter((e,n,r)=>!!e&&r.indexOf(e)===n).join(" ");var XN={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const JN=j.forwardRef(({color:t="currentColor",size:e=24,strokeWidth:n=2,absoluteStrokeWidth:r,className:a="",children:u,iconNode:h,...m},y)=>j.createElement("svg",{ref:y,...XN,width:e,height:e,stroke:t,strokeWidth:r?Number(n)*24/Number(e):n,className:M_("lucide",a),...m},[...h.map(([x,k])=>j.createElement(x,k)),...Array.isArray(u)?u:[u]]));const ct=(t,e)=>{const n=j.forwardRef(({className:r,...a},u)=>j.createElement(JN,{ref:u,iconNode:e,className:M_(`lucide-${YN(t)}`,r),...a}));return n.displayName=`${t}`,n};const ZN=ct("ArrowLeftRight",[["path",{d:"M8 3 4 7l4 4",key:"9rb6wj"}],["path",{d:"M4 7h16",key:"6tx8e3"}],["path",{d:"m16 21 4-4-4-4",key:"siv7j2"}],["path",{d:"M20 17H4",key:"h6l3hr"}]]);const v0=ct("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);const eE=ct("BookOpen",[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]]);const tE=ct("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);const O_=ct("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);const nE=ct("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);const sE=ct("Chrome",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["line",{x1:"21.17",x2:"12",y1:"8",y2:"8",key:"a0cw5f"}],["line",{x1:"3.95",x2:"8.54",y1:"6.06",y2:"14",key:"1kftof"}],["line",{x1:"10.88",x2:"15.46",y1:"21.94",y2:"14",key:"1ymyh8"}]]);const ry=ct("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);const rE=ct("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);const jx=ct("Clock3",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16.5 12",key:"1aq6pp"}]]);const iE=ct("Crown",[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]]);const iy=ct("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);const Px=ct("Earth",[["path",{d:"M21.54 15H17a2 2 0 0 0-2 2v4.54",key:"1djwo0"}],["path",{d:"M7 3.34V5a3 3 0 0 0 3 3a2 2 0 0 1 2 2c0 1.1.9 2 2 2a2 2 0 0 0 2-2c0-1.1.9-2 2-2h3.17",key:"1tzkfa"}],["path",{d:"M11 21.95V18a2 2 0 0 0-2-2a2 2 0 0 1-2-2v-1a2 2 0 0 0-2-2H2.05",key:"14pb5j"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);const oE=ct("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);const aE=ct("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]);const lE=ct("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);const cE=ct("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);const uE=ct("LayoutList",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}],["path",{d:"M14 4h7",key:"3xa0d5"}],["path",{d:"M14 9h7",key:"1icrd9"}],["path",{d:"M14 15h7",key:"1mj8o2"}],["path",{d:"M14 20h7",key:"11slyb"}]]);const Ax=ct("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);const dE=ct("LockOpen",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]);const L_=ct("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);const fE=ct("LogIn",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]]);const y0=ct("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);const D_=ct("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);const hE=ct("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);const pE=ct("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);const lm=ct("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);const mE=ct("Pause",[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]]);const Dd=ct("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);const F_=ct("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);const w0=ct("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);const gE=ct("Rocket",[["path",{d:"M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z",key:"m3kijz"}],["path",{d:"m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z",key:"1fmvmk"}],["path",{d:"M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0",key:"1f8sc4"}],["path",{d:"M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5",key:"qeys4"}]]);const vE=ct("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);const yE=ct("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);const U_=ct("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);const wE=ct("ShieldOff",[["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M5 5a1 1 0 0 0-1 1v7c0 5 3.5 7.5 7.67 8.94a1 1 0 0 0 .67.01c2.35-.82 4.48-1.97 5.9-3.71",key:"1jlk70"}],["path",{d:"M9.309 3.652A12.252 12.252 0 0 0 11.24 2.28a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1v7a9.784 9.784 0 0 1-.08 1.264",key:"18rp1v"}]]);const xE=ct("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]);const cm=ct("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);const um=ct("Swords",[["polyline",{points:"14.5 17.5 3 6 3 3 6 3 17.5 14.5",key:"1hfsw2"}],["line",{x1:"13",x2:"19",y1:"19",y2:"13",key:"1vrmhu"}],["line",{x1:"16",x2:"20",y1:"16",y2:"20",key:"1bron3"}],["line",{x1:"19",x2:"21",y1:"21",y2:"19",key:"13pww6"}],["polyline",{points:"14.5 6.5 18 3 21 3 21 6 17.5 9.5",key:"hbey2j"}],["line",{x1:"5",x2:"9",y1:"14",y2:"18",key:"1hf58s"}],["line",{x1:"7",x2:"4",y1:"17",y2:"20",key:"pidxm4"}],["line",{x1:"3",x2:"5",y1:"19",y2:"21",key:"1pehsh"}]]);const _E=ct("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);const bE=ct("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);const oy=ct("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);const CE=ct("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);const B_=ct("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]);const ay=ct("UserRound",[["circle",{cx:"12",cy:"8",r:"5",key:"1hypcn"}],["path",{d:"M20 21a8 8 0 0 0-16 0",key:"rfgkzh"}]]);const kE=ct("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);const SE=ct("Video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]]);const NE=ct("Volume2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]);const EE=ct("VolumeX",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]);const nr=ct("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);const TE=ct("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),x0="/assets/Pawn%20Point%20Icon-C6jPZUFy.png";function IE(){const[,t]=ua(),[e,n]=j.useState(!1),r=()=>n(a=>!a);return d.jsxs("div",{className:`min-h-screen relative overflow-hidden ${e?"bg-[#f7f7fb] text-slate-900":"bg-[#0b0f1c] text-white"}`,children:[d.jsxs("div",{className:"pointer-events-none absolute inset-0",children:[d.jsx("div",{className:`absolute -left-24 top-24 h-72 w-72 ${e?"bg-pink-300/30":"bg-pink-500/20"} blur-[120px]`}),d.jsx("div",{className:`absolute right-0 top-10 h-96 w-96 ${e?"bg-purple-300/30":"bg-purple-500/25"} blur-[160px]`})]}),d.jsx("div",{className:`relative ${e?"bg-white/90 border-b border-slate-200":"bg-[#0b0f1c]/90 border-b border-white/5"}`,children:d.jsxs("div",{className:"max-w-6xl w-full mx-auto px-4 sm:px-6 h-16 flex items-center justify-between",children:[d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:"h-10 w-10 rounded-xl bg-white flex items-center justify-center shadow-[0_12px_30px_rgba(0,0,0,0.25)] overflow-hidden",children:d.jsx("img",{src:x0,alt:"Pawn Point logo",className:"h-full w-full object-cover"})}),d.jsx("span",{className:"text-2xl font-extrabold tracking-tight",children:"Pawn Point"})]}),d.jsxs("div",{className:"flex items-center gap-3 md:hidden",children:[d.jsx("button",{onClick:r,className:`h-9 w-9 rounded-full border flex items-center justify-center transition ${e?"bg-slate-100 border-slate-300 text-slate-800 hover:bg-slate-200":"bg-white/5 border-white/10 text-white hover:bg-white/10"}`,"aria-label":"Toggle theme",children:e?d.jsx(lm,{className:"h-4 w-4"}):d.jsx(cm,{className:"h-4 w-4"})}),d.jsx("button",{onClick:()=>t("/login"),className:`rounded-full px-3 py-2 text-sm font-semibold border transition ${e?"border-slate-200 bg-white text-slate-900 hover:bg-slate-100":"border-white/10 bg-white/5 text-white hover:bg-white/10"}`,children:"Log in"})]}),d.jsxs("div",{className:`hidden md:flex items-center gap-4 text-base font-semibold md:translate-x-[-8px] ${e?"text-slate-700":"text-white/80"}`,children:[d.jsxs("button",{onClick:()=>t("/login"),className:`transition flex items-center gap-2 ${e?"hover:text-slate-900":"hover:text-white"}`,children:[d.jsx(fE,{className:"h-5 w-5",strokeWidth:2.5}),"Log in"]}),d.jsx("button",{onClick:r,className:`h-9 w-9 rounded-full border flex items-center justify-center transition ${e?"bg-slate-100 border-slate-300 text-slate-800 hover:bg-slate-200":"bg-white/5 border-white/10 text-white hover:bg-white/10"}`,"aria-label":"Toggle theme",children:e?d.jsx(lm,{className:"h-4 w-4"}):d.jsx(cm,{className:"h-4 w-4"})})]})]})}),d.jsx("main",{className:"relative max-w-6xl w-full mx-auto px-4 sm:px-6 pb-20 pt-10 sm:pt-12 min-h-[calc(100vh-64px)] flex items-center",children:d.jsxs("section",{className:"w-full grid md:grid-cols-2 gap-10 sm:gap-12 items-center",children:[d.jsxs("div",{className:"space-y-6 relative flex flex-col items-center text-center md:items-start md:text-left",children:[d.jsx("div",{className:"absolute -left-10 -top-6 h-20 w-20 rounded-full bg-pink-500/20 blur-3xl"}),d.jsx("h1",{className:"text-4xl sm:text-5xl md:text-6xl font-extrabold leading-tight text-[#ff0fb3] drop-shadow-[0_10px_35px_rgba(255,15,179,0.35)]",children:"Become the Player You Were Meant to Be"}),d.jsx("p",{className:`text-lg leading-relaxed ${e?"text-slate-700":"text-white/80"}`,children:"Pawn Point gives you the roadmap to real improvement. Learn smarter, train efficient, and develop the skills that actually win games."}),d.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-3 w-full sm:w-auto",children:[d.jsx("button",{onClick:()=>t("/signup"),className:"w-full sm:w-auto rounded-full bg-[#ff0fb3] hover:bg-pink-500 text-white px-5 py-3 text-sm font-semibold shadow-[0_10px_30px_rgba(255,15,179,0.35)] transition",children:"Start free"}),d.jsx("button",{onClick:()=>t("/login"),className:`w-full sm:w-auto rounded-full px-5 py-3 text-sm font-semibold border transition ${e?"border-slate-300 bg-white text-slate-900 hover:bg-slate-100":"border-white/15 bg-white/5 text-white hover:bg-white/10"}`,children:"I already have an account"})]})]}),d.jsxs("div",{className:"relative flex justify-center items-center",children:[d.jsx("div",{className:"absolute -inset-10 bg-gradient-to-br from-[#ff0fb3]/25 via-[#7c3aed]/20 to-[#0ea5e9]/25 blur-[140px]"}),d.jsx("div",{className:`relative w-full max-w-[320px] sm:max-w-[360px] aspect-square overflow-hidden rounded-[28px] sm:rounded-[32px] border ${e?"border-slate-200 bg-white":"border-white/10 bg-white/5"} shadow-[0_20px_60px_rgba(0,0,0,0.45)]`,children:d.jsx("img",{src:x0,alt:"Pawn Point icon",className:"h-full w-full object-cover"})})]})]})})]})}function z_(t){var e,n,r="";if(typeof t=="string"||typeof t=="number")r+=t;else if(typeof t=="object")if(Array.isArray(t)){var a=t.length;for(e=0;e<a;e++)t[e]&&(n=z_(t[e]))&&(r&&(r+=" "),r+=n)}else for(n in t)t[n]&&(r&&(r+=" "),r+=n);return r}function Oc(){for(var t,e,n=0,r="",a=arguments.length;n<a;n++)(t=arguments[n])&&(e=z_(t))&&(r&&(r+=" "),r+=e);return r}const Le=j.forwardRef(function({className:e,variant:n="primary",...r},a){const u="inline-flex items-center justify-center rounded-full px-4 py-2 text-sm font-semibold transition",h={primary:"bg-brand.pink hover:bg-pink-500 text-white shadow-glow",ghost:"bg-transparent hover:bg-white/10 text-white",outline:"border border-white/30 text-white hover:bg-white/10"};return d.jsx("button",{ref:a,className:Oc(u,h[n],e),...r})}),jE=()=>{};var Rx={};const W_={NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};const Te=function(t,e){if(!t)throw Lc(e)},Lc=function(t){return new Error("Firebase Database ("+W_.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)};const q_=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let a=t.charCodeAt(r);a<128?e[n++]=a:a<2048?(e[n++]=a>>6|192,e[n++]=a&63|128):(a&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(a=65536+((a&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=a>>18|240,e[n++]=a>>12&63|128,e[n++]=a>>6&63|128,e[n++]=a&63|128):(e[n++]=a>>12|224,e[n++]=a>>6&63|128,e[n++]=a&63|128)}return e},PE=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const a=t[n++];if(a<128)e[r++]=String.fromCharCode(a);else if(a>191&&a<224){const u=t[n++];e[r++]=String.fromCharCode((a&31)<<6|u&63)}else if(a>239&&a<365){const u=t[n++],h=t[n++],m=t[n++],y=((a&7)<<18|(u&63)<<12|(h&63)<<6|m&63)-65536;e[r++]=String.fromCharCode(55296+(y>>10)),e[r++]=String.fromCharCode(56320+(y&1023))}else{const u=t[n++],h=t[n++];e[r++]=String.fromCharCode((a&15)<<12|(u&63)<<6|h&63)}}return e.join("")},ly={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let a=0;a<t.length;a+=3){const u=t[a],h=a+1<t.length,m=h?t[a+1]:0,y=a+2<t.length,x=y?t[a+2]:0,k=u>>2,T=(u&3)<<4|m>>4;let S=(m&15)<<2|x>>6,R=x&63;y||(R=64,h||(S=64)),r.push(n[k],n[T],n[S],n[R])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(q_(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):PE(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let a=0;a<t.length;){const u=n[t.charAt(a++)],m=a<t.length?n[t.charAt(a)]:0;++a;const x=a<t.length?n[t.charAt(a)]:64;++a;const T=a<t.length?n[t.charAt(a)]:64;if(++a,u==null||m==null||x==null||T==null)throw new AE;const S=u<<2|m>>4;if(r.push(S),x!==64){const R=m<<4&240|x>>2;if(r.push(R),T!==64){const O=x<<6&192|T;r.push(O)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class AE extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const V_=function(t){const e=q_(t);return ly.encodeByteArray(e,!0)},dm=function(t){return V_(t).replace(/\./g,"")},fm=function(t){try{return ly.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function RE(t){return H_(void 0,t)}function H_(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const n=e;return new Date(n.getTime());case Object:t===void 0&&(t={});break;case Array:t=[];break;default:return e}for(const n in e)!e.hasOwnProperty(n)||!$E(n)||(t[n]=H_(t[n],e[n]));return t}function $E(t){return t!=="__proto__"}function ME(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const OE=()=>ME().__FIREBASE_DEFAULTS__,LE=()=>{if(typeof process>"u"||typeof Rx>"u")return;const t=Rx.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},DE=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&fm(t[1]);return e&&JSON.parse(e)},cy=()=>{try{return jE()||OE()||LE()||DE()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},K_=t=>cy()?.emulatorHosts?.[t],FE=t=>{const e=K_(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},G_=()=>cy()?.config,Q_=t=>cy()?.[`_${t}`];class ef{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}function Dc(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Y_(t){return(await fetch(t,{credentials:"include"})).ok}function UE(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",a=t.iat||0,u=t.sub||t.user_id;if(!u)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const h={iss:`https://securetoken.google.com/${r}`,aud:r,iat:a,exp:a+3600,auth_time:a,sub:u,user_id:u,firebase:{sign_in_provider:"custom",identities:{}},...t};return[dm(JSON.stringify(n)),dm(JSON.stringify(h)),""].join(".")}const Id={};function BE(){const t={prod:[],emulator:[]};for(const e of Object.keys(Id))Id[e]?t.emulator.push(e):t.prod.push(e);return t}function zE(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}let $x=!1;function X_(t,e){if(typeof window>"u"||typeof document>"u"||!Dc(window.location.host)||Id[t]===e||Id[t]||$x)return;Id[t]=e;function n(S){return`__firebase__banner__${S}`}const r="__firebase__banner",u=BE().prod.length>0;function h(){const S=document.getElementById(r);S&&S.remove()}function m(S){S.style.display="flex",S.style.background="#7faaf0",S.style.position="fixed",S.style.bottom="5px",S.style.left="5px",S.style.padding=".5em",S.style.borderRadius="5px",S.style.alignItems="center"}function y(S,R){S.setAttribute("width","24"),S.setAttribute("id",R),S.setAttribute("height","24"),S.setAttribute("viewBox","0 0 24 24"),S.setAttribute("fill","none"),S.style.marginLeft="-6px"}function x(){const S=document.createElement("span");return S.style.cursor="pointer",S.style.marginLeft="16px",S.style.fontSize="24px",S.innerHTML=" &times;",S.onclick=()=>{$x=!0,h()},S}function k(S,R){S.setAttribute("id",R),S.innerText="Learn more",S.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",S.setAttribute("target","__blank"),S.style.paddingLeft="5px",S.style.textDecoration="underline"}function T(){const S=zE(r),R=n("text"),O=document.getElementById(R)||document.createElement("span"),D=n("learnmore"),q=document.getElementById(D)||document.createElement("a"),he=n("preprendIcon"),ce=document.getElementById(he)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(S.created){const C=S.element;m(C),k(q,D);const le=x();y(ce,he),C.append(ce,O,q,le),document.body.appendChild(C)}u?(O.innerText="Preview backend disconnected.",ce.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(ce.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,O.innerText="Preview backend running in this workspace."),O.setAttribute("id",R)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",T):T()}function rr(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function uy(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(rr())}function WE(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function qE(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function J_(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function VE(){const t=rr();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function HE(){return W_.NODE_ADMIN===!0}function KE(){try{return typeof indexedDB=="object"}catch{return!1}}function GE(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",a=self.indexedDB.open(r);a.onsuccess=()=>{a.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},a.onupgradeneeded=()=>{n=!1},a.onerror=()=>{e(a.error?.message||"")}}catch(n){e(n)}})}const QE="FirebaseError";class da extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=QE,Object.setPrototypeOf(this,da.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,tf.prototype.create)}}class tf{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},a=`${this.service}/${e}`,u=this.errors[e],h=u?YE(u,r):"Error",m=`${this.serviceName}: ${h} (${a}).`;return new da(a,m,r)}}function YE(t,e){return t.replace(XE,(n,r)=>{const a=e[r];return a!=null?String(a):`<${r}?>`})}const XE=/\{\$([^}]+)}/g;function Fd(t){return JSON.parse(t)}function ps(t){return JSON.stringify(t)}const Z_=function(t){let e={},n={},r={},a="";try{const u=t.split(".");e=Fd(fm(u[0])||""),n=Fd(fm(u[1])||""),a=u[2],r=n.d||{},delete n.d}catch{}return{header:e,claims:n,data:r,signature:a}},JE=function(t){const e=Z_(t),n=e.claims;return!!n&&typeof n=="object"&&n.hasOwnProperty("iat")},ZE=function(t){const e=Z_(t).claims;return typeof e=="object"&&e.admin===!0};function ji(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Sc(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]}function _0(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function hm(t,e,n){const r={};for(const a in t)Object.prototype.hasOwnProperty.call(t,a)&&(r[a]=e.call(n,t[a],a,t));return r}function ol(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const a of n){if(!r.includes(a))return!1;const u=t[a],h=e[a];if(Mx(u)&&Mx(h)){if(!ol(u,h))return!1}else if(u!==h)return!1}for(const a of r)if(!n.includes(a))return!1;return!0}function Mx(t){return t!==null&&typeof t=="object"}function Fc(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(a=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(a))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Sd(t){const e={};return t.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[a,u]=r.split("=");e[decodeURIComponent(a)]=decodeURIComponent(u)}}),e}function Nd(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}class e2{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,n){n||(n=0);const r=this.W_;if(typeof e=="string")for(let T=0;T<16;T++)r[T]=e.charCodeAt(n)<<24|e.charCodeAt(n+1)<<16|e.charCodeAt(n+2)<<8|e.charCodeAt(n+3),n+=4;else for(let T=0;T<16;T++)r[T]=e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3],n+=4;for(let T=16;T<80;T++){const S=r[T-3]^r[T-8]^r[T-14]^r[T-16];r[T]=(S<<1|S>>>31)&4294967295}let a=this.chain_[0],u=this.chain_[1],h=this.chain_[2],m=this.chain_[3],y=this.chain_[4],x,k;for(let T=0;T<80;T++){T<40?T<20?(x=m^u&(h^m),k=1518500249):(x=u^h^m,k=1859775393):T<60?(x=u&h|m&(u|h),k=2400959708):(x=u^h^m,k=3395469782);const S=(a<<5|a>>>27)+x+y+k+r[T]&4294967295;y=m,m=h,h=(u<<30|u>>>2)&4294967295,u=a,a=S}this.chain_[0]=this.chain_[0]+a&4294967295,this.chain_[1]=this.chain_[1]+u&4294967295,this.chain_[2]=this.chain_[2]+h&4294967295,this.chain_[3]=this.chain_[3]+m&4294967295,this.chain_[4]=this.chain_[4]+y&4294967295}update(e,n){if(e==null)return;n===void 0&&(n=e.length);const r=n-this.blockSize;let a=0;const u=this.buf_;let h=this.inbuf_;for(;a<n;){if(h===0)for(;a<=r;)this.compress_(e,a),a+=this.blockSize;if(typeof e=="string"){for(;a<n;)if(u[h]=e.charCodeAt(a),++h,++a,h===this.blockSize){this.compress_(u),h=0;break}}else for(;a<n;)if(u[h]=e[a],++h,++a,h===this.blockSize){this.compress_(u),h=0;break}}this.inbuf_=h,this.total_+=n}digest(){const e=[];let n=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let a=this.blockSize-1;a>=56;a--)this.buf_[a]=n&255,n/=256;this.compress_(this.buf_);let r=0;for(let a=0;a<5;a++)for(let u=24;u>=0;u-=8)e[r]=this.chain_[a]>>u&255,++r;return e}}function t2(t,e){const n=new n2(t,e);return n.subscribe.bind(n)}class n2{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,r){let a;if(e===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");s2(e,["next","error","complete"])?a=e:a={next:e,error:n,complete:r},a.next===void 0&&(a.next=Fv),a.error===void 0&&(a.error=Fv),a.complete===void 0&&(a.complete=Fv);const u=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?a.error(this.finalError):a.complete()}catch{}}),this.observers.push(a),u}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function s2(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function Fv(){}function Wm(t,e){return`${t} failed: ${e} argument `}const r2=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let a=t.charCodeAt(r);if(a>=55296&&a<=56319){const u=a-55296;r++,Te(r<t.length,"Surrogate pair missing trail surrogate.");const h=t.charCodeAt(r)-56320;a=65536+(u<<10)+h}a<128?e[n++]=a:a<2048?(e[n++]=a>>6|192,e[n++]=a&63|128):a<65536?(e[n++]=a>>12|224,e[n++]=a>>6&63|128,e[n++]=a&63|128):(e[n++]=a>>18|240,e[n++]=a>>12&63|128,e[n++]=a>>6&63|128,e[n++]=a&63|128)}return e},qm=function(t){let e=0;for(let n=0;n<t.length;n++){const r=t.charCodeAt(n);r<128?e++:r<2048?e+=2:r>=55296&&r<=56319?(e+=4,n++):e+=3}return e};function Os(t){return t&&t._delegate?t._delegate:t}class al{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const Ya="[DEFAULT]";class i2{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new ef;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const a=this.getOrInitializeService({instanceIdentifier:n});a&&r.resolve(a)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){const n=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(a){if(r)return null;throw a}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(a2(e))try{this.getOrInitializeService({instanceIdentifier:Ya})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(n);try{const u=this.getOrInitializeService({instanceIdentifier:a});r.resolve(u)}catch{}}}}clearInstance(e=Ya){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Ya){return this.instances.has(e)}getOptions(e=Ya){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const a=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[u,h]of this.instancesDeferred.entries()){const m=this.normalizeInstanceIdentifier(u);r===m&&h.resolve(a)}return a}onInit(e,n){const r=this.normalizeInstanceIdentifier(n),a=this.onInitCallbacks.get(r)??new Set;a.add(e),this.onInitCallbacks.set(r,a);const u=this.instances.get(r);return u&&e(u,r),()=>{a.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const a of r)try{a(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:o2(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Ya){return this.component?this.component.multipleInstances?e:Ya:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function o2(t){return t===Ya?void 0:t}function a2(t){return t.instantiationMode==="EAGER"}class l2{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new i2(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}var dn;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(dn||(dn={}));const c2={debug:dn.DEBUG,verbose:dn.VERBOSE,info:dn.INFO,warn:dn.WARN,error:dn.ERROR,silent:dn.SILENT},u2=dn.INFO,d2={[dn.DEBUG]:"log",[dn.VERBOSE]:"log",[dn.INFO]:"info",[dn.WARN]:"warn",[dn.ERROR]:"error"},f2=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),a=d2[e];if(a)console[a](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class dy{constructor(e){this.name=e,this._logLevel=u2,this._logHandler=f2,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in dn))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?c2[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,dn.DEBUG,...e),this._logHandler(this,dn.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,dn.VERBOSE,...e),this._logHandler(this,dn.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,dn.INFO,...e),this._logHandler(this,dn.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,dn.WARN,...e),this._logHandler(this,dn.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,dn.ERROR,...e),this._logHandler(this,dn.ERROR,...e)}}const h2=(t,e)=>e.some(n=>t instanceof n);let Ox,Lx;function p2(){return Ox||(Ox=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function m2(){return Lx||(Lx=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const eb=new WeakMap,b0=new WeakMap,tb=new WeakMap,Uv=new WeakMap,fy=new WeakMap;function g2(t){const e=new Promise((n,r)=>{const a=()=>{t.removeEventListener("success",u),t.removeEventListener("error",h)},u=()=>{n(na(t.result)),a()},h=()=>{r(t.error),a()};t.addEventListener("success",u),t.addEventListener("error",h)});return e.then(n=>{n instanceof IDBCursor&&eb.set(n,t)}).catch(()=>{}),fy.set(e,t),e}function v2(t){if(b0.has(t))return;const e=new Promise((n,r)=>{const a=()=>{t.removeEventListener("complete",u),t.removeEventListener("error",h),t.removeEventListener("abort",h)},u=()=>{n(),a()},h=()=>{r(t.error||new DOMException("AbortError","AbortError")),a()};t.addEventListener("complete",u),t.addEventListener("error",h),t.addEventListener("abort",h)});b0.set(t,e)}let C0={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return b0.get(t);if(e==="objectStoreNames")return t.objectStoreNames||tb.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return na(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function y2(t){C0=t(C0)}function w2(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(Bv(this),e,...n);return tb.set(r,e.sort?e.sort():[e]),na(r)}:m2().includes(t)?function(...e){return t.apply(Bv(this),e),na(eb.get(this))}:function(...e){return na(t.apply(Bv(this),e))}}function x2(t){return typeof t=="function"?w2(t):(t instanceof IDBTransaction&&v2(t),h2(t,p2())?new Proxy(t,C0):t)}function na(t){if(t instanceof IDBRequest)return g2(t);if(Uv.has(t))return Uv.get(t);const e=x2(t);return e!==t&&(Uv.set(t,e),fy.set(e,t)),e}const Bv=t=>fy.get(t);function _2(t,e,{blocked:n,upgrade:r,blocking:a,terminated:u}={}){const h=indexedDB.open(t,e),m=na(h);return r&&h.addEventListener("upgradeneeded",y=>{r(na(h.result),y.oldVersion,y.newVersion,na(h.transaction),y)}),n&&h.addEventListener("blocked",y=>n(y.oldVersion,y.newVersion,y)),m.then(y=>{u&&y.addEventListener("close",()=>u()),a&&y.addEventListener("versionchange",x=>a(x.oldVersion,x.newVersion,x))}).catch(()=>{}),m}const b2=["get","getKey","getAll","getAllKeys","count"],C2=["put","add","delete","clear"],zv=new Map;function Dx(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(zv.get(e))return zv.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,a=C2.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(a||b2.includes(n)))return;const u=async function(h,...m){const y=this.transaction(h,a?"readwrite":"readonly");let x=y.store;return r&&(x=x.index(m.shift())),(await Promise.all([x[n](...m),a&&y.done]))[0]};return zv.set(e,u),u}y2(t=>({...t,get:(e,n,r)=>Dx(e,n)||t.get(e,n,r),has:(e,n)=>!!Dx(e,n)||t.has(e,n)}));class k2{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(S2(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function S2(t){return t.getComponent()?.type==="VERSION"}const k0="@firebase/app",Fx="0.14.6";const ao=new dy("@firebase/app"),N2="@firebase/app-compat",E2="@firebase/analytics-compat",T2="@firebase/analytics",I2="@firebase/app-check-compat",j2="@firebase/app-check",P2="@firebase/auth",A2="@firebase/auth-compat",R2="@firebase/database",$2="@firebase/data-connect",M2="@firebase/database-compat",O2="@firebase/functions",L2="@firebase/functions-compat",D2="@firebase/installations",F2="@firebase/installations-compat",U2="@firebase/messaging",B2="@firebase/messaging-compat",z2="@firebase/performance",W2="@firebase/performance-compat",q2="@firebase/remote-config",V2="@firebase/remote-config-compat",H2="@firebase/storage",K2="@firebase/storage-compat",G2="@firebase/firestore",Q2="@firebase/ai",Y2="@firebase/firestore-compat",X2="firebase",J2="12.6.0";const S0="[DEFAULT]",Z2={[k0]:"fire-core",[N2]:"fire-core-compat",[T2]:"fire-analytics",[E2]:"fire-analytics-compat",[j2]:"fire-app-check",[I2]:"fire-app-check-compat",[P2]:"fire-auth",[A2]:"fire-auth-compat",[R2]:"fire-rtdb",[$2]:"fire-data-connect",[M2]:"fire-rtdb-compat",[O2]:"fire-fn",[L2]:"fire-fn-compat",[D2]:"fire-iid",[F2]:"fire-iid-compat",[U2]:"fire-fcm",[B2]:"fire-fcm-compat",[z2]:"fire-perf",[W2]:"fire-perf-compat",[q2]:"fire-rc",[V2]:"fire-rc-compat",[H2]:"fire-gcs",[K2]:"fire-gcs-compat",[G2]:"fire-fst",[Y2]:"fire-fst-compat",[Q2]:"fire-vertex","fire-js":"fire-js",[X2]:"fire-js-all"};const pm=new Map,eT=new Map,N0=new Map;function Ux(t,e){try{t.container.addComponent(e)}catch(n){ao.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Nc(t){const e=t.name;if(N0.has(e))return ao.debug(`There were multiple attempts to register component ${e}.`),!1;N0.set(e,t);for(const n of pm.values())Ux(n,t);for(const n of eT.values())Ux(n,t);return!0}function hy(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function Ar(t){return t==null?!1:t.settings!==void 0}const tT={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},sa=new tf("app","Firebase",tT);class nT{constructor(e,n,r){this._isDeleted=!1,this._options={...e},this._config={...n},this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new al("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw sa.create("app-deleted",{appName:this._name})}}const Uc=J2;function nb(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r={name:S0,automaticDataCollectionEnabled:!0,...e},a=r.name;if(typeof a!="string"||!a)throw sa.create("bad-app-name",{appName:String(a)});if(n||(n=G_()),!n)throw sa.create("no-options");const u=pm.get(a);if(u){if(ol(n,u.options)&&ol(r,u.config))return u;throw sa.create("duplicate-app",{appName:a})}const h=new l2(a);for(const y of N0.values())h.addComponent(y);const m=new nT(n,r,h);return pm.set(a,m),m}function sb(t=S0){const e=pm.get(t);if(!e&&t===S0&&G_())return nb();if(!e)throw sa.create("no-app",{appName:t});return e}function ra(t,e,n){let r=Z2[t]??t;n&&(r+=`-${n}`);const a=r.match(/\s|\//),u=e.match(/\s|\//);if(a||u){const h=[`Unable to register library "${r}" with version "${e}":`];a&&h.push(`library name "${r}" contains illegal characters (whitespace or "/")`),a&&u&&h.push("and"),u&&h.push(`version name "${e}" contains illegal characters (whitespace or "/")`),ao.warn(h.join(" "));return}Nc(new al(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}const sT="firebase-heartbeat-database",rT=1,Ud="firebase-heartbeat-store";let Wv=null;function rb(){return Wv||(Wv=_2(sT,rT,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(Ud)}catch(n){console.warn(n)}}}}).catch(t=>{throw sa.create("idb-open",{originalErrorMessage:t.message})})),Wv}async function iT(t){try{const n=(await rb()).transaction(Ud),r=await n.objectStore(Ud).get(ib(t));return await n.done,r}catch(e){if(e instanceof da)ao.warn(e.message);else{const n=sa.create("idb-get",{originalErrorMessage:e?.message});ao.warn(n.message)}}}async function Bx(t,e){try{const r=(await rb()).transaction(Ud,"readwrite");await r.objectStore(Ud).put(e,ib(t)),await r.done}catch(n){if(n instanceof da)ao.warn(n.message);else{const r=sa.create("idb-set",{originalErrorMessage:n?.message});ao.warn(r.message)}}}function ib(t){return`${t.name}!${t.options.appId}`}const oT=1024,aT=30;class lT{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new uT(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=zx();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(a=>a.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats.length>aT){const a=dT(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(a,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){ao.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=zx(),{heartbeatsToSend:n,unsentEntries:r}=cT(this._heartbeatsCache.heartbeats),a=dm(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),a}catch(e){return ao.warn(e),""}}}function zx(){return new Date().toISOString().substring(0,10)}function cT(t,e=oT){const n=[];let r=t.slice();for(const a of t){const u=n.find(h=>h.agent===a.agent);if(u){if(u.dates.push(a.date),Wx(n)>e){u.dates.pop();break}}else if(n.push({agent:a.agent,dates:[a.date]}),Wx(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class uT{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return KE()?GE().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await iT(this.app);return n?.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return Bx(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return Bx(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function Wx(t){return dm(JSON.stringify({version:2,heartbeats:t})).length}function dT(t){if(t.length===0)return-1;let e=0,n=t[0].date;for(let r=1;r<t.length;r++)t[r].date<n&&(n=t[r].date,e=r);return e}function fT(t){Nc(new al("platform-logger",e=>new k2(e),"PRIVATE")),Nc(new al("heartbeat",e=>new lT(e),"PRIVATE")),ra(k0,Fx,t),ra(k0,Fx,"esm2020"),ra("fire-js","")}fT("");function ob(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const hT=ob,ab=new tf("auth","Firebase",ob());const mm=new dy("@firebase/auth");function pT(t,...e){mm.logLevel<=dn.WARN&&mm.warn(`Auth (${Uc}): ${t}`,...e)}function Yp(t,...e){mm.logLevel<=dn.ERROR&&mm.error(`Auth (${Uc}): ${t}`,...e)}function zr(t,...e){throw my(t,...e)}function ii(t,...e){return my(t,...e)}function py(t,e,n){const r={...hT(),[e]:n};return new tf("auth","Firebase",r).create(e,{appName:t.name})}function so(t){return py(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function mT(t,e,n){const r=n;if(!(e instanceof r))throw r.name!==e.constructor.name&&zr(t,"argument-error"),py(t,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function my(t,...e){if(typeof t!="string"){const n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return ab.create(t,...e)}function pt(t,e,...n){if(!t)throw my(e,...n)}function Ji(t){const e="INTERNAL ASSERTION FAILED: "+t;throw Yp(e),new Error(e)}function lo(t,e){t||Ji(e)}function E0(){return typeof self<"u"&&self.location?.href||""}function gT(){return qx()==="http:"||qx()==="https:"}function qx(){return typeof self<"u"&&self.location?.protocol||null}function vT(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(gT()||qE()||"connection"in navigator)?navigator.onLine:!0}function yT(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}class nf{constructor(e,n){this.shortDelay=e,this.longDelay=n,lo(n>e,"Short delay should be less than long delay!"),this.isMobile=uy()||J_()}get(){return vT()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function gy(t,e){lo(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}class lb{static initialize(e,n,r){this.fetchImpl=e,n&&(this.headersImpl=n),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Ji("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Ji("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Ji("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const wT={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const xT=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],_T=new nf(3e4,6e4);function fa(t,e){return t.tenantId&&!e.tenantId?{...e,tenantId:t.tenantId}:e}async function uo(t,e,n,r,a={}){return cb(t,a,async()=>{let u={},h={};r&&(e==="GET"?h=r:u={body:JSON.stringify(r)});const m=Fc({key:t.config.apiKey,...h}).slice(1),y=await t._getAdditionalHeaders();y["Content-Type"]="application/json",t.languageCode&&(y["X-Firebase-Locale"]=t.languageCode);const x={method:e,headers:y,...u};return WE()||(x.referrerPolicy="no-referrer"),t.emulatorConfig&&Dc(t.emulatorConfig.host)&&(x.credentials="include"),lb.fetch()(await ub(t,t.config.apiHost,n,m),x)})}async function cb(t,e,n){t._canInitEmulator=!1;const r={...wT,...e};try{const a=new CT(t),u=await Promise.race([n(),a.promise]);a.clearNetworkTimeout();const h=await u.json();if("needConfirmation"in h)throw Dp(t,"account-exists-with-different-credential",h);if(u.ok&&!("errorMessage"in h))return h;{const m=u.ok?h.errorMessage:h.error.message,[y,x]=m.split(" : ");if(y==="FEDERATED_USER_ID_ALREADY_LINKED")throw Dp(t,"credential-already-in-use",h);if(y==="EMAIL_EXISTS")throw Dp(t,"email-already-in-use",h);if(y==="USER_DISABLED")throw Dp(t,"user-disabled",h);const k=r[y]||y.toLowerCase().replace(/[_\s]+/g,"-");if(x)throw py(t,k,x);zr(t,k)}}catch(a){if(a instanceof da)throw a;zr(t,"network-request-failed",{message:String(a)})}}async function sf(t,e,n,r,a={}){const u=await uo(t,e,n,r,a);return"mfaPendingCredential"in u&&zr(t,"multi-factor-auth-required",{_serverResponse:u}),u}async function ub(t,e,n,r){const a=`${e}${n}?${r}`,u=t,h=u.config.emulator?gy(t.config,a):`${t.config.apiScheme}://${a}`;return xT.includes(n)&&(await u._persistenceManagerAvailable,u._getPersistenceType()==="COOKIE")?u._getPersistence()._getFinalTarget(h).toString():h}function bT(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class CT{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,r)=>{this.timer=setTimeout(()=>r(ii(this.auth,"network-request-failed")),_T.get())})}}function Dp(t,e,n){const r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const a=ii(t,e,r);return a.customData._tokenResponse=n,a}function Vx(t){return t!==void 0&&t.enterprise!==void 0}class kT{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const n of this.recaptchaEnforcementState)if(n.provider&&n.provider===e)return bT(n.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function ST(t,e){return uo(t,"GET","/v2/recaptchaConfig",fa(t,e))}async function NT(t,e){return uo(t,"POST","/v1/accounts:delete",e)}async function gm(t,e){return uo(t,"POST","/v1/accounts:lookup",e)}function jd(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function ET(t,e=!1){const n=Os(t),r=await n.getIdToken(e),a=vy(r);pt(a&&a.exp&&a.auth_time&&a.iat,n.auth,"internal-error");const u=typeof a.firebase=="object"?a.firebase:void 0,h=u?.sign_in_provider;return{claims:a,token:r,authTime:jd(qv(a.auth_time)),issuedAtTime:jd(qv(a.iat)),expirationTime:jd(qv(a.exp)),signInProvider:h||null,signInSecondFactor:u?.sign_in_second_factor||null}}function qv(t){return Number(t)*1e3}function vy(t){const[e,n,r]=t.split(".");if(e===void 0||n===void 0||r===void 0)return Yp("JWT malformed, contained fewer than 3 sections"),null;try{const a=fm(n);return a?JSON.parse(a):(Yp("Failed to decode base64 JWT payload"),null)}catch(a){return Yp("Caught error parsing JWT payload as JSON",a?.toString()),null}}function Hx(t){const e=vy(t);return pt(e,"internal-error"),pt(typeof e.exp<"u","internal-error"),pt(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function Ec(t,e,n=!1){if(n)return e;try{return await e}catch(r){throw r instanceof da&&TT(r)&&t.auth.currentUser===t&&await t.auth.signOut(),r}}function TT({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}class IT{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class T0{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=jd(this.lastLoginAt),this.creationTime=jd(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function vm(t){const e=t.auth,n=await t.getIdToken(),r=await Ec(t,gm(e,{idToken:n}));pt(r?.users.length,e,"internal-error");const a=r.users[0];t._notifyReloadListener(a);const u=a.providerUserInfo?.length?db(a.providerUserInfo):[],h=PT(t.providerData,u),m=t.isAnonymous,y=!(t.email&&a.passwordHash)&&!h?.length,x=m?y:!1,k={uid:a.localId,displayName:a.displayName||null,photoURL:a.photoUrl||null,email:a.email||null,emailVerified:a.emailVerified||!1,phoneNumber:a.phoneNumber||null,tenantId:a.tenantId||null,providerData:h,metadata:new T0(a.createdAt,a.lastLoginAt),isAnonymous:x};Object.assign(t,k)}async function jT(t){const e=Os(t);await vm(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function PT(t,e){return[...t.filter(r=>!e.some(a=>a.providerId===r.providerId)),...e]}function db(t){return t.map(({providerId:e,...n})=>({providerId:e,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}))}async function AT(t,e){const n=await cb(t,{},async()=>{const r=Fc({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:a,apiKey:u}=t.config,h=await ub(t,a,"/v1/token",`key=${u}`),m=await t._getAdditionalHeaders();m["Content-Type"]="application/x-www-form-urlencoded";const y={method:"POST",headers:m,body:r};return t.emulatorConfig&&Dc(t.emulatorConfig.host)&&(y.credentials="include"),lb.fetch()(h,y)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function RT(t,e){return uo(t,"POST","/v2/accounts:revokeToken",fa(t,e))}class yc{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){pt(e.idToken,"internal-error"),pt(typeof e.idToken<"u","internal-error"),pt(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Hx(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){pt(e.length!==0,"internal-error");const n=Hx(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(pt(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:r,refreshToken:a,expiresIn:u}=await AT(e,n);this.updateTokensAndExpiration(r,a,Number(u))}updateTokensAndExpiration(e,n,r){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,n){const{refreshToken:r,accessToken:a,expirationTime:u}=n,h=new yc;return r&&(pt(typeof r=="string","internal-error",{appName:e}),h.refreshToken=r),a&&(pt(typeof a=="string","internal-error",{appName:e}),h.accessToken=a),u&&(pt(typeof u=="number","internal-error",{appName:e}),h.expirationTime=u),h}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new yc,this.toJSON())}_performRefresh(){return Ji("not implemented")}}function Ho(t,e){pt(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class si{constructor({uid:e,auth:n,stsTokenManager:r,...a}){this.providerId="firebase",this.proactiveRefresh=new IT(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=a.displayName||null,this.email=a.email||null,this.emailVerified=a.emailVerified||!1,this.phoneNumber=a.phoneNumber||null,this.photoURL=a.photoURL||null,this.isAnonymous=a.isAnonymous||!1,this.tenantId=a.tenantId||null,this.providerData=a.providerData?[...a.providerData]:[],this.metadata=new T0(a.createdAt||void 0,a.lastLoginAt||void 0)}async getIdToken(e){const n=await Ec(this,this.stsTokenManager.getToken(this.auth,e));return pt(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return ET(this,e)}reload(){return jT(this)}_assign(e){this!==e&&(pt(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>({...n})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new si({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return n.metadata._copy(this.metadata),n}_onReload(e){pt(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),n&&await vm(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Ar(this.auth.app))return Promise.reject(so(this.auth));const e=await this.getIdToken();return await Ec(this,NT(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){const r=n.displayName??void 0,a=n.email??void 0,u=n.phoneNumber??void 0,h=n.photoURL??void 0,m=n.tenantId??void 0,y=n._redirectEventId??void 0,x=n.createdAt??void 0,k=n.lastLoginAt??void 0,{uid:T,emailVerified:S,isAnonymous:R,providerData:O,stsTokenManager:D}=n;pt(T&&D,e,"internal-error");const q=yc.fromJSON(this.name,D);pt(typeof T=="string",e,"internal-error"),Ho(r,e.name),Ho(a,e.name),pt(typeof S=="boolean",e,"internal-error"),pt(typeof R=="boolean",e,"internal-error"),Ho(u,e.name),Ho(h,e.name),Ho(m,e.name),Ho(y,e.name),Ho(x,e.name),Ho(k,e.name);const he=new si({uid:T,auth:e,email:a,emailVerified:S,displayName:r,isAnonymous:R,photoURL:h,phoneNumber:u,tenantId:m,stsTokenManager:q,createdAt:x,lastLoginAt:k});return O&&Array.isArray(O)&&(he.providerData=O.map(ce=>({...ce}))),y&&(he._redirectEventId=y),he}static async _fromIdTokenResponse(e,n,r=!1){const a=new yc;a.updateFromServerResponse(n);const u=new si({uid:n.localId,auth:e,stsTokenManager:a,isAnonymous:r});return await vm(u),u}static async _fromGetAccountInfoResponse(e,n,r){const a=n.users[0];pt(a.localId!==void 0,"internal-error");const u=a.providerUserInfo!==void 0?db(a.providerUserInfo):[],h=!(a.email&&a.passwordHash)&&!u?.length,m=new yc;m.updateFromIdToken(r);const y=new si({uid:a.localId,auth:e,stsTokenManager:m,isAnonymous:h}),x={uid:a.localId,displayName:a.displayName||null,photoURL:a.photoUrl||null,email:a.email||null,emailVerified:a.emailVerified||!1,phoneNumber:a.phoneNumber||null,tenantId:a.tenantId||null,providerData:u,metadata:new T0(a.createdAt,a.lastLoginAt),isAnonymous:!(a.email&&a.passwordHash)&&!u?.length};return Object.assign(y,x),y}}const Kx=new Map;function Zi(t){lo(t instanceof Function,"Expected a class definition");let e=Kx.get(t);return e?(lo(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,Kx.set(t,e),e)}class fb{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}fb.type="NONE";const Gx=fb;function Xp(t,e,n){return`firebase:${t}:${e}:${n}`}class wc{constructor(e,n,r){this.persistence=e,this.auth=n,this.userKey=r;const{config:a,name:u}=this.auth;this.fullUserKey=Xp(this.userKey,a.apiKey,u),this.fullPersistenceKey=Xp("persistence",a.apiKey,u),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const n=await gm(this.auth,{idToken:e}).catch(()=>{});return n?si._fromGetAccountInfoResponse(this.auth,n,e):null}return si._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,r="authUser"){if(!n.length)return new wc(Zi(Gx),e,r);const a=(await Promise.all(n.map(async x=>{if(await x._isAvailable())return x}))).filter(x=>x);let u=a[0]||Zi(Gx);const h=Xp(r,e.config.apiKey,e.name);let m=null;for(const x of n)try{const k=await x._get(h);if(k){let T;if(typeof k=="string"){const S=await gm(e,{idToken:k}).catch(()=>{});if(!S)break;T=await si._fromGetAccountInfoResponse(e,S,k)}else T=si._fromJSON(e,k);x!==u&&(m=T),u=x;break}}catch{}const y=a.filter(x=>x._shouldAllowMigration);return!u._shouldAllowMigration||!y.length?new wc(u,e,r):(u=y[0],m&&await u._set(h,m.toJSON()),await Promise.all(n.map(async x=>{if(x!==u)try{await x._remove(h)}catch{}})),new wc(u,e,r))}}function Qx(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(gb(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(hb(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(yb(e))return"Blackberry";if(wb(e))return"Webos";if(pb(e))return"Safari";if((e.includes("chrome/")||mb(e))&&!e.includes("edge/"))return"Chrome";if(vb(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(n);if(r?.length===2)return r[1]}return"Other"}function hb(t=rr()){return/firefox\//i.test(t)}function pb(t=rr()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function mb(t=rr()){return/crios\//i.test(t)}function gb(t=rr()){return/iemobile/i.test(t)}function vb(t=rr()){return/android/i.test(t)}function yb(t=rr()){return/blackberry/i.test(t)}function wb(t=rr()){return/webos/i.test(t)}function yy(t=rr()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function $T(t=rr()){return yy(t)&&!!window.navigator?.standalone}function MT(){return VE()&&document.documentMode===10}function xb(t=rr()){return yy(t)||vb(t)||wb(t)||yb(t)||/windows phone/i.test(t)||gb(t)}function _b(t,e=[]){let n;switch(t){case"Browser":n=Qx(rr());break;case"Worker":n=`${Qx(rr())}-${t}`;break;default:n=t}const r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${Uc}/${r}`}class OT{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const r=u=>new Promise((h,m)=>{try{const y=e(u);h(y)}catch(y){m(y)}});r.onAbort=n,this.queue.push(r);const a=this.queue.length-1;return()=>{this.queue[a]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const r of this.queue)await r(e),r.onAbort&&n.push(r.onAbort)}catch(r){n.reverse();for(const a of n)try{a()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}}}async function LT(t,e={}){return uo(t,"GET","/v2/passwordPolicy",fa(t,e))}const DT=6;class FT{constructor(e){const n=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=n.minPasswordLength??DT,n.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=n.maxPasswordLength),n.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=n.containsLowercaseCharacter),n.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=n.containsUppercaseCharacter),n.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=n.containsNumericCharacter),n.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=n.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const n={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,n),this.validatePasswordCharacterOptions(e,n),n.isValid&&(n.isValid=n.meetsMinPasswordLength??!0),n.isValid&&(n.isValid=n.meetsMaxPasswordLength??!0),n.isValid&&(n.isValid=n.containsLowercaseLetter??!0),n.isValid&&(n.isValid=n.containsUppercaseLetter??!0),n.isValid&&(n.isValid=n.containsNumericCharacter??!0),n.isValid&&(n.isValid=n.containsNonAlphanumericCharacter??!0),n}validatePasswordLengthOptions(e,n){const r=this.customStrengthOptions.minPasswordLength,a=this.customStrengthOptions.maxPasswordLength;r&&(n.meetsMinPasswordLength=e.length>=r),a&&(n.meetsMaxPasswordLength=e.length<=a)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let r;for(let a=0;a<e.length;a++)r=e.charAt(a),this.updatePasswordCharacterOptionsStatuses(n,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,n,r,a,u){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=a)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=u))}}class UT{constructor(e,n,r,a){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=a,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Yx(this),this.idTokenSubscription=new Yx(this),this.beforeStateQueue=new OT(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=ab,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=a.sdkClientVersion,this._persistenceManagerAvailable=new Promise(u=>this._resolvePersistenceManagerAvailable=u)}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=Zi(n)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await wc.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await gm(this,{idToken:e}),r=await si._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(r)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(Ar(this.app)){const u=this.app.settings.authIdToken;return u?new Promise(h=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(u).then(h,h))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let r=n,a=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const u=this.redirectUser?._redirectEventId,h=r?._redirectEventId,m=await this.tryRedirectSignIn(e);(!u||u===h)&&m?.user&&(r=m.user,a=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(a)try{await this.beforeStateQueue.runMiddleware(r)}catch(u){r=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(u))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return pt(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await vm(e)}catch(n){if(n?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=yT()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Ar(this.app))return Promise.reject(so(this));const n=e?Os(e):null;return n&&pt(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&pt(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Ar(this.app)?Promise.reject(so(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Ar(this.app)?Promise.reject(so(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Zi(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await LT(this),n=new FT(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new tf("auth","Firebase",e())}onAuthStateChanged(e,n,r){return this.registerStateListener(this.authStateSubscription,e,n,r)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,r){return this.registerStateListener(this.idTokenSubscription,e,n,r)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(r.tenantId=this.tenantId),await RT(this,r)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,n){const r=await this.getOrInitRedirectPersistenceManager(n);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&Zi(e)||this._popupRedirectResolver;pt(n,this,"argument-error"),this.redirectPersistenceManager=await wc.create(this,[Zi(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,r,a){if(this._deleted)return()=>{};const u=typeof n=="function"?n:n.next.bind(n);let h=!1;const m=this._isInitialized?Promise.resolve():this._initializationPromise;if(pt(m,this,"internal-error"),m.then(()=>{h||u(this.currentUser)}),typeof n=="function"){const y=e.addObserver(n,r,a);return()=>{h=!0,y()}}else{const y=e.addObserver(n);return()=>{h=!0,y()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return pt(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=_b(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const n=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();n&&(e["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){if(Ar(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&pT(`Error while retrieving App Check token: ${e.error}`),e?.token}}function ha(t){return Os(t)}class Yx{constructor(e){this.auth=e,this.observer=null,this.addObserver=t2(n=>this.observer=n)}get next(){return pt(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let Vm={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function BT(t){Vm=t}function bb(t){return Vm.loadJS(t)}function zT(){return Vm.recaptchaEnterpriseScript}function WT(){return Vm.gapiScript}function qT(t){return`__${t}${Math.floor(Math.random()*1e6)}`}class VT{constructor(){this.enterprise=new HT}ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}class HT{ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}const KT="recaptcha-enterprise",Cb="NO_RECAPTCHA";class GT{constructor(e){this.type=KT,this.auth=ha(e)}async verify(e="verify",n=!1){async function r(u){if(!n){if(u.tenantId==null&&u._agentRecaptchaConfig!=null)return u._agentRecaptchaConfig.siteKey;if(u.tenantId!=null&&u._tenantRecaptchaConfigs[u.tenantId]!==void 0)return u._tenantRecaptchaConfigs[u.tenantId].siteKey}return new Promise(async(h,m)=>{ST(u,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(y=>{if(y.recaptchaKey===void 0)m(new Error("recaptcha Enterprise site key undefined"));else{const x=new kT(y);return u.tenantId==null?u._agentRecaptchaConfig=x:u._tenantRecaptchaConfigs[u.tenantId]=x,h(x.siteKey)}}).catch(y=>{m(y)})})}function a(u,h,m){const y=window.grecaptcha;Vx(y)?y.enterprise.ready(()=>{y.enterprise.execute(u,{action:e}).then(x=>{h(x)}).catch(()=>{h(Cb)})}):m(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new VT().execute("siteKey",{action:"verify"}):new Promise((u,h)=>{r(this.auth).then(m=>{if(!n&&Vx(window.grecaptcha))a(m,u,h);else{if(typeof window>"u"){h(new Error("RecaptchaVerifier is only supported in browser"));return}let y=zT();y.length!==0&&(y+=m),bb(y).then(()=>{a(m,u,h)}).catch(x=>{h(x)})}}).catch(m=>{h(m)})})}}async function Xx(t,e,n,r=!1,a=!1){const u=new GT(t);let h;if(a)h=Cb;else try{h=await u.verify(n)}catch{h=await u.verify(n,!0)}const m={...e};if(n==="mfaSmsEnrollment"||n==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in m){const y=m.phoneEnrollmentInfo.phoneNumber,x=m.phoneEnrollmentInfo.recaptchaToken;Object.assign(m,{phoneEnrollmentInfo:{phoneNumber:y,recaptchaToken:x,captchaResponse:h,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in m){const y=m.phoneSignInInfo.recaptchaToken;Object.assign(m,{phoneSignInInfo:{recaptchaToken:y,captchaResponse:h,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return m}return r?Object.assign(m,{captchaResp:h}):Object.assign(m,{captchaResponse:h}),Object.assign(m,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(m,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),m}async function I0(t,e,n,r,a){if(t._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const u=await Xx(t,e,n,n==="getOobCode");return r(t,u)}else return r(t,e).catch(async u=>{if(u.code==="auth/missing-recaptcha-token"){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const h=await Xx(t,e,n,n==="getOobCode");return r(t,h)}else return Promise.reject(u)})}function QT(t,e){const n=hy(t,"auth");if(n.isInitialized()){const a=n.getImmediate(),u=n.getOptions();if(ol(u,e??{}))return a;zr(a,"already-initialized")}return n.initialize({options:e})}function YT(t,e){const n=e?.persistence||[],r=(Array.isArray(n)?n:[n]).map(Zi);e?.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e?.popupRedirectResolver)}function XT(t,e,n){const r=ha(t);pt(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const a=!1,u=kb(e),{host:h,port:m}=JT(e),y=m===null?"":`:${m}`,x={url:`${u}//${h}${y}/`},k=Object.freeze({host:h,port:m,protocol:u.replace(":",""),options:Object.freeze({disableWarnings:a})});if(!r._canInitEmulator){pt(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),pt(ol(x,r.config.emulator)&&ol(k,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=x,r.emulatorConfig=k,r.settings.appVerificationDisabledForTesting=!0,Dc(h)?(Y_(`${u}//${h}${y}`),X_("Auth",!0)):ZT()}function kb(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function JT(t){const e=kb(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",a=/^(\[[^\]]+\])(:|$)/.exec(r);if(a){const u=a[1];return{host:u,port:Jx(r.substr(u.length+1))}}else{const[u,h]=r.split(":");return{host:u,port:Jx(h)}}}function Jx(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function ZT(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}class wy{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return Ji("not implemented")}_getIdTokenResponse(e){return Ji("not implemented")}_linkToIdToken(e,n){return Ji("not implemented")}_getReauthenticationResolver(e){return Ji("not implemented")}}async function eI(t,e){return uo(t,"POST","/v1/accounts:signUp",e)}async function tI(t,e){return sf(t,"POST","/v1/accounts:signInWithPassword",fa(t,e))}async function nI(t,e){return sf(t,"POST","/v1/accounts:signInWithEmailLink",fa(t,e))}async function sI(t,e){return sf(t,"POST","/v1/accounts:signInWithEmailLink",fa(t,e))}class Bd extends wy{constructor(e,n,r,a=null){super("password",r),this._email=e,this._password=n,this._tenantId=a}static _fromEmailAndPassword(e,n){return new Bd(e,n,"password")}static _fromEmailAndCode(e,n,r=null){return new Bd(e,n,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n?.email&&n?.password){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return I0(e,n,"signInWithPassword",tI);case"emailLink":return nI(e,{email:this._email,oobCode:this._password});default:zr(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":const r={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return I0(e,r,"signUpPassword",eI);case"emailLink":return sI(e,{idToken:n,email:this._email,oobCode:this._password});default:zr(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function xc(t,e){return sf(t,"POST","/v1/accounts:signInWithIdp",fa(t,e))}const rI="http://localhost";class ll extends wy{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new ll(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):zr("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:a,...u}=n;if(!r||!a)return null;const h=new ll(r,a);return h.idToken=u.idToken||void 0,h.accessToken=u.accessToken||void 0,h.secret=u.secret,h.nonce=u.nonce,h.pendingToken=u.pendingToken||null,h}_getIdTokenResponse(e){const n=this.buildRequest();return xc(e,n)}_linkToIdToken(e,n){const r=this.buildRequest();return r.idToken=n,xc(e,r)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,xc(e,n)}buildRequest(){const e={requestUri:rI,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=Fc(n)}return e}}function iI(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function oI(t){const e=Sd(Nd(t)).link,n=e?Sd(Nd(e)).deep_link_id:null,r=Sd(Nd(t)).deep_link_id;return(r?Sd(Nd(r)).link:null)||r||n||e||t}class xy{constructor(e){const n=Sd(Nd(e)),r=n.apiKey??null,a=n.oobCode??null,u=iI(n.mode??null);pt(r&&a&&u,"argument-error"),this.apiKey=r,this.operation=u,this.code=a,this.continueUrl=n.continueUrl??null,this.languageCode=n.lang??null,this.tenantId=n.tenantId??null}static parseLink(e){const n=oI(e);try{return new xy(n)}catch{return null}}}class Bc{constructor(){this.providerId=Bc.PROVIDER_ID}static credential(e,n){return Bd._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const r=xy.parseLink(n);return pt(r,"argument-error"),Bd._fromEmailAndCode(e,r.code,r.tenantId)}}Bc.PROVIDER_ID="password";Bc.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Bc.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class _y{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class rf extends _y{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Xo extends rf{constructor(){super("facebook.com")}static credential(e){return ll._fromParams({providerId:Xo.PROVIDER_ID,signInMethod:Xo.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Xo.credentialFromTaggedObject(e)}static credentialFromError(e){return Xo.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Xo.credential(e.oauthAccessToken)}catch{return null}}}Xo.FACEBOOK_SIGN_IN_METHOD="facebook.com";Xo.PROVIDER_ID="facebook.com";class Xi extends rf{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return ll._fromParams({providerId:Xi.PROVIDER_ID,signInMethod:Xi.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return Xi.credentialFromTaggedObject(e)}static credentialFromError(e){return Xi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:r}=e;if(!n&&!r)return null;try{return Xi.credential(n,r)}catch{return null}}}Xi.GOOGLE_SIGN_IN_METHOD="google.com";Xi.PROVIDER_ID="google.com";class Jo extends rf{constructor(){super("github.com")}static credential(e){return ll._fromParams({providerId:Jo.PROVIDER_ID,signInMethod:Jo.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Jo.credentialFromTaggedObject(e)}static credentialFromError(e){return Jo.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Jo.credential(e.oauthAccessToken)}catch{return null}}}Jo.GITHUB_SIGN_IN_METHOD="github.com";Jo.PROVIDER_ID="github.com";class Zo extends rf{constructor(){super("twitter.com")}static credential(e,n){return ll._fromParams({providerId:Zo.PROVIDER_ID,signInMethod:Zo.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return Zo.credentialFromTaggedObject(e)}static credentialFromError(e){return Zo.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=e;if(!n||!r)return null;try{return Zo.credential(n,r)}catch{return null}}}Zo.TWITTER_SIGN_IN_METHOD="twitter.com";Zo.PROVIDER_ID="twitter.com";async function aI(t,e){return sf(t,"POST","/v1/accounts:signUp",fa(t,e))}class cl{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,r,a=!1){const u=await si._fromIdTokenResponse(e,r,a),h=Zx(r);return new cl({user:u,providerId:h,_tokenResponse:r,operationType:n})}static async _forOperation(e,n,r){await e._updateTokensIfNecessary(r,!0);const a=Zx(r);return new cl({user:e,providerId:a,_tokenResponse:r,operationType:n})}}function Zx(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}class ym extends da{constructor(e,n,r,a){super(n.code,n.message),this.operationType=r,this.user=a,Object.setPrototypeOf(this,ym.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:n.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,n,r,a){return new ym(e,n,r,a)}}function Sb(t,e,n,r){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(u=>{throw u.code==="auth/multi-factor-auth-required"?ym._fromErrorAndOperation(t,u,e,r):u})}async function lI(t,e,n=!1){const r=await Ec(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return cl._forOperation(t,"link",r)}async function cI(t,e,n=!1){const{auth:r}=t;if(Ar(r.app))return Promise.reject(so(r));const a="reauthenticate";try{const u=await Ec(t,Sb(r,a,e,t),n);pt(u.idToken,r,"internal-error");const h=vy(u.idToken);pt(h,r,"internal-error");const{sub:m}=h;return pt(t.uid===m,r,"user-mismatch"),cl._forOperation(t,a,u)}catch(u){throw u?.code==="auth/user-not-found"&&zr(r,"user-mismatch"),u}}async function Nb(t,e,n=!1){if(Ar(t.app))return Promise.reject(so(t));const r="signIn",a=await Sb(t,r,e),u=await cl._fromIdTokenResponse(t,r,a);return n||await t._updateCurrentUser(u.user),u}async function uI(t,e){return Nb(ha(t),e)}async function Eb(t){const e=ha(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function dI(t,e,n){if(Ar(t.app))return Promise.reject(so(t));const r=ha(t),h=await I0(r,{returnSecureToken:!0,email:e,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",aI).catch(y=>{throw y.code==="auth/password-does-not-meet-requirements"&&Eb(t),y}),m=await cl._fromIdTokenResponse(r,"signIn",h);return await r._updateCurrentUser(m.user),m}function fI(t,e,n){return Ar(t.app)?Promise.reject(so(t)):uI(Os(t),Bc.credential(e,n)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&Eb(t),r})}async function hI(t,e){return uo(t,"POST","/v1/accounts:update",e)}async function pI(t,{displayName:e,photoURL:n}){if(e===void 0&&n===void 0)return;const r=Os(t),u={idToken:await r.getIdToken(),displayName:e,photoUrl:n,returnSecureToken:!0},h=await Ec(r,hI(r.auth,u));r.displayName=h.displayName||null,r.photoURL=h.photoUrl||null;const m=r.providerData.find(({providerId:y})=>y==="password");m&&(m.displayName=r.displayName,m.photoURL=r.photoURL),await r._updateTokensIfNecessary(h)}function mI(t,e){return Os(t).setPersistence(e)}function gI(t,e,n,r){return Os(t).onIdTokenChanged(e,n,r)}function vI(t,e,n){return Os(t).beforeAuthStateChanged(e,n)}function yI(t,e,n,r){return Os(t).onAuthStateChanged(e,n,r)}function wI(t){return Os(t).signOut()}const wm="__sak";class Tb{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(wm,"1"),this.storage.removeItem(wm),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const xI=1e3,_I=10;class Ib extends Tb{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=xb(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const r=this.storage.getItem(n),a=this.localCache[n];r!==a&&e(n,a,r)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((h,m,y)=>{this.notifyListeners(h,y)});return}const r=e.key;n?this.detachListener():this.stopPolling();const a=()=>{const h=this.storage.getItem(r);!n&&this.localCache[r]===h||this.notifyListeners(r,h)},u=this.storage.getItem(r);MT()&&u!==e.newValue&&e.newValue!==e.oldValue?setTimeout(a,_I):a()}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const a of Array.from(r))a(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:r}),!0)})},xI)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}Ib.type="LOCAL";const jb=Ib;class Pb extends Tb{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}Pb.type="SESSION";const Ab=Pb;function bI(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}class Hm{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(a=>a.isListeningto(e));if(n)return n;const r=new Hm(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:r,eventType:a,data:u}=n.data,h=this.handlersMap[a];if(!h?.size)return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:a});const m=Array.from(h).map(async x=>x(n.origin,u)),y=await bI(m);n.ports[0].postMessage({status:"done",eventId:r,eventType:a,response:y})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Hm.receivers=[];function by(t="",e=10){let n="";for(let r=0;r<e;r++)n+=Math.floor(Math.random()*10);return t+n}class CI{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,r=50){const a=typeof MessageChannel<"u"?new MessageChannel:null;if(!a)throw new Error("connection_unavailable");let u,h;return new Promise((m,y)=>{const x=by("",20);a.port1.start();const k=setTimeout(()=>{y(new Error("unsupported_event"))},r);h={messageChannel:a,onMessage(T){const S=T;if(S.data.eventId===x)switch(S.data.status){case"ack":clearTimeout(k),u=setTimeout(()=>{y(new Error("timeout"))},3e3);break;case"done":clearTimeout(u),m(S.data.response);break;default:clearTimeout(k),clearTimeout(u),y(new Error("invalid_response"));break}}},this.handlers.add(h),a.port1.addEventListener("message",h.onMessage),this.target.postMessage({eventType:e,eventId:x,data:n},[a.port2])}).finally(()=>{h&&this.removeMessageHandler(h)})}}function Ti(){return window}function kI(t){Ti().location.href=t}function Rb(){return typeof Ti().WorkerGlobalScope<"u"&&typeof Ti().importScripts=="function"}async function SI(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function NI(){return navigator?.serviceWorker?.controller||null}function EI(){return Rb()?self:null}const $b="firebaseLocalStorageDb",TI=1,xm="firebaseLocalStorage",Mb="fbase_key";class of{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function Km(t,e){return t.transaction([xm],e?"readwrite":"readonly").objectStore(xm)}function II(){const t=indexedDB.deleteDatabase($b);return new of(t).toPromise()}function j0(){const t=indexedDB.open($b,TI);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const r=t.result;try{r.createObjectStore(xm,{keyPath:Mb})}catch(a){n(a)}}),t.addEventListener("success",async()=>{const r=t.result;r.objectStoreNames.contains(xm)?e(r):(r.close(),await II(),e(await j0()))})})}async function e1(t,e,n){const r=Km(t,!0).put({[Mb]:e,value:n});return new of(r).toPromise()}async function jI(t,e){const n=Km(t,!1).get(e),r=await new of(n).toPromise();return r===void 0?null:r.value}function t1(t,e){const n=Km(t,!0).delete(e);return new of(n).toPromise()}const PI=800,AI=3;class Ob{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await j0(),this.db)}async _withRetries(e){let n=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(n++>AI)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Rb()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Hm._getInstance(EI()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await SI(),!this.activeServiceWorker)return;this.sender=new CI(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||NI()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await j0();return await e1(e,wm,"1"),await t1(e,wm),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(r=>e1(r,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(r=>jI(r,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>t1(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(a=>{const u=Km(a,!1).getAll();return new of(u).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],r=new Set;if(e.length!==0)for(const{fbase_key:a,value:u}of e)r.add(a),JSON.stringify(this.localCache[a])!==JSON.stringify(u)&&(this.notifyListeners(a,u),n.push(a));for(const a of Object.keys(this.localCache))this.localCache[a]&&!r.has(a)&&(this.notifyListeners(a,null),n.push(a));return n}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const a of Array.from(r))a(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),PI)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Ob.type="LOCAL";const RI=Ob;new nf(3e4,6e4);function Lb(t,e){return e?Zi(e):(pt(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}class Cy extends wy{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return xc(e,this._buildIdpRequest())}_linkToIdToken(e,n){return xc(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return xc(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function $I(t){return Nb(t.auth,new Cy(t),t.bypassAuthState)}function MI(t){const{auth:e,user:n}=t;return pt(n,e,"internal-error"),cI(n,new Cy(t),t.bypassAuthState)}async function OI(t){const{auth:e,user:n}=t;return pt(n,e,"internal-error"),lI(n,new Cy(t),t.bypassAuthState)}class Db{constructor(e,n,r,a,u=!1){this.auth=e,this.resolver=r,this.user=a,this.bypassAuthState=u,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:r,postBody:a,tenantId:u,error:h,type:m}=e;if(h){this.reject(h);return}const y={auth:this.auth,requestUri:n,sessionId:r,tenantId:u||void 0,postBody:a||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(m)(y))}catch(x){this.reject(x)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return $I;case"linkViaPopup":case"linkViaRedirect":return OI;case"reauthViaPopup":case"reauthViaRedirect":return MI;default:zr(this.auth,"internal-error")}}resolve(e){lo(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){lo(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const LI=new nf(2e3,1e4);async function DI(t,e,n){if(Ar(t.app))return Promise.reject(ii(t,"operation-not-supported-in-this-environment"));const r=ha(t);mT(t,e,_y);const a=Lb(r,n);return new Za(r,"signInViaPopup",e,a).executeNotNull()}class Za extends Db{constructor(e,n,r,a,u){super(e,n,a,u),this.provider=r,this.authWindow=null,this.pollId=null,Za.currentPopupAction&&Za.currentPopupAction.cancel(),Za.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return pt(e,this.auth,"internal-error"),e}async onExecution(){lo(this.filter.length===1,"Popup operations only handle one event");const e=by();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(ii(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(ii(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Za.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(ii(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,LI.get())};e()}}Za.currentPopupAction=null;const FI="pendingRedirect",Jp=new Map;class UI extends Db{constructor(e,n,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,r),this.eventId=null}async execute(){let e=Jp.get(this.auth._key());if(!e){try{const r=await BI(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(n){e=()=>Promise.reject(n)}Jp.set(this.auth._key(),e)}return this.bypassAuthState||Jp.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function BI(t,e){const n=qI(e),r=WI(t);if(!await r._isAvailable())return!1;const a=await r._get(n)==="true";return await r._remove(n),a}function zI(t,e){Jp.set(t._key(),e)}function WI(t){return Zi(t._redirectPersistence)}function qI(t){return Xp(FI,t.config.apiKey,t.name)}async function VI(t,e,n=!1){if(Ar(t.app))return Promise.reject(so(t));const r=ha(t),a=Lb(r,e),h=await new UI(r,a,n).execute();return h&&!n&&(delete h.user._redirectEventId,await r._persistUserIfCurrent(h.user),await r._setRedirectUser(null,e)),h}const HI=600*1e3;class KI{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(n=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!GI(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){if(e.error&&!Fb(e)){const r=e.error.code?.split("auth/")[1]||"internal-error";n.onError(ii(this.auth,r))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const r=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=HI&&this.cachedEventUids.clear(),this.cachedEventUids.has(n1(e))}saveEventToCache(e){this.cachedEventUids.add(n1(e)),this.lastProcessedEventTime=Date.now()}}function n1(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function Fb({type:t,error:e}){return t==="unknown"&&e?.code==="auth/no-auth-event"}function GI(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Fb(t);default:return!1}}async function QI(t,e={}){return uo(t,"GET","/v1/projects",e)}const YI=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,XI=/^https?/;async function JI(t){if(t.config.emulator)return;const{authorizedDomains:e}=await QI(t);for(const n of e)try{if(ZI(n))return}catch{}zr(t,"unauthorized-domain")}function ZI(t){const e=E0(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const h=new URL(t);return h.hostname===""&&r===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&h.hostname===r}if(!XI.test(n))return!1;if(YI.test(t))return r===t;const a=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+a+"|"+a+")$","i").test(r)}const ej=new nf(3e4,6e4);function s1(){const t=Ti().___jsl;if(t?.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function tj(t){return new Promise((e,n)=>{function r(){s1(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{s1(),n(ii(t,"network-request-failed"))},timeout:ej.get()})}if(Ti().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(Ti().gapi?.load)r();else{const a=qT("iframefcb");return Ti()[a]=()=>{gapi.load?r():n(ii(t,"network-request-failed"))},bb(`${WT()}?onload=${a}`).catch(u=>n(u))}}).catch(e=>{throw Zp=null,e})}let Zp=null;function nj(t){return Zp=Zp||tj(t),Zp}const sj=new nf(5e3,15e3),rj="__/auth/iframe",ij="emulator/auth/iframe",oj={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},aj=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function lj(t){const e=t.config;pt(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?gy(e,ij):`https://${t.config.authDomain}/${rj}`,r={apiKey:e.apiKey,appName:t.name,v:Uc},a=aj.get(t.config.apiHost);a&&(r.eid=a);const u=t._getFrameworks();return u.length&&(r.fw=u.join(",")),`${n}?${Fc(r).slice(1)}`}async function cj(t){const e=await nj(t),n=Ti().gapi;return pt(n,t,"internal-error"),e.open({where:document.body,url:lj(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:oj,dontclear:!0},r=>new Promise(async(a,u)=>{await r.restyle({setHideOnLeave:!1});const h=ii(t,"network-request-failed"),m=Ti().setTimeout(()=>{u(h)},sj.get());function y(){Ti().clearTimeout(m),a(r)}r.ping(y).then(y,()=>{u(h)})}))}const uj={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},dj=500,fj=600,hj="_blank",pj="http://localhost";class r1{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function mj(t,e,n,r=dj,a=fj){const u=Math.max((window.screen.availHeight-a)/2,0).toString(),h=Math.max((window.screen.availWidth-r)/2,0).toString();let m="";const y={...uj,width:r.toString(),height:a.toString(),top:u,left:h},x=rr().toLowerCase();n&&(m=mb(x)?hj:n),hb(x)&&(e=e||pj,y.scrollbars="yes");const k=Object.entries(y).reduce((S,[R,O])=>`${S}${R}=${O},`,"");if($T(x)&&m!=="_self")return gj(e||"",m),new r1(null);const T=window.open(e||"",m,k);pt(T,t,"popup-blocked");try{T.focus()}catch{}return new r1(T)}function gj(t,e){const n=document.createElement("a");n.href=t,n.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}const vj="__/auth/handler",yj="emulator/auth/handler",wj=encodeURIComponent("fac");async function i1(t,e,n,r,a,u){pt(t.config.authDomain,t,"auth-domain-config-required"),pt(t.config.apiKey,t,"invalid-api-key");const h={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:Uc,eventId:a};if(e instanceof _y){e.setDefaultLanguage(t.languageCode),h.providerId=e.providerId||"",_0(e.getCustomParameters())||(h.customParameters=JSON.stringify(e.getCustomParameters()));for(const[k,T]of Object.entries({}))h[k]=T}if(e instanceof rf){const k=e.getScopes().filter(T=>T!=="");k.length>0&&(h.scopes=k.join(","))}t.tenantId&&(h.tid=t.tenantId);const m=h;for(const k of Object.keys(m))m[k]===void 0&&delete m[k];const y=await t._getAppCheckToken(),x=y?`#${wj}=${encodeURIComponent(y)}`:"";return`${xj(t)}?${Fc(m).slice(1)}${x}`}function xj({config:t}){return t.emulator?gy(t,yj):`https://${t.authDomain}/${vj}`}const Vv="webStorageSupport";class _j{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Ab,this._completeRedirectFn=VI,this._overrideRedirectResult=zI}async _openPopup(e,n,r,a){lo(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const u=await i1(e,n,r,E0(),a);return mj(e,u,by())}async _openRedirect(e,n,r,a){await this._originValidation(e);const u=await i1(e,n,r,E0(),a);return kI(u),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:a,promise:u}=this.eventManagers[n];return a?Promise.resolve(a):(lo(u,"If manager is not set, promise should be"),u)}const r=this.initAndGetManager(e);return this.eventManagers[n]={promise:r},r.catch(()=>{delete this.eventManagers[n]}),r}async initAndGetManager(e){const n=await cj(e),r=new KI(e);return n.register("authEvent",a=>(pt(a?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(a.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=n,r}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(Vv,{type:Vv},a=>{const u=a?.[0]?.[Vv];u!==void 0&&n(!!u),zr(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=JI(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return xb()||pb()||yy()}}const Ub=_j;var o1="@firebase/auth",a1="1.11.1";class bj{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){pt(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function Cj(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function kj(t){Nc(new al("auth",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),a=e.getProvider("heartbeat"),u=e.getProvider("app-check-internal"),{apiKey:h,authDomain:m}=r.options;pt(h&&!h.includes(":"),"invalid-api-key",{appName:r.name});const y={apiKey:h,authDomain:m,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:_b(t)},x=new UT(r,a,u,y);return YT(x,n),x},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,r)=>{e.getProvider("auth-internal").initialize()})),Nc(new al("auth-internal",e=>{const n=ha(e.getProvider("auth").getImmediate());return(r=>new bj(r))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),ra(o1,a1,Cj(t)),ra(o1,a1,"esm2020")}const Sj=300,Nj=Q_("authIdTokenMaxAge")||Sj;let l1=null;const Ej=t=>async e=>{const n=e&&await e.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>Nj)return;const a=n?.token;l1!==a&&(l1=a,await fetch(t,{method:a?"POST":"DELETE",headers:a?{Authorization:`Bearer ${a}`}:{}}))};function Tj(t=sb()){const e=hy(t,"auth");if(e.isInitialized())return e.getImmediate();const n=QT(t,{popupRedirectResolver:Ub,persistence:[RI,jb,Ab]}),r=Q_("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const u=new URL(r,location.origin);if(location.origin===u.origin){const h=Ej(u.toString());vI(n,h,()=>h(n.currentUser)),gI(n,m=>h(m))}}const a=K_("auth");return a&&XT(n,`http://${a}`),n}function Ij(){return document.getElementsByTagName("head")?.[0]??document}BT({loadJS(t){return new Promise((e,n)=>{const r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=a=>{const u=ii("internal-error");u.customData=a,n(u)},r.type="text/javascript",r.charset="UTF-8",Ij().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});kj("Browser");var jj="firebase",Pj="12.6.0";ra(jj,Pj,"app");var c1={};const u1="@firebase/database",d1="1.1.0";let Bb="";function Aj(t){Bb=t}class Rj{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,n){n==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),ps(n))}get(e){const n=this.domStorage_.getItem(this.prefixedName_(e));return n==null?null:Fd(n)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class $j{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,n){n==null?delete this.cache_[e]:this.cache_[e]=n}get(e){return ji(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const zb=function(t){try{if(typeof window<"u"&&typeof window[t]<"u"){const e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new Rj(e)}}catch{}return new $j},el=zb("localStorage"),Mj=zb("sessionStorage");const _c=new dy("@firebase/database"),Oj=(function(){let t=1;return function(){return t++}})(),Wb=function(t){const e=r2(t),n=new e2;n.update(e);const r=n.digest();return ly.encodeByteArray(r)},af=function(...t){let e="";for(let n=0;n<t.length;n++){const r=t[n];Array.isArray(r)||r&&typeof r=="object"&&typeof r.length=="number"?e+=af.apply(null,r):typeof r=="object"?e+=ps(r):e+=r,e+=" "}return e};let Pd=null,f1=!0;const Lj=function(t,e){Te(!0,"Can't turn on custom loggers persistently."),_c.logLevel=dn.VERBOSE,Pd=_c.log.bind(_c)},$s=function(...t){if(f1===!0&&(f1=!1,Pd===null&&Mj.get("logging_enabled")===!0&&Lj()),Pd){const e=af.apply(null,t);Pd(e)}},lf=function(t){return function(...e){$s(t,...e)}},P0=function(...t){const e="FIREBASE INTERNAL ERROR: "+af(...t);_c.error(e)},co=function(...t){const e=`FIREBASE FATAL ERROR: ${af(...t)}`;throw _c.error(e),new Error(e)},sr=function(...t){const e="FIREBASE WARNING: "+af(...t);_c.warn(e)},Dj=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&sr("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},ky=function(t){return typeof t=="number"&&(t!==t||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)},Fj=function(t){if(document.readyState==="complete")t();else{let e=!1;const n=function(){if(!document.body){setTimeout(n,Math.floor(10));return}e||(e=!0,t())};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&n()}),window.attachEvent("onload",n))}},Tc="[MIN_NAME]",ul="[MAX_NAME]",hl=function(t,e){if(t===e)return 0;if(t===Tc||e===ul)return-1;if(e===Tc||t===ul)return 1;{const n=h1(t),r=h1(e);return n!==null?r!==null?n-r===0?t.length-e.length:n-r:-1:r!==null?1:t<e?-1:1}},Uj=function(t,e){return t===e?0:t<e?-1:1},xd=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+ps(e))},Sy=function(t){if(typeof t!="object"||t===null)return ps(t);const e=[];for(const r in t)e.push(r);e.sort();let n="{";for(let r=0;r<e.length;r++)r!==0&&(n+=","),n+=ps(e[r]),n+=":",n+=Sy(t[e[r]]);return n+="}",n},qb=function(t,e){const n=t.length;if(n<=e)return[t];const r=[];for(let a=0;a<n;a+=e)a+e>n?r.push(t.substring(a,n)):r.push(t.substring(a,a+e));return r};function Ms(t,e){for(const n in t)t.hasOwnProperty(n)&&e(n,t[n])}const Vb=function(t){Te(!ky(t),"Invalid JSON number");const e=11,n=52,r=(1<<e-1)-1;let a,u,h,m,y;t===0?(u=0,h=0,a=1/t===-1/0?1:0):(a=t<0,t=Math.abs(t),t>=Math.pow(2,1-r)?(m=Math.min(Math.floor(Math.log(t)/Math.LN2),r),u=m+r,h=Math.round(t*Math.pow(2,n-m)-Math.pow(2,n))):(u=0,h=Math.round(t/Math.pow(2,1-r-n))));const x=[];for(y=n;y;y-=1)x.push(h%2?1:0),h=Math.floor(h/2);for(y=e;y;y-=1)x.push(u%2?1:0),u=Math.floor(u/2);x.push(a?1:0),x.reverse();const k=x.join("");let T="";for(y=0;y<64;y+=8){let S=parseInt(k.substr(y,8),2).toString(16);S.length===1&&(S="0"+S),T=T+S}return T.toLowerCase()},Bj=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},zj=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function Wj(t,e){let n="Unknown Error";t==="too_big"?n="The data requested exceeds the maximum size that can be accessed with a single request.":t==="permission_denied"?n="Client doesn't have permission to access the desired data.":t==="unavailable"&&(n="The service is unavailable");const r=new Error(t+" at "+e._path.toString()+": "+n);return r.code=t.toUpperCase(),r}const qj=new RegExp("^-?(0*)\\d{1,10}$"),Vj=-2147483648,Hj=2147483647,h1=function(t){if(qj.test(t)){const e=Number(t);if(e>=Vj&&e<=Hj)return e}return null},zc=function(t){try{t()}catch(e){setTimeout(()=>{const n=e.stack||"";throw sr("Exception was thrown by user callback.",n),e},Math.floor(0))}},Kj=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Ad=function(t,e){const n=setTimeout(t,e);return typeof n=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(n):typeof n=="object"&&n.unref&&n.unref(),n};class Gj{constructor(e,n){this.appCheckProvider=n,this.appName=e.name,Ar(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=n?.getImmediate({optional:!0}),this.appCheck||n?.get().then(r=>this.appCheck=r)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((n,r)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(n,r):n(null)},0)})}addTokenChangeListener(e){this.appCheckProvider?.get().then(n=>n.addTokenListener(e))}notifyForInvalidToken(){sr(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}class Qj{constructor(e,n,r){this.appName_=e,this.firebaseOptions_=n,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit(a=>this.auth_=a)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(n=>n&&n.code==="auth/token-not-initialized"?($s("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(n)):new Promise((n,r)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(n,r):n(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(n=>n.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(n=>n.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',sr(e)}}class em{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}em.OWNER="owner";const Ny="5",Hb="v",Kb="s",Gb="r",Qb="f",Yb=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Xb="ls",Jb="p",A0="ac",Zb="websocket",eC="long_polling";class tC{constructor(e,n,r,a,u=!1,h="",m=!1,y=!1,x=null){this.secure=n,this.namespace=r,this.webSocketOnly=a,this.nodeAdmin=u,this.persistenceKey=h,this.includeNamespaceInQueryParams=m,this.isUsingEmulator=y,this.emulatorOptions=x,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=el.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&el.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",n=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${n}`}}function Yj(t){return t.host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams}function nC(t,e,n){Te(typeof e=="string","typeof type must == string"),Te(typeof n=="object","typeof params must == object");let r;if(e===Zb)r=(t.secure?"wss://":"ws://")+t.internalHost+"/.ws?";else if(e===eC)r=(t.secure?"https://":"http://")+t.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);Yj(t)&&(n.ns=t.namespace);const a=[];return Ms(n,(u,h)=>{a.push(u+"="+h)}),r+a.join("&")}class Xj{constructor(){this.counters_={}}incrementCounter(e,n=1){ji(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=n}get(){return RE(this.counters_)}}const Hv={},Kv={};function Ey(t){const e=t.toString();return Hv[e]||(Hv[e]=new Xj),Hv[e]}function Jj(t,e){const n=t.toString();return Kv[n]||(Kv[n]=e()),Kv[n]}class Zj{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,n){this.closeAfterResponse=e,this.onClose=n,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,n){for(this.pendingResponses[e]=n;this.pendingResponses[this.currentResponseNum];){const r=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let a=0;a<r.length;++a)r[a]&&zc(()=>{this.onMessage_(r[a])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}const p1="start",eP="close",tP="pLPCommand",nP="pRTLPCB",sC="id",rC="pw",iC="ser",sP="cb",rP="seg",iP="ts",oP="d",aP="dframe",oC=1870,aC=30,lP=oC-aC,cP=25e3,uP=3e4;class vc{constructor(e,n,r,a,u,h,m){this.connId=e,this.repoInfo=n,this.applicationId=r,this.appCheckToken=a,this.authToken=u,this.transportSessionId=h,this.lastSessionId=m,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=lf(e),this.stats_=Ey(n),this.urlFn=y=>(this.appCheckToken&&(y[A0]=this.appCheckToken),nC(n,eC,y))}open(e,n){this.curSegmentNum=0,this.onDisconnect_=n,this.myPacketOrderer=new Zj(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(uP)),Fj(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Ty((...u)=>{const[h,m,y,x,k]=u;if(this.incrementIncomingBytes_(u),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,h===p1)this.id=m,this.password=y;else if(h===eP)m?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(m,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+h)},(...u)=>{const[h,m]=u;this.incrementIncomingBytes_(u),this.myPacketOrderer.handleResponse(h,m)},()=>{this.onClosed_()},this.urlFn);const r={};r[p1]="t",r[iC]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(r[sP]=this.scriptTagHolder.uniqueCallbackIdentifier),r[Hb]=Ny,this.transportSessionId&&(r[Kb]=this.transportSessionId),this.lastSessionId&&(r[Xb]=this.lastSessionId),this.applicationId&&(r[Jb]=this.applicationId),this.appCheckToken&&(r[A0]=this.appCheckToken),typeof location<"u"&&location.hostname&&Yb.test(location.hostname)&&(r[Gb]=Qb);const a=this.urlFn(r);this.log_("Connecting via long-poll to "+a),this.scriptTagHolder.addTag(a,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){vc.forceAllow_=!0}static forceDisallow(){vc.forceDisallow_=!0}static isAvailable(){return vc.forceAllow_?!0:!vc.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!Bj()&&!zj()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const n=ps(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);const r=V_(n),a=qb(r,lP);for(let u=0;u<a.length;u++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,a.length,a[u]),this.curSegmentNum++}addDisconnectPingFrame(e,n){this.myDisconnFrame=document.createElement("iframe");const r={};r[aP]="t",r[sC]=e,r[rC]=n,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const n=ps(e).length;this.bytesReceived+=n,this.stats_.incrementCounter("bytes_received",n)}}class Ty{constructor(e,n,r,a){this.onDisconnect=r,this.urlFn=a,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=Oj(),window[tP+this.uniqueCallbackIdentifier]=e,window[nP+this.uniqueCallbackIdentifier]=n,this.myIFrame=Ty.createIFrame_();let u="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(u='<script>document.domain="'+document.domain+'";<\/script>');const h="<html><body>"+u+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(h),this.myIFrame.doc.close()}catch(m){$s("frame writing exception"),m.stack&&$s(m.stack),$s(m)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||$s("No IE domain setting required")}catch{const r=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+r+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,n){for(this.myID=e,this.myPW=n,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[sC]=this.myID,e[rC]=this.myPW,e[iC]=this.currentSerial;let n=this.urlFn(e),r="",a=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+aC+r.length<=oC;){const h=this.pendingSegs.shift();r=r+"&"+rP+a+"="+h.seg+"&"+iP+a+"="+h.ts+"&"+oP+a+"="+h.d,a++}return n=n+r,this.addLongPollTag_(n,this.currentSerial),!0}else return!1}enqueueSegment(e,n,r){this.pendingSegs.push({seg:e,ts:n,d:r}),this.alive&&this.newRequest_()}addLongPollTag_(e,n){this.outstandingRequests.add(n);const r=()=>{this.outstandingRequests.delete(n),this.newRequest_()},a=setTimeout(r,Math.floor(cP)),u=()=>{clearTimeout(a),r()};this.addTag(e,u)}addTag(e,n){setTimeout(()=>{try{if(!this.sendNewPolls)return;const r=this.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){const a=r.readyState;(!a||a==="loaded"||a==="complete")&&(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),n())},r.onerror=()=>{$s("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(r)}catch{}},Math.floor(1))}}const dP=16384,fP=45e3;let _m=null;typeof MozWebSocket<"u"?_m=MozWebSocket:typeof WebSocket<"u"&&(_m=WebSocket);class ni{constructor(e,n,r,a,u,h,m){this.connId=e,this.applicationId=r,this.appCheckToken=a,this.authToken=u,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=lf(this.connId),this.stats_=Ey(n),this.connURL=ni.connectionURL_(n,h,m,a,r),this.nodeAdmin=n.nodeAdmin}static connectionURL_(e,n,r,a,u){const h={};return h[Hb]=Ny,typeof location<"u"&&location.hostname&&Yb.test(location.hostname)&&(h[Gb]=Qb),n&&(h[Kb]=n),r&&(h[Xb]=r),a&&(h[A0]=a),u&&(h[Jb]=u),nC(e,Zb,h)}open(e,n){this.onDisconnect=n,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,el.set("previous_websocket_failure",!0);try{let r;HE(),this.mySock=new _m(this.connURL,[],r)}catch(r){this.log_("Error instantiating WebSocket.");const a=r.message||r.data;a&&this.log_(a),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=r=>{this.handleIncomingFrame(r)},this.mySock.onerror=r=>{this.log_("WebSocket error.  Closing connection.");const a=r.message||r.data;a&&this.log_(a),this.onClosed_()}}start(){}static forceDisallow(){ni.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const n=/Android ([0-9]{0,}\.[0-9]{0,})/,r=navigator.userAgent.match(n);r&&r.length>1&&parseFloat(r[1])<4.4&&(e=!0)}return!e&&_m!==null&&!ni.forceDisallow_}static previouslyFailed(){return el.isInMemoryStorage||el.get("previous_websocket_failure")===!0}markConnectionHealthy(){el.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const n=this.frames.join("");this.frames=null;const r=Fd(n);this.onMessage(r)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(Te(this.frames===null,"We already have a frame buffer"),e.length<=6){const n=Number(e);if(!isNaN(n))return this.handleNewFrameCount_(n),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const n=e.data;if(this.bytesReceived+=n.length,this.stats_.incrementCounter("bytes_received",n.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(n);else{const r=this.extractFrameCount_(n);r!==null&&this.appendFrame_(r)}}send(e){this.resetKeepAlive();const n=ps(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);const r=qb(n,dP);r.length>1&&this.sendString_(String(r.length));for(let a=0;a<r.length;a++)this.sendString_(r[a])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(fP))}sendString_(e){try{this.mySock.send(e)}catch(n){this.log_("Exception thrown from WebSocket.send():",n.message||n.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}ni.responsesRequiredToBeHealthy=2;ni.healthyTimeout=3e4;class zd{static get ALL_TRANSPORTS(){return[vc,ni]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const n=ni&&ni.isAvailable();let r=n&&!ni.previouslyFailed();if(e.webSocketOnly&&(n||sr("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[ni];else{const a=this.transports_=[];for(const u of zd.ALL_TRANSPORTS)u&&u.isAvailable()&&a.push(u);zd.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}zd.globalTransportInitialized_=!1;const hP=6e4,pP=5e3,mP=10*1024,gP=100*1024,Gv="t",m1="d",vP="s",g1="r",yP="e",v1="o",y1="a",w1="n",x1="p",wP="h";class xP{constructor(e,n,r,a,u,h,m,y,x,k){this.id=e,this.repoInfo_=n,this.applicationId_=r,this.appCheckToken_=a,this.authToken_=u,this.onMessage_=h,this.onReady_=m,this.onDisconnect_=y,this.onKill_=x,this.lastSessionId=k,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=lf("c:"+this.id+":"),this.transportManager_=new zd(n),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(n,r)},Math.floor(0));const a=e.healthyTimeout||0;a>0&&(this.healthyTimeout_=Ad(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>gP?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>mP?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(a)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return n=>{e===this.conn_?this.onConnectionLost_(n):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return n=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(n):e===this.secondaryConn_?this.onSecondaryMessageReceived_(n):this.log_("message on old connection"))}}sendRequest(e){const n={t:"d",d:e};this.sendData_(n)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(Gv in e){const n=e[Gv];n===y1?this.upgradeIfSecondaryHealthy_():n===g1?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):n===v1&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const n=xd("t",e),r=xd("d",e);if(n==="c")this.onSecondaryControl_(r);else if(n==="d")this.pendingDataMessages.push(r);else throw new Error("Unknown protocol layer: "+n)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:x1,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:y1,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:w1,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const n=xd("t",e),r=xd("d",e);n==="c"?this.onControl_(r):n==="d"&&this.onDataMessage_(r)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const n=xd(Gv,e);if(m1 in e){const r=e[m1];if(n===wP){const a={...r};this.repoInfo_.isUsingEmulator&&(a.h=this.repoInfo_.host),this.onHandshake_(a)}else if(n===w1){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let a=0;a<this.pendingDataMessages.length;++a)this.onDataMessage_(this.pendingDataMessages[a]);this.pendingDataMessages=[],this.tryCleanupConnection()}else n===vP?this.onConnectionShutdown_(r):n===g1?this.onReset_(r):n===yP?P0("Server Error: "+r):n===v1?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):P0("Unknown control packet command: "+n)}}onHandshake_(e){const n=e.ts,r=e.v,a=e.h;this.sessionId=e.s,this.repoInfo_.host=a,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,n),Ny!==r&&sr("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),Ad(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(hP))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,n){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(n,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Ad(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(pP))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:x1,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(el.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class lC{put(e,n,r,a){}merge(e,n,r,a){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,n,r){}onDisconnectMerge(e,n,r){}onDisconnectCancel(e,n){}reportStats(e){}}class cC{constructor(e){this.allowedEvents_=e,this.listeners_={},Te(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...n){if(Array.isArray(this.listeners_[e])){const r=[...this.listeners_[e]];for(let a=0;a<r.length;a++)r[a].callback.apply(r[a].context,n)}}on(e,n,r){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:n,context:r});const a=this.getInitialEvent(e);a&&n.apply(r,a)}off(e,n,r){this.validateEventType_(e);const a=this.listeners_[e]||[];for(let u=0;u<a.length;u++)if(a[u].callback===n&&(!r||r===a[u].context)){a.splice(u,1);return}}validateEventType_(e){Te(this.allowedEvents_.find(n=>n===e),"Unknown event: "+e)}}class bm extends cC{static getInstance(){return new bm}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!uy()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return Te(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}const _1=32,b1=768;class fn{constructor(e,n){if(n===void 0){this.pieces_=e.split("/");let r=0;for(let a=0;a<this.pieces_.length;a++)this.pieces_[a].length>0&&(this.pieces_[r]=this.pieces_[a],r++);this.pieces_.length=r,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=n}toString(){let e="";for(let n=this.pieceNum_;n<this.pieces_.length;n++)this.pieces_[n]!==""&&(e+="/"+this.pieces_[n]);return e||"/"}}function Gt(){return new fn("")}function It(t){return t.pieceNum_>=t.pieces_.length?null:t.pieces_[t.pieceNum_]}function aa(t){return t.pieces_.length-t.pieceNum_}function kn(t){let e=t.pieceNum_;return e<t.pieces_.length&&e++,new fn(t.pieces_,e)}function Iy(t){return t.pieceNum_<t.pieces_.length?t.pieces_[t.pieces_.length-1]:null}function _P(t){let e="";for(let n=t.pieceNum_;n<t.pieces_.length;n++)t.pieces_[n]!==""&&(e+="/"+encodeURIComponent(String(t.pieces_[n])));return e||"/"}function Wd(t,e=0){return t.pieces_.slice(t.pieceNum_+e)}function uC(t){if(t.pieceNum_>=t.pieces_.length)return null;const e=[];for(let n=t.pieceNum_;n<t.pieces_.length-1;n++)e.push(t.pieces_[n]);return new fn(e,0)}function Un(t,e){const n=[];for(let r=t.pieceNum_;r<t.pieces_.length;r++)n.push(t.pieces_[r]);if(e instanceof fn)for(let r=e.pieceNum_;r<e.pieces_.length;r++)n.push(e.pieces_[r]);else{const r=e.split("/");for(let a=0;a<r.length;a++)r[a].length>0&&n.push(r[a])}return new fn(n,0)}function Ot(t){return t.pieceNum_>=t.pieces_.length}function tr(t,e){const n=It(t),r=It(e);if(n===null)return e;if(n===r)return tr(kn(t),kn(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")}function bP(t,e){const n=Wd(t,0),r=Wd(e,0);for(let a=0;a<n.length&&a<r.length;a++){const u=hl(n[a],r[a]);if(u!==0)return u}return n.length===r.length?0:n.length<r.length?-1:1}function jy(t,e){if(aa(t)!==aa(e))return!1;for(let n=t.pieceNum_,r=e.pieceNum_;n<=t.pieces_.length;n++,r++)if(t.pieces_[n]!==e.pieces_[r])return!1;return!0}function Ur(t,e){let n=t.pieceNum_,r=e.pieceNum_;if(aa(t)>aa(e))return!1;for(;n<t.pieces_.length;){if(t.pieces_[n]!==e.pieces_[r])return!1;++n,++r}return!0}class CP{constructor(e,n){this.errorPrefix_=n,this.parts_=Wd(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let r=0;r<this.parts_.length;r++)this.byteLength_+=qm(this.parts_[r]);dC(this)}}function kP(t,e){t.parts_.length>0&&(t.byteLength_+=1),t.parts_.push(e),t.byteLength_+=qm(e),dC(t)}function SP(t){const e=t.parts_.pop();t.byteLength_-=qm(e),t.parts_.length>0&&(t.byteLength_-=1)}function dC(t){if(t.byteLength_>b1)throw new Error(t.errorPrefix_+"has a key path longer than "+b1+" bytes ("+t.byteLength_+").");if(t.parts_.length>_1)throw new Error(t.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+_1+") or object contains a cycle "+Xa(t))}function Xa(t){return t.parts_.length===0?"":"in property '"+t.parts_.join(".")+"'"}class Py extends cC{static getInstance(){return new Py}constructor(){super(["visible"]);let e,n;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(n="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(n="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(n="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(n="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,n&&document.addEventListener(n,()=>{const r=!document[e];r!==this.visible_&&(this.visible_=r,this.trigger("visible",r))},!1)}getInitialEvent(e){return Te(e==="visible","Unknown event type: "+e),[this.visible_]}}const _d=1e3,NP=300*1e3,C1=30*1e3,EP=1.3,TP=3e4,IP="server_kill",k1=3;class ro extends lC{constructor(e,n,r,a,u,h,m,y){if(super(),this.repoInfo_=e,this.applicationId_=n,this.onDataUpdate_=r,this.onConnectStatus_=a,this.onServerInfoUpdate_=u,this.authTokenProvider_=h,this.appCheckTokenProvider_=m,this.authOverride_=y,this.id=ro.nextPersistentConnectionId_++,this.log_=lf("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=_d,this.maxReconnectDelay_=NP,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,y)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Py.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&bm.getInstance().on("online",this.onOnline_,this)}sendRequest(e,n,r){const a=++this.requestNumber_,u={r:a,a:e,b:n};this.log_(ps(u)),Te(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(u),r&&(this.requestCBHash_[a]=r)}get(e){this.initConnection_();const n=new ef,a={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:h=>{const m=h.d;h.s==="ok"?n.resolve(m):n.reject(m)}};this.outstandingGets_.push(a),this.outstandingGetCount_++;const u=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(u),n.promise}listen(e,n,r,a){this.initConnection_();const u=e._queryIdentifier,h=e._path.toString();this.log_("Listen called for "+h+" "+u),this.listens.has(h)||this.listens.set(h,new Map),Te(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),Te(!this.listens.get(h).has(u),"listen() called twice for same path/queryId.");const m={onComplete:a,hashFn:n,query:e,tag:r};this.listens.get(h).set(u,m),this.connected_&&this.sendListen_(m)}sendGet_(e){const n=this.outstandingGets_[e];this.sendRequest("g",n.request,r=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),n.onComplete&&n.onComplete(r)})}sendListen_(e){const n=e.query,r=n._path.toString(),a=n._queryIdentifier;this.log_("Listen on "+r+" for "+a);const u={p:r},h="q";e.tag&&(u.q=n._queryObject,u.t=e.tag),u.h=e.hashFn(),this.sendRequest(h,u,m=>{const y=m.d,x=m.s;ro.warnOnListenWarnings_(y,n),(this.listens.get(r)&&this.listens.get(r).get(a))===e&&(this.log_("listen response",m),x!=="ok"&&this.removeListen_(r,a),e.onComplete&&e.onComplete(x,y))})}static warnOnListenWarnings_(e,n){if(e&&typeof e=="object"&&ji(e,"w")){const r=Sc(e,"w");if(Array.isArray(r)&&~r.indexOf("no_index")){const a='".indexOn": "'+n._queryParams.getIndex().toString()+'"',u=n._path.toString();sr(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${a} at ${u} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||ZE(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=C1)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,n=JE(e)?"auth":"gauth",r={cred:e};this.authOverride_===null?r.noauth=!0:typeof this.authOverride_=="object"&&(r.authvar=this.authOverride_),this.sendRequest(n,r,a=>{const u=a.s,h=a.d||"error";this.authToken_===e&&(u==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(u,h))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const n=e.s,r=e.d||"error";n==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(n,r)})}unlisten(e,n){const r=e._path.toString(),a=e._queryIdentifier;this.log_("Unlisten called for "+r+" "+a),Te(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(r,a)&&this.connected_&&this.sendUnlisten_(r,a,e._queryObject,n)}sendUnlisten_(e,n,r,a){this.log_("Unlisten on "+e+" for "+n);const u={p:e},h="n";a&&(u.q=r,u.t=a),this.sendRequest(h,u)}onDisconnectPut(e,n,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,n,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:n,onComplete:r})}onDisconnectMerge(e,n,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,n,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:n,onComplete:r})}onDisconnectCancel(e,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:n})}sendOnDisconnect_(e,n,r,a){const u={p:n,d:r};this.log_("onDisconnect "+e,u),this.sendRequest(e,u,h=>{a&&setTimeout(()=>{a(h.s,h.d)},Math.floor(0))})}put(e,n,r,a){this.putInternal("p",e,n,r,a)}merge(e,n,r,a){this.putInternal("m",e,n,r,a)}putInternal(e,n,r,a,u){this.initConnection_();const h={p:n,d:r};u!==void 0&&(h.h=u),this.outstandingPuts_.push({action:e,request:h,onComplete:a}),this.outstandingPutCount_++;const m=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(m):this.log_("Buffering put: "+n)}sendPut_(e){const n=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,a=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(n,r,u=>{this.log_(n+" response",u),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),a&&a(u.s,u.d)})}reportStats(e){if(this.connected_){const n={c:e};this.log_("reportStats",n),this.sendRequest("s",n,r=>{if(r.s!=="ok"){const u=r.d;this.log_("reportStats","Error sending stats: "+u)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+ps(e));const n=e.r,r=this.requestCBHash_[n];r&&(delete this.requestCBHash_[n],r(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,n){this.log_("handleServerMessage",e,n),e==="d"?this.onDataUpdate_(n.p,n.d,!1,n.t):e==="m"?this.onDataUpdate_(n.p,n.d,!0,n.t):e==="c"?this.onListenRevoked_(n.p,n.q):e==="ac"?this.onAuthRevoked_(n.s,n.d):e==="apc"?this.onAppCheckRevoked_(n.s,n.d):e==="sd"?this.onSecurityDebugPacket_(n):P0("Unrecognized action received from server: "+ps(e)+`
Are you using the latest client?`)}onReady_(e,n){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=n,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){Te(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=_d,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=_d,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>TP&&(this.reconnectDelay_=_d),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let n=Math.max(0,this.reconnectDelay_-e);n=Math.random()*n,this.log_("Trying to reconnect in "+n+"ms"),this.scheduleConnect_(n),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*EP)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),a=this.id+":"+ro.nextConnectionId_++,u=this.lastSessionId;let h=!1,m=null;const y=function(){m?m.close():(h=!0,r())},x=function(T){Te(m,"sendRequest call when we're not connected not allowed."),m.sendRequest(T)};this.realtime_={close:y,sendRequest:x};const k=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[T,S]=await Promise.all([this.authTokenProvider_.getToken(k),this.appCheckTokenProvider_.getToken(k)]);h?$s("getToken() completed but was canceled"):($s("getToken() completed. Creating connection."),this.authToken_=T&&T.accessToken,this.appCheckToken_=S&&S.token,m=new xP(a,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,n,r,R=>{sr(R+" ("+this.repoInfo_.toString()+")"),this.interrupt(IP)},u))}catch(T){this.log_("Failed to get token: "+T),h||(this.repoInfo_.nodeAdmin&&sr(T),y())}}}interrupt(e){$s("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){$s("Resuming connection for reason: "+e),delete this.interruptReasons_[e],_0(this.interruptReasons_)&&(this.reconnectDelay_=_d,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const n=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:n})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const n=this.outstandingPuts_[e];n&&"h"in n.request&&n.queued&&(n.onComplete&&n.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,n){let r;n?r=n.map(u=>Sy(u)).join("$"):r="default";const a=this.removeListen_(e,r);a&&a.onComplete&&a.onComplete("permission_denied")}removeListen_(e,n){const r=new fn(e).toString();let a;if(this.listens.has(r)){const u=this.listens.get(r);a=u.get(n),u.delete(n),u.size===0&&this.listens.delete(r)}else a=void 0;return a}onAuthRevoked_(e,n){$s("Auth token revoked: "+e+"/"+n),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=k1&&(this.reconnectDelay_=C1,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,n){$s("App check token revoked: "+e+"/"+n),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=k1&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const n of e.values())this.sendListen_(n);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let n="js";e["sdk."+n+"."+Bb.replace(/\./g,"-")]=1,uy()?e["framework.cordova"]=1:J_()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=bm.getInstance().currentlyOnline();return _0(this.interruptReasons_)&&e}}ro.nextPersistentConnectionId_=0;ro.nextConnectionId_=0;class jt{constructor(e,n){this.name=e,this.node=n}static Wrap(e,n){return new jt(e,n)}}class Gm{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,n){const r=new jt(Tc,e),a=new jt(Tc,n);return this.compare(r,a)!==0}minPost(){return jt.MIN}}let Fp;class fC extends Gm{static get __EMPTY_NODE(){return Fp}static set __EMPTY_NODE(e){Fp=e}compare(e,n){return hl(e.name,n.name)}isDefinedOn(e){throw Lc("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,n){return!1}minPost(){return jt.MIN}maxPost(){return new jt(ul,Fp)}makePost(e,n){return Te(typeof e=="string","KeyIndex indexValue must always be a string."),new jt(e,Fp)}toString(){return".key"}}const bc=new fC;class Up{constructor(e,n,r,a,u=null){this.isReverse_=a,this.resultGenerator_=u,this.nodeStack_=[];let h=1;for(;!e.isEmpty();)if(e=e,h=n?r(e.key,n):1,a&&(h*=-1),h<0)this.isReverse_?e=e.left:e=e.right;else if(h===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),n;if(this.resultGenerator_?n=this.resultGenerator_(e.key,e.value):n={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return n}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class Es{constructor(e,n,r,a,u){this.key=e,this.value=n,this.color=r??Es.RED,this.left=a??_r.EMPTY_NODE,this.right=u??_r.EMPTY_NODE}copy(e,n,r,a,u){return new Es(e??this.key,n??this.value,r??this.color,a??this.left,u??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let a=this;const u=r(e,a.key);return u<0?a=a.copy(null,null,null,a.left.insert(e,n,r),null):u===0?a=a.copy(null,n,null,null,null):a=a.copy(null,null,null,null,a.right.insert(e,n,r)),a.fixUp_()}removeMin_(){if(this.left.isEmpty())return _r.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,n){let r,a;if(r=this,n(e,r.key)<0)!r.left.isEmpty()&&!r.left.isRed_()&&!r.left.left.isRed_()&&(r=r.moveRedLeft_()),r=r.copy(null,null,null,r.left.remove(e,n),null);else{if(r.left.isRed_()&&(r=r.rotateRight_()),!r.right.isEmpty()&&!r.right.isRed_()&&!r.right.left.isRed_()&&(r=r.moveRedRight_()),n(e,r.key)===0){if(r.right.isEmpty())return _r.EMPTY_NODE;a=r.right.min_(),r=r.copy(a.key,a.value,null,null,r.right.removeMin_())}r=r.copy(null,null,null,null,r.right.remove(e,n))}return r.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,Es.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,Es.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}Es.RED=!0;Es.BLACK=!1;class jP{copy(e,n,r,a,u){return this}insert(e,n,r){return new Es(e,n,null)}remove(e,n){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class _r{constructor(e,n=_r.EMPTY_NODE){this.comparator_=e,this.root_=n}insert(e,n){return new _r(this.comparator_,this.root_.insert(e,n,this.comparator_).copy(null,null,Es.BLACK,null,null))}remove(e){return new _r(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Es.BLACK,null,null))}get(e){let n,r=this.root_;for(;!r.isEmpty();){if(n=this.comparator_(e,r.key),n===0)return r.value;n<0?r=r.left:n>0&&(r=r.right)}return null}getPredecessorKey(e){let n,r=this.root_,a=null;for(;!r.isEmpty();)if(n=this.comparator_(e,r.key),n===0){if(r.left.isEmpty())return a?a.key:null;for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}else n<0?r=r.left:n>0&&(a=r,r=r.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Up(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,n){return new Up(this.root_,e,this.comparator_,!1,n)}getReverseIteratorFrom(e,n){return new Up(this.root_,e,this.comparator_,!0,n)}getReverseIterator(e){return new Up(this.root_,null,this.comparator_,!0,e)}}_r.EMPTY_NODE=new jP;function PP(t,e){return hl(t.name,e.name)}function Ay(t,e){return hl(t,e)}let R0;function AP(t){R0=t}const hC=function(t){return typeof t=="number"?"number:"+Vb(t):"string:"+t},pC=function(t){if(t.isLeafNode()){const e=t.val();Te(typeof e=="string"||typeof e=="number"||typeof e=="object"&&ji(e,".sv"),"Priority must be a string or number.")}else Te(t===R0||t.isEmpty(),"priority of unexpected type.");Te(t===R0||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let S1;class Ns{static set __childrenNodeConstructor(e){S1=e}static get __childrenNodeConstructor(){return S1}constructor(e,n=Ns.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=n,this.lazyHash_=null,Te(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),pC(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new Ns(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:Ns.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return Ot(e)?this:It(e)===".priority"?this.priorityNode_:Ns.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,n){return null}updateImmediateChild(e,n){return e===".priority"?this.updatePriority(n):n.isEmpty()&&e!==".priority"?this:Ns.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,n).updatePriority(this.priorityNode_)}updateChild(e,n){const r=It(e);return r===null?n:n.isEmpty()&&r!==".priority"?this:(Te(r!==".priority"||aa(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(r,Ns.__childrenNodeConstructor.EMPTY_NODE.updateChild(kn(e),n)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,n){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+hC(this.priorityNode_.val())+":");const n=typeof this.value_;e+=n+":",n==="number"?e+=Vb(this.value_):e+=this.value_,this.lazyHash_=Wb(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===Ns.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof Ns.__childrenNodeConstructor?-1:(Te(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const n=typeof e.value_,r=typeof this.value_,a=Ns.VALUE_TYPE_ORDER.indexOf(n),u=Ns.VALUE_TYPE_ORDER.indexOf(r);return Te(a>=0,"Unknown leaf type: "+n),Te(u>=0,"Unknown leaf type: "+r),a===u?r==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:u-a}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const n=e;return this.value_===n.value_&&this.priorityNode_.equals(n.priorityNode_)}else return!1}}Ns.VALUE_TYPE_ORDER=["object","boolean","number","string"];let mC,gC;function RP(t){mC=t}function $P(t){gC=t}class MP extends Gm{compare(e,n){const r=e.node.getPriority(),a=n.node.getPriority(),u=r.compareTo(a);return u===0?hl(e.name,n.name):u}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,n){return!e.getPriority().equals(n.getPriority())}minPost(){return jt.MIN}maxPost(){return new jt(ul,new Ns("[PRIORITY-POST]",gC))}makePost(e,n){const r=mC(e);return new jt(n,new Ns("[PRIORITY-POST]",r))}toString(){return".priority"}}const Bn=new MP;const OP=Math.log(2);class LP{constructor(e){const n=u=>parseInt(Math.log(u)/OP,10),r=u=>parseInt(Array(u+1).join("1"),2);this.count=n(e+1),this.current_=this.count-1;const a=r(this.count);this.bits_=e+1&a}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Cm=function(t,e,n,r){t.sort(e);const a=function(y,x){const k=x-y;let T,S;if(k===0)return null;if(k===1)return T=t[y],S=n?n(T):T,new Es(S,T.node,Es.BLACK,null,null);{const R=parseInt(k/2,10)+y,O=a(y,R),D=a(R+1,x);return T=t[R],S=n?n(T):T,new Es(S,T.node,Es.BLACK,O,D)}},u=function(y){let x=null,k=null,T=t.length;const S=function(O,D){const q=T-O,he=T;T-=O;const ce=a(q+1,he),C=t[q],le=n?n(C):C;R(new Es(le,C.node,D,null,ce))},R=function(O){x?(x.left=O,x=O):(k=O,x=O)};for(let O=0;O<y.count;++O){const D=y.nextBitIsOne(),q=Math.pow(2,y.count-(O+1));D?S(q,Es.BLACK):(S(q,Es.BLACK),S(q,Es.RED))}return k},h=new LP(t.length),m=u(h);return new _r(r||e,m)};let Qv;const pc={};class eo{static get Default(){return Te(pc&&Bn,"ChildrenNode.ts has not been loaded"),Qv=Qv||new eo({".priority":pc},{".priority":Bn}),Qv}constructor(e,n){this.indexes_=e,this.indexSet_=n}get(e){const n=Sc(this.indexes_,e);if(!n)throw new Error("No index defined for "+e);return n instanceof _r?n:null}hasIndex(e){return ji(this.indexSet_,e.toString())}addIndex(e,n){Te(e!==bc,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const r=[];let a=!1;const u=n.getIterator(jt.Wrap);let h=u.getNext();for(;h;)a=a||e.isDefinedOn(h.node),r.push(h),h=u.getNext();let m;a?m=Cm(r,e.getCompare()):m=pc;const y=e.toString(),x={...this.indexSet_};x[y]=e;const k={...this.indexes_};return k[y]=m,new eo(k,x)}addToIndexes(e,n){const r=hm(this.indexes_,(a,u)=>{const h=Sc(this.indexSet_,u);if(Te(h,"Missing index implementation for "+u),a===pc)if(h.isDefinedOn(e.node)){const m=[],y=n.getIterator(jt.Wrap);let x=y.getNext();for(;x;)x.name!==e.name&&m.push(x),x=y.getNext();return m.push(e),Cm(m,h.getCompare())}else return pc;else{const m=n.get(e.name);let y=a;return m&&(y=y.remove(new jt(e.name,m))),y.insert(e,e.node)}});return new eo(r,this.indexSet_)}removeFromIndexes(e,n){const r=hm(this.indexes_,a=>{if(a===pc)return a;{const u=n.get(e.name);return u?a.remove(new jt(e.name,u)):a}});return new eo(r,this.indexSet_)}}let bd;class mt{static get EMPTY_NODE(){return bd||(bd=new mt(new _r(Ay),null,eo.Default))}constructor(e,n,r){this.children_=e,this.priorityNode_=n,this.indexMap_=r,this.lazyHash_=null,this.priorityNode_&&pC(this.priorityNode_),this.children_.isEmpty()&&Te(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||bd}updatePriority(e){return this.children_.isEmpty()?this:new mt(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const n=this.children_.get(e);return n===null?bd:n}}getChild(e){const n=It(e);return n===null?this:this.getImmediateChild(n).getChild(kn(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,n){if(Te(n,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(n);{const r=new jt(e,n);let a,u;n.isEmpty()?(a=this.children_.remove(e),u=this.indexMap_.removeFromIndexes(r,this.children_)):(a=this.children_.insert(e,n),u=this.indexMap_.addToIndexes(r,this.children_));const h=a.isEmpty()?bd:this.priorityNode_;return new mt(a,h,u)}}updateChild(e,n){const r=It(e);if(r===null)return n;{Te(It(e)!==".priority"||aa(e)===1,".priority must be the last token in a path");const a=this.getImmediateChild(r).updateChild(kn(e),n);return this.updateImmediateChild(r,a)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const n={};let r=0,a=0,u=!0;if(this.forEachChild(Bn,(h,m)=>{n[h]=m.val(e),r++,u&&mt.INTEGER_REGEXP_.test(h)?a=Math.max(a,Number(h)):u=!1}),!e&&u&&a<2*r){const h=[];for(const m in n)h[m]=n[m];return h}else return e&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+hC(this.getPriority().val())+":"),this.forEachChild(Bn,(n,r)=>{const a=r.hash();a!==""&&(e+=":"+n+":"+a)}),this.lazyHash_=e===""?"":Wb(e)}return this.lazyHash_}getPredecessorChildName(e,n,r){const a=this.resolveIndex_(r);if(a){const u=a.getPredecessorKey(new jt(e,n));return u?u.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const n=this.resolveIndex_(e);if(n){const r=n.minKey();return r&&r.name}else return this.children_.minKey()}getFirstChild(e){const n=this.getFirstChildName(e);return n?new jt(n,this.children_.get(n)):null}getLastChildName(e){const n=this.resolveIndex_(e);if(n){const r=n.maxKey();return r&&r.name}else return this.children_.maxKey()}getLastChild(e){const n=this.getLastChildName(e);return n?new jt(n,this.children_.get(n)):null}forEachChild(e,n){const r=this.resolveIndex_(e);return r?r.inorderTraversal(a=>n(a.name,a.node)):this.children_.inorderTraversal(n)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,n){const r=this.resolveIndex_(n);if(r)return r.getIteratorFrom(e,a=>a);{const a=this.children_.getIteratorFrom(e.name,jt.Wrap);let u=a.peek();for(;u!=null&&n.compare(u,e)<0;)a.getNext(),u=a.peek();return a}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,n){const r=this.resolveIndex_(n);if(r)return r.getReverseIteratorFrom(e,a=>a);{const a=this.children_.getReverseIteratorFrom(e.name,jt.Wrap);let u=a.peek();for(;u!=null&&n.compare(u,e)>0;)a.getNext(),u=a.peek();return a}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===cf?-1:0}withIndex(e){if(e===bc||this.indexMap_.hasIndex(e))return this;{const n=this.indexMap_.addIndex(e,this.children_);return new mt(this.children_,this.priorityNode_,n)}}isIndexed(e){return e===bc||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const n=e;if(this.getPriority().equals(n.getPriority()))if(this.children_.count()===n.children_.count()){const r=this.getIterator(Bn),a=n.getIterator(Bn);let u=r.getNext(),h=a.getNext();for(;u&&h;){if(u.name!==h.name||!u.node.equals(h.node))return!1;u=r.getNext(),h=a.getNext()}return u===null&&h===null}else return!1;else return!1}}resolveIndex_(e){return e===bc?null:this.indexMap_.get(e.toString())}}mt.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class DP extends mt{constructor(){super(new _r(Ay),mt.EMPTY_NODE,eo.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return mt.EMPTY_NODE}isEmpty(){return!1}}const cf=new DP;Object.defineProperties(jt,{MIN:{value:new jt(Tc,mt.EMPTY_NODE)},MAX:{value:new jt(ul,cf)}});fC.__EMPTY_NODE=mt.EMPTY_NODE;Ns.__childrenNodeConstructor=mt;AP(cf);$P(cf);const FP=!0;function hs(t,e=null){if(t===null)return mt.EMPTY_NODE;if(typeof t=="object"&&".priority"in t&&(e=t[".priority"]),Te(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof t=="object"&&".value"in t&&t[".value"]!==null&&(t=t[".value"]),typeof t!="object"||".sv"in t){const n=t;return new Ns(n,hs(e))}if(!(t instanceof Array)&&FP){const n=[];let r=!1;if(Ms(t,(h,m)=>{if(h.substring(0,1)!=="."){const y=hs(m);y.isEmpty()||(r=r||!y.getPriority().isEmpty(),n.push(new jt(h,y)))}}),n.length===0)return mt.EMPTY_NODE;const u=Cm(n,PP,h=>h.name,Ay);if(r){const h=Cm(n,Bn.getCompare());return new mt(u,hs(e),new eo({".priority":h},{".priority":Bn}))}else return new mt(u,hs(e),eo.Default)}else{let n=mt.EMPTY_NODE;return Ms(t,(r,a)=>{if(ji(t,r)&&r.substring(0,1)!=="."){const u=hs(a);(u.isLeafNode()||!u.isEmpty())&&(n=n.updateImmediateChild(r,u))}}),n.updatePriority(hs(e))}}RP(hs);class UP extends Gm{constructor(e){super(),this.indexPath_=e,Te(!Ot(e)&&It(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,n){const r=this.extractChild(e.node),a=this.extractChild(n.node),u=r.compareTo(a);return u===0?hl(e.name,n.name):u}makePost(e,n){const r=hs(e),a=mt.EMPTY_NODE.updateChild(this.indexPath_,r);return new jt(n,a)}maxPost(){const e=mt.EMPTY_NODE.updateChild(this.indexPath_,cf);return new jt(ul,e)}toString(){return Wd(this.indexPath_,0).join("/")}}class BP extends Gm{compare(e,n){const r=e.node.compareTo(n.node);return r===0?hl(e.name,n.name):r}isDefinedOn(e){return!0}indexedValueChanged(e,n){return!e.equals(n)}minPost(){return jt.MIN}maxPost(){return jt.MAX}makePost(e,n){const r=hs(e);return new jt(n,r)}toString(){return".value"}}const zP=new BP;function vC(t){return{type:"value",snapshotNode:t}}function Ic(t,e){return{type:"child_added",snapshotNode:e,childName:t}}function qd(t,e){return{type:"child_removed",snapshotNode:e,childName:t}}function Vd(t,e,n){return{type:"child_changed",snapshotNode:e,childName:t,oldSnap:n}}function WP(t,e){return{type:"child_moved",snapshotNode:e,childName:t}}class Ry{constructor(e){this.index_=e}updateChild(e,n,r,a,u,h){Te(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const m=e.getImmediateChild(n);return m.getChild(a).equals(r.getChild(a))&&m.isEmpty()===r.isEmpty()||(h!=null&&(r.isEmpty()?e.hasChild(n)?h.trackChildChange(qd(n,m)):Te(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):m.isEmpty()?h.trackChildChange(Ic(n,r)):h.trackChildChange(Vd(n,r,m))),e.isLeafNode()&&r.isEmpty())?e:e.updateImmediateChild(n,r).withIndex(this.index_)}updateFullNode(e,n,r){return r!=null&&(e.isLeafNode()||e.forEachChild(Bn,(a,u)=>{n.hasChild(a)||r.trackChildChange(qd(a,u))}),n.isLeafNode()||n.forEachChild(Bn,(a,u)=>{if(e.hasChild(a)){const h=e.getImmediateChild(a);h.equals(u)||r.trackChildChange(Vd(a,u,h))}else r.trackChildChange(Ic(a,u))})),n.withIndex(this.index_)}updatePriority(e,n){return e.isEmpty()?mt.EMPTY_NODE:e.updatePriority(n)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class Hd{constructor(e){this.indexedFilter_=new Ry(e.getIndex()),this.index_=e.getIndex(),this.startPost_=Hd.getStartPost_(e),this.endPost_=Hd.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const n=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,r=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return n&&r}updateChild(e,n,r,a,u,h){return this.matches(new jt(n,r))||(r=mt.EMPTY_NODE),this.indexedFilter_.updateChild(e,n,r,a,u,h)}updateFullNode(e,n,r){n.isLeafNode()&&(n=mt.EMPTY_NODE);let a=n.withIndex(this.index_);a=a.updatePriority(mt.EMPTY_NODE);const u=this;return n.forEachChild(Bn,(h,m)=>{u.matches(new jt(h,m))||(a=a.updateImmediateChild(h,mt.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,a,r)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const n=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),n)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const n=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),n)}else return e.getIndex().maxPost()}}class qP{constructor(e){this.withinDirectionalStart=n=>this.reverse_?this.withinEndPost(n):this.withinStartPost(n),this.withinDirectionalEnd=n=>this.reverse_?this.withinStartPost(n):this.withinEndPost(n),this.withinStartPost=n=>{const r=this.index_.compare(this.rangedFilter_.getStartPost(),n);return this.startIsInclusive_?r<=0:r<0},this.withinEndPost=n=>{const r=this.index_.compare(n,this.rangedFilter_.getEndPost());return this.endIsInclusive_?r<=0:r<0},this.rangedFilter_=new Hd(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,n,r,a,u,h){return this.rangedFilter_.matches(new jt(n,r))||(r=mt.EMPTY_NODE),e.getImmediateChild(n).equals(r)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,n,r,a,u,h):this.fullLimitUpdateChild_(e,n,r,u,h)}updateFullNode(e,n,r){let a;if(n.isLeafNode()||n.isEmpty())a=mt.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<n.numChildren()&&n.isIndexed(this.index_)){a=mt.EMPTY_NODE.withIndex(this.index_);let u;this.reverse_?u=n.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):u=n.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let h=0;for(;u.hasNext()&&h<this.limit_;){const m=u.getNext();if(this.withinDirectionalStart(m))if(this.withinDirectionalEnd(m))a=a.updateImmediateChild(m.name,m.node),h++;else break;else continue}}else{a=n.withIndex(this.index_),a=a.updatePriority(mt.EMPTY_NODE);let u;this.reverse_?u=a.getReverseIterator(this.index_):u=a.getIterator(this.index_);let h=0;for(;u.hasNext();){const m=u.getNext();h<this.limit_&&this.withinDirectionalStart(m)&&this.withinDirectionalEnd(m)?h++:a=a.updateImmediateChild(m.name,mt.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,a,r)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,n,r,a,u){let h;if(this.reverse_){const T=this.index_.getCompare();h=(S,R)=>T(R,S)}else h=this.index_.getCompare();const m=e;Te(m.numChildren()===this.limit_,"");const y=new jt(n,r),x=this.reverse_?m.getFirstChild(this.index_):m.getLastChild(this.index_),k=this.rangedFilter_.matches(y);if(m.hasChild(n)){const T=m.getImmediateChild(n);let S=a.getChildAfterChild(this.index_,x,this.reverse_);for(;S!=null&&(S.name===n||m.hasChild(S.name));)S=a.getChildAfterChild(this.index_,S,this.reverse_);const R=S==null?1:h(S,y);if(k&&!r.isEmpty()&&R>=0)return u?.trackChildChange(Vd(n,r,T)),m.updateImmediateChild(n,r);{u?.trackChildChange(qd(n,T));const D=m.updateImmediateChild(n,mt.EMPTY_NODE);return S!=null&&this.rangedFilter_.matches(S)?(u?.trackChildChange(Ic(S.name,S.node)),D.updateImmediateChild(S.name,S.node)):D}}else return r.isEmpty()?e:k&&h(x,y)>=0?(u!=null&&(u.trackChildChange(qd(x.name,x.node)),u.trackChildChange(Ic(n,r))),m.updateImmediateChild(n,r).updateImmediateChild(x.name,mt.EMPTY_NODE)):e}}class $y{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Bn}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return Te(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return Te(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Tc}hasEnd(){return this.endSet_}getIndexEndValue(){return Te(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return Te(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:ul}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return Te(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Bn}copy(){const e=new $y;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function VP(t){return t.loadsAllData()?new Ry(t.getIndex()):t.hasLimit()?new qP(t):new Hd(t)}function N1(t){const e={};if(t.isDefault())return e;let n;if(t.index_===Bn?n="$priority":t.index_===zP?n="$value":t.index_===bc?n="$key":(Te(t.index_ instanceof UP,"Unrecognized index type!"),n=t.index_.toString()),e.orderBy=ps(n),t.startSet_){const r=t.startAfterSet_?"startAfter":"startAt";e[r]=ps(t.indexStartValue_),t.startNameSet_&&(e[r]+=","+ps(t.indexStartName_))}if(t.endSet_){const r=t.endBeforeSet_?"endBefore":"endAt";e[r]=ps(t.indexEndValue_),t.endNameSet_&&(e[r]+=","+ps(t.indexEndName_))}return t.limitSet_&&(t.isViewFromLeft()?e.limitToFirst=t.limit_:e.limitToLast=t.limit_),e}function E1(t){const e={};if(t.startSet_&&(e.sp=t.indexStartValue_,t.startNameSet_&&(e.sn=t.indexStartName_),e.sin=!t.startAfterSet_),t.endSet_&&(e.ep=t.indexEndValue_,t.endNameSet_&&(e.en=t.indexEndName_),e.ein=!t.endBeforeSet_),t.limitSet_){e.l=t.limit_;let n=t.viewFrom_;n===""&&(t.isViewFromLeft()?n="l":n="r"),e.vf=n}return t.index_!==Bn&&(e.i=t.index_.toString()),e}class km extends lC{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,n){return n!==void 0?"tag$"+n:(Te(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,n,r,a){super(),this.repoInfo_=e,this.onDataUpdate_=n,this.authTokenProvider_=r,this.appCheckTokenProvider_=a,this.log_=lf("p:rest:"),this.listens_={}}listen(e,n,r,a){const u=e._path.toString();this.log_("Listen called for "+u+" "+e._queryIdentifier);const h=km.getListenId_(e,r),m={};this.listens_[h]=m;const y=N1(e._queryParams);this.restRequest_(u+".json",y,(x,k)=>{let T=k;if(x===404&&(T=null,x=null),x===null&&this.onDataUpdate_(u,T,!1,r),Sc(this.listens_,h)===m){let S;x?x===401?S="permission_denied":S="rest_error:"+x:S="ok",a(S,null)}})}unlisten(e,n){const r=km.getListenId_(e,n);delete this.listens_[r]}get(e){const n=N1(e._queryParams),r=e._path.toString(),a=new ef;return this.restRequest_(r+".json",n,(u,h)=>{let m=h;u===404&&(m=null,u=null),u===null?(this.onDataUpdate_(r,m,!1,null),a.resolve(m)):a.reject(new Error(m))}),a.promise}refreshAuthToken(e){}restRequest_(e,n={},r){return n.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([a,u])=>{a&&a.accessToken&&(n.auth=a.accessToken),u&&u.token&&(n.ac=u.token);const h=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+Fc(n);this.log_("Sending REST request for "+h);const m=new XMLHttpRequest;m.onreadystatechange=()=>{if(r&&m.readyState===4){this.log_("REST Response for "+h+" received. status:",m.status,"response:",m.responseText);let y=null;if(m.status>=200&&m.status<300){try{y=Fd(m.responseText)}catch{sr("Failed to parse JSON response for "+h+": "+m.responseText)}r(null,y)}else m.status!==401&&m.status!==404&&sr("Got unsuccessful REST response for "+h+" Status: "+m.status),r(m.status);r=null}},m.open("GET",h,!0),m.send()})}}class HP{constructor(){this.rootNode_=mt.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,n){this.rootNode_=this.rootNode_.updateChild(e,n)}}function Sm(){return{value:null,children:new Map}}function yC(t,e,n){if(Ot(e))t.value=n,t.children.clear();else if(t.value!==null)t.value=t.value.updateChild(e,n);else{const r=It(e);t.children.has(r)||t.children.set(r,Sm());const a=t.children.get(r);e=kn(e),yC(a,e,n)}}function $0(t,e,n){t.value!==null?n(e,t.value):KP(t,(r,a)=>{const u=new fn(e.toString()+"/"+r);$0(a,u,n)})}function KP(t,e){t.children.forEach((n,r)=>{e(r,n)})}class GP{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),n={...e};return this.last_&&Ms(this.last_,(r,a)=>{n[r]=n[r]-a}),this.last_=e,n}}const T1=10*1e3,QP=30*1e3,YP=300*1e3;class XP{constructor(e,n){this.server_=n,this.statsToReport_={},this.statsListener_=new GP(e);const r=T1+(QP-T1)*Math.random();Ad(this.reportStats_.bind(this),Math.floor(r))}reportStats_(){const e=this.statsListener_.get(),n={};let r=!1;Ms(e,(a,u)=>{u>0&&ji(this.statsToReport_,a)&&(n[a]=u,r=!0)}),r&&this.server_.reportStats(n),Ad(this.reportStats_.bind(this),Math.floor(Math.random()*2*YP))}}var ri;(function(t){t[t.OVERWRITE=0]="OVERWRITE",t[t.MERGE=1]="MERGE",t[t.ACK_USER_WRITE=2]="ACK_USER_WRITE",t[t.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(ri||(ri={}));function My(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function Oy(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function Ly(t){return{fromUser:!1,fromServer:!0,queryId:t,tagged:!0}}class Nm{constructor(e,n,r){this.path=e,this.affectedTree=n,this.revert=r,this.type=ri.ACK_USER_WRITE,this.source=My()}operationForChild(e){if(Ot(this.path)){if(this.affectedTree.value!=null)return Te(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const n=this.affectedTree.subtree(new fn(e));return new Nm(Gt(),n,this.revert)}}else return Te(It(this.path)===e,"operationForChild called for unrelated child."),new Nm(kn(this.path),this.affectedTree,this.revert)}}class Kd{constructor(e,n){this.source=e,this.path=n,this.type=ri.LISTEN_COMPLETE}operationForChild(e){return Ot(this.path)?new Kd(this.source,Gt()):new Kd(this.source,kn(this.path))}}class dl{constructor(e,n,r){this.source=e,this.path=n,this.snap=r,this.type=ri.OVERWRITE}operationForChild(e){return Ot(this.path)?new dl(this.source,Gt(),this.snap.getImmediateChild(e)):new dl(this.source,kn(this.path),this.snap)}}class jc{constructor(e,n,r){this.source=e,this.path=n,this.children=r,this.type=ri.MERGE}operationForChild(e){if(Ot(this.path)){const n=this.children.subtree(new fn(e));return n.isEmpty()?null:n.value?new dl(this.source,Gt(),n.value):new jc(this.source,Gt(),n)}else return Te(It(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new jc(this.source,kn(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class la{constructor(e,n,r){this.node_=e,this.fullyInitialized_=n,this.filtered_=r}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(Ot(e))return this.isFullyInitialized()&&!this.filtered_;const n=It(e);return this.isCompleteForChild(n)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class JP{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function ZP(t,e,n,r){const a=[],u=[];return e.forEach(h=>{h.type==="child_changed"&&t.index_.indexedValueChanged(h.oldSnap,h.snapshotNode)&&u.push(WP(h.childName,h.snapshotNode))}),Cd(t,a,"child_removed",e,r,n),Cd(t,a,"child_added",e,r,n),Cd(t,a,"child_moved",u,r,n),Cd(t,a,"child_changed",e,r,n),Cd(t,a,"value",e,r,n),a}function Cd(t,e,n,r,a,u){const h=r.filter(m=>m.type===n);h.sort((m,y)=>tA(t,m,y)),h.forEach(m=>{const y=eA(t,m,u);a.forEach(x=>{x.respondsTo(m.type)&&e.push(x.createEvent(y,t.query_))})})}function eA(t,e,n){return e.type==="value"||e.type==="child_removed"||(e.prevName=n.getPredecessorChildName(e.childName,e.snapshotNode,t.index_)),e}function tA(t,e,n){if(e.childName==null||n.childName==null)throw Lc("Should only compare child_ events.");const r=new jt(e.childName,e.snapshotNode),a=new jt(n.childName,n.snapshotNode);return t.index_.compare(r,a)}function Qm(t,e){return{eventCache:t,serverCache:e}}function Rd(t,e,n,r){return Qm(new la(e,n,r),t.serverCache)}function wC(t,e,n,r){return Qm(t.eventCache,new la(e,n,r))}function Em(t){return t.eventCache.isFullyInitialized()?t.eventCache.getNode():null}function fl(t){return t.serverCache.isFullyInitialized()?t.serverCache.getNode():null}let Yv;const nA=()=>(Yv||(Yv=new _r(Uj)),Yv);class Cn{static fromObject(e){let n=new Cn(null);return Ms(e,(r,a)=>{n=n.set(new fn(r),a)}),n}constructor(e,n=nA()){this.value=e,this.children=n}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,n){if(this.value!=null&&n(this.value))return{path:Gt(),value:this.value};if(Ot(e))return null;{const r=It(e),a=this.children.get(r);if(a!==null){const u=a.findRootMostMatchingPathAndValue(kn(e),n);return u!=null?{path:Un(new fn(r),u.path),value:u.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(Ot(e))return this;{const n=It(e),r=this.children.get(n);return r!==null?r.subtree(kn(e)):new Cn(null)}}set(e,n){if(Ot(e))return new Cn(n,this.children);{const r=It(e),u=(this.children.get(r)||new Cn(null)).set(kn(e),n),h=this.children.insert(r,u);return new Cn(this.value,h)}}remove(e){if(Ot(e))return this.children.isEmpty()?new Cn(null):new Cn(null,this.children);{const n=It(e),r=this.children.get(n);if(r){const a=r.remove(kn(e));let u;return a.isEmpty()?u=this.children.remove(n):u=this.children.insert(n,a),this.value===null&&u.isEmpty()?new Cn(null):new Cn(this.value,u)}else return this}}get(e){if(Ot(e))return this.value;{const n=It(e),r=this.children.get(n);return r?r.get(kn(e)):null}}setTree(e,n){if(Ot(e))return n;{const r=It(e),u=(this.children.get(r)||new Cn(null)).setTree(kn(e),n);let h;return u.isEmpty()?h=this.children.remove(r):h=this.children.insert(r,u),new Cn(this.value,h)}}fold(e){return this.fold_(Gt(),e)}fold_(e,n){const r={};return this.children.inorderTraversal((a,u)=>{r[a]=u.fold_(Un(e,a),n)}),n(e,this.value,r)}findOnPath(e,n){return this.findOnPath_(e,Gt(),n)}findOnPath_(e,n,r){const a=this.value?r(n,this.value):!1;if(a)return a;if(Ot(e))return null;{const u=It(e),h=this.children.get(u);return h?h.findOnPath_(kn(e),Un(n,u),r):null}}foreachOnPath(e,n){return this.foreachOnPath_(e,Gt(),n)}foreachOnPath_(e,n,r){if(Ot(e))return this;{this.value&&r(n,this.value);const a=It(e),u=this.children.get(a);return u?u.foreachOnPath_(kn(e),Un(n,a),r):new Cn(null)}}foreach(e){this.foreach_(Gt(),e)}foreach_(e,n){this.children.inorderTraversal((r,a)=>{a.foreach_(Un(e,r),n)}),this.value&&n(e,this.value)}foreachChild(e){this.children.inorderTraversal((n,r)=>{r.value&&e(n,r.value)})}}class oi{constructor(e){this.writeTree_=e}static empty(){return new oi(new Cn(null))}}function $d(t,e,n){if(Ot(e))return new oi(new Cn(n));{const r=t.writeTree_.findRootMostValueAndPath(e);if(r!=null){const a=r.path;let u=r.value;const h=tr(a,e);return u=u.updateChild(h,n),new oi(t.writeTree_.set(a,u))}else{const a=new Cn(n),u=t.writeTree_.setTree(e,a);return new oi(u)}}}function M0(t,e,n){let r=t;return Ms(n,(a,u)=>{r=$d(r,Un(e,a),u)}),r}function I1(t,e){if(Ot(e))return oi.empty();{const n=t.writeTree_.setTree(e,new Cn(null));return new oi(n)}}function O0(t,e){return pl(t,e)!=null}function pl(t,e){const n=t.writeTree_.findRootMostValueAndPath(e);return n!=null?t.writeTree_.get(n.path).getChild(tr(n.path,e)):null}function j1(t){const e=[],n=t.writeTree_.value;return n!=null?n.isLeafNode()||n.forEachChild(Bn,(r,a)=>{e.push(new jt(r,a))}):t.writeTree_.children.inorderTraversal((r,a)=>{a.value!=null&&e.push(new jt(r,a.value))}),e}function ia(t,e){if(Ot(e))return t;{const n=pl(t,e);return n!=null?new oi(new Cn(n)):new oi(t.writeTree_.subtree(e))}}function L0(t){return t.writeTree_.isEmpty()}function Pc(t,e){return xC(Gt(),t.writeTree_,e)}function xC(t,e,n){if(e.value!=null)return n.updateChild(t,e.value);{let r=null;return e.children.inorderTraversal((a,u)=>{a===".priority"?(Te(u.value!==null,"Priority writes must always be leaf nodes"),r=u.value):n=xC(Un(t,a),u,n)}),!n.getChild(t).isEmpty()&&r!==null&&(n=n.updateChild(Un(t,".priority"),r)),n}}function Ym(t,e){return kC(e,t)}function sA(t,e,n,r,a){Te(r>t.lastWriteId,"Stacking an older write on top of newer ones"),a===void 0&&(a=!0),t.allWrites.push({path:e,snap:n,writeId:r,visible:a}),a&&(t.visibleWrites=$d(t.visibleWrites,e,n)),t.lastWriteId=r}function rA(t,e,n,r){Te(r>t.lastWriteId,"Stacking an older merge on top of newer ones"),t.allWrites.push({path:e,children:n,writeId:r,visible:!0}),t.visibleWrites=M0(t.visibleWrites,e,n),t.lastWriteId=r}function iA(t,e){for(let n=0;n<t.allWrites.length;n++){const r=t.allWrites[n];if(r.writeId===e)return r}return null}function oA(t,e){const n=t.allWrites.findIndex(m=>m.writeId===e);Te(n>=0,"removeWrite called with nonexistent writeId.");const r=t.allWrites[n];t.allWrites.splice(n,1);let a=r.visible,u=!1,h=t.allWrites.length-1;for(;a&&h>=0;){const m=t.allWrites[h];m.visible&&(h>=n&&aA(m,r.path)?a=!1:Ur(r.path,m.path)&&(u=!0)),h--}if(a){if(u)return lA(t),!0;if(r.snap)t.visibleWrites=I1(t.visibleWrites,r.path);else{const m=r.children;Ms(m,y=>{t.visibleWrites=I1(t.visibleWrites,Un(r.path,y))})}return!0}else return!1}function aA(t,e){if(t.snap)return Ur(t.path,e);for(const n in t.children)if(t.children.hasOwnProperty(n)&&Ur(Un(t.path,n),e))return!0;return!1}function lA(t){t.visibleWrites=_C(t.allWrites,cA,Gt()),t.allWrites.length>0?t.lastWriteId=t.allWrites[t.allWrites.length-1].writeId:t.lastWriteId=-1}function cA(t){return t.visible}function _C(t,e,n){let r=oi.empty();for(let a=0;a<t.length;++a){const u=t[a];if(e(u)){const h=u.path;let m;if(u.snap)Ur(n,h)?(m=tr(n,h),r=$d(r,m,u.snap)):Ur(h,n)&&(m=tr(h,n),r=$d(r,Gt(),u.snap.getChild(m)));else if(u.children){if(Ur(n,h))m=tr(n,h),r=M0(r,m,u.children);else if(Ur(h,n))if(m=tr(h,n),Ot(m))r=M0(r,Gt(),u.children);else{const y=Sc(u.children,It(m));if(y){const x=y.getChild(kn(m));r=$d(r,Gt(),x)}}}else throw Lc("WriteRecord should have .snap or .children")}}return r}function bC(t,e,n,r,a){if(!r&&!a){const u=pl(t.visibleWrites,e);if(u!=null)return u;{const h=ia(t.visibleWrites,e);if(L0(h))return n;if(n==null&&!O0(h,Gt()))return null;{const m=n||mt.EMPTY_NODE;return Pc(h,m)}}}else{const u=ia(t.visibleWrites,e);if(!a&&L0(u))return n;if(!a&&n==null&&!O0(u,Gt()))return null;{const h=function(x){return(x.visible||a)&&(!r||!~r.indexOf(x.writeId))&&(Ur(x.path,e)||Ur(e,x.path))},m=_C(t.allWrites,h,e),y=n||mt.EMPTY_NODE;return Pc(m,y)}}}function uA(t,e,n){let r=mt.EMPTY_NODE;const a=pl(t.visibleWrites,e);if(a)return a.isLeafNode()||a.forEachChild(Bn,(u,h)=>{r=r.updateImmediateChild(u,h)}),r;if(n){const u=ia(t.visibleWrites,e);return n.forEachChild(Bn,(h,m)=>{const y=Pc(ia(u,new fn(h)),m);r=r.updateImmediateChild(h,y)}),j1(u).forEach(h=>{r=r.updateImmediateChild(h.name,h.node)}),r}else{const u=ia(t.visibleWrites,e);return j1(u).forEach(h=>{r=r.updateImmediateChild(h.name,h.node)}),r}}function dA(t,e,n,r,a){Te(r||a,"Either existingEventSnap or existingServerSnap must exist");const u=Un(e,n);if(O0(t.visibleWrites,u))return null;{const h=ia(t.visibleWrites,u);return L0(h)?a.getChild(n):Pc(h,a.getChild(n))}}function fA(t,e,n,r){const a=Un(e,n),u=pl(t.visibleWrites,a);if(u!=null)return u;if(r.isCompleteForChild(n)){const h=ia(t.visibleWrites,a);return Pc(h,r.getNode().getImmediateChild(n))}else return null}function hA(t,e){return pl(t.visibleWrites,e)}function pA(t,e,n,r,a,u,h){let m;const y=ia(t.visibleWrites,e),x=pl(y,Gt());if(x!=null)m=x;else if(n!=null)m=Pc(y,n);else return[];if(m=m.withIndex(h),!m.isEmpty()&&!m.isLeafNode()){const k=[],T=h.getCompare(),S=u?m.getReverseIteratorFrom(r,h):m.getIteratorFrom(r,h);let R=S.getNext();for(;R&&k.length<a;)T(R,r)!==0&&k.push(R),R=S.getNext();return k}else return[]}function mA(){return{visibleWrites:oi.empty(),allWrites:[],lastWriteId:-1}}function Tm(t,e,n,r){return bC(t.writeTree,t.treePath,e,n,r)}function Dy(t,e){return uA(t.writeTree,t.treePath,e)}function P1(t,e,n,r){return dA(t.writeTree,t.treePath,e,n,r)}function Im(t,e){return hA(t.writeTree,Un(t.treePath,e))}function gA(t,e,n,r,a,u){return pA(t.writeTree,t.treePath,e,n,r,a,u)}function Fy(t,e,n){return fA(t.writeTree,t.treePath,e,n)}function CC(t,e){return kC(Un(t.treePath,e),t.writeTree)}function kC(t,e){return{treePath:t,writeTree:e}}class vA{constructor(){this.changeMap=new Map}trackChildChange(e){const n=e.type,r=e.childName;Te(n==="child_added"||n==="child_changed"||n==="child_removed","Only child changes supported for tracking"),Te(r!==".priority","Only non-priority child changes can be tracked.");const a=this.changeMap.get(r);if(a){const u=a.type;if(n==="child_added"&&u==="child_removed")this.changeMap.set(r,Vd(r,e.snapshotNode,a.snapshotNode));else if(n==="child_removed"&&u==="child_added")this.changeMap.delete(r);else if(n==="child_removed"&&u==="child_changed")this.changeMap.set(r,qd(r,a.oldSnap));else if(n==="child_changed"&&u==="child_added")this.changeMap.set(r,Ic(r,e.snapshotNode));else if(n==="child_changed"&&u==="child_changed")this.changeMap.set(r,Vd(r,e.snapshotNode,a.oldSnap));else throw Lc("Illegal combination of changes: "+e+" occurred after "+a)}else this.changeMap.set(r,e)}getChanges(){return Array.from(this.changeMap.values())}}class yA{getCompleteChild(e){return null}getChildAfterChild(e,n,r){return null}}const SC=new yA;class Uy{constructor(e,n,r=null){this.writes_=e,this.viewCache_=n,this.optCompleteServerCache_=r}getCompleteChild(e){const n=this.viewCache_.eventCache;if(n.isCompleteForChild(e))return n.getNode().getImmediateChild(e);{const r=this.optCompleteServerCache_!=null?new la(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Fy(this.writes_,e,r)}}getChildAfterChild(e,n,r){const a=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:fl(this.viewCache_),u=gA(this.writes_,a,n,1,r,e);return u.length===0?null:u[0]}}function wA(t){return{filter:t}}function xA(t,e){Te(e.eventCache.getNode().isIndexed(t.filter.getIndex()),"Event snap not indexed"),Te(e.serverCache.getNode().isIndexed(t.filter.getIndex()),"Server snap not indexed")}function _A(t,e,n,r,a){const u=new vA;let h,m;if(n.type===ri.OVERWRITE){const x=n;x.source.fromUser?h=D0(t,e,x.path,x.snap,r,a,u):(Te(x.source.fromServer,"Unknown source."),m=x.source.tagged||e.serverCache.isFiltered()&&!Ot(x.path),h=jm(t,e,x.path,x.snap,r,a,m,u))}else if(n.type===ri.MERGE){const x=n;x.source.fromUser?h=CA(t,e,x.path,x.children,r,a,u):(Te(x.source.fromServer,"Unknown source."),m=x.source.tagged||e.serverCache.isFiltered(),h=F0(t,e,x.path,x.children,r,a,m,u))}else if(n.type===ri.ACK_USER_WRITE){const x=n;x.revert?h=NA(t,e,x.path,r,a,u):h=kA(t,e,x.path,x.affectedTree,r,a,u)}else if(n.type===ri.LISTEN_COMPLETE)h=SA(t,e,n.path,r,u);else throw Lc("Unknown operation type: "+n.type);const y=u.getChanges();return bA(e,h,y),{viewCache:h,changes:y}}function bA(t,e,n){const r=e.eventCache;if(r.isFullyInitialized()){const a=r.getNode().isLeafNode()||r.getNode().isEmpty(),u=Em(t);(n.length>0||!t.eventCache.isFullyInitialized()||a&&!r.getNode().equals(u)||!r.getNode().getPriority().equals(u.getPriority()))&&n.push(vC(Em(e)))}}function NC(t,e,n,r,a,u){const h=e.eventCache;if(Im(r,n)!=null)return e;{let m,y;if(Ot(n))if(Te(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const x=fl(e),k=x instanceof mt?x:mt.EMPTY_NODE,T=Dy(r,k);m=t.filter.updateFullNode(e.eventCache.getNode(),T,u)}else{const x=Tm(r,fl(e));m=t.filter.updateFullNode(e.eventCache.getNode(),x,u)}else{const x=It(n);if(x===".priority"){Te(aa(n)===1,"Can't have a priority with additional path components");const k=h.getNode();y=e.serverCache.getNode();const T=P1(r,n,k,y);T!=null?m=t.filter.updatePriority(k,T):m=h.getNode()}else{const k=kn(n);let T;if(h.isCompleteForChild(x)){y=e.serverCache.getNode();const S=P1(r,n,h.getNode(),y);S!=null?T=h.getNode().getImmediateChild(x).updateChild(k,S):T=h.getNode().getImmediateChild(x)}else T=Fy(r,x,e.serverCache);T!=null?m=t.filter.updateChild(h.getNode(),x,T,k,a,u):m=h.getNode()}}return Rd(e,m,h.isFullyInitialized()||Ot(n),t.filter.filtersNodes())}}function jm(t,e,n,r,a,u,h,m){const y=e.serverCache;let x;const k=h?t.filter:t.filter.getIndexedFilter();if(Ot(n))x=k.updateFullNode(y.getNode(),r,null);else if(k.filtersNodes()&&!y.isFiltered()){const R=y.getNode().updateChild(n,r);x=k.updateFullNode(y.getNode(),R,null)}else{const R=It(n);if(!y.isCompleteForPath(n)&&aa(n)>1)return e;const O=kn(n),q=y.getNode().getImmediateChild(R).updateChild(O,r);R===".priority"?x=k.updatePriority(y.getNode(),q):x=k.updateChild(y.getNode(),R,q,O,SC,null)}const T=wC(e,x,y.isFullyInitialized()||Ot(n),k.filtersNodes()),S=new Uy(a,T,u);return NC(t,T,n,a,S,m)}function D0(t,e,n,r,a,u,h){const m=e.eventCache;let y,x;const k=new Uy(a,e,u);if(Ot(n))x=t.filter.updateFullNode(e.eventCache.getNode(),r,h),y=Rd(e,x,!0,t.filter.filtersNodes());else{const T=It(n);if(T===".priority")x=t.filter.updatePriority(e.eventCache.getNode(),r),y=Rd(e,x,m.isFullyInitialized(),m.isFiltered());else{const S=kn(n),R=m.getNode().getImmediateChild(T);let O;if(Ot(S))O=r;else{const D=k.getCompleteChild(T);D!=null?Iy(S)===".priority"&&D.getChild(uC(S)).isEmpty()?O=D:O=D.updateChild(S,r):O=mt.EMPTY_NODE}if(R.equals(O))y=e;else{const D=t.filter.updateChild(m.getNode(),T,O,S,k,h);y=Rd(e,D,m.isFullyInitialized(),t.filter.filtersNodes())}}}return y}function A1(t,e){return t.eventCache.isCompleteForChild(e)}function CA(t,e,n,r,a,u,h){let m=e;return r.foreach((y,x)=>{const k=Un(n,y);A1(e,It(k))&&(m=D0(t,m,k,x,a,u,h))}),r.foreach((y,x)=>{const k=Un(n,y);A1(e,It(k))||(m=D0(t,m,k,x,a,u,h))}),m}function R1(t,e,n){return n.foreach((r,a)=>{e=e.updateChild(r,a)}),e}function F0(t,e,n,r,a,u,h,m){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let y=e,x;Ot(n)?x=r:x=new Cn(null).setTree(n,r);const k=e.serverCache.getNode();return x.children.inorderTraversal((T,S)=>{if(k.hasChild(T)){const R=e.serverCache.getNode().getImmediateChild(T),O=R1(t,R,S);y=jm(t,y,new fn(T),O,a,u,h,m)}}),x.children.inorderTraversal((T,S)=>{const R=!e.serverCache.isCompleteForChild(T)&&S.value===null;if(!k.hasChild(T)&&!R){const O=e.serverCache.getNode().getImmediateChild(T),D=R1(t,O,S);y=jm(t,y,new fn(T),D,a,u,h,m)}}),y}function kA(t,e,n,r,a,u,h){if(Im(a,n)!=null)return e;const m=e.serverCache.isFiltered(),y=e.serverCache;if(r.value!=null){if(Ot(n)&&y.isFullyInitialized()||y.isCompleteForPath(n))return jm(t,e,n,y.getNode().getChild(n),a,u,m,h);if(Ot(n)){let x=new Cn(null);return y.getNode().forEachChild(bc,(k,T)=>{x=x.set(new fn(k),T)}),F0(t,e,n,x,a,u,m,h)}else return e}else{let x=new Cn(null);return r.foreach((k,T)=>{const S=Un(n,k);y.isCompleteForPath(S)&&(x=x.set(k,y.getNode().getChild(S)))}),F0(t,e,n,x,a,u,m,h)}}function SA(t,e,n,r,a){const u=e.serverCache,h=wC(e,u.getNode(),u.isFullyInitialized()||Ot(n),u.isFiltered());return NC(t,h,n,r,SC,a)}function NA(t,e,n,r,a,u){let h;if(Im(r,n)!=null)return e;{const m=new Uy(r,e,a),y=e.eventCache.getNode();let x;if(Ot(n)||It(n)===".priority"){let k;if(e.serverCache.isFullyInitialized())k=Tm(r,fl(e));else{const T=e.serverCache.getNode();Te(T instanceof mt,"serverChildren would be complete if leaf node"),k=Dy(r,T)}k=k,x=t.filter.updateFullNode(y,k,u)}else{const k=It(n);let T=Fy(r,k,e.serverCache);T==null&&e.serverCache.isCompleteForChild(k)&&(T=y.getImmediateChild(k)),T!=null?x=t.filter.updateChild(y,k,T,kn(n),m,u):e.eventCache.getNode().hasChild(k)?x=t.filter.updateChild(y,k,mt.EMPTY_NODE,kn(n),m,u):x=y,x.isEmpty()&&e.serverCache.isFullyInitialized()&&(h=Tm(r,fl(e)),h.isLeafNode()&&(x=t.filter.updateFullNode(x,h,u)))}return h=e.serverCache.isFullyInitialized()||Im(r,Gt())!=null,Rd(e,x,h,t.filter.filtersNodes())}}class EA{constructor(e,n){this.query_=e,this.eventRegistrations_=[];const r=this.query_._queryParams,a=new Ry(r.getIndex()),u=VP(r);this.processor_=wA(u);const h=n.serverCache,m=n.eventCache,y=a.updateFullNode(mt.EMPTY_NODE,h.getNode(),null),x=u.updateFullNode(mt.EMPTY_NODE,m.getNode(),null),k=new la(y,h.isFullyInitialized(),a.filtersNodes()),T=new la(x,m.isFullyInitialized(),u.filtersNodes());this.viewCache_=Qm(T,k),this.eventGenerator_=new JP(this.query_)}get query(){return this.query_}}function TA(t){return t.viewCache_.serverCache.getNode()}function IA(t){return Em(t.viewCache_)}function jA(t,e){const n=fl(t.viewCache_);return n&&(t.query._queryParams.loadsAllData()||!Ot(e)&&!n.getImmediateChild(It(e)).isEmpty())?n.getChild(e):null}function $1(t){return t.eventRegistrations_.length===0}function PA(t,e){t.eventRegistrations_.push(e)}function M1(t,e,n){const r=[];if(n){Te(e==null,"A cancel should cancel all event registrations.");const a=t.query._path;t.eventRegistrations_.forEach(u=>{const h=u.createCancelEvent(n,a);h&&r.push(h)})}if(e){let a=[];for(let u=0;u<t.eventRegistrations_.length;++u){const h=t.eventRegistrations_[u];if(!h.matches(e))a.push(h);else if(e.hasAnyCallback()){a=a.concat(t.eventRegistrations_.slice(u+1));break}}t.eventRegistrations_=a}else t.eventRegistrations_=[];return r}function O1(t,e,n,r){e.type===ri.MERGE&&e.source.queryId!==null&&(Te(fl(t.viewCache_),"We should always have a full cache before handling merges"),Te(Em(t.viewCache_),"Missing event cache, even though we have a server cache"));const a=t.viewCache_,u=_A(t.processor_,a,e,n,r);return xA(t.processor_,u.viewCache),Te(u.viewCache.serverCache.isFullyInitialized()||!a.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),t.viewCache_=u.viewCache,EC(t,u.changes,u.viewCache.eventCache.getNode(),null)}function AA(t,e){const n=t.viewCache_.eventCache,r=[];return n.getNode().isLeafNode()||n.getNode().forEachChild(Bn,(u,h)=>{r.push(Ic(u,h))}),n.isFullyInitialized()&&r.push(vC(n.getNode())),EC(t,r,n.getNode(),e)}function EC(t,e,n,r){const a=r?[r]:t.eventRegistrations_;return ZP(t.eventGenerator_,e,n,a)}let Pm;class TC{constructor(){this.views=new Map}}function RA(t){Te(!Pm,"__referenceConstructor has already been defined"),Pm=t}function $A(){return Te(Pm,"Reference.ts has not been loaded"),Pm}function MA(t){return t.views.size===0}function By(t,e,n,r){const a=e.source.queryId;if(a!==null){const u=t.views.get(a);return Te(u!=null,"SyncTree gave us an op for an invalid query."),O1(u,e,n,r)}else{let u=[];for(const h of t.views.values())u=u.concat(O1(h,e,n,r));return u}}function IC(t,e,n,r,a){const u=e._queryIdentifier,h=t.views.get(u);if(!h){let m=Tm(n,a?r:null),y=!1;m?y=!0:r instanceof mt?(m=Dy(n,r),y=!1):(m=mt.EMPTY_NODE,y=!1);const x=Qm(new la(m,y,!1),new la(r,a,!1));return new EA(e,x)}return h}function OA(t,e,n,r,a,u){const h=IC(t,e,r,a,u);return t.views.has(e._queryIdentifier)||t.views.set(e._queryIdentifier,h),PA(h,n),AA(h,n)}function LA(t,e,n,r){const a=e._queryIdentifier,u=[];let h=[];const m=ca(t);if(a==="default")for(const[y,x]of t.views.entries())h=h.concat(M1(x,n,r)),$1(x)&&(t.views.delete(y),x.query._queryParams.loadsAllData()||u.push(x.query));else{const y=t.views.get(a);y&&(h=h.concat(M1(y,n,r)),$1(y)&&(t.views.delete(a),y.query._queryParams.loadsAllData()||u.push(y.query)))}return m&&!ca(t)&&u.push(new($A())(e._repo,e._path)),{removed:u,events:h}}function jC(t){const e=[];for(const n of t.views.values())n.query._queryParams.loadsAllData()||e.push(n);return e}function oa(t,e){let n=null;for(const r of t.views.values())n=n||jA(r,e);return n}function PC(t,e){if(e._queryParams.loadsAllData())return Xm(t);{const r=e._queryIdentifier;return t.views.get(r)}}function AC(t,e){return PC(t,e)!=null}function ca(t){return Xm(t)!=null}function Xm(t){for(const e of t.views.values())if(e.query._queryParams.loadsAllData())return e;return null}let Am;function DA(t){Te(!Am,"__referenceConstructor has already been defined"),Am=t}function FA(){return Te(Am,"Reference.ts has not been loaded"),Am}let UA=1;class L1{constructor(e){this.listenProvider_=e,this.syncPointTree_=new Cn(null),this.pendingWriteTree_=mA(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function RC(t,e,n,r,a){return sA(t.pendingWriteTree_,e,n,r,a),a?Wc(t,new dl(My(),e,n)):[]}function BA(t,e,n,r){rA(t.pendingWriteTree_,e,n,r);const a=Cn.fromObject(n);return Wc(t,new jc(My(),e,a))}function ea(t,e,n=!1){const r=iA(t.pendingWriteTree_,e);if(oA(t.pendingWriteTree_,e)){let u=new Cn(null);return r.snap!=null?u=u.set(Gt(),!0):Ms(r.children,h=>{u=u.set(new fn(h),!0)}),Wc(t,new Nm(r.path,u,n))}else return[]}function uf(t,e,n){return Wc(t,new dl(Oy(),e,n))}function zA(t,e,n){const r=Cn.fromObject(n);return Wc(t,new jc(Oy(),e,r))}function WA(t,e){return Wc(t,new Kd(Oy(),e))}function qA(t,e,n){const r=Wy(t,n);if(r){const a=qy(r),u=a.path,h=a.queryId,m=tr(u,e),y=new Kd(Ly(h),m);return Vy(t,u,y)}else return[]}function Rm(t,e,n,r,a=!1){const u=e._path,h=t.syncPointTree_.get(u);let m=[];if(h&&(e._queryIdentifier==="default"||AC(h,e))){const y=LA(h,e,n,r);MA(h)&&(t.syncPointTree_=t.syncPointTree_.remove(u));const x=y.removed;if(m=y.events,!a){const k=x.findIndex(S=>S._queryParams.loadsAllData())!==-1,T=t.syncPointTree_.findOnPath(u,(S,R)=>ca(R));if(k&&!T){const S=t.syncPointTree_.subtree(u);if(!S.isEmpty()){const R=KA(S);for(let O=0;O<R.length;++O){const D=R[O],q=D.query,he=LC(t,D);t.listenProvider_.startListening(Md(q),Gd(t,q),he.hashFn,he.onComplete)}}}!T&&x.length>0&&!r&&(k?t.listenProvider_.stopListening(Md(e),null):x.forEach(S=>{const R=t.queryToTagMap.get(Jm(S));t.listenProvider_.stopListening(Md(S),R)}))}GA(t,x)}return m}function $C(t,e,n,r){const a=Wy(t,r);if(a!=null){const u=qy(a),h=u.path,m=u.queryId,y=tr(h,e),x=new dl(Ly(m),y,n);return Vy(t,h,x)}else return[]}function VA(t,e,n,r){const a=Wy(t,r);if(a){const u=qy(a),h=u.path,m=u.queryId,y=tr(h,e),x=Cn.fromObject(n),k=new jc(Ly(m),y,x);return Vy(t,h,k)}else return[]}function U0(t,e,n,r=!1){const a=e._path;let u=null,h=!1;t.syncPointTree_.foreachOnPath(a,(S,R)=>{const O=tr(S,a);u=u||oa(R,O),h=h||ca(R)});let m=t.syncPointTree_.get(a);m?(h=h||ca(m),u=u||oa(m,Gt())):(m=new TC,t.syncPointTree_=t.syncPointTree_.set(a,m));let y;u!=null?y=!0:(y=!1,u=mt.EMPTY_NODE,t.syncPointTree_.subtree(a).foreachChild((R,O)=>{const D=oa(O,Gt());D&&(u=u.updateImmediateChild(R,D))}));const x=AC(m,e);if(!x&&!e._queryParams.loadsAllData()){const S=Jm(e);Te(!t.queryToTagMap.has(S),"View does not exist, but we have a tag");const R=QA();t.queryToTagMap.set(S,R),t.tagToQueryMap.set(R,S)}const k=Ym(t.pendingWriteTree_,a);let T=OA(m,e,n,k,u,y);if(!x&&!h&&!r){const S=PC(m,e);T=T.concat(YA(t,e,S))}return T}function zy(t,e,n){const a=t.pendingWriteTree_,u=t.syncPointTree_.findOnPath(e,(h,m)=>{const y=tr(h,e),x=oa(m,y);if(x)return x});return bC(a,e,u,n,!0)}function HA(t,e){const n=e._path;let r=null;t.syncPointTree_.foreachOnPath(n,(x,k)=>{const T=tr(x,n);r=r||oa(k,T)});let a=t.syncPointTree_.get(n);a?r=r||oa(a,Gt()):(a=new TC,t.syncPointTree_=t.syncPointTree_.set(n,a));const u=r!=null,h=u?new la(r,!0,!1):null,m=Ym(t.pendingWriteTree_,e._path),y=IC(a,e,m,u?h.getNode():mt.EMPTY_NODE,u);return IA(y)}function Wc(t,e){return MC(e,t.syncPointTree_,null,Ym(t.pendingWriteTree_,Gt()))}function MC(t,e,n,r){if(Ot(t.path))return OC(t,e,n,r);{const a=e.get(Gt());n==null&&a!=null&&(n=oa(a,Gt()));let u=[];const h=It(t.path),m=t.operationForChild(h),y=e.children.get(h);if(y&&m){const x=n?n.getImmediateChild(h):null,k=CC(r,h);u=u.concat(MC(m,y,x,k))}return a&&(u=u.concat(By(a,t,r,n))),u}}function OC(t,e,n,r){const a=e.get(Gt());n==null&&a!=null&&(n=oa(a,Gt()));let u=[];return e.children.inorderTraversal((h,m)=>{const y=n?n.getImmediateChild(h):null,x=CC(r,h),k=t.operationForChild(h);k&&(u=u.concat(OC(k,m,y,x)))}),a&&(u=u.concat(By(a,t,r,n))),u}function LC(t,e){const n=e.query,r=Gd(t,n);return{hashFn:()=>(TA(e)||mt.EMPTY_NODE).hash(),onComplete:a=>{if(a==="ok")return r?qA(t,n._path,r):WA(t,n._path);{const u=Wj(a,n);return Rm(t,n,null,u)}}}}function Gd(t,e){const n=Jm(e);return t.queryToTagMap.get(n)}function Jm(t){return t._path.toString()+"$"+t._queryIdentifier}function Wy(t,e){return t.tagToQueryMap.get(e)}function qy(t){const e=t.indexOf("$");return Te(e!==-1&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new fn(t.substr(0,e))}}function Vy(t,e,n){const r=t.syncPointTree_.get(e);Te(r,"Missing sync point for query tag that we're tracking");const a=Ym(t.pendingWriteTree_,e);return By(r,n,a,null)}function KA(t){return t.fold((e,n,r)=>{if(n&&ca(n))return[Xm(n)];{let a=[];return n&&(a=jC(n)),Ms(r,(u,h)=>{a=a.concat(h)}),a}})}function Md(t){return t._queryParams.loadsAllData()&&!t._queryParams.isDefault()?new(FA())(t._repo,t._path):t}function GA(t,e){for(let n=0;n<e.length;++n){const r=e[n];if(!r._queryParams.loadsAllData()){const a=Jm(r),u=t.queryToTagMap.get(a);t.queryToTagMap.delete(a),t.tagToQueryMap.delete(u)}}}function QA(){return UA++}function YA(t,e,n){const r=e._path,a=Gd(t,e),u=LC(t,n),h=t.listenProvider_.startListening(Md(e),a,u.hashFn,u.onComplete),m=t.syncPointTree_.subtree(r);if(a)Te(!ca(m.value),"If we're adding a query, it shouldn't be shadowed");else{const y=m.fold((x,k,T)=>{if(!Ot(x)&&k&&ca(k))return[Xm(k).query];{let S=[];return k&&(S=S.concat(jC(k).map(R=>R.query))),Ms(T,(R,O)=>{S=S.concat(O)}),S}});for(let x=0;x<y.length;++x){const k=y[x];t.listenProvider_.stopListening(Md(k),Gd(t,k))}}return h}class Hy{constructor(e){this.node_=e}getImmediateChild(e){const n=this.node_.getImmediateChild(e);return new Hy(n)}node(){return this.node_}}class Ky{constructor(e,n){this.syncTree_=e,this.path_=n}getImmediateChild(e){const n=Un(this.path_,e);return new Ky(this.syncTree_,n)}node(){return zy(this.syncTree_,this.path_)}}const XA=function(t){return t=t||{},t.timestamp=t.timestamp||new Date().getTime(),t},D1=function(t,e,n){if(!t||typeof t!="object")return t;if(Te(".sv"in t,"Unexpected leaf node or priority contents"),typeof t[".sv"]=="string")return JA(t[".sv"],e,n);if(typeof t[".sv"]=="object")return ZA(t[".sv"],e);Te(!1,"Unexpected server value: "+JSON.stringify(t,null,2))},JA=function(t,e,n){switch(t){case"timestamp":return n.timestamp;default:Te(!1,"Unexpected server value: "+t)}},ZA=function(t,e,n){t.hasOwnProperty("increment")||Te(!1,"Unexpected server value: "+JSON.stringify(t,null,2));const r=t.increment;typeof r!="number"&&Te(!1,"Unexpected increment value: "+r);const a=e.node();if(Te(a!==null&&typeof a<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!a.isLeafNode())return r;const h=a.getValue();return typeof h!="number"?r:h+r},DC=function(t,e,n,r){return Gy(e,new Ky(n,t),r)},FC=function(t,e,n){return Gy(t,new Hy(e),n)};function Gy(t,e,n){const r=t.getPriority().val(),a=D1(r,e.getImmediateChild(".priority"),n);let u;if(t.isLeafNode()){const h=t,m=D1(h.getValue(),e,n);return m!==h.getValue()||a!==h.getPriority().val()?new Ns(m,hs(a)):t}else{const h=t;return u=h,a!==h.getPriority().val()&&(u=u.updatePriority(new Ns(a))),h.forEachChild(Bn,(m,y)=>{const x=Gy(y,e.getImmediateChild(m),n);x!==y&&(u=u.updateImmediateChild(m,x))}),u}}class Qy{constructor(e="",n=null,r={children:{},childCount:0}){this.name=e,this.parent=n,this.node=r}}function Yy(t,e){let n=e instanceof fn?e:new fn(e),r=t,a=It(n);for(;a!==null;){const u=Sc(r.node.children,a)||{children:{},childCount:0};r=new Qy(a,r,u),n=kn(n),a=It(n)}return r}function qc(t){return t.node.value}function UC(t,e){t.node.value=e,B0(t)}function BC(t){return t.node.childCount>0}function eR(t){return qc(t)===void 0&&!BC(t)}function Zm(t,e){Ms(t.node.children,(n,r)=>{e(new Qy(n,t,r))})}function zC(t,e,n,r){n&&e(t),Zm(t,a=>{zC(a,e,!0)})}function tR(t,e,n){let r=t.parent;for(;r!==null;){if(e(r))return!0;r=r.parent}return!1}function df(t){return new fn(t.parent===null?t.name:df(t.parent)+"/"+t.name)}function B0(t){t.parent!==null&&nR(t.parent,t.name,t)}function nR(t,e,n){const r=eR(n),a=ji(t.node.children,e);r&&a?(delete t.node.children[e],t.node.childCount--,B0(t)):!r&&!a&&(t.node.children[e]=n.node,t.node.childCount++,B0(t))}const sR=/[\[\].#$\/\u0000-\u001F\u007F]/,rR=/[\[\].#$\u0000-\u001F\u007F]/,Xv=10*1024*1024,Xy=function(t){return typeof t=="string"&&t.length!==0&&!sR.test(t)},WC=function(t){return typeof t=="string"&&t.length!==0&&!rR.test(t)},iR=function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),WC(t)},oR=function(t){return t===null||typeof t=="string"||typeof t=="number"&&!ky(t)||t&&typeof t=="object"&&ji(t,".sv")},aR=function(t,e,n,r){eg(Wm(t,"value"),e,n)},eg=function(t,e,n){const r=n instanceof fn?new CP(n,t):n;if(e===void 0)throw new Error(t+"contains undefined "+Xa(r));if(typeof e=="function")throw new Error(t+"contains a function "+Xa(r)+" with contents = "+e.toString());if(ky(e))throw new Error(t+"contains "+e.toString()+" "+Xa(r));if(typeof e=="string"&&e.length>Xv/3&&qm(e)>Xv)throw new Error(t+"contains a string greater than "+Xv+" utf8 bytes "+Xa(r)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let a=!1,u=!1;if(Ms(e,(h,m)=>{if(h===".value")a=!0;else if(h!==".priority"&&h!==".sv"&&(u=!0,!Xy(h)))throw new Error(t+" contains an invalid key ("+h+") "+Xa(r)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);kP(r,h),eg(t,m,r),SP(r)}),a&&u)throw new Error(t+' contains ".value" child '+Xa(r)+" in addition to actual children.")}},lR=function(t,e){let n,r;for(n=0;n<e.length;n++){r=e[n];const u=Wd(r);for(let h=0;h<u.length;h++)if(!(u[h]===".priority"&&h===u.length-1)){if(!Xy(u[h]))throw new Error(t+"contains an invalid key ("+u[h]+") in path "+r.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(bP);let a=null;for(n=0;n<e.length;n++){if(r=e[n],a!==null&&Ur(a,r))throw new Error(t+"contains a path "+a.toString()+" that is ancestor of another path "+r.toString());a=r}},cR=function(t,e,n,r){const a=Wm(t,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(a+" must be an object containing the children to replace.");const u=[];Ms(e,(h,m)=>{const y=new fn(h);if(eg(a,m,Un(n,y)),Iy(y)===".priority"&&!oR(m))throw new Error(a+"contains an invalid value for '"+y.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");u.push(y)}),lR(a,u)},qC=function(t,e,n,r){if(!WC(n))throw new Error(Wm(t,e)+'was an invalid path = "'+n+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},uR=function(t,e,n,r){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),qC(t,e,n)},VC=function(t,e){if(It(e)===".info")throw new Error(t+" failed = Can't modify data under /.info/")},dR=function(t,e){const n=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!Xy(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||n.length!==0&&!iR(n))throw new Error(Wm(t,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};class fR{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function tg(t,e){let n=null;for(let r=0;r<e.length;r++){const a=e[r],u=a.getPath();n!==null&&!jy(u,n.path)&&(t.eventLists_.push(n),n=null),n===null&&(n={events:[],path:u}),n.events.push(a)}n&&t.eventLists_.push(n)}function HC(t,e,n){tg(t,n),KC(t,r=>jy(r,e))}function Wr(t,e,n){tg(t,n),KC(t,r=>Ur(r,e)||Ur(e,r))}function KC(t,e){t.recursionDepth_++;let n=!0;for(let r=0;r<t.eventLists_.length;r++){const a=t.eventLists_[r];if(a){const u=a.path;e(u)?(hR(t.eventLists_[r]),t.eventLists_[r]=null):n=!1}}n&&(t.eventLists_=[]),t.recursionDepth_--}function hR(t){for(let e=0;e<t.events.length;e++){const n=t.events[e];if(n!==null){t.events[e]=null;const r=n.getEventRunner();Pd&&$s("event: "+n.toString()),zc(r)}}}const pR="repo_interrupt",mR=25;class gR{constructor(e,n,r,a){this.repoInfo_=e,this.forceRestClient_=n,this.authTokenProvider_=r,this.appCheckProvider_=a,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new fR,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Sm(),this.transactionQueueTree_=new Qy,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function vR(t,e,n){if(t.stats_=Ey(t.repoInfo_),t.forceRestClient_||Kj())t.server_=new km(t.repoInfo_,(r,a,u,h)=>{F1(t,r,a,u,h)},t.authTokenProvider_,t.appCheckProvider_),setTimeout(()=>U1(t,!0),0);else{if(typeof n<"u"&&n!==null){if(typeof n!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{ps(n)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}t.persistentConnection_=new ro(t.repoInfo_,e,(r,a,u,h)=>{F1(t,r,a,u,h)},r=>{U1(t,r)},r=>{wR(t,r)},t.authTokenProvider_,t.appCheckProvider_,n),t.server_=t.persistentConnection_}t.authTokenProvider_.addTokenChangeListener(r=>{t.server_.refreshAuthToken(r)}),t.appCheckProvider_.addTokenChangeListener(r=>{t.server_.refreshAppCheckToken(r.token)}),t.statsReporter_=Jj(t.repoInfo_,()=>new XP(t.stats_,t.server_)),t.infoData_=new HP,t.infoSyncTree_=new L1({startListening:(r,a,u,h)=>{let m=[];const y=t.infoData_.getNode(r._path);return y.isEmpty()||(m=uf(t.infoSyncTree_,r._path,y),setTimeout(()=>{h("ok")},0)),m},stopListening:()=>{}}),Jy(t,"connected",!1),t.serverSyncTree_=new L1({startListening:(r,a,u,h)=>(t.server_.listen(r,u,a,(m,y)=>{const x=h(m,y);Wr(t.eventQueue_,r._path,x)}),[]),stopListening:(r,a)=>{t.server_.unlisten(r,a)}})}function yR(t){const n=t.infoData_.getNode(new fn(".info/serverTimeOffset")).val()||0;return new Date().getTime()+n}function ng(t){return XA({timestamp:yR(t)})}function F1(t,e,n,r,a){t.dataUpdateCount++;const u=new fn(e);n=t.interceptServerDataCallback_?t.interceptServerDataCallback_(e,n):n;let h=[];if(a)if(r){const y=hm(n,x=>hs(x));h=VA(t.serverSyncTree_,u,y,a)}else{const y=hs(n);h=$C(t.serverSyncTree_,u,y,a)}else if(r){const y=hm(n,x=>hs(x));h=zA(t.serverSyncTree_,u,y)}else{const y=hs(n);h=uf(t.serverSyncTree_,u,y)}let m=u;h.length>0&&(m=Ac(t,u)),Wr(t.eventQueue_,m,h)}function U1(t,e){Jy(t,"connected",e),e===!1&&CR(t)}function wR(t,e){Ms(e,(n,r)=>{Jy(t,n,r)})}function Jy(t,e,n){const r=new fn("/.info/"+e),a=hs(n);t.infoData_.updateSnapshot(r,a);const u=uf(t.infoSyncTree_,r,a);Wr(t.eventQueue_,r,u)}function Zy(t){return t.nextWriteId_++}function xR(t,e,n){const r=HA(t.serverSyncTree_,e);return r!=null?Promise.resolve(r):t.server_.get(e).then(a=>{const u=hs(a).withIndex(e._queryParams.getIndex());U0(t.serverSyncTree_,e,n,!0);let h;if(e._queryParams.loadsAllData())h=uf(t.serverSyncTree_,e._path,u);else{const m=Gd(t.serverSyncTree_,e);h=$C(t.serverSyncTree_,e._path,u,m)}return Wr(t.eventQueue_,e._path,h),Rm(t.serverSyncTree_,e,n,null,!0),u},a=>(ff(t,"get for query "+ps(e)+" failed: "+a),Promise.reject(new Error(a))))}function _R(t,e,n,r,a){ff(t,"set",{path:e.toString(),value:n,priority:r});const u=ng(t),h=hs(n,r),m=zy(t.serverSyncTree_,e),y=FC(h,m,u),x=Zy(t),k=RC(t.serverSyncTree_,e,y,x,!0);tg(t.eventQueue_,k),t.server_.put(e.toString(),h.val(!0),(S,R)=>{const O=S==="ok";O||sr("set at "+e+" failed: "+S);const D=ea(t.serverSyncTree_,x,!O);Wr(t.eventQueue_,e,D),z0(t,a,S,R)});const T=tw(t,e);Ac(t,T),Wr(t.eventQueue_,T,[])}function bR(t,e,n,r){ff(t,"update",{path:e.toString(),value:n});let a=!0;const u=ng(t),h={};if(Ms(n,(m,y)=>{a=!1,h[m]=DC(Un(e,m),hs(y),t.serverSyncTree_,u)}),a)$s("update() called with empty data.  Don't do anything."),z0(t,r,"ok",void 0);else{const m=Zy(t),y=BA(t.serverSyncTree_,e,h,m);tg(t.eventQueue_,y),t.server_.merge(e.toString(),n,(x,k)=>{const T=x==="ok";T||sr("update at "+e+" failed: "+x);const S=ea(t.serverSyncTree_,m,!T),R=S.length>0?Ac(t,e):e;Wr(t.eventQueue_,R,S),z0(t,r,x,k)}),Ms(n,x=>{const k=tw(t,Un(e,x));Ac(t,k)}),Wr(t.eventQueue_,e,[])}}function CR(t){ff(t,"onDisconnectEvents");const e=ng(t),n=Sm();$0(t.onDisconnect_,Gt(),(a,u)=>{const h=DC(a,u,t.serverSyncTree_,e);yC(n,a,h)});let r=[];$0(n,Gt(),(a,u)=>{r=r.concat(uf(t.serverSyncTree_,a,u));const h=tw(t,a);Ac(t,h)}),t.onDisconnect_=Sm(),Wr(t.eventQueue_,Gt(),r)}function kR(t,e,n){let r;It(e._path)===".info"?r=U0(t.infoSyncTree_,e,n):r=U0(t.serverSyncTree_,e,n),HC(t.eventQueue_,e._path,r)}function B1(t,e,n){let r;It(e._path)===".info"?r=Rm(t.infoSyncTree_,e,n):r=Rm(t.serverSyncTree_,e,n),HC(t.eventQueue_,e._path,r)}function SR(t){t.persistentConnection_&&t.persistentConnection_.interrupt(pR)}function ff(t,...e){let n="";t.persistentConnection_&&(n=t.persistentConnection_.id+":"),$s(n,...e)}function z0(t,e,n,r){e&&zc(()=>{if(n==="ok")e(null);else{const a=(n||"error").toUpperCase();let u=a;r&&(u+=": "+r);const h=new Error(u);h.code=a,e(h)}})}function GC(t,e,n){return zy(t.serverSyncTree_,e,n)||mt.EMPTY_NODE}function ew(t,e=t.transactionQueueTree_){if(e||sg(t,e),qc(e)){const n=YC(t,e);Te(n.length>0,"Sending zero length transaction queue"),n.every(a=>a.status===0)&&NR(t,df(e),n)}else BC(e)&&Zm(e,n=>{ew(t,n)})}function NR(t,e,n){const r=n.map(x=>x.currentWriteId),a=GC(t,e,r);let u=a;const h=a.hash();for(let x=0;x<n.length;x++){const k=n[x];Te(k.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),k.status=1,k.retryCount++;const T=tr(e,k.path);u=u.updateChild(T,k.currentOutputSnapshotRaw)}const m=u.val(!0),y=e;t.server_.put(y.toString(),m,x=>{ff(t,"transaction put response",{path:y.toString(),status:x});let k=[];if(x==="ok"){const T=[];for(let S=0;S<n.length;S++)n[S].status=2,k=k.concat(ea(t.serverSyncTree_,n[S].currentWriteId)),n[S].onComplete&&T.push(()=>n[S].onComplete(null,!0,n[S].currentOutputSnapshotResolved)),n[S].unwatcher();sg(t,Yy(t.transactionQueueTree_,e)),ew(t,t.transactionQueueTree_),Wr(t.eventQueue_,e,k);for(let S=0;S<T.length;S++)zc(T[S])}else{if(x==="datastale")for(let T=0;T<n.length;T++)n[T].status===3?n[T].status=4:n[T].status=0;else{sr("transaction at "+y.toString()+" failed: "+x);for(let T=0;T<n.length;T++)n[T].status=4,n[T].abortReason=x}Ac(t,e)}},h)}function Ac(t,e){const n=QC(t,e),r=df(n),a=YC(t,n);return ER(t,a,r),r}function ER(t,e,n){if(e.length===0)return;const r=[];let a=[];const h=e.filter(m=>m.status===0).map(m=>m.currentWriteId);for(let m=0;m<e.length;m++){const y=e[m],x=tr(n,y.path);let k=!1,T;if(Te(x!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),y.status===4)k=!0,T=y.abortReason,a=a.concat(ea(t.serverSyncTree_,y.currentWriteId,!0));else if(y.status===0)if(y.retryCount>=mR)k=!0,T="maxretry",a=a.concat(ea(t.serverSyncTree_,y.currentWriteId,!0));else{const S=GC(t,y.path,h);y.currentInputSnapshot=S;const R=e[m].update(S.val());if(R!==void 0){eg("transaction failed: Data returned ",R,y.path);let O=hs(R);typeof R=="object"&&R!=null&&ji(R,".priority")||(O=O.updatePriority(S.getPriority()));const q=y.currentWriteId,he=ng(t),ce=FC(O,S,he);y.currentOutputSnapshotRaw=O,y.currentOutputSnapshotResolved=ce,y.currentWriteId=Zy(t),h.splice(h.indexOf(q),1),a=a.concat(RC(t.serverSyncTree_,y.path,ce,y.currentWriteId,y.applyLocally)),a=a.concat(ea(t.serverSyncTree_,q,!0))}else k=!0,T="nodata",a=a.concat(ea(t.serverSyncTree_,y.currentWriteId,!0))}Wr(t.eventQueue_,n,a),a=[],k&&(e[m].status=2,(function(S){setTimeout(S,Math.floor(0))})(e[m].unwatcher),e[m].onComplete&&(T==="nodata"?r.push(()=>e[m].onComplete(null,!1,e[m].currentInputSnapshot)):r.push(()=>e[m].onComplete(new Error(T),!1,null))))}sg(t,t.transactionQueueTree_);for(let m=0;m<r.length;m++)zc(r[m]);ew(t,t.transactionQueueTree_)}function QC(t,e){let n,r=t.transactionQueueTree_;for(n=It(e);n!==null&&qc(r)===void 0;)r=Yy(r,n),e=kn(e),n=It(e);return r}function YC(t,e){const n=[];return XC(t,e,n),n.sort((r,a)=>r.order-a.order),n}function XC(t,e,n){const r=qc(e);if(r)for(let a=0;a<r.length;a++)n.push(r[a]);Zm(e,a=>{XC(t,a,n)})}function sg(t,e){const n=qc(e);if(n){let r=0;for(let a=0;a<n.length;a++)n[a].status!==2&&(n[r]=n[a],r++);n.length=r,UC(e,n.length>0?n:void 0)}Zm(e,r=>{sg(t,r)})}function tw(t,e){const n=df(QC(t,e)),r=Yy(t.transactionQueueTree_,e);return tR(r,a=>{Jv(t,a)}),Jv(t,r),zC(r,a=>{Jv(t,a)}),n}function Jv(t,e){const n=qc(e);if(n){const r=[];let a=[],u=-1;for(let h=0;h<n.length;h++)n[h].status===3||(n[h].status===1?(Te(u===h-1,"All SENT items should be at beginning of queue."),u=h,n[h].status=3,n[h].abortReason="set"):(Te(n[h].status===0,"Unexpected transaction status in abort"),n[h].unwatcher(),a=a.concat(ea(t.serverSyncTree_,n[h].currentWriteId,!0)),n[h].onComplete&&r.push(n[h].onComplete.bind(null,new Error("set"),!1,null))));u===-1?UC(e,void 0):n.length=u+1,Wr(t.eventQueue_,df(e),a);for(let h=0;h<r.length;h++)zc(r[h])}}function TR(t){let e="";const n=t.split("/");for(let r=0;r<n.length;r++)if(n[r].length>0){let a=n[r];try{a=decodeURIComponent(a.replace(/\+/g," "))}catch{}e+="/"+a}return e}function IR(t){const e={};t.charAt(0)==="?"&&(t=t.substring(1));for(const n of t.split("&")){if(n.length===0)continue;const r=n.split("=");r.length===2?e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):sr(`Invalid query segment '${n}' in query '${t}'`)}return e}const z1=function(t,e){const n=jR(t),r=n.namespace;n.domain==="firebase.com"&&co(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||r==="undefined")&&n.domain!=="localhost"&&co("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||Dj();const a=n.scheme==="ws"||n.scheme==="wss";return{repoInfo:new tC(n.host,n.secure,r,a,e,"",r!==n.subdomain),path:new fn(n.pathString)}},jR=function(t){let e="",n="",r="",a="",u="",h=!0,m="https",y=443;if(typeof t=="string"){let x=t.indexOf("//");x>=0&&(m=t.substring(0,x-1),t=t.substring(x+2));let k=t.indexOf("/");k===-1&&(k=t.length);let T=t.indexOf("?");T===-1&&(T=t.length),e=t.substring(0,Math.min(k,T)),k<T&&(a=TR(t.substring(k,T)));const S=IR(t.substring(Math.min(t.length,T)));x=e.indexOf(":"),x>=0?(h=m==="https"||m==="wss",y=parseInt(e.substring(x+1),10)):x=e.length;const R=e.slice(0,x);if(R.toLowerCase()==="localhost")n="localhost";else if(R.split(".").length<=2)n=R;else{const O=e.indexOf(".");r=e.substring(0,O).toLowerCase(),n=e.substring(O+1),u=r}"ns"in S&&(u=S.ns)}return{host:e,port:y,domain:n,subdomain:r,secure:h,scheme:m,pathString:a,namespace:u}};class PR{constructor(e,n,r,a){this.eventType=e,this.eventRegistration=n,this.snapshot=r,this.prevName=a}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+ps(this.snapshot.exportVal())}}class AR{constructor(e,n,r){this.eventRegistration=e,this.error=n,this.path=r}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class JC{constructor(e,n){this.snapshotCallback=e,this.cancelCallback=n}onValue(e,n){this.snapshotCallback.call(null,e,n)}onCancel(e){return Te(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class nw{constructor(e,n,r,a){this._repo=e,this._path=n,this._queryParams=r,this._orderByCalled=a}get key(){return Ot(this._path)?null:Iy(this._path)}get ref(){return new fo(this._repo,this._path)}get _queryIdentifier(){const e=E1(this._queryParams),n=Sy(e);return n==="{}"?"default":n}get _queryObject(){return E1(this._queryParams)}isEqual(e){if(e=Os(e),!(e instanceof nw))return!1;const n=this._repo===e._repo,r=jy(this._path,e._path),a=this._queryIdentifier===e._queryIdentifier;return n&&r&&a}toJSON(){return this.toString()}toString(){return this._repo.toString()+_P(this._path)}}class fo extends nw{constructor(e,n){super(e,n,new $y,!1)}get parent(){const e=uC(this._path);return e===null?null:new fo(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class Qd{constructor(e,n,r){this._node=e,this.ref=n,this._index=r}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const n=new fn(e),r=W0(this.ref,e);return new Qd(this._node.getChild(n),r,Bn)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(r,a)=>e(new Qd(a,W0(this.ref,r),Bn)))}hasChild(e){const n=new fn(e);return!this._node.getChild(n).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function Ke(t,e){return t=Os(t),t._checkNotDeleted("ref"),e!==void 0?W0(t._root,e):t._root}function W0(t,e){return t=Os(t),It(t._path)===null?uR("child","path",e):qC("child","path",e),new fo(t._repo,Un(t._path,e))}function Ii(t){return VC("remove",t._path),qs(t,null)}function qs(t,e){t=Os(t),VC("set",t._path),aR("set",e,t._path);const n=new ef;return _R(t._repo,t._path,e,null,n.wrapCallback(()=>{})),n.promise}function ms(t,e){cR("update",e,t._path);const n=new ef;return bR(t._repo,t._path,e,n.wrapCallback(()=>{})),n.promise}function or(t){t=Os(t);const e=new JC(()=>{}),n=new rg(e);return xR(t._repo,t,n).then(r=>new Qd(r,new fo(t._repo,t._path),t._queryParams.getIndex()))}class rg{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,n){const r=n._queryParams.getIndex();return new PR("value",this,new Qd(e.snapshotNode,new fo(n._repo,n._path),r))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,n){return this.callbackContext.hasCancelCallback?new AR(this,e,n):null}matches(e){return e instanceof rg?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}function RR(t,e,n,r,a){let u;if(typeof r=="object"&&(u=void 0,a=r),typeof r=="function"&&(u=r),a&&a.onlyOnce){const y=n,x=(k,T)=>{B1(t._repo,t,m),y(k,T)};x.userCallback=n.userCallback,x.context=n.context,n=x}const h=new JC(n,u||void 0),m=new rg(h);return kR(t._repo,t,m),()=>B1(t._repo,t,m)}function Rc(t,e,n,r){return RR(t,"value",e,n,r)}RA(fo);DA(fo);const $R="FIREBASE_DATABASE_EMULATOR_HOST",q0={};let MR=!1;function OR(t,e,n,r){const a=e.lastIndexOf(":"),u=e.substring(0,a),h=Dc(u);t.repoInfo_=new tC(e,h,t.repoInfo_.namespace,t.repoInfo_.webSocketOnly,t.repoInfo_.nodeAdmin,t.repoInfo_.persistenceKey,t.repoInfo_.includeNamespaceInQueryParams,!0,n),r&&(t.authTokenProvider_=r)}function LR(t,e,n,r,a){let u=r||t.options.databaseURL;u===void 0&&(t.options.projectId||co("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),$s("Using default host for project ",t.options.projectId),u=`${t.options.projectId}-default-rtdb.firebaseio.com`);let h=z1(u,a),m=h.repoInfo,y;typeof process<"u"&&c1&&(y=c1[$R]),y?(u=`http://${y}?ns=${m.namespace}`,h=z1(u,a),m=h.repoInfo):h.repoInfo.secure;const x=new Qj(t.name,t.options,e);dR("Invalid Firebase Database URL",h),Ot(h.path)||co("Database URL must point to the root of a Firebase Database (not including a child path).");const k=FR(m,t,x,new Gj(t,n));return new UR(k,t)}function DR(t,e){const n=q0[e];(!n||n[t.key]!==t)&&co(`Database ${e}(${t.repoInfo_}) has already been deleted.`),SR(t),delete n[t.key]}function FR(t,e,n,r){let a=q0[e.name];a||(a={},q0[e.name]=a);let u=a[t.toURLString()];return u&&co("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),u=new gR(t,MR,n,r),a[t.toURLString()]=u,u}class UR{constructor(e,n){this._repoInternal=e,this.app=n,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(vR(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new fo(this._repo,Gt())),this._rootInternal}_delete(){return this._rootInternal!==null&&(DR(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&co("Cannot call "+e+" on a deleted database.")}}function BR(t=sb(),e){const n=hy(t,"database").getImmediate({identifier:e});if(!n._instanceStarted){const r=FE("database");r&&zR(n,...r)}return n}function zR(t,e,n,r={}){t=Os(t),t._checkNotDeleted("useEmulator");const a=`${e}:${n}`,u=t._repoInternal;if(t._instanceStarted){if(a===t._repoInternal.repoInfo_.host&&ol(r,u.repoInfo_.emulatorOptions))return;co("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let h;if(u.repoInfo_.nodeAdmin)r.mockUserToken&&co('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),h=new em(em.OWNER);else if(r.mockUserToken){const m=typeof r.mockUserToken=="string"?r.mockUserToken:UE(r.mockUserToken,t.app.options.projectId);h=new em(m)}Dc(e)&&(Y_(e),X_("Database",!0)),OR(u,a,r,h)}function WR(t){Aj(Uc),Nc(new al("database",(e,{instanceIdentifier:n})=>{const r=e.getProvider("app").getImmediate(),a=e.getProvider("auth-internal"),u=e.getProvider("app-check-internal");return LR(r,a,u,n)},"PUBLIC").setMultipleInstances(!0)),ra(u1,d1,t),ra(u1,d1,"esm2020")}ro.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)};ro.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};WR();const qR={apiKey:"AIzaSyApZcKZtqIkR1lMF4Ynavf0AJJb-rjNYBg",authDomain:"flowbuddy-vi7rt.firebaseapp.com",databaseURL:"https://flowbuddy-vi7rt-default-rtdb.firebaseio.com",projectId:"flowbuddy-vi7rt",storageBucket:"flowbuddy-vi7rt.firebasestorage.app",messagingSenderId:"885170360423",appId:"1:885170360423:web:e94217a42c9c6eaac184c2"},ZC=nb(qR),mc=Tj(ZC),Ge=BR(ZC);function ir(t=12){const e="abcdefghijklmnopqrstuvwxyz0123456789";let n="";return crypto.getRandomValues(new Uint8Array(t)).forEach(r=>{n+=e[r%e.length]}),n}const $m={brown:{light:"#f4e3c7",dark:"#a27355"},blue:{light:"#e2ecf7",dark:"#5b6f8c"},green:{light:"#e5f2e0",dark:"#6a8b6a"}},ek="brown";function ai(t){const e=t&&$m[t]?t:ek;return{key:e,colors:$m[e]}}const VR="/assets/White%20Pawn-CsxYRWps.png",HR="/assets/White%20Rook-Bo7aN8jK.png",KR="/assets/White%20Knight-DNZQZ2iP.png",GR="/assets/White%20Bishop-DpinRom7.png",QR="/assets/White%20Queen-BemhFu2x.png",YR="/assets/White%20King-CC7LKORR.png",XR="/assets/Black%20Pawn-BvkQ8cBr.png",JR="/assets/Black%20Rook-B15T88c8.png",ZR="/assets/Black%20Knight-fCWnImSB.png",e4="/assets/Black%20Bishop-CY89vPKV.png",t4="/assets/Black%20Queen-B0QwyR23.png",n4="/assets/Black%20King-BYuYmXG4.png",s4="/assets/Freestyle%20White%20Pawn-DQs2ozLP.png",r4="/assets/Freestyle%20White%20Rook-cFEcTf9D.png",i4="/assets/Freestyle%20White%20Knight-CGp3GcZI.png",o4="/assets/Freestyle%20White%20Bishop-omNqahjR.png",a4="/assets/Freestyle%20White%20Queen-BmEImOqm.png",l4="/assets/Freestyle%20White%20King-DrFFolR7.png",c4="/assets/Freestyle%20Black%20Pawn-CGWGnBiM.png",u4="/assets/Freestyle%20Black%20Rook-0YZE8Pge.png",d4="/assets/Freestyle%20Black%20Knight-YLsk7VZm.png",f4="/assets/Freestyle%20Black%20Bishop-Ds-t94xf.png",h4="/assets/Freestyle%20Black%20Queen-STJDFxnw.png",p4="/assets/Freestyle%20Black%20King-3DRjg-29.png",V0={chesscom:{w:{p:VR,r:HR,n:KR,b:GR,q:QR,k:YR},b:{p:XR,r:JR,n:ZR,b:e4,q:t4,k:n4}},freestyle:{w:{p:s4,r:r4,n:i4,b:o4,q:a4,k:l4},b:{p:c4,r:u4,n:d4,b:f4,q:h4,k:p4}}},tk="chesscom";function Br(t){const e=t&&V0[t]?t:tk;return{key:e,pieces:V0[e]}}const Rr={user:"pawnpoint_user",progress:"pawnpoint_progress",courses:"pawnpoint_courses",subscription:"pawnpoint_subscription",suggestions:"pawnpoint_suggestions",xpHistory:"pawnpoint_xp_history",clubLeaderboard:"pawnpoint_club_leaderboard"},nl="/pieces/wQ.png",sw="courses",nk="xpHistory",Bp=["/pieces/wB.png","/pieces/bQ.png","/pieces/wN.png","/pieces/bK.png"],m4="My Group",g4=120*1e3,W1=[{id:"course-london",title:"The London System",description:"Club-ready white repertoire that keeps pressure and teaches universal plans.",category:"white_opening",difficulty:"beginner",thumbnailUrl:Bp[0],accentColor:"#ec4899",lessons:[{id:"l1",title:"Why Play the London",summary:"Principles and key themes."},{id:"l2",title:"Typical Structures",summary:"Plans in classical pawn chains."},{id:"l3",title:"Model Game Review",summary:"Club-level example with blunders fixed."}]},{id:"course-dragon",title:"The Sicilian Dragon",description:"Dynamic counter-attacking weapon with clear tactical motifs.",category:"black_opening",difficulty:"intermediate",thumbnailUrl:Bp[1],accentColor:"#34d399",lessons:[{id:"l4",title:"Move Order Basics",summary:"How to reach the Dragon safely."},{id:"l5",title:"Yugoslav Plans",summary:"Attacking setups and typical breaks."},{id:"l6",title:"Dragon Tactics Pack",summary:"Tactical drills you must know."}]},{id:"course-skills",title:"Pawn Point Skills Lab",description:"Short drills to sharpen calculation, pattern spotting, and endgame instincts.",category:"skills",difficulty:"beginner",thumbnailUrl:Bp[2],accentColor:"#a855f7",lessons:[{id:"l7",title:"Tactics Warmup",summary:"Pins, forks, and mates-in-two."},{id:"l8",title:"Endgame Basics",summary:"King activity and pawn races."},{id:"l9",title:"Defense Builder",summary:"Finding resources under pressure."}]},{id:"course-endgame",title:"Endgame Essentials",description:"Build confidence in simplified positions with practical club scenarios.",category:"endgame",difficulty:"beginner",thumbnailUrl:Bp[3],accentColor:"#06b6d4",lessons:[{id:"l10",title:"Opposition and Shouldering",summary:"King activity fundamentals."},{id:"l11",title:"Rook Endgame Traps",summary:"Practical drawing tricks."},{id:"l12",title:"Converting Small Edges",summary:"Technique at +1."}]}];function Mm(t){const e=(t||"").replace(/[^0-9]/g,"");return e?e.slice(-4).padStart(4,"0"):""}function ig(t){return(t||"").toLowerCase().replace(/[^a-z0-9_]/g,"")||"rapid"}function q1(t){return(t||"").trim().toLowerCase()}function sk(t){const e=Mm(t);return e?`#${e}`:""}function Vr(t){const e=t||an();return e?.groupId?{scope:"group",cacheKey:`group-${e.groupId}`,groupId:e.groupId,userId:e.id}:e?.id?{scope:"personal",cacheKey:`user-${e.id}`,userId:e.id}:{scope:"public",cacheKey:"public"}}function ml(t,e){const n=Vr(e),r=n.scope==="group"?`groups/${n.groupId}/`:n.scope==="personal"?`users/${n.userId}/`:"";return{...n,path:`${r}${t}`}}function og(t,e){return`${t}:${e.cacheKey}`}function an(){const t=localStorage.getItem(Rr.user);if(!t)return null;try{const e=JSON.parse(t);return e.isAdmin===void 0&&(e.isAdmin=!1,Yn(e)),e.createdAt===void 0&&(e.createdAt=Date.now(),Yn(e)),e.pawns===void 0&&(e.pawns=0,Yn(e)),e.accountType===void 0&&(e.accountType=e.groupId?"group":void 0,Yn(e)),e.groupId=e.groupId??null,e.groupCode=e.groupCode??null,e.groupName=e.groupName??null,e.groupRole=e.groupRole??null,e.unlockedPfps=e.unlockedPfps||[],e.unlockedTaglines=e.unlockedTaglines||[],e.unlockedVideos=e.unlockedVideos||[],e.unlockedSets=e.unlockedSets||[],e.taglinesEnabled=e.taglinesEnabled??!0,e.selectedTagline=e.selectedTagline??"",e.onlineRating=typeof e.onlineRating=="number"?e.onlineRating:1e3,e.boardTheme=ai(e.boardTheme).key,e.pieceTheme=Br(e.pieceTheme).key,Yn(e),e.xpReachedAt===void 0&&(e.xpReachedAt=e.createdAt??Date.now(),Yn(e)),e}catch{return null}}function Yn(t){localStorage.setItem(Rr.user,JSON.stringify(t))}function v4(){try{const t=localStorage.getItem(Rr.suggestions);if(!t)return null;const e=JSON.parse(t);return Array.isArray(e?.courseIds)?{courseIds:e.courseIds,source:e.source}:null}catch{return null}}function y4(t,e){localStorage.setItem(Rr.suggestions,JSON.stringify({courseIds:t.slice(0,5),source:e||"manual"}))}function ag(t){return{id:t.id||ir(),name:(t.name||"").trim()||"Player",rating:Math.max(0,Math.round(t.rating||0)),performance:t.performance!==void 0?Math.round(t.performance):void 0,addedBy:t.addedBy,createdAt:t.createdAt||Date.now()}}function lg(t){const e=t||Vr();try{const n=localStorage.getItem(og(Rr.clubLeaderboard,e));if(!n)return[];const r=JSON.parse(n);return Array.isArray(r)?r.map(a=>ag(a||{})):[]}catch{return[]}}function cg(t,e){const n=e||Vr();try{localStorage.setItem(og(Rr.clubLeaderboard,n),JSON.stringify(t))}catch{}}function rw(t){if(!t)return nl;const e=t.trim();return e&&(e.startsWith("/")||e.startsWith("data:"))?e:nl}function H0(t){const e={...t};if(typeof e.index!="number"&&delete e.index,"fen"in e){const n=typeof e.fen=="string"?e.fen.trim():"";n?e.fen=n:delete e.fen}if("trainerNote"in e){const n=typeof e.trainerNote=="string"?e.trainerNote.trim():"";n?e.trainerNote=n:delete e.trainerNote}return Object.keys(e).forEach(n=>{e[n]===void 0&&delete e[n]}),e}function iw(t,e){const n=new Set,r=[],a=(h,m)=>{const y=typeof t[h]?.index=="number"?t[h].index:Number.MAX_SAFE_INTEGER,x=typeof t[m]?.index=="number"?t[m].index:Number.MAX_SAFE_INTEGER;return y!==x?y-x:h.localeCompare(m)},u=h=>{h.forEach(m=>{t[m]&&!n.has(m)&&(r.push(m),n.add(m))})};return e?.length&&u(e),u(Object.keys(t).sort(a)),r.reduce((h,m,y)=>(h[m]={...t[m],index:y},h),{})}function to(t){const e={};return Object.entries(t||{}).forEach(([n,r])=>{if(!r)return;const a={};Object.entries(r.chapters||{}).forEach(([u,h])=>{if(!h)return;const m={};Object.entries(h.subsections||{}).forEach(([y,x])=>{x&&(m[y]=H0(x))}),a[u]={...h,subsections:iw(m)}}),e[n]={...r,thumbnailUrl:rw(r.thumbnailUrl),chapters:a}}),e}function no(t){return Array.isArray(t)?t.map(e=>no(e)):t&&typeof t=="object"?Object.entries(t).reduce((n,[r,a])=>(a===void 0||(n[r]=no(a)),n),{}):t}function ow(t){const e={};return Object.entries(t||{}).forEach(([n,r])=>{r!==void 0&&(e[n]=r)}),e}function tm(t){return t.reduce((e,n)=>(e[n.id]=n,e),{})}function w4(t){return Object.values(t||{})}function rk(t){const e=t||Vr(),n=localStorage.getItem(og(Rr.courses,e));if(!n)return{};try{const r=JSON.parse(n);return Array.isArray(r)?to(tm(r.filter(Boolean))):to(r||{})}catch{return{}}}function Om(t,e){const n=e||Vr();try{const r=to(t),a=no(r);localStorage.setItem(og(Rr.courses,n),JSON.stringify(a))}catch{}}async function Vs(t){const e=Vr(t),{path:n}=ml(sw,t);try{const r=await or(Ke(Ge,n));if(r.exists()){const a=r.val(),u=Array.isArray(a)?tm(a.filter(Boolean)):a||{};return no(to(u))}if(e.scope==="public"){const a=no(to(tm(W1)));return await qs(Ke(Ge,n),a),Om(a,e),a}return{}}catch(r){const a=no(to(rk(e)));if(Object.keys(a).length)return a;if(e.scope==="public"){console.warn("Failed to fetch courses from Firebase, using samples.",r);const u=no(to(tm(W1)));return Om(u,e),u}return console.warn("Failed to fetch courses for scoped user/group; returning empty.",r),{}}}async function ho(t,e){const n=Vr(e),{path:r}=ml(sw,e),a=to(t),u=no(a);try{await qs(Ke(Ge,r),u),Om(u,n)}catch(h){throw Om(u,n),console.error("Failed to write courses to Firebase; saved locally instead.",h),new Error("Cloud save failed. Check network/Firebase rules.")}}function x4(t,e,n){const r=Vr(n),{path:a}=ml(`${sw}/${t}`,n),u=Ke(Ge,a),h=Rc(u,m=>{const y=m.val(),x=y&&y.id?no(to({[y.id]:y})[y.id]):y?{...y,thumbnailUrl:nl}:null;e(x||null)},()=>{const m=rk(r);e(m[t]||null)});return()=>h()}function ik(){const t=localStorage.getItem(Rr.progress);if(!t)return{};try{return JSON.parse(t)}catch{return{}}}function _4(t){localStorage.setItem(Rr.progress,JSON.stringify(t))}const b4=7;function C4(t){const e=new Date(t);return e.setHours(0,0,0,0),e.getTime()}function ug(t,e=b4){const n=Date.now()-e*24*60*60*1e3;return(t||[]).filter(r=>(r?.ts||0)>=n&&typeof r.amount=="number")}function ok(t){try{const e=localStorage.getItem(`${Rr.xpHistory}:${t}`);if(!e)return[];const n=JSON.parse(e);return ug(Array.isArray(n)?n:[])}catch{return[]}}function ak(t,e){try{localStorage.setItem(`${Rr.xpHistory}:${t}`,JSON.stringify(ug(e)))}catch{}}async function lk(t,e){const n=e.ts||Date.now(),r={...e,ts:n,amount:Math.max(0,e.amount)},a=ir();try{await qs(Ke(Ge,`${nk}/${t}/${a}`),r)}catch(m){console.warn("Failed to write XP event to Firebase; keeping local only",m)}const u=ok(t),h=ug([...u,{...r,id:a}]);ak(t,h)}async function K0(t,e){const n=Date.now(),r=Math.floor(e/100)+1,a={totalXp:e,level:r,xpReachedAt:n},u=Ke(Ge,`users/${t}`);try{await ms(u,a)}catch(m){console.warn("Failed to update XP in Firebase",m)}const h=an();if(h&&h.id===t){const m={...h,...a};Yn(m)}return a}async function aw(t,e,n){const r=Math.max(0,e);if(!r)return;const a=Ke(Ge,`users/${t}`);try{const m=(((await or(a)).val()||{}).totalXp||0)+r;await K0(t,m)}catch(u){console.warn("Failed to update XP in Firebase, continuing locally",u);const h=an(),m=h&&h.id===t&&h.totalXp||0;await K0(t,m+r)}try{await lk(t,{amount:r,courseId:n?.courseId,subsectionId:n?.subsectionId,type:n?.type,source:n?.source||"general"})}catch(u){console.warn("Failed to log XP event",u)}}async function k4(t){const e=an();if(!e||e.id!==t)return null;const n=Math.floor((e.totalXp||0)/25);if(n<=0)return{pawnsAdded:0,remainingXp:e.totalXp};const r=n*25,a=Math.max(0,(e.totalXp||0)-r),u=(e.pawns||0)+n;await K0(t,a);const h=an(),m=h&&h.id===t?{...h,pawns:u}:{...e,pawns:u};Yn(m);const y=Ke(Ge,`users/${t}`);try{await ms(y,{pawns:u})}catch(x){console.warn("Failed to update pawns/XP in Firebase",x)}try{await lk(t,{amount:0,courseId:void 0,subsectionId:"xp_to_pawn_claim",source:"xp_to_pawns",type:void 0})}catch(x){console.warn("Failed to log XP-to-pawn claim",x)}return{pawnsAdded:n,remainingXp:a}}async function S4(t){const e=()=>ok(t);try{const n=await or(Ke(Ge,`${nk}/${t}`));if(n.exists()){const r=n.val(),a=Object.entries(r||{}).map(([h,m])=>({...m,id:h,ts:m&&m.ts||m&&m.timestamp||0,amount:(m&&m.amount)??0})),u=ug(a);return ak(t,u),u}return e()}catch(n){return console.warn("Failed to fetch XP history, using local cache",n),e()}}function N4(t,e){const n=new Date;n.setHours(0,0,0,0);const r=n.getTime(),a=r-8640*60*1e3,u=Math.min(r,Math.max(a,e?.startFrom??a)),h=[];let m=u;for(;m<=r;){const k=new Date(m).toLocaleDateString("en-US",{weekday:"short"});h.push({key:m,label:k,total:0}),m+=1440*60*1e3}if(!h.length){const x=n.toLocaleDateString("en-US",{weekday:"short"});h.push({key:r,label:x,total:0})}const y=new Map(h.map((x,k)=>[x.key,k]));return(t||[]).forEach(x=>{if(!x?.ts)return;const k=C4(new Date(x.ts)),T=y.get(k);T!==void 0&&(h[T].total+=Math.max(0,x.amount))}),h.map(x=>({day:x.label,label:x.label,total:Math.round(x.total)}))}function E4(t){const e={};(t||[]).forEach(r=>{if(!r?.amount)return;const a=r.type,u=(r.source||"").toLowerCase();let h="Other";a==="quiz"||u.includes("quiz")?h="Quizzes":a==="video"||u.includes("video")?h="Videos":u.includes("game")||u.includes("practice")||u.includes("match")?h="Games":(u.includes("course")||a==="study")&&(h="Courses"),e[h]=(e[h]||0)+r.amount});const n={Quizzes:"#60a5fa",Videos:"#a855f7",Games:"#f59e0b",Courses:"#22d3ee",Other:"#94a3b8"};return Object.entries(e).map(([r,a])=>({label:r,value:Math.round(a),color:n[r]||"#94a3b8"}))}async function dg(t){try{const e=await or(Ke(Ge,`progress/${t}`));return e.exists()?e.val():{}}catch{const e=ik(),n={};return Object.entries(e).forEach(([r,a])=>{const[u]=r.split(":").slice(-1);n[u]={completedSubsections:a.completedLessonIds.reduce((h,m)=>({...h,[m]:!0}),{}),percent:a.progressPercent}}),n}}async function ck(t,e){try{await qs(Ke(Ge,`progress/${t}`),e)}catch(n){console.error("Failed to write progress to Firebase",n)}}function lw(t){return t?.chapters?Object.values(t.chapters).reduce((e,n)=>e+Object.keys(n.subsections||{}).length,0):0}function T4(t){return t==="video"?100:t==="study"?150:200}async function zp(t,e,n){const r=an(),a=r&&r.email===t?{...r,accountType:r.accountType??(r.groupId?"group":void 0),groupId:r.groupId??null,groupCode:r.groupCode??null,groupName:r.groupName??null,groupRole:r.groupRole??(r.groupId?"member":null),isAdmin:r.isAdmin??!1,chessUsername:r.chessUsername||r.displayName||r.email.split("@")[0],createdAt:r.createdAt??Date.now(),xpReachedAt:r.xpReachedAt??r.createdAt??Date.now(),unlockedPfps:r.unlockedPfps||[],unlockedTaglines:r.unlockedTaglines||[],unlockedVideos:r.unlockedVideos||[],unlockedSets:r.unlockedSets||[],selectedTagline:r.selectedTagline??"",taglinesEnabled:r.taglinesEnabled??!0,onlineRating:typeof r.onlineRating=="number"?r.onlineRating:1e3,boardTheme:ai(r.boardTheme).key,pieceTheme:Br(r.pieceTheme).key}:{id:n||ir(),email:t,displayName:e||t.split("@")[0],chessUsername:e||t.split("@")[0],avatarUrl:void 0,subscriptionPlan:"free",subscriptionActive:!1,totalXp:120,level:2,streak:1,pawns:0,onlineRating:1e3,isAdmin:!1,createdAt:Date.now(),xpReachedAt:Date.now(),accountType:void 0,groupId:null,groupCode:null,groupName:null,groupRole:null,unlockedPfps:[],unlockedTaglines:[],unlockedVideos:[],unlockedSets:[],selectedTagline:"",taglinesEnabled:!0,boardTheme:ek,pieceTheme:tk},u=Ke(Ge,`users/${a.id}`);try{const m=(await or(u)).val(),y=m?.accountType??a.accountType??(m?.groupId||a.groupId?"group":void 0),x={...a,...m||{},email:a.email,displayName:a.displayName||m?.displayName||a.email.split("@")[0],chessUsername:a.chessUsername||m?.chessUsername||a.displayName||a.email.split("@")[0],createdAt:m?.createdAt??a.createdAt,xpReachedAt:m?.xpReachedAt??a.xpReachedAt??a.createdAt??Date.now(),pawns:m?.pawns??a.pawns??0,onlineRating:m?.onlineRating??a.onlineRating??1e3,totalXp:m?.totalXp??a.totalXp,level:m?.level??a.level,subscriptionActive:m?.subscriptionActive??a.subscriptionActive,subscriptionPlan:m?.subscriptionPlan??a.subscriptionPlan,accountType:y,groupId:m?.groupId??a.groupId??null,groupCode:m?.groupCode??a.groupCode??null,groupName:m?.groupName??a.groupName??null,groupRole:m?.groupRole??a.groupRole??(m?.groupId||a.groupId?"member":null),unlockedPfps:m?.unlockedPfps||a.unlockedPfps||[],unlockedTaglines:m?.unlockedTaglines||a.unlockedTaglines||[],unlockedVideos:m?.unlockedVideos||a.unlockedVideos||[],unlockedSets:m?.unlockedSets||a.unlockedSets||[],selectedTagline:m?.selectedTagline??a.selectedTagline??"",taglinesEnabled:m?.taglinesEnabled??a.taglinesEnabled??!0,boardTheme:ai(m?.boardTheme||a.boardTheme).key,pieceTheme:Br(m?.pieceTheme||a.pieceTheme).key};Yn(x);const k=ow(x);return await ms(u,k),x}catch(h){return console.warn("Failed to sync profile with Firebase, using local only",h),Yn(a),a}}async function V1(t){const e=an();if(!e)return null;const n={...e,isAdmin:t};return Yn(n),n}async function uk(t,e,n){const r=ir(),a=Math.random()<.5?"w":"b",u=a==="w"?"b":"w",h={id:r,timeControl:n,status:"pending",createdAt:Date.now(),players:{[t.id]:{...t,color:a},[e.id]:{...e,color:u}}};return await qs(Ke(Ge,`matches/${r}`),h),await qs(Ke(Ge,`userMatches/${t.id}`),{matchId:r,timeControl:n}),await qs(Ke(Ge,`userMatches/${e.id}`),{matchId:r,timeControl:n}),h}async function I4(t,e){if(!e)throw new Error("Sign in to find a match.");const n=ig(t),r=Ke(Ge,`matchmaking/${n}`),a=Date.now(),u=await or(r),h=u.exists()?u.val():{},m=Object.entries(h||{}).filter(([x,k])=>x!==e.id&&a-(k?.createdAt||0)<g4);if(m.length){const[x,k]=m[0];await Ii(Ke(Ge,`matchmaking/${n}/${x}`)).catch(()=>{});const T={id:e.id,name:e.chessUsername||e.displayName||e.email.split("@")[0],rating:e.onlineRating||1e3,color:"w",chessUsername:e.chessUsername},S={id:x,name:k?.name||k?.displayName||"Player",rating:k?.rating||1e3,color:"b",chessUsername:k?.chessUsername},R=await uk(T,S,n);await Ii(Ke(Ge,`matchmaking/${n}/${e.id}`)).catch(()=>{});const O=R.players[e.id]?.color||"w",D=R.players[x];return{status:"matched",matchId:R.id,opponent:D,color:O,timeControl:n}}const y={id:e.id,name:e.chessUsername||e.displayName||e.email.split("@")[0],rating:e.onlineRating||1e3,chessUsername:e.chessUsername,createdAt:a};return await qs(Ke(Ge,`matchmaking/${n}/${e.id}`),y),{status:"queued"}}function j4(t,e){const n=Ke(Ge,`userMatches/${t}`),r=Rc(n,a=>{const u=a.val();e(u?.matchId||null)},()=>e(null));return()=>r()}async function P4(t,e){const n=ig(t);await Ii(Ke(Ge,`matchmaking/${n}/${e}`)).catch(()=>{})}async function H1(t){try{const e=await or(Ke(Ge,`matches/${t}`));return e.exists()?e.val():null}catch{return null}}async function A4(t,e){Ke(Ge,`matches/${t}/moves`);const n=ir(),r={...e,id:n,ts:e.ts||Date.now()};await qs(Ke(Ge,`matches/${t}/moves/${n}`),r)}function R4(t,e){const n=Ke(Ge,`matches/${t}/moves`),r=Rc(n,a=>{const u=a.val()||{},h=Object.values(u||{}).sort((m,y)=>(m.ts||0)-(y.ts||0));e(h)},()=>e([]));return()=>r()}async function $4(t,e,n){if(!e)throw new Error("Sign in to send a challenge.");const r=q1(t);if(!r)throw new Error("Enter a chess.com username.");const a=await or(Ke(Ge,"users")),u=a.exists()?a.val():{},h=Object.entries(u||{}).find(([,T])=>q1(T?.chessUsername||T?.displayName)===r);if(!h)throw new Error("Could not find a player with that chess.com username.");const[m,y]=h,x=ir(),k={id:x,fromId:e.id,fromName:e.chessUsername||e.displayName||e.email.split("@")[0],fromChessUsername:e.chessUsername,fromRating:e.onlineRating,timeControl:ig(n),createdAt:Date.now()};await qs(Ke(Ge,`challenges/${m}/${x}`),k)}function dk(t,e){const n=Ke(Ge,`challenges/${t}`),r=Rc(n,a=>{const u=a.val()||{},h=Object.values(u||{}).sort((m,y)=>(y.createdAt||0)-(m.createdAt||0))[0];e(h||null)},()=>e(null));return()=>r()}async function Lm(t,e,n){const r=`challenges/${t}/${e}`;{await Ii(Ke(Ge,r)).catch(()=>{});return}}async function fk(t,e){if(!e)return null;const r=(await or(Ke(Ge,`users/${t.fromId}`))).val()||{},a={id:t.fromId,name:t.fromName||r.displayName||"Player",rating:t.fromRating||r.onlineRating||1e3,color:"w",chessUsername:t.fromChessUsername||r.chessUsername},u={id:e.id,name:e.chessUsername||e.displayName||e.email.split("@")[0],rating:e.onlineRating||1e3,color:"b",chessUsername:e.chessUsername},h=await uk(a,u,ig(t.timeControl));return await Ii(Ke(Ge,`challenges/${e.id}/${t.id}`)).catch(()=>{}),h}async function M4(t){const e=an();if(!e)return null;const n={...e,chessUsername:t,displayName:e.displayName||t};Yn(n);try{await ms(Ke(Ge,`users/${e.id}`),{chessUsername:t})}catch(r){console.warn("Failed to sync chess username to Firebase",r)}return n}async function O4(t,e){const n=an();if(!n||n.id!==t)return null;const r=Math.max(0,Math.round(e)),a=gk({...n,onlineRating:r});Yn(a);try{await ms(Ke(Ge,`users/${t}`),{onlineRating:r})}catch(u){console.warn("Failed to sync online rating",u)}return a}async function L4(t,e){const n=an();if(!n)return null;const r=ai(t).key,a=Br(e||n.pieceTheme).key,u={...n,boardTheme:r,pieceTheme:a};Yn(u);try{await ms(Ke(Ge,`users/${n.id}`),{boardTheme:r,pieceTheme:a})}catch(h){console.warn("Failed to sync board theme",h)}return u}async function D4(){localStorage.removeItem(Rr.user)}async function F4(){for(let t=0;t<25;t++){const e=Math.floor(Math.random()*1e4).toString().padStart(4,"0"),n=Ke(Ge,`groupCodes/${e}`);if(!(await or(n)).exists())return{code:sk(e),digits:e}}throw new Error("Could not generate a unique group code. Please try again.")}async function cw(t){try{const e=await or(Ke(Ge,`groups/${t}`));return e.exists()?e.val():null}catch{return null}}async function U4(){const t=an();if(!t)return null;const e=t.groupRole==="admin"?!1:t.isAdmin,n={...t,accountType:"personal",groupId:null,groupCode:null,groupName:null,groupRole:null,isAdmin:e};Yn(n);try{await ms(Ke(Ge,`users/${t.id}`),{accountType:"personal",groupId:null,groupCode:null,groupName:null,groupRole:null,isAdmin:n.isAdmin})}catch(r){console.warn("Failed to persist personal account choice",r)}return await Vs(n).catch(()=>{}),n}async function hk(t){const e=an();if(!e)return null;const n=(t||"").trim()||`${e.displayName||"My"} Group`,{code:r,digits:a}=await F4(),u=ir(),h={id:u,name:n,code:r,createdBy:e.id,createdAt:Date.now()},m={id:e.id,displayName:e.displayName,email:e.email,role:"admin",joinedAt:Date.now()};try{await qs(Ke(Ge,`groups/${u}`),{...h,members:{[e.id]:m}}),await qs(Ke(Ge,`groupCodes/${a}`),u)}catch(x){console.warn("Failed to create group in Firebase",x)}const y={...e,accountType:"group",groupId:u,groupCode:h.code,groupName:h.name,groupRole:"admin",isAdmin:!0};Yn(y);try{await ms(Ke(Ge,`users/${e.id}`),{accountType:"group",groupId:u,groupCode:h.code,groupName:h.name,groupRole:"admin",isAdmin:!0})}catch(x){console.warn("Failed to sync group details to user profile",x)}return await Vs(y).catch(()=>{}),{group:h,profile:y}}async function pk(t){const e=an();if(!e)return null;const n=Mm(t);if(n.length!==4)throw new Error("Enter a valid 4-digit code.");const r=Ke(Ge,`groupCodes/${n}`),a=await or(r);if(!a.exists())throw new Error("No group found for that code.");const u=a.val(),h=await cw(u);if(!h)throw new Error("That group no longer exists.");const m={id:u,name:h.name||m4,code:h.code||sk(n),createdBy:h.createdBy,createdAt:h.createdAt||Date.now()},y={id:e.id,displayName:e.displayName,email:e.email,role:"member",joinedAt:Date.now()};try{await ms(Ke(Ge,`groups/${u}/members/${e.id}`),y)}catch(k){console.warn("Failed to record membership in Firebase",k)}const x={...e,accountType:"group",groupId:u,groupCode:m.code,groupName:m.name,groupRole:"member"};Yn(x);try{await ms(Ke(Ge,`users/${e.id}`),{accountType:"group",groupId:u,groupCode:m.code,groupName:m.name,groupRole:"member"})}catch(k){console.warn("Failed to sync group join to user profile",k)}return await Vs(x).catch(()=>{}),{group:m,profile:x}}async function B4(){const t=an();if(!t?.groupId)return t;try{await Ii(Ke(Ge,`groups/${t.groupId}/members/${t.id}`))}catch(r){console.warn("Failed to remove membership from Firebase",r)}const e=t.groupRole==="admin"?!1:t.isAdmin,n={...t,accountType:"personal",groupId:null,groupCode:null,groupName:null,groupRole:null,isAdmin:e};Yn(n);try{await ms(Ke(Ge,`users/${t.id}`),{accountType:"personal",groupId:null,groupCode:null,groupName:null,groupRole:null,isAdmin:n.isAdmin})}catch(r){console.warn("Failed to sync group exit",r)}return await Vs(n).catch(()=>{}),n}async function Yd(t){const e=t||an()?.groupId;if(!e)return[];try{const n=await or(Ke(Ge,`groups/${e}/members`));if(!n.exists())return[];const r=n.val();return Object.values(r||{}).map(a=>({...a,role:a.role==="admin"?"admin":"member"}))}catch(n){return console.warn("Failed to load group members",n),[]}}async function z4(t,e){if(!t?.groupId||t.groupRole!=="admin")throw new Error("Only group admins can rename the group.");const n=e.trim();if(!n)throw new Error("Enter a group name.");const r=Ke(Ge,`groups/${t.groupId}`);try{await ms(r,{name:n})}catch(m){console.warn("Failed to rename group in Firebase",m)}const a=await Yd(t.groupId);await Promise.all(a.map(async m=>{try{await ms(Ke(Ge,`users/${m.id}`),{groupName:n})}catch(y){console.warn("Failed to sync member name update",y)}}));const u={...t,groupName:n};t.id===an()?.id&&Yn(u);const h=await cw(t.groupId);return{id:t.groupId,name:n,code:h?.code||t.groupCode||"",createdBy:h?.createdBy||t.id,createdAt:h?.createdAt||Date.now()}}async function W4(t,e){if(!t?.groupId||t.groupRole!=="admin")throw new Error("Only admins can manage members.");if(e===t.id)return Yd(t.groupId);try{await Ii(Ke(Ge,`groups/${t.groupId}/members/${e}`))}catch(n){console.warn("Failed to remove member from group",n)}try{await ms(Ke(Ge,`users/${e}`),{accountType:"personal",groupId:null,groupCode:null,groupName:null,groupRole:null,isAdmin:!1})}catch(n){console.warn("Failed to reset member profile after removal",n)}return Yd(t.groupId)}async function q4(t){if(!t?.groupId||t.groupRole!=="admin")throw new Error("Only group admins can delete the group.");let e=[],n=Mm(t.groupCode||"");const r=await cw(t.groupId);r&&(e=Object.values(r.members||{}).map(h=>({...h,role:h.role==="admin"?"admin":"member"})),n=n||Mm(r.code||""));try{await Ii(Ke(Ge,`groups/${t.groupId}`))}catch(h){console.warn("Failed to delete group from Firebase",h)}if(n)try{await Ii(Ke(Ge,`groupCodes/${n}`))}catch(h){console.warn("Failed to clear group code mapping",h)}await Promise.all(e.map(async h=>{try{await ms(Ke(Ge,`users/${h.id}`),{accountType:"personal",groupId:null,groupCode:null,groupName:null,groupRole:null,isAdmin:!1})}catch(m){console.warn("Failed to reset member after deletion",m)}}));const a=t.groupRole==="admin"?!1:t.isAdmin,u={...t,accountType:"personal",groupId:null,groupCode:null,groupName:null,groupRole:null,isAdmin:a};Yn(u);try{await ms(Ke(Ge,`users/${t.id}`),{accountType:"personal",groupId:null,groupCode:null,groupName:null,groupRole:null,isAdmin:u.isAdmin})}catch(h){console.warn("Failed to sync profile after deleting group",h)}return await Vs(u).catch(()=>{}),u}async function Dm(t,e,n){const r=await Vs(n);let a=w4(r);if(e&&e!=="all"&&(a=a.filter(u=>u.category===e)),t){const u=t.toLowerCase();a=a.filter(h=>h.title.toLowerCase().includes(u))}return a}async function hf(t,e){return(await Vs(e))[t]||null}async function V4(t){const e=an(),n=await Vs(e),r={...t,id:t.id||ir(),lessons:t.lessons.map(u=>({...u,id:u.id||ir()}))},a={...r,thumbnailUrl:rw(r.thumbnailUrl)};return n[a.id]=a,await ho(n,e),a}async function H4(t){const e=an(),n=await Vs(e),r={...t,thumbnailUrl:rw(t.thumbnailUrl)};return n[r.id]=r,await ho(n,e),n[t.id]}async function K4(t){const e=an(),n=await Vs(e);delete n[t],await ho(n,e)}async function G4(t,e,n){const r=an(),a=await Vs(r),u=a[t];if(!u)return null;const h=ir(),m={id:h,title:e,index:n,subsections:{}},y=u.chapters||{};return y[h]=m,a[t]={...u,chapters:y},await ho(a,r),m}async function Q4(t,e){const n=an(),r=await Vs(n),a=r[t];a?.chapters&&(delete a.chapters[e],r[t]={...a},await ho(r,n))}async function Y4(t,e,n){const r=an(),a=await Vs(r),u=a[t];if(!u?.chapters?.[e])return null;const h={...u.chapters[e],...n};return u.chapters[e]=h,a[t]={...u},await ho(a,r),h}async function X4(t,e,n){const r=an(),a=await Vs(r),u=a[t];if(!u)return null;const h=u.chapters||{},m=h[e];if(!m)return null;const y=m.subsections||{},x=Object.fromEntries(Object.entries(y).map(([R,O])=>[R,H0(O)])),k=n.id||ir(),T=typeof n.index=="number"?n.index:Object.keys(x).length;x[k]=H0({...n,id:k,index:T});const S=iw(x);return h[e]={...m,subsections:S},a[t]={...u,chapters:h},await ho(a,r),S[k]}async function J4(t,e,n){const r=an(),a=await Vs(r),u=a[t],h=u?.chapters?.[e],m=h?.subsections;if(!u||!h||!m)return null;const y=new Set,x=[];n.forEach(S=>{m[S]&&!y.has(S)&&(x.push([S,m[S]]),y.add(S))}),Object.entries(m).forEach(([S,R])=>{y.has(S)||(x.push([S,R]),y.add(S))});const k=x.reduce((S,[R,O])=>(S[R]=O,S),{}),T=iw(k,n);return u.chapters[e]={...h,subsections:T},a[t]={...u},await ho(a,r),T}async function Z4(t,e,n){const r=an(),a=await Vs(r),u=a[t];u?.chapters?.[e]?.subsections&&(delete u.chapters[e].subsections[n],a[t]={...u},await ho(a,r))}async function e3(t){const e=await dg(t),n={};return await Promise.all(Object.entries(e).map(async([r,a])=>{const u=await hf(r,an()),h=lw(u)||1,m=Object.keys(a.completedSubsections||{});n[r]={courseId:r,completedLessonIds:m,progressPercent:a.percent??Math.round(m.length/h*100),lastLessonId:m[m.length-1]}})),n}async function mk(t,e){const r=(await dg(t))[e],a=await hf(e,an()),u=lw(a)||1;if(!r)return null;const h=Object.keys(r.completedSubsections||{});return{courseId:e,completedLessonIds:h,progressPercent:r.percent??Math.round(h.length/u*100),lastLessonId:h[h.length-1]}}async function t3(t,e){const n=await dg(t);n[e]&&(delete n[e],await ck(t,n));const r=ik();r[e]&&(delete r[e],_4(r))}function gk(t){return{...t,unlockedPfps:t.unlockedPfps||[],unlockedTaglines:t.unlockedTaglines||[],unlockedVideos:t.unlockedVideos||[],unlockedSets:t.unlockedSets||[],selectedTagline:t.selectedTagline??"",taglinesEnabled:t.taglinesEnabled??!0,onlineRating:typeof t.onlineRating=="number"?t.onlineRating:1e3,pieceTheme:Br(t.pieceTheme).key,boardTheme:ai(t.boardTheme).key}}async function n3(t,e){const n=an();if(!n||n.id!==t)return null;const r=gk(n);e.type==="pfp"?r.unlockedPfps.includes(e.value)||r.unlockedPfps.push(e.value):e.type==="tagline"?e.value&&!r.unlockedTaglines.includes(e.value)&&r.unlockedTaglines.push(e.value):e.type==="video"?e.value&&!r.unlockedVideos.includes(e.value)&&r.unlockedVideos.push(e.value):e.type==="piece"&&e.value&&!r.unlockedSets.includes(e.value)&&r.unlockedSets.push(e.value),Yn(r);try{await ms(Ke(Ge,`users/${t}`),{unlockedPfps:r.unlockedPfps,unlockedTaglines:r.unlockedTaglines,unlockedVideos:r.unlockedVideos,unlockedSets:r.unlockedSets})}catch(a){console.warn("Failed to sync unlocked gifts",a)}return r}async function s3(t,e,n){return G0(t,e,n,"study")}async function vk(t){const e=await S4(t.id),n=N4(e,{startFrom:t.createdAt}),r=E4(e),a=await Dm(void 0,void 0,t),u=v4();let h=a.slice(0,3);if(u?.courseIds?.length){const m=u.courseIds.map(y=>a.find(x=>x.id===y)).filter(Boolean);m.length&&(h=m.slice(0,3))}return{profile:t,xpHistory:n,xpDistribution:r,suggested:h}}function r3(t,e){y4(t,e)}async function i3(t){const e=Vr(t),{path:n}=ml("clubLeaderboard",t),r=()=>lg(e);try{const a=await or(Ke(Ge,n));if(a.exists()){const u=a.val(),h=Object.values(u||{}).map(m=>ag(m||{}));return cg(h,e),h}return r()}catch(a){return console.warn("Failed to load club leaderboard from Firebase",a),r()}}async function o3(t,e){if(!t?.isAdmin)throw new Error("Only admins can add participants.");const n=ag({...e,addedBy:t.id}),r=Vr(t),{path:a}=ml("clubLeaderboard",t),u=[...lg(r),n];cg(u,r);try{await qs(Ke(Ge,`${a}/${n.id}`),ow(n))}catch(h){console.warn("Failed to sync club participant to Firebase",h)}return u}async function a3(t,e,n){if(!t?.isAdmin)throw new Error("Only admins can update performance.");const r=Vr(t),{path:a}=ml("clubLeaderboard",t),h=lg(r).map(y=>y.id===e?ag({...y,rating:n.rating!==void 0?n.rating:y.rating,performance:n.performance!==void 0?n.performance:y.performance}):y);cg(h);const m=ow({rating:n.rating!==void 0?Math.max(0,Math.round(n.rating)):void 0,performance:n.performance!==void 0?Math.round(n.performance):void 0});try{await ms(Ke(Ge,`${a}/${e}`),m)}catch(y){console.warn("Failed to update club performance",y)}return h}async function l3(t,e){if(!t?.isAdmin)throw new Error("Only admins can remove participants.");const n=Vr(t),{path:r}=ml("clubLeaderboard",t),a=lg(n).filter(u=>u.id!==e);cg(a,n);try{await Ii(Ke(Ge,`${r}/${e}`))}catch(u){console.warn("Failed to remove club participant from Firebase",u)}return a}async function G0(t,e,n,r){const a=await dg(t),u=await hf(e,an()),h=lw(u)||1,m=a[e]||{completedSubsections:{},percent:0},y=!!m.completedSubsections[n];m.completedSubsections[n]=!0;const x=Object.keys(m.completedSubsections).length;if(m.percent=Math.min(100,Math.round(x/h*100)),m.lastUpdated=Date.now(),a[e]=m,await ck(t,a),!y){const k=T4(r);await aw(t,k,{source:"course_progress",courseId:e,subsectionId:n,type:r})}return{courseId:e,completedLessonIds:Object.keys(m.completedSubsections),progressPercent:m.percent,lastLessonId:n}}const yk=j.createContext(void 0),c3={user:null,loading:!1,login:async()=>{},loginWithGoogle:async()=>{},logout:async()=>{},setUser:()=>{}};function u3({children:t}){const[e,n]=j.useState(null),[r,a]=j.useState(!0),u=new Xi,h=new Date().toDateString();j.useEffect(()=>{mI(mc,jb).catch(T=>{console.warn("Failed to set auth persistence",T)})},[]);const m=T=>{if(!T||localStorage.getItem("pawnpoint_last_login_day")===h)return T;const R={...T,streak:(T.streak||0)+1};return localStorage.setItem("pawnpoint_last_login_day",h),localStorage.setItem("pawnpoint_user",JSON.stringify(R)),R};j.useEffect(()=>{const T=yI(mc,async S=>{if(S?.email){const R=await zp(S.email,S.displayName||S.email.split("@")[0],S.uid),O=m(R);n(O)}else n(null);a(!1)});return()=>T()},[h]);const y=async(T,S,R,O="login")=>{a(!0);try{if(O==="signup"){const D=await dI(mc,T,S);R&&await pI(D.user,{displayName:R});const q=await zp(D.user.email||T,R||D.user.displayName||T.split("@")[0],D.user.uid),he=m(q);n(he)}else{const D=await fI(mc,T,S),q=await zp(D.user.email||T,D.user.displayName||R||T.split("@")[0],D.user.uid),he=m(q);n(he)}}finally{a(!1)}},x=async()=>{a(!0);try{const T=await DI(mc,u,Ub),S=T.user.email||"",R=await zp(S,T.user.displayName||S.split("@")[0],T.user.uid),O=m(R);n(O)}finally{a(!1)}},k=async()=>{await wI(mc),await D4(),n(null)};return d.jsx(yk.Provider,{value:{user:e,loading:r,login:y,loginWithGoogle:x,logout:k,setUser:n},children:t})}function $r(){const t=j.useContext(yk);return t||(console.error("useAuth must be used inside AuthProvider. Falling back to a safe default context."),c3)}const wk="/assets/Login%20screen-3VPFw6PG.png";function K1({mode:t}){const{user:e,login:n,loginWithGoogle:r,loading:a}=$r(),[,u]=ua(),[h,m]=j.useState(""),[y,x]=j.useState(""),[k,T]=j.useState(""),[S,R]=j.useState(""),[O,D]=j.useState(0),q=t==="login",he=Date.now(),ce=O>he,[C,le]=j.useState(0);j.useEffect(()=>{if(!ce){le(0);return}const xe=()=>{const Fe=Math.max(0,Math.ceil((O-Date.now())/1e3));le(Fe)};xe();const je=window.setInterval(xe,1e3);return()=>window.clearInterval(je)},[ce,O]),j.useEffect(()=>{e&&u("/dashboard")},[e,u]);const c=async()=>{if(!h||!q&&!y||!k){R("Please fill in all required fields.");return}if(ce){const xe=Math.max(1,Math.ceil((O-Date.now())/1e3));R(`Too many attempts. Please wait ${xe}s before trying again.`);return}try{R(""),await n(h,k,y||h.split("@")[0],q?"login":"signup"),u("/dashboard")}catch(xe){console.error("Auth error",xe);const je=xe?.code||"";je==="auth/email-already-in-use"?R("That email is already registered. Try logging in instead."):je==="auth/invalid-credential"||je==="auth/wrong-password"?R("Invalid email or password. Please try again."):je==="auth/too-many-requests"?(R("Too many attempts. Please wait a minute and try again."),D(Date.now()+6e4)):R("Sign-in failed. Please check your details and try again.")}},re=async()=>{try{R(""),await r(),u("/dashboard")}catch(xe){console.error("Google auth error",xe);const je=xe?.code||"";je==="auth/popup-closed-by-user"?R("Google popup was closed. Please try again."):je==="auth/too-many-requests"?(R("Too many attempts. Please wait a minute and try again."),D(Date.now()+6e4)):R("Google sign-in failed. Please try again or use email/password.")}};return d.jsxs("div",{className:"min-h-screen relative bg-slate-950 text-white flex items-center justify-center px-4",children:[d.jsx("div",{className:"absolute inset-0 bg-cover bg-center opacity-40",style:{backgroundImage:`url(${wk})`}}),d.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-slate-900/40 via-slate-950/50 to-black/60"}),d.jsxs("div",{className:"relative z-10 w-full max-w-lg rounded-3xl p-8 shadow-2xl border border-white/10 bg-white/5 backdrop-blur-xl",children:[d.jsxs("div",{className:"text-center mb-6 space-y-2",children:[d.jsxs("div",{className:"pill glass inline-flex items-center gap-2 border-white/10",children:[d.jsx("div",{className:"h-2 w-2 rounded-full bg-brand.pink"}),d.jsx("span",{children:"Pawn Point"})]}),d.jsx("h1",{className:"text-3xl font-semibold",children:q?"Log In":"Create Account"}),d.jsx("p",{className:"text-white/70 text-sm",children:"Train, track XP, and climb the club leaderboard."})]}),d.jsxs("div",{className:"space-y-3",children:[d.jsxs(Le,{variant:"outline",className:"w-full justify-center",onClick:re,disabled:a||ce,children:[d.jsx(sE,{className:"h-4 w-4 mr-2"}),a?"Please wait...":"Continue with Google"]}),d.jsxs("div",{className:"flex items-center gap-3 text-xs text-white/60",children:[d.jsx("span",{className:"h-px flex-1 bg-white/10"}),"or",d.jsx("span",{className:"h-px flex-1 bg-white/10"})]}),S&&d.jsxs("div",{className:"rounded-xl border border-amber-400/40 bg-amber-400/10 text-amber-100 px-3 py-2 text-sm",children:[S," ",ce&&C>0?`(wait ${C}s)`:""]}),!q&&d.jsxs("div",{children:[d.jsx("label",{className:"text-sm text-white/80",children:"Display name"}),d.jsx("div",{className:"mt-1 relative",children:d.jsx("input",{className:"w-full rounded-xl bg-white/10 border border-white/10 px-3 py-3 focus:outline-none focus:ring-2 focus:ring-brand.pink",placeholder:"Chess Shark",value:y,onChange:xe=>x(xe.target.value)})})]}),d.jsxs("div",{children:[d.jsx("label",{className:"text-sm text-white/80",children:"Email"}),d.jsxs("div",{className:"mt-1 relative",children:[d.jsx(D_,{className:"absolute left-3 top-3 h-4 w-4 text-white/50"}),d.jsx("input",{type:"email",className:"w-full rounded-xl bg-white/10 border border-white/10 px-10 py-3 focus:outline-none focus:ring-2 focus:ring-brand.pink",placeholder:"you@example.com",value:h,onChange:xe=>m(xe.target.value)})]})]}),d.jsxs("div",{children:[d.jsx("label",{className:"text-sm text-white/80",children:"Password"}),d.jsxs("div",{className:"mt-1 relative",children:[d.jsx(L_,{className:"absolute left-3 top-3 h-4 w-4 text-white/50"}),d.jsx("input",{type:"password",className:"w-full rounded-xl bg-white/10 border border-white/10 px-10 py-3 focus:outline-none focus:ring-2 focus:ring-brand.pink",placeholder:"",value:k,onChange:xe=>T(xe.target.value)})]})]}),d.jsx(Le,{className:"w-full justify-center",onClick:c,disabled:a||ce,children:a?"One moment...":ce?`Please wait${C?` (${C}s)`:"..."}`:q?"Log In":"Create Account"}),d.jsxs("div",{className:"text-sm text-white/70 text-center",children:[q?"New to Pawn Point?":"Already have an account?"," ",d.jsx("button",{className:"text-brand.pink underline",onClick:()=>u(q?"/signup":"/login"),children:q?"Create account":"Log in"})]})]})]})]})}function io({children:t,className:e}){return d.jsx("div",{className:Oc("glass rounded-2xl",e),children:t})}function Cc({children:t,className:e}){return d.jsx("div",{className:Oc("px-5 py-4 border-b border-white/10",e),children:t})}function oo({children:t,className:e}){return d.jsx("div",{className:Oc("px-5 py-4 space-y-3",e),children:t})}function kc({children:t,className:e}){return d.jsx("div",{className:Oc("text-lg font-semibold",e),children:t})}const xk=[{label:"Home",href:"/dashboard",icon:aE},{label:"All Courses",href:"/courses",icon:eE},{label:"Leaderboards",href:"/leaderboard",icon:B_},{label:"Play Online",href:"/play-online",icon:um},{label:"Practice",href:"/practice",icon:bE}],d3=[...xk,{label:"Profile",href:"/profile",icon:ay},{label:"Settings",href:"/settings",icon:U_}];function qr({children:t}){const{user:e,logout:n,setUser:r}=$r(),[,a]=ua(),[u,h]=j.useState(!1),[m,y]=j.useState(!1),[x,k]=j.useState(!1),[T,S]=j.useState(!1),[R,O]=j.useState("Meh"),[D,q]=j.useState(""),[he,ce]=j.useState(""),[C,le]=j.useState(!1),[c,re]=j.useState("choose"),[xe,je]=j.useState(""),[Fe,Ze]=j.useState(""),[st,Re]=j.useState(""),[Ae,ue]=j.useState(!1),[pe,$e]=j.useState(null),[Y,J]=j.useState(""),Se=e?.chessUsername||e?.displayName||e?.email?.split("@")[0]||"Player",de=Se?.split(" ").map(Be=>Be[0]).join("").slice(0,2).toUpperCase()||"PP",$=e?.level??1,ee=e?.totalXp??0,Pe=!!e&&!e.accountType,Ee=[{label:"Angry",emoji:""},{label:"Dislike",emoji:""},{label:"Meh",emoji:""},{label:"Happy",emoji:""},{label:"Excited",emoji:""}],G=x?"bg-slate-50 text-slate-900":"bg-slate-950 text-white",ae=x?"border-slate-200 bg-white/90":"border-white/10 bg-slate-950/80",Ue=x?"text-slate-700":"text-white/80",qe=R==="Meh",et=D.trim().length>0;j.useEffect(()=>{Pe&&(le(!0),re("choose"),Re(""),je(e?.groupName||""),Ze(""))},[Pe,e?.groupName]),j.useEffect(()=>{if(!e?.id)return;const Be=dk(e.id,Pt=>$e(Pt));return()=>Be?.()},[e?.id]);const ot=()=>{S(!1),O("Meh"),q(""),ce("")},bt=async()=>{if(!et)return;const Be=D.trim(),Pt=Be==="TSEC0ADMIN",Wt=Be==="TSEC0STANDARD";if(!qe&&(Pt||Wt)){ce("Admin keys only work when MEH is selected.");return}if(qe&&(Pt||Wt)){if(Pt){const On=await V1(!0);On?(r(On),ce("Admin privileges unlocked. Editing tools are now visible.")):ce("Key rejected. No status change applied.")}else if(Wt){const On=await V1(!1);On?(r(On),ce("Admin privileges removed. You are back to standard access.")):ce("Key rejected. No status change applied.")}q("");return}D.trim()&&ot()},nn=()=>{Pe||(le(!1),Re(""),re("choose"))},hn=async()=>{ue(!0),Re("");try{const Be=await U4();Be&&r(Be),le(!1)}catch(Be){Re(Be?.message||"Could not switch to a personal account.")}finally{ue(!1)}},Dt=async()=>{if(!xe.trim()){Re("Name your group to continue.");return}ue(!0),Re("");try{const Be=await hk(xe.trim());Be?.profile&&(r(Be.profile),le(!1))}catch(Be){Re(Be?.message||"Could not create the group. Try again.")}finally{ue(!1)}},Mn=async()=>{if(!Fe.trim()){Re("Enter the group code shown to you.");return}ue(!0),Re("");try{const Be=await pk(Fe.trim());Be?.profile&&(r(Be.profile),le(!1))}catch(Be){Re(Be?.message||"Could not join that group.")}finally{ue(!1)}};return d.jsxs("div",{className:`min-h-screen ${G}`,children:[d.jsxs("header",{className:`sticky top-0 z-20 border-b ${ae} backdrop-blur`,children:[d.jsxs("div",{className:"max-w-6xl w-full mx-auto px-4 sm:px-6 py-3 sm:py-4 flex items-center justify-between gap-3",children:[d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:"h-10 w-10 rounded-xl bg-white flex items-center justify-center shadow-[0_12px_30px_rgba(0,0,0,0.25)] overflow-hidden",children:d.jsx("img",{src:x0,alt:"Pawn Point logo",className:"h-full w-full object-cover"})}),d.jsx("span",{className:"text-2xl font-extrabold tracking-tight",children:"Pawn Point"})]}),d.jsx("nav",{className:`hidden md:flex items-center gap-6 text-sm ${Ue}`,children:xk.map(({href:Be,label:Pt,icon:Wt})=>d.jsxs(Ix,{href:Be,className:`flex items-center gap-2 hover:text-white ${x?"hover:text-slate-900":""}`,children:[d.jsx(Wt,{className:"h-4 w-4"}),Pt]},Be))}),d.jsxs("div",{className:"hidden md:flex items-center gap-3 relative",children:[d.jsxs("button",{onClick:()=>y(Be=>!Be),className:`relative flex items-center gap-3 rounded-full border px-3 py-2 hover:bg-white/10 transition ${x?"border-slate-200 bg-white text-slate-900":"border-white/10 bg-white/5 text-white"}`,"aria-haspopup":"menu","aria-expanded":m,children:[e?.avatarUrl?d.jsx("div",{className:"h-9 w-9 rounded-full overflow-hidden border border-white/20 shadow-glow",children:d.jsx("img",{src:e.avatarUrl,alt:"Profile avatar",className:"h-full w-full object-cover"})}):d.jsx("div",{className:"h-9 w-9 rounded-full bg-gradient-to-br from-pink-500 to-purple-500 flex items-center justify-center text-sm font-bold text-white shadow-glow",children:de}),d.jsxs("div",{className:"text-left",children:[d.jsxs("div",{className:"text-xs text-white/60",children:["Level ",$]}),d.jsxs("div",{className:"text-sm font-semibold text-white/90",children:[ee," XP"]})]})]}),m&&d.jsxs("div",{className:"absolute right-0 top-14 w-56 rounded-2xl bg-slate-800 shadow-2xl border border-white/10 py-3",children:[d.jsx("div",{className:"px-4 pb-3",children:d.jsxs("div",{className:"flex items-center gap-3",children:[e?.avatarUrl?d.jsx("div",{className:"h-8 w-8 rounded-full overflow-hidden border border-white/20 shadow-glow",children:d.jsx("img",{src:e.avatarUrl,alt:"Profile avatar",className:"h-full w-full object-cover"})}):d.jsx("div",{className:"h-8 w-8 rounded-full bg-slate-700 flex items-center justify-center text-xs font-bold text-white",children:de}),d.jsxs("div",{children:[d.jsx("div",{className:"text-sm font-semibold text-white",children:Se}),d.jsxs("div",{className:"text-xs text-emerald-300 font-semibold",children:["LVL ",$," | ",ee," XP"]}),e?.accountType&&d.jsx("div",{className:"text-[10px] uppercase text-white/50",children:e.accountType==="group"?"Group account":"Personal account"})]})]})}),d.jsxs("div",{className:"px-2 space-y-1 text-sm text-white/80",children:[d.jsxs("button",{className:"w-full flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-white/10 text-left",onClick:()=>{a("/profile"),y(!1)},children:[d.jsx(ay,{className:"h-4 w-4"}),"My Profile"]}),d.jsxs("button",{className:"w-full flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-white/10 text-left",onClick:()=>{a("/settings"),y(!1)},children:[d.jsx(U_,{className:"h-4 w-4"}),"Settings"]}),d.jsxs("button",{className:"w-full flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-white/10 text-left",onClick:()=>{S(!0),O("Meh"),q(""),ce("")},children:[d.jsx(pE,{className:"h-4 w-4"}),"Feedback"]}),d.jsxs("button",{className:"w-full flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-white/10 text-left",onClick:()=>{n(),a("/login")},children:[d.jsx(y0,{className:"h-4 w-4"}),"Sign out"]})]}),d.jsxs("div",{className:"flex items-center justify-between px-4 pt-3 text-xs text-white/60",children:[d.jsx("span",{children:"Theme"}),d.jsx("button",{className:"flex items-center gap-2 rounded-full bg-white/10 px-2 py-1 text-white hover:bg-white/20 transition",onClick:()=>k(Be=>!Be),children:x?d.jsx(cm,{className:"h-4 w-4 text-amber-300"}):d.jsx(lm,{className:"h-4 w-4 text-amber-300"})})]})]})]}),d.jsx("button",{className:"md:hidden text-white/80",onClick:()=>h(Be=>!Be),"aria-label":"Toggle navigation",children:u?d.jsx(nr,{}):d.jsx(hE,{})})]}),u&&d.jsx("div",{className:"md:hidden border-t border-white/10 bg-slate-900/95 backdrop-blur",children:d.jsxs("div",{className:"px-4 py-4 space-y-4",children:[e&&d.jsxs("div",{className:"flex items-center gap-3 rounded-xl border border-white/10 bg-white/5 px-3 py-2",children:[e?.avatarUrl?d.jsx("div",{className:"h-10 w-10 rounded-full overflow-hidden border border-white/15 shadow-glow",children:d.jsx("img",{src:e.avatarUrl,alt:"Profile avatar",className:"h-full w-full object-cover"})}):d.jsx("div",{className:"h-10 w-10 rounded-full bg-gradient-to-br from-pink-500 to-purple-500 flex items-center justify-center text-sm font-bold text-white shadow-glow",children:de}),d.jsxs("div",{children:[d.jsx("div",{className:"text-sm font-semibold",children:Se}),d.jsxs("div",{className:"text-xs text-white/60",children:["LVL ",$,"  ",ee," XP"]})]})]}),d.jsx("div",{className:"grid grid-cols-2 gap-2",children:d3.map(({href:Be,label:Pt,icon:Wt})=>d.jsxs(Ix,{href:Be,className:"flex items-center gap-2 rounded-lg border border-white/10 bg-white/5 px-3 py-2 text-sm text-white/80 hover:bg-white/10 hover:text-white",onClick:()=>h(!1),children:[d.jsx(Wt,{className:"h-4 w-4"}),Pt]},Be))}),d.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[d.jsxs("button",{className:"flex items-center gap-2 rounded-full border border-white/10 bg-white/5 px-3 py-2 text-sm text-white hover:bg-white/10",onClick:()=>k(Be=>!Be),children:[x?d.jsx(cm,{className:"h-4 w-4 text-amber-300"}):d.jsx(lm,{className:"h-4 w-4 text-amber-300"}),d.jsx("span",{children:"Theme"})]}),d.jsxs(Le,{variant:"ghost",onClick:()=>{n(),a("/login")},className:"flex-1 min-w-[140px]",children:[d.jsx(y0,{className:"h-4 w-4 mr-2"}),"Log out"]})]})]})})]}),d.jsx("main",{className:"w-full max-w-6xl xl:max-w-7xl 2xl:max-w-[1500px] mx-auto px-4 sm:px-6 py-6 sm:py-8",children:t}),C&&d.jsx("div",{className:"fixed inset-0 z-40 flex items-center justify-center bg-black/70 px-4",children:d.jsxs("div",{className:"w-full max-w-lg rounded-2xl bg-slate-900 text-white border border-white/10 shadow-2xl p-6 space-y-4",children:[d.jsxs("div",{className:"flex items-start justify-between gap-3",children:[d.jsxs("div",{children:[d.jsx("div",{className:"text-xl font-semibold",children:Pe?"Choose your account type":"Switch account"}),d.jsx("div",{className:"text-sm text-white/70",children:"Pick personal to keep your data private, or join/create a group to share courses and leaderboards only with members."})]}),!Pe&&d.jsx("button",{className:"h-9 w-9 rounded-full bg-white/10 hover:bg-white/20 text-white flex items-center justify-center",onClick:nn,"aria-label":"Close group dialog",children:d.jsx(nr,{className:"h-4 w-4"})})]}),st&&d.jsx("div",{className:"rounded-xl border border-amber-400/40 bg-amber-400/10 text-amber-100 px-3 py-2 text-sm",children:st}),c==="choose"&&d.jsxs("div",{className:"space-y-2",children:[d.jsx(Le,{variant:"outline",className:"w-full !justify-start !items-start text-left px-5",onClick:hn,disabled:Ae,children:d.jsxs("div",{className:"text-left flex flex-col items-start",children:[d.jsx("div",{className:"font-semibold",children:"Personal Account"}),d.jsx("div",{className:"text-xs text-white/80",children:"Only you can see your courses and leaderboard data."})]})}),d.jsx(Le,{variant:"outline",className:"w-full !justify-start !items-start text-left px-5",onClick:()=>{re("join"),Re("")},disabled:Ae,children:d.jsxs("div",{className:"text-left flex flex-col items-start",children:[d.jsx("div",{className:"font-semibold",children:"Join a Group"}),d.jsx("div",{className:"text-xs text-white/80",children:"Use a #1234 code that was shared with you."})]})}),d.jsx(Le,{variant:"outline",className:"w-full !justify-start !items-start text-left px-5",onClick:()=>{re("create"),Re("")},disabled:Ae,children:d.jsxs("div",{className:"text-left flex flex-col items-start",children:[d.jsx("div",{className:"font-semibold",children:"Create a Group"}),d.jsx("div",{className:"text-xs text-white/80",children:"Generate a private code and invite teammates."})]})})]}),c==="join"&&d.jsxs("div",{className:"space-y-3",children:[d.jsxs("div",{className:"flex items-center justify-between text-sm text-white/70",children:[d.jsx("span",{children:"Enter the group code"}),d.jsxs("button",{className:"flex items-center gap-1 text-white/70 hover:text-white text-xs",onClick:()=>re("choose"),children:[d.jsx(v0,{className:"h-3 w-3"}),"Back to options"]})]}),d.jsx("input",{value:Fe,onChange:Be=>Ze(Be.target.value),className:"w-full rounded-xl border border-white/10 bg-white/5 px-3 py-3 text-sm outline-none focus:ring-2 focus:ring-pink-400",placeholder:"#1234"}),d.jsx(Le,{className:"w-full justify-center",onClick:Mn,disabled:Ae,children:Ae?"Joining...":"Join Group"})]}),c==="create"&&d.jsxs("div",{className:"space-y-3",children:[d.jsxs("div",{className:"flex items-center justify-between text-sm text-white/70",children:[d.jsx("span",{children:"Name your group"}),d.jsxs("button",{className:"flex items-center gap-1 text-white/70 hover:text-white text-xs",onClick:()=>re("choose"),children:[d.jsx(v0,{className:"h-3 w-3"}),"Back to options"]})]}),d.jsx("input",{value:xe,onChange:Be=>je(Be.target.value),className:"w-full rounded-xl border border-white/10 bg-white/5 px-3 py-3 text-sm outline-none focus:ring-2 focus:ring-pink-400",placeholder:"Team Knights"}),d.jsx(Le,{className:"w-full justify-center",onClick:Dt,disabled:Ae,children:Ae?"Creating...":"Create Group"})]})]})}),pe&&d.jsx("div",{className:"fixed inset-0 z-40 flex items-center justify-center bg-black/70 px-4",children:d.jsxs("div",{className:"w-full max-w-md rounded-2xl bg-slate-900 text-white border border-white/10 shadow-2xl p-6 space-y-4",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("div",{className:"text-lg font-semibold",children:"Incoming challenge"}),d.jsxs("div",{className:"text-xs text-white/60",children:[pe.fromName," challenged you to ",pe.timeControl?.toUpperCase(),"."]})]}),d.jsx("button",{className:"p-2 rounded-full hover:bg-white/10 text-white/70",onClick:async()=>{e&&(await Lm(e.id,pe.id),$e(null))},children:d.jsx(nr,{className:"h-4 w-4"})})]}),Y&&d.jsx("div",{className:"text-sm text-red-200 bg-red-500/10 border border-red-400/40 rounded-xl px-3 py-2",children:Y}),d.jsxs("div",{className:"flex justify-end gap-2",children:[d.jsx(Le,{variant:"outline",onClick:async()=>{e&&(await Lm(e.id,pe.id),$e(null))},children:"Decline"}),d.jsx(Le,{onClick:async()=>{if(e)try{const Be=await fk(pe,e);Be?.id&&localStorage.setItem("pawnpoint_pending_match",JSON.stringify({matchId:Be.id})),$e(null),a("/play-online")}catch(Be){J(Be?.message||"Could not accept challenge.")}},children:"Accept"})]})]})}),T&&d.jsx("div",{className:"fixed inset-0 z-30 flex items-center justify-center bg-black/60 px-4",children:d.jsxs("div",{className:"w-full max-w-md rounded-2xl bg-slate-800 text-white shadow-2xl border border-white/10 p-6",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("h2",{className:"text-xl font-semibold",children:"Feedback"}),d.jsx("button",{onClick:ot,className:"p-1 rounded-full hover:bg-white/10 text-white/70",children:d.jsx(rE,{className:"h-5 w-5"})})]}),d.jsx("div",{className:"mt-4 text-sm text-white/80",children:"How do you feel about Pawn Point?"}),d.jsx("div",{className:"mt-3 grid grid-cols-5 gap-2",children:Ee.map(({label:Be,emoji:Pt})=>{const Wt=R===Be;return d.jsxs("button",{onClick:()=>{O(Be),ce("")},className:`flex flex-col items-center gap-1 rounded-xl border px-3 py-2 text-xs ${Wt?"border-blue-400 bg-blue-500/20 text-white":"border-white/10 bg-white/5 text-white/80 hover:bg-white/10"}`,children:[d.jsx("span",{className:"text-lg",children:Pt}),d.jsx("span",{children:Be})]},Be)})}),d.jsx("div",{className:"mt-4 text-sm text-white/80",children:"Tell us why"}),d.jsxs("div",{className:"mt-2",children:[d.jsx("textarea",{value:D,onChange:Be=>q(Be.target.value.slice(0,500)),className:"w-full rounded-xl border border-white/10 bg-white/5 px-3 py-3 text-sm text-white outline-none focus:ring-2 focus:ring-pink-400",rows:4,placeholder:"Share your thoughts..."}),d.jsxs("div",{className:"text-right text-xs text-white/60",children:[D.length,"/500"]})]}),d.jsx(Le,{className:`w-full mt-4 justify-center ${et?"":"bg-white/10 text-white/50 shadow-none pointer-events-none"}`,onClick:bt,children:"Submit Feedback"}),he&&d.jsx("div",{className:"mt-3 text-sm text-emerald-200 bg-emerald-500/10 border border-emerald-300/30 rounded-xl px-3 py-2",children:he})]})})]})}const Xd="/assets/The%20South%20Knight-BIvptcHK.png";function f3(){const{user:t}=$r(),[,e]=ua(),[n,r]=j.useState(null),a=j.useMemo(()=>["gothamchess","gmhikaru","jesse_feb","chesscom","botezlive","chessbrah","annacramling","thechessnerd","dinabelenkaya","chessdojo","chesstopia1","chess24","wittyalien","ericrosen"],[]),u=j.useMemo(()=>typeof window<"u"&&window.location.hostname||"localhost",[]);j.useEffect(()=>{t||e("/login")},[t,e]);const{data:h}=Ld({queryKey:["dashboard",t?.id,t?.groupId,t?.accountType],enabled:!!t,queryFn:()=>vk(t)});if(!t)return null;j.useEffect(()=>{let y=!1;return(async()=>{try{const T={query:`query FeaturedLive { ${a.map((q,he)=>`
            c${he}: user(login: "${q}") {
              login
              displayName
              stream {
                id
                viewersCount
              }
            }`).join(`
`)} }`},O=(await(await fetch("https://gql.twitch.tv/gql",{method:"POST",headers:{"Client-ID":"kimne78kx3ncx6brgo4mv6wki5h1ko","Content-Type":"application/json"},body:JSON.stringify(T)})).json())?.data||{},D=Object.values(O).map(q=>!q?.stream?.id||!q?.login?null:{login:q.login.toLowerCase(),viewers:q.stream.viewersCount??0}).filter(Boolean);if(!y)if(D.length>0){const q=D[Math.floor(Math.random()*D.length)];r(q.login)}else r("chess")}catch(k){console.warn("Failed to fetch top chess stream, using default channel.",k),y||r("chess")}})(),()=>{y=!0}},[]);const m=j.useMemo(()=>{if(!n)return"";const y=`https://player.twitch.tv/?channel=${encodeURIComponent(n)}`,x=`&parent=${encodeURIComponent(u)}&muted=true&autoplay=true&playsinline=true`;return y+x},[n,u]);return d.jsx(qr,{children:d.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[d.jsxs(io,{className:"lg:col-span-1",children:[d.jsxs(Cc,{children:[d.jsxs(kc,{children:["Hi, ",t.chessUsername||t.displayName]}),d.jsxs("div",{className:"flex items-center gap-2 text-sm text-white/70",children:[d.jsxs("div",{className:"px-3 py-1 rounded-full bg-emerald-500/20 text-emerald-200 border border-emerald-400/30",children:["Level ",t.level]}),d.jsx("div",{className:"px-3 py-1 rounded-full bg-brand.pink/20 text-white border border-white/20",children:t.subscriptionActive?t.subscriptionPlan:"Free"})]})]}),d.jsxs(oo,{className:"space-y-3",children:[d.jsxs("div",{className:"flex items-center justify-between text-sm text-white/70",children:[d.jsx("span",{children:"Total XP"}),d.jsx("span",{className:"text-white font-semibold",children:t.totalXp})]}),d.jsxs("div",{className:"rounded-xl overflow-hidden border border-white/10 bg-black/40 shadow-inner",children:[d.jsxs("div",{className:"flex items-center justify-between px-3 py-2 text-xs text-white/70 border-b border-white/10",children:[d.jsx("span",{className:"font-semibold text-white",children:"Chess TV"}),d.jsx("span",{className:"uppercase tracking-wide text-[10px] text-white/60",children:"Live on Twitch"})]}),d.jsx("div",{className:"aspect-video bg-black",children:d.jsx("iframe",{title:"Chess TV",src:m,allow:"accelerometer; autoplay; clipboard-write; encrypted-media; picture-in-picture",allowFullScreen:!0,className:"w-full h-full"})})]})]})]}),d.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[d.jsxs(io,{children:[d.jsxs(Cc,{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[d.jsx(kc,{children:"Suggested Courses"}),d.jsx(Le,{variant:"outline",onClick:()=>e("/courses"),children:"Browse all"})]}),d.jsxs(oo,{className:"grid md:grid-cols-3 gap-4",children:[(h?.suggested||[]).map(y=>d.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/5 overflow-hidden",children:[d.jsx("img",{src:y.thumbnailUrl,alt:y.title,className:"h-28 w-full object-cover"}),d.jsxs("div",{className:"p-4 space-y-2",children:[d.jsx("div",{className:"text-sm text-brand.pink uppercase tracking-wide",children:"Suggested"}),d.jsx("div",{className:"font-semibold",children:y.title}),d.jsx("p",{className:"text-sm text-white/70 line-clamp-3",children:y.description}),d.jsx(Le,{className:"w-full",onClick:()=>e(`/lesson/${y.id}`),children:"Continue"})]})]},y.id)),!h&&d.jsx("div",{className:"text-white/70 text-sm",children:"Loading dashboard..."})]})]}),d.jsxs(io,{children:[d.jsxs(Cc,{className:"flex flex-col gap-2",children:[d.jsxs(kc,{className:"flex items-center gap-2",children:[d.jsx(F_,{className:"h-5 w-5 text-emerald-300"}),"AI Practice"]}),d.jsx("p",{className:"text-white/75 text-sm",children:"Sharpen openings, tactics, and endgames with adaptive difficulty and live XP tracking."})]}),d.jsxs(oo,{className:"grid md:grid-cols-[1fr_auto] gap-4 items-center",children:[d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx("div",{className:"h-20 w-20 rounded-full overflow-hidden border border-white/10 shadow-lg",children:d.jsx("img",{src:Xd,alt:"The South Knight",className:"h-full w-full object-cover"})}),d.jsxs("div",{className:"space-y-1",children:[d.jsx("div",{className:"text-sm text-white/70",children:"Train with the South Knight"}),d.jsx("div",{className:"text-base font-semibold text-white",children:"Custom sparring sessions, instant XP."})]})]}),d.jsx("div",{className:"flex flex-col gap-3 w-full md:w-auto",children:d.jsx(Le,{size:"lg",onClick:()=>e("/practice"),children:"Play Training Bot"})})]})]})]})]})})}function _k({value:t,className:e}){return d.jsx("div",{className:Oc("w-full h-2 rounded-full bg-white/10 overflow-hidden",e),children:d.jsx("div",{className:"h-full rounded-full bg-gradient-to-r from-brand.pink to-brand.purple transition-all",style:{width:`${Math.min(Math.max(t,0),100)}%`}})})}const Zv=[{key:"all",label:"All"},{key:"white_opening",label:"White Openings"},{key:"black_opening",label:"Black Openings"},{key:"beginner",label:"Beginners"},{key:"middlegame",label:"Middlegame"},{key:"endgame",label:"Endgame"},{key:"skills",label:"Skills"}],e0=()=>({title:"",description:"",category:"beginner",difficulty:"beginner",thumbnailUrl:nl,accentColor:"#ec4899",lessons:[{id:ir(),title:"Lesson 1",summary:"Add content inside the course."},{id:ir(),title:"Lesson 2",summary:"Add content inside the course."}]});function h3(){const[,t]=ua(),e=Bm(),{user:n}=$r(),r=!!n?.isAdmin,a=n?.accountType==="group"&&!!n?.groupId,[u,h]=j.useState(""),[m,y]=j.useState("all"),[x,k]=j.useState(!1),[T,S]=j.useState(null),[R,O]=j.useState(e0()),[D,q]=j.useState(!1),[he,ce]=j.useState(!1),[C,le]=j.useState(""),c=5e6,{data:re=[]}=Ld({queryKey:["courses",u,m,n?.groupId,n?.id,n?.accountType],queryFn:()=>Dm(u,m)}),xe=()=>{e.invalidateQueries({queryKey:["courses"]}),e.invalidateQueries({queryKey:["course"]}),e.invalidateQueries({queryKey:["dashboard"]})},je=Qp({mutationFn:V4,onSuccess:()=>{le(""),xe(),st()},onError:Y=>{const J=Y instanceof Error?Y.message:"Could not save the course. Try again or clear some data and retry.";le(J)}}),Fe=Qp({mutationFn:H4,onSuccess:()=>{le(""),xe(),st()},onError:Y=>{const J=Y instanceof Error?Y.message:"Could not save the course. Try again or clear some data and retry.";le(J)}}),Ze=Qp({mutationFn:K4,onSuccess:(Y,J)=>{xe(),T&&T.id===J&&st()}}),st=()=>{k(!1),S(null),O(e0()),le(""),q(!1),ce(!1)},Re=Y=>{Y?(S(Y),O({...Y,lessons:Y.lessons.map(J=>({...J}))})):(S(null),O(e0())),k(!0),le(""),q(!1),ce(!1)},Ae=()=>{if(!r)return;if(le(""),q(!1),ce(!1),R.thumbnailUrl.startsWith("data:image/")&&R.thumbnailUrl.length>c){le("Thumbnail too large. Try a smaller PNG or a hosted link under ~5MB.");return}const Y=(R.lessons||[]).length>0?R.lessons:[{id:ir(),title:"Lesson 1",summary:"Add content inside the course."}],J={id:T?.id||R.id||ir(),title:R.title.trim()||"Untitled Course",description:R.description.trim()||"No description yet.",category:R.category,difficulty:R.difficulty,thumbnailUrl:R.thumbnailUrl.trim()||nl,accentColor:R.accentColor||"#ec4899",lessons:Y};T?Fe.mutate(J):je.mutate(J)},ue=Y=>{!r||!window.confirm(`Delete "${Y.title}"? This cannot be undone.`)||Ze.mutate(Y.id)},pe=je.isPending||Fe.isPending,$e=Ze.isPending;return d.jsx(qr,{children:d.jsxs("div",{className:"space-y-6",children:[d.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[d.jsxs("div",{children:[d.jsx("h1",{className:"text-2xl font-semibold",children:"All Courses"}),d.jsx("p",{className:"text-white/70 text-sm",children:"Search, filter, and pick up where you left off."})]}),d.jsxs("div",{className:"flex items-center gap-2 text-white/70 text-sm",children:[d.jsx(oE,{className:"h-4 w-4"}),a?"Group catalog":"Personal catalog"]})]}),r&&d.jsxs("div",{className:"rounded-xl border border-emerald-400/30 bg-emerald-500/10 px-4 py-3 flex flex-col md:flex-row md:items-center md:justify-between gap-3",children:[d.jsxs("div",{children:[d.jsx("div",{className:"text-sm font-semibold text-emerald-100",children:"Admin mode active"}),d.jsx("div",{className:"text-xs text-emerald-50/80",children:"Add, edit, delete courses, and update thumbnails directly from the catalog."})]}),d.jsx("div",{className:"flex items-center gap-2",children:d.jsxs(Le,{variant:"outline",onClick:()=>Re(),children:[d.jsx(w0,{className:"h-4 w-4 mr-2"}),"Add course"]})})]}),d.jsxs("div",{className:"flex flex-col lg:flex-row gap-3 lg:items-center",children:[d.jsxs("div",{className:"relative flex-1",children:[d.jsx(yE,{className:"absolute left-3 top-3 h-4 w-4 text-white/50"}),d.jsx("input",{placeholder:"Search courses",value:u,onChange:Y=>h(Y.target.value),className:"w-full rounded-xl bg-white/5 border border-white/10 px-10 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-brand.pink"})]}),d.jsx("div",{className:"flex flex-wrap gap-2",children:Zv.map(Y=>d.jsx(Le,{variant:m===Y.key?"primary":"outline",onClick:()=>y(Y.key),children:Y.label},Y.key))})]}),re.length===0?d.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/5 p-6 text-center text-white/80",children:[a?"No courses available for this group yet.":"Create your first course to get started.",r&&!a&&d.jsx("div",{className:"mt-3",children:d.jsxs(Le,{variant:"outline",onClick:()=>Re(),children:[d.jsx(w0,{className:"h-4 w-4 mr-2"}),"Add course"]})})]}):d.jsx("div",{className:"grid md:grid-cols-3 gap-4",children:re.map(Y=>d.jsx(p3,{course:Y,onOpen:()=>t(`/lesson/${Y.id}`),isAdmin:r,onEdit:()=>Re(Y),onDelete:ue},Y.id))}),x&&d.jsx("div",{className:"fixed inset-0 z-30 flex items-center justify-center bg-black/70 px-4",children:d.jsxs("div",{className:"w-full max-w-4xl max-h-[90vh] overflow-y-auto rounded-2xl bg-slate-900 text-white border border-white/10 shadow-2xl",children:[d.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-white/10",children:[d.jsxs("div",{children:[d.jsx("div",{className:"text-lg font-semibold",children:T?"Edit course":"Add new course"}),d.jsx("div",{className:"text-xs text-white/60",children:"Admin-only course management"})]}),d.jsx("button",{onClick:st,className:"p-2 rounded-full hover:bg-white/10 text-white/70","aria-label":"Close editor",children:d.jsx(nr,{className:"h-4 w-4"})})]}),d.jsxs("div",{className:"p-5 space-y-4",children:[d.jsxs("div",{className:"grid md:grid-cols-2 gap-3",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx("label",{className:"text-sm text-white/80",children:"Title"}),d.jsx("input",{value:R.title,onChange:Y=>O(J=>({...J,title:Y.target.value})),className:"w-full rounded-xl border border-white/10 bg-white/5 px-3 py-3 text-sm outline-none focus:ring-2 focus:ring-pink-400",placeholder:"Course title"})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx("label",{className:"text-sm text-white/80",children:"Thumbnail URL or PNG upload"}),d.jsx("input",{value:R.thumbnailUrl,onChange:Y=>O(J=>({...J,thumbnailUrl:Y.target.value})),className:"w-full rounded-xl border border-white/10 bg-white/5 px-3 py-3 text-sm outline-none focus:ring-2 focus:ring-pink-400",placeholder:"Paste a link to the cover image"}),d.jsx("input",{type:"file",accept:"image/png",onChange:Y=>{const J=Y.target.files?.[0];if(!J)return;const Se=new FileReader;Se.onload=de=>{const $=de.target?.result;typeof $=="string"&&O(ee=>({...ee,thumbnailUrl:$}))},Se.readAsDataURL(J)},className:"w-full text-sm text-white/80 file:mr-3 file:rounded-lg file:border-none file:bg-white/10 file:px-3 file:py-2 file:text-white hover:file:bg-white/20"}),d.jsx("div",{className:"text-xs text-white/60",children:"Use a link or upload a PNG to show on the card."})]})]}),d.jsxs("div",{className:"grid md:grid-cols-2 gap-3",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx("label",{className:"text-sm text-white/80",children:"Category"}),d.jsxs("div",{className:"relative",children:[d.jsxs("button",{type:"button",onClick:()=>q(Y=>!Y),className:"w-full rounded-xl border border-white/10 bg-white/5 px-3 py-3 text-sm outline-none hover:border-white/20 flex items-center justify-between",children:[d.jsx("span",{children:Zv.find(Y=>Y.key===R.category)?.label||"Select category"}),d.jsx("span",{className:"text-xs text-white/60",children:D?"Hide":"Show"})]}),D&&d.jsx("div",{className:"absolute z-20 mt-2 w-full rounded-2xl bg-slate-800 border border-white/10 shadow-2xl overflow-hidden",children:Zv.filter(Y=>Y.key!=="all").map(Y=>d.jsx("button",{onClick:()=>{O(J=>({...J,category:Y.key})),q(!1)},className:"w-full text-left px-4 py-2 text-sm text-white hover:bg-white/10",children:Y.label},Y.key))})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx("label",{className:"text-sm text-white/80",children:"Difficulty"}),d.jsxs("div",{className:"relative",children:[d.jsxs("button",{type:"button",onClick:()=>ce(Y=>!Y),className:"w-full rounded-xl border border-white/10 bg-white/5 px-3 py-3 text-sm outline-none hover:border-white/20 flex items-center justify-between",children:[d.jsx("span",{className:"capitalize",children:R.difficulty}),d.jsx("span",{className:"text-xs text-white/60",children:he?"Hide":"Show"})]}),he&&d.jsx("div",{className:"absolute z-20 mt-2 w-full rounded-2xl bg-slate-800 border border-white/10 shadow-2xl overflow-hidden",children:["beginner","intermediate","advanced"].map(Y=>d.jsx("button",{onClick:()=>{O(J=>({...J,difficulty:Y})),ce(!1)},className:"w-full text-left px-4 py-2 text-sm text-white hover:bg-white/10 capitalize",children:Y},Y))})]})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx("label",{className:"text-sm text-white/80",children:"Description"}),d.jsx("textarea",{value:R.description,onChange:Y=>O(J=>({...J,description:Y.target.value})),className:"w-full rounded-xl border border-white/10 bg-white/5 px-3 py-3 text-sm outline-none focus:ring-2 focus:ring-pink-400",rows:3,placeholder:"What will learners get from this course?"})]}),d.jsxs("div",{className:"flex items-center justify-between pt-2",children:[T&&d.jsxs(Le,{variant:"ghost",onClick:()=>ue(T),className:$e?"opacity-50 pointer-events-none":"text-red-200 hover:text-red-100",disabled:$e,children:[d.jsx(oy,{className:"h-4 w-4 mr-2"}),"Delete course"]}),d.jsxs("div",{className:"flex items-center gap-2 ml-auto",children:[d.jsx(Le,{variant:"outline",onClick:st,children:"Cancel"}),d.jsx(Le,{onClick:Ae,className:pe?"opacity-60 pointer-events-none":"",disabled:pe,children:pe?"Saving...":"Save course"})]})]}),C&&d.jsx("div",{className:"text-sm text-red-200 bg-red-500/10 border border-red-400/40 rounded-xl px-3 py-2",children:C})]})]})})]})})}function p3({course:t,onOpen:e,isAdmin:n,onEdit:r,onDelete:a}){const u=t.thumbnailUrl||nl;return d.jsxs(io,{className:"relative overflow-hidden hover:border-white/20 transition border border-white/10",children:[n&&d.jsxs("div",{className:"absolute right-2 top-2 z-10 flex items-center gap-1 rounded-full bg-black/50 px-2 py-1",children:[d.jsx("button",{onClick:()=>r(t),className:"p-1 rounded-md hover:bg-white/10 text-white","aria-label":"Edit course",children:d.jsx(Dd,{className:"h-4 w-4"})}),d.jsx("button",{onClick:()=>a(t),className:"p-1 rounded-md hover:bg-white/10 text-red-200","aria-label":"Delete course",children:d.jsx(oy,{className:"h-4 w-4"})})]}),d.jsx("img",{src:u,alt:t.title,className:"h-32 w-full object-cover"}),d.jsxs(oo,{className:"space-y-3",children:[d.jsx("div",{className:"text-sm text-brand.pink uppercase tracking-wide",children:t.category.replace("_"," ")}),d.jsx("div",{className:"font-semibold",children:t.title}),d.jsx("p",{className:"text-sm text-white/70 line-clamp-3",children:t.description}),d.jsx(_k,{value:0}),d.jsx(Le,{className:"w-full",onClick:e,children:"Start Course"})]})]})}function m3({id:t}){const{user:e}=$r(),[,n]=ua(),r=Bm(),{data:a}=Ld({queryKey:["course",t,e?.groupId,e?.accountType],queryFn:()=>hf(t,e||void 0)}),{data:u}=Ld({queryKey:["progress",t,e?.groupId,e?.accountType],enabled:!!e,queryFn:()=>mk(e.id,t)}),h=Qp({mutationFn:y=>s3(e.id,t,y),onSuccess:()=>{r.invalidateQueries({queryKey:["course",t]}),r.invalidateQueries({queryKey:["progress",t]}),r.invalidateQueries({queryKey:["dashboard"]})}});if(!a)return d.jsx(qr,{children:d.jsx("div",{className:"text-white/70 text-sm",children:"Loading course..."})});const m=new Set(u?.completedLessonIds||[]);return d.jsxs(qr,{children:[d.jsxs("button",{onClick:()=>n("/courses"),className:"text-white/70 hover:text-white flex items-center gap-2 mb-4 text-sm",children:[d.jsx(v0,{className:"h-4 w-4"}),"Back to courses"]}),d.jsxs(io,{children:[d.jsxs(Cc,{children:[d.jsx(kc,{className:"text-2xl",children:a.title}),d.jsx("p",{className:"text-white/70 text-sm",children:a.description})]}),d.jsxs(oo,{className:"space-y-4",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsxs("div",{className:"flex items-center justify-between text-sm text-white/70",children:[d.jsx("span",{children:"Progress"}),d.jsxs("span",{className:"text-white font-semibold",children:[u?.progressPercent??0,"%"]})]}),d.jsx(_k,{value:u?.progressPercent??0})]}),d.jsx("div",{className:"space-y-3",children:a.lessons.map(y=>d.jsxs("div",{className:"flex items-center justify-between rounded-lg border border-white/10 bg-white/5 p-3",children:[d.jsxs("div",{children:[d.jsx("div",{className:"font-semibold",children:y.title}),d.jsx("div",{className:"text-white/70 text-sm",children:y.summary})]}),d.jsx(Le,{variant:m.has(y.id)?"outline":"primary",onClick:()=>h.mutate(y.id),disabled:h.isPending,children:m.has(y.id)?d.jsxs("span",{className:"flex items-center gap-1",children:[d.jsx(ry,{className:"h-4 w-4"}),"Completed"]}):"Mark done"})]},y.id))})]})]})]})}function g3(){const{user:t}=$r(),[e,n]=j.useState([]),[r,a]=j.useState(!0),[u,h]=j.useState("xp"),[m,y]=j.useState([]),[x,k]=j.useState(!0),[T,S]=j.useState(""),[R,O]=j.useState(""),[D,q]=j.useState(""),[he,ce]=j.useState(""),[C,le]=j.useState(!1),[c,re]=j.useState({}),[xe,je]=j.useState(null),[Fe,Ze]=j.useState(null),[st,Re]=j.useState(""),[Ae,ue]=j.useState(""),pe=!!t?.groupId&&t?.accountType==="group",$e=t?.groupId?`groups/${t.groupId}/clubLeaderboard`:t?`users/${t.id}/clubLeaderboard`:"clubLeaderboard";j.useEffect(()=>{if(!t||u!=="xp")return;const G=Ke(Ge,"users"),ae=Rc(G,Ue=>{const qe=Ue.val()||{};let et=Object.values(qe||{}).filter(bt=>typeof bt?.totalXp=="number");pe?et=et.filter(bt=>bt.groupId===t.groupId):et=et.filter(bt=>bt.id===t.id);const ot=et.sort((bt,nn)=>{const hn=(nn.totalXp||0)-(bt.totalXp||0);if(hn!==0)return hn;const Dt=bt.xpReachedAt??bt.createdAt??0,Mn=nn.xpReachedAt??nn.createdAt??0;return Dt-Mn});n(ot),a(!1)},()=>a(!1));return()=>ae()},[t,u,pe]),j.useEffect(()=>{if(!t||u!=="club")return;k(!0),S(""),i3(t).then(Ue=>y(Ue)).catch(()=>S("Could not load club leaderboard.")).finally(()=>k(!1));const G=Ke(Ge,$e),ae=Rc(G,Ue=>{const qe=Ue.val()||{},et=Object.values(qe||{}).map(ot=>({...ot,rating:Math.max(0,Math.round(ot.rating||0)),performance:ot.performance!==void 0&&ot.performance!==null?Math.round(ot.performance):void 0}));y(et),k(!1)},()=>k(!1));return()=>ae()},[t,u,$e]);const Y=j.useMemo(()=>[...m].sort((G,ae)=>{const Ue=(ae.rating||0)-(G.rating||0);if(Ue!==0)return Ue;const qe=(ae.performance||0)-(G.performance||0);return qe!==0?qe:(G.name||"").localeCompare(ae.name||"")}),[m]),J=j.useMemo(()=>e.map((G,ae)=>({entry:G,rank:ae+1})),[e]),Se=j.useMemo(()=>{const G=st.trim().toLowerCase();return G?J.filter(({entry:ae})=>(ae.chessUsername||ae.displayName||(ae.email?ae.email.split("@")[0]:"Player")).toLowerCase().includes(G)):J},[J,st]),de=j.useMemo(()=>Y.map((G,ae)=>({entry:G,rank:ae+1})),[Y]),$=j.useMemo(()=>{const G=Ae.trim().toLowerCase();return G?de.filter(({entry:ae})=>ae.name.toLowerCase().includes(G)):de},[de,Ae]),ee=async G=>{if(G.preventDefault(),!t?.isAdmin){S("Only admins can add participants.");return}const ae=Number(D),Ue=he.trim()?Number(he):void 0;if(!R.trim()){S("Name is required.");return}if(!Number.isFinite(ae)){S("Rating must be a number.");return}le(!0),S("");try{await o3(t,{name:R,rating:ae,performance:Ue}),O(""),q(""),ce("")}catch(qe){S(qe?.message||"Failed to add participant.")}finally{le(!1)}},Pe=async G=>{if(!t?.isAdmin){S("Only admins can update performance.");return}const ae=c[G],Ue=ae!==void 0?Number(ae):void 0;if(ae!==void 0&&ae!==""&&!Number.isFinite(Ue)){S("Performance must be a number.");return}je(G),S("");try{await a3(t,G,{performance:Ue})}catch(qe){S(qe?.message||"Failed to update performance.")}finally{je(null)}},Ee=async G=>{if(!t?.isAdmin){S("Only admins can remove participants.");return}Ze(G),S("");try{await l3(t,G)}catch(ae){S(ae?.message||"Failed to remove participant.")}finally{Ze(null)}};return!t||u==="xp"&&r?d.jsx(qr,{children:d.jsx("div",{className:"text-white/70 text-sm",children:"Loading leaderboard..."})}):d.jsx(qr,{children:d.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[d.jsxs(io,{children:[d.jsxs(Cc,{className:"flex flex-col items-center gap-3",children:[d.jsxs("div",{className:"relative h-28 w-28",children:[d.jsx("div",{className:"absolute inset-0 rounded-full bg-gradient-to-tr from-emerald-400 via-blue-400 to-purple-500 opacity-80"}),d.jsx("div",{className:"relative h-full w-full rounded-full bg-slate-900 p-1",children:d.jsx("div",{className:"h-full w-full rounded-full overflow-hidden bg-slate-800 border border-white/10",children:t.avatarUrl?d.jsx("img",{src:t.avatarUrl,alt:"Avatar",className:"h-full w-full object-cover"}):d.jsx("div",{className:"h-full w-full flex items-center justify-center text-2xl font-bold text-white",children:(t.chessUsername||t.displayName||"Player").slice(0,2).toUpperCase()})})})]}),d.jsx(kc,{className:"text-3xl font-extrabold text-white text-center",children:t.chessUsername||t.displayName})]}),d.jsxs(oo,{className:"grid grid-cols-2 gap-3 text-sm text-white/80 items-stretch",children:[d.jsxs("div",{className:"flex items-center gap-2 rounded-xl border border-white/10 bg-white/5 px-3 py-2",children:[d.jsx(TE,{className:"h-5 w-5 text-emerald-300"}),d.jsxs("div",{children:[d.jsx("div",{className:"text-lg font-semibold text-white",children:t.totalXp}),d.jsx("div",{className:"text-xs text-white/70",children:"Total XP"})]})]}),d.jsxs("div",{className:"flex items-center gap-2 rounded-xl border border-white/10 bg-white/5 px-3 py-2",children:[d.jsx(B_,{className:"h-5 w-5 text-emerald-300"}),d.jsxs("div",{children:[d.jsx("div",{className:"text-lg font-semibold text-white",children:t.level}),d.jsx("div",{className:"text-xs text-white/70",children:"Level"})]})]})]})]}),d.jsxs(io,{className:"lg:col-span-2",children:[d.jsxs(Cc,{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[d.jsxs(kc,{className:"flex items-center gap-2",children:[d.jsx(xE,{className:"h-5 w-5 text-brand.pink"}),"Leaderboard"]}),d.jsxs("div",{className:"flex items-center gap-2 text-sm text-white/80",children:[d.jsx("span",{children:"View:"}),d.jsxs("select",{value:u,onChange:G=>h(G.target.value),className:"rounded-lg border border-white/10 bg-white/5 px-3 py-2 text-white/80 focus:outline-none focus:ring-2 focus:ring-pink-400",children:[d.jsx("option",{value:"xp",children:"XP Leaderboard"}),d.jsx("option",{value:"club",children:"Club Leaderboard"})]})]})]}),d.jsxs(oo,{className:"space-y-3",children:[d.jsx("div",{className:"text-xs text-white/60",children:pe?"You are viewing private rankings for your group only.":"Personal account: only your own stats appear here."}),u==="xp"?d.jsx("div",{className:"flex items-center gap-2",children:d.jsx("input",{value:st,onChange:G=>Re(G.target.value),placeholder:"Search players",className:"w-full rounded-lg border border-white/10 bg-white/5 px-3 py-2 text-sm text-white outline-none focus:ring-2 focus:ring-pink-400"})}):d.jsx("div",{className:"flex items-center gap-2",children:d.jsx("input",{value:Ae,onChange:G=>ue(G.target.value),placeholder:"Search club players",className:"w-full rounded-lg border border-white/10 bg-white/5 px-3 py-2 text-sm text-white outline-none focus:ring-2 focus:ring-pink-400"})}),u==="xp"?d.jsx("div",{className:"space-y-3 max-h-[420px] overflow-y-auto pr-1",children:Se.map(({entry:G,rank:ae})=>{const Ue=G.chessUsername||G.displayName||(G.email?G.email.split("@")[0]:"Player");return d.jsxs("div",{className:"flex items-center justify-between rounded-lg border border-white/10 bg-white/5 p-3",children:[d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:"h-9 w-9 rounded-full bg-white/10 flex items-center justify-center",children:ae}),d.jsxs("div",{children:[d.jsx("div",{className:"font-semibold text-white",children:Ue}),d.jsxs("div",{className:"text-xs text-white/60",children:["Level ",G.level]})]})]}),d.jsxs("div",{className:"font-semibold text-emerald-200",children:[G.totalXp," XP"]})]},`${G.id||G.email||G.displayName||ae}`)})}):d.jsxs(d.Fragment,{children:[t?.isAdmin&&d.jsxs("form",{onSubmit:ee,className:"space-y-2 rounded-xl border border-white/10 bg-white/5 p-3",children:[d.jsx("div",{className:"text-sm font-semibold text-white",children:"Club Leaderboard Controls (Admin)"}),d.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2",children:[d.jsx("input",{value:R,onChange:G=>O(G.target.value),placeholder:"Name",className:"rounded-lg border border-white/10 bg-slate-900 px-3 py-2 text-sm text-white outline-none focus:ring-2 focus:ring-pink-400"}),d.jsx("input",{value:D,onChange:G=>q(G.target.value),placeholder:"Rating",type:"number",className:"rounded-lg border border-white/10 bg-slate-900 px-3 py-2 text-sm text-white outline-none focus:ring-2 focus:ring-pink-400"}),d.jsx("input",{value:he,onChange:G=>ce(G.target.value),placeholder:"Performance",type:"number",className:"rounded-lg border border-white/10 bg-slate-900 px-3 py-2 text-sm text-white outline-none focus:ring-2 focus:ring-pink-400"})]}),d.jsxs("div",{className:"flex items-center justify-between gap-2 text-xs text-white/60",children:[d.jsx("span",{children:"Add participants and set their performance."}),d.jsx(Le,{type:"submit",size:"sm",disabled:C,children:C?"Saving...":"Add participant"})]}),T&&d.jsx("div",{className:"text-xs text-amber-300",children:T})]}),x?d.jsx("div",{className:"text-white/70 text-sm",children:"Loading club leaderboard..."}):Y.length===0?d.jsx("div",{className:"text-white/60 text-sm",children:"No club entries yet."}):d.jsx("div",{className:"space-y-3 max-h-[420px] overflow-y-auto pr-1",children:$.map(({entry:G,rank:ae})=>d.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 rounded-lg border border-white/10 bg-white/5 p-3",children:[d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:"h-9 w-9 rounded-full bg-white/10 flex items-center justify-center",children:ae}),d.jsxs("div",{children:[d.jsx("div",{className:"font-semibold text-white",children:G.name}),d.jsxs("div",{className:"text-xs text-white/60",children:["Rating ",G.rating,G.performance!==void 0?`  Performance ${G.performance}`:""]})]})]}),t?.isAdmin?d.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 w-full sm:w-auto",children:[d.jsx("input",{type:"number",value:c[G.id]!==void 0?c[G.id]:G.performance??"",onChange:Ue=>re(qe=>({...qe,[G.id]:Ue.target.value})),className:"w-full sm:w-28 rounded-lg border border-white/10 bg-slate-900 px-3 py-2 text-sm text-white outline-none focus:ring-2 focus:ring-pink-400",placeholder:"Performance"}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(Le,{size:"sm",variant:"outline",onClick:()=>Pe(G.id),disabled:xe===G.id,children:xe===G.id?"Saving...":"Save"}),d.jsx(Le,{size:"sm",variant:"ghost",onClick:()=>Ee(G.id),disabled:Fe===G.id,children:Fe===G.id?"Removing...":"Delete"})]})]}):d.jsxs("div",{className:"text-sm font-semibold text-emerald-200",children:["Performance ",G.performance??"N/A"]})]},G.id))})]})]})]})]})})}function v3(t){return t!==null?{comment:t,variations:[]}:{variations:[]}}function y3(t,e,n,r,a){const u={move:t,variations:a};return e&&(u.suffix=e),n&&(u.nag=n),r!==null&&(u.comment=r),u}function w3(...t){const[e,...n]=t;let r=e;for(const a of n)a!==null&&(r.variations=[a,...a.variations],a.variations=[],r=a);return e}function x3(t,e){if(e.marker&&e.marker.comment){let n=e.root;for(;;){const r=n.variations[0];if(!r){n.comment=e.marker.comment;break}n=r}}return{headers:t,root:e.root,result:(e.marker&&e.marker.result)??void 0}}function _3(t,e){function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n}function $c(t,e,n,r){var a=Error.call(this,t);return Object.setPrototypeOf&&Object.setPrototypeOf(a,$c.prototype),a.expected=e,a.found=n,a.location=r,a.name="SyntaxError",a}_3($c,Error);function t0(t,e,n){return n=n||" ",t.length>e?t:(e-=t.length,n+=n.repeat(e),t+n.slice(0,e))}$c.prototype.format=function(t){var e="Error: "+this.message;if(this.location){var n=null,r;for(r=0;r<t.length;r++)if(t[r].source===this.location.source){n=t[r].text.split(/\r\n|\n|\r/g);break}var a=this.location.start,u=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(a):a,h=this.location.source+":"+u.line+":"+u.column;if(n){var m=this.location.end,y=t0("",u.line.toString().length," "),x=n[a.line-1],k=a.line===m.line?m.column:x.length+1,T=k-a.column||1;e+=`
 --> `+h+`
`+y+` |
`+u.line+" | "+x+`
`+y+" | "+t0("",a.column-1," ")+t0("",T,"^")}else e+=`
 at `+h}return e};$c.buildMessage=function(t,e){var n={literal:function(x){return'"'+a(x.text)+'"'},class:function(x){var k=x.parts.map(function(T){return Array.isArray(T)?u(T[0])+"-"+u(T[1]):u(T)});return"["+(x.inverted?"^":"")+k.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(x){return x.description}};function r(x){return x.charCodeAt(0).toString(16).toUpperCase()}function a(x){return x.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(k){return"\\x0"+r(k)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(k){return"\\x"+r(k)})}function u(x){return x.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(k){return"\\x0"+r(k)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(k){return"\\x"+r(k)})}function h(x){return n[x.type](x)}function m(x){var k=x.map(h),T,S;if(k.sort(),k.length>0){for(T=1,S=1;T<k.length;T++)k[T-1]!==k[T]&&(k[S]=k[T],S++);k.length=S}switch(k.length){case 1:return k[0];case 2:return k[0]+" or "+k[1];default:return k.slice(0,-1).join(", ")+", or "+k[k.length-1]}}function y(x){return x?'"'+a(x)+'"':"end of input"}return"Expected "+m(t)+" but "+y(e)+" found."};function b3(t,e){e=e!==void 0?e:{};var n={},r=e.grammarSource,a={pgn:Nt},u=Nt,h="[",m='"',y="]",x=".",k="O-O-O",T="O-O",S="0-0-0",R="0-0",O="$",D="{",q="}",he=";",ce="(",C=")",le="1-0",c="0-1",re="1/2-1/2",xe="*",je=/^[a-zA-Z]/,Fe=/^[^"]/,Ze=/^[0-9]/,st=/^[.]/,Re=/^[a-zA-Z1-8\-=]/,Ae=/^[+#]/,ue=/^[!?]/,pe=/^[^}]/,$e=/^[^\r\n]/,Y=/^[ \t\r\n]/,J=se("tag pair"),Se=At("[",!1),de=At('"',!1),$=At("]",!1),ee=se("tag name"),Pe=W([["a","z"],["A","Z"]],!1,!1),Ee=se("tag value"),G=W(['"'],!0,!1),ae=se("move number"),Ue=W([["0","9"]],!1,!1),qe=At(".",!1),et=W(["."],!1,!1),ot=se("standard algebraic notation"),bt=At("O-O-O",!1),nn=At("O-O",!1),hn=At("0-0-0",!1),Dt=At("0-0",!1),Mn=W([["a","z"],["A","Z"],["1","8"],"-","="],!1,!1),Be=W(["+","#"],!1,!1),Pt=se("suffix annotation"),Wt=W(["!","?"],!1,!1),On=se("NAG"),sn=At("$",!1),qt=se("brace comment"),ln=At("{",!1),zn=W(["}"],!0,!1),Wn=At("}",!1),Ts=se("rest of line comment"),qn=At(";",!1),cn=W(["\r",`
`],!0,!1),Ln=se("variation"),ns=At("(",!1),ne=At(")",!1),at=se("game termination marker"),yt=At("1-0",!1),Ft=At("0-1",!1),Lt=At("1/2-1/2",!1),En=At("*",!1),Yt=se("whitespace"),Qt=W([" ","	","\r",`
`],!1,!1),Xt=function(z,Z){return x3(z,Z)},Tn=function(z){return Object.fromEntries(z)},gs=function(z,Z){return[z,Z]},Vn=function(z,Z){return{root:z,marker:Z}},Sn=function(z,Z){return w3(v3(z),...Z.flat())},Is=function(z,Z,X,tt,Ye){return y3(z,Z,X,tt,Ye)},vs=function(z){return z},Hn=function(z){return z.replace(/[\r\n]+/g," ")},Kn=function(z){return z.trim()},Hs=function(z){return z},ys=function(z,Z){return{result:z,comment:Z}},K=e.peg$currPos|0,yn=[{line:1,column:1}],Jt=K,An=e.peg$maxFailExpected||[],Ne=e.peg$silentFails|0,In;if(e.startRule){if(!(e.startRule in a))throw new Error(`Can't start parsing from rule "`+e.startRule+'".');u=a[e.startRule]}function At(z,Z){return{type:"literal",text:z,ignoreCase:Z}}function W(z,Z,X){return{type:"class",parts:z,inverted:Z,ignoreCase:X}}function ie(){return{type:"end"}}function se(z){return{type:"other",description:z}}function ke(z){var Z=yn[z],X;if(Z)return Z;if(z>=yn.length)X=yn.length-1;else for(X=z;!yn[--X];);for(Z=yn[X],Z={line:Z.line,column:Z.column};X<z;)t.charCodeAt(X)===10?(Z.line++,Z.column=1):Z.column++,X++;return yn[z]=Z,Z}function Qe(z,Z,X){var tt=ke(z),Ye=ke(Z),V={source:r,start:{offset:z,line:tt.line,column:tt.column},end:{offset:Z,line:Ye.line,column:Ye.column}};return V}function ge(z){K<Jt||(K>Jt&&(Jt=K,An=[]),An.push(z))}function Bt(z,Z,X){return new $c($c.buildMessage(z,Z),z,Z,X)}function Nt(){var z,Z,X;return z=K,Z=Rt(),X=Ct(),z=Xt(Z,X),z}function Rt(){var z,Z,X;for(z=K,Z=[],X=lt();X!==n;)Z.push(X),X=lt();return X=rn(),z=Tn(Z),z}function lt(){var z,Z,X,tt,Ye,V,ye;return Ne++,z=K,rn(),t.charCodeAt(K)===91?(Z=h,K++):(Z=n,Ne===0&&ge(Se)),Z!==n?(rn(),X=nt(),X!==n?(rn(),t.charCodeAt(K)===34?(tt=m,K++):(tt=n,Ne===0&&ge(de)),tt!==n?(Ye=ut(),t.charCodeAt(K)===34?(V=m,K++):(V=n,Ne===0&&ge(de)),V!==n?(rn(),t.charCodeAt(K)===93?(ye=y,K++):(ye=n,Ne===0&&ge($)),ye!==n?z=gs(X,Ye):(K=z,z=n)):(K=z,z=n)):(K=z,z=n)):(K=z,z=n)):(K=z,z=n),Ne--,z===n&&Ne===0&&ge(J),z}function nt(){var z,Z,X;if(Ne++,z=K,Z=[],X=t.charAt(K),je.test(X)?K++:(X=n,Ne===0&&ge(Pe)),X!==n)for(;X!==n;)Z.push(X),X=t.charAt(K),je.test(X)?K++:(X=n,Ne===0&&ge(Pe));else Z=n;return Z!==n?z=t.substring(z,K):z=Z,Ne--,z===n&&(Z=n,Ne===0&&ge(ee)),z}function ut(){var z,Z,X;for(Ne++,z=K,Z=[],X=t.charAt(K),Fe.test(X)?K++:(X=n,Ne===0&&ge(G));X!==n;)Z.push(X),X=t.charAt(K),Fe.test(X)?K++:(X=n,Ne===0&&ge(G));return z=t.substring(z,K),Ne--,Z=n,Ne===0&&ge(Ee),z}function Ct(){var z,Z,X;return z=K,Z=kt(),rn(),X=Kt(),X===n&&(X=null),rn(),z=Vn(Z,X),z}function kt(){var z,Z,X,tt;for(z=K,Z=Dn(),Z===n&&(Z=null),X=[],tt=Vt();tt!==n;)X.push(tt),tt=Vt();return z=Sn(Z,X),z}function Vt(){var z,Z,X,tt,Ye,V,ye,Ie;if(z=K,rn(),$t(),rn(),Z=Xn(),Z!==n){for(X=wn(),X===n&&(X=null),tt=[],Ye=ss();Ye!==n;)tt.push(Ye),Ye=ss();for(Ye=rn(),V=Dn(),V===n&&(V=null),ye=[],Ie=rs();Ie!==n;)ye.push(Ie),Ie=rs();z=Is(Z,X,tt,V,ye)}else K=z,z=n;return z}function $t(){var z,Z,X,tt,Ye,V;for(Ne++,z=K,Z=[],X=t.charAt(K),Ze.test(X)?K++:(X=n,Ne===0&&ge(Ue));X!==n;)Z.push(X),X=t.charAt(K),Ze.test(X)?K++:(X=n,Ne===0&&ge(Ue));if(t.charCodeAt(K)===46?(X=x,K++):(X=n,Ne===0&&ge(qe)),X!==n){for(tt=rn(),Ye=[],V=t.charAt(K),st.test(V)?K++:(V=n,Ne===0&&ge(et));V!==n;)Ye.push(V),V=t.charAt(K),st.test(V)?K++:(V=n,Ne===0&&ge(et));Z=[Z,X,tt,Ye],z=Z}else K=z,z=n;return Ne--,z===n&&(Z=n,Ne===0&&ge(ae)),z}function Xn(){var z,Z,X,tt,Ye,V;if(Ne++,z=K,Z=K,t.substr(K,5)===k?(X=k,K+=5):(X=n,Ne===0&&ge(bt)),X===n&&(t.substr(K,3)===T?(X=T,K+=3):(X=n,Ne===0&&ge(nn)),X===n&&(t.substr(K,5)===S?(X=S,K+=5):(X=n,Ne===0&&ge(hn)),X===n&&(t.substr(K,3)===R?(X=R,K+=3):(X=n,Ne===0&&ge(Dt)),X===n))))if(X=K,tt=t.charAt(K),je.test(tt)?K++:(tt=n,Ne===0&&ge(Pe)),tt!==n){if(Ye=[],V=t.charAt(K),Re.test(V)?K++:(V=n,Ne===0&&ge(Mn)),V!==n)for(;V!==n;)Ye.push(V),V=t.charAt(K),Re.test(V)?K++:(V=n,Ne===0&&ge(Mn));else Ye=n;Ye!==n?(tt=[tt,Ye],X=tt):(K=X,X=n)}else K=X,X=n;return X!==n?(tt=t.charAt(K),Ae.test(tt)?K++:(tt=n,Ne===0&&ge(Be)),tt===n&&(tt=null),X=[X,tt],Z=X):(K=Z,Z=n),Z!==n?z=t.substring(z,K):z=Z,Ne--,z===n&&(Z=n,Ne===0&&ge(ot)),z}function wn(){var z,Z,X;for(Ne++,z=K,Z=[],X=t.charAt(K),ue.test(X)?K++:(X=n,Ne===0&&ge(Wt));X!==n;)Z.push(X),Z.length>=2?X=n:(X=t.charAt(K),ue.test(X)?K++:(X=n,Ne===0&&ge(Wt)));return Z.length<1?(K=z,z=n):z=Z,Ne--,z===n&&(Z=n,Ne===0&&ge(Pt)),z}function ss(){var z,Z,X,tt,Ye;if(Ne++,z=K,rn(),t.charCodeAt(K)===36?(Z=O,K++):(Z=n,Ne===0&&ge(sn)),Z!==n){if(X=K,tt=[],Ye=t.charAt(K),Ze.test(Ye)?K++:(Ye=n,Ne===0&&ge(Ue)),Ye!==n)for(;Ye!==n;)tt.push(Ye),Ye=t.charAt(K),Ze.test(Ye)?K++:(Ye=n,Ne===0&&ge(Ue));else tt=n;tt!==n?X=t.substring(X,K):X=tt,X!==n?z=vs(X):(K=z,z=n)}else K=z,z=n;return Ne--,z===n&&Ne===0&&ge(On),z}function Dn(){var z;return z=jn(),z===n&&(z=ws()),z}function jn(){var z,Z,X,tt,Ye;if(Ne++,z=K,t.charCodeAt(K)===123?(Z=D,K++):(Z=n,Ne===0&&ge(ln)),Z!==n){for(X=K,tt=[],Ye=t.charAt(K),pe.test(Ye)?K++:(Ye=n,Ne===0&&ge(zn));Ye!==n;)tt.push(Ye),Ye=t.charAt(K),pe.test(Ye)?K++:(Ye=n,Ne===0&&ge(zn));X=t.substring(X,K),t.charCodeAt(K)===125?(tt=q,K++):(tt=n,Ne===0&&ge(Wn)),tt!==n?z=Hn(X):(K=z,z=n)}else K=z,z=n;return Ne--,z===n&&(Z=n,Ne===0&&ge(qt)),z}function ws(){var z,Z,X,tt,Ye;if(Ne++,z=K,t.charCodeAt(K)===59?(Z=he,K++):(Z=n,Ne===0&&ge(qn)),Z!==n){for(X=K,tt=[],Ye=t.charAt(K),$e.test(Ye)?K++:(Ye=n,Ne===0&&ge(cn));Ye!==n;)tt.push(Ye),Ye=t.charAt(K),$e.test(Ye)?K++:(Ye=n,Ne===0&&ge(cn));X=t.substring(X,K),z=Kn(X)}else K=z,z=n;return Ne--,z===n&&(Z=n,Ne===0&&ge(Ts)),z}function rs(){var z,Z,X,tt;return Ne++,z=K,rn(),t.charCodeAt(K)===40?(Z=ce,K++):(Z=n,Ne===0&&ge(ns)),Z!==n?(X=kt(),X!==n?(rn(),t.charCodeAt(K)===41?(tt=C,K++):(tt=n,Ne===0&&ge(ne)),tt!==n?z=Hs(X):(K=z,z=n)):(K=z,z=n)):(K=z,z=n),Ne--,z===n&&Ne===0&&ge(Ln),z}function Kt(){var z,Z,X;return Ne++,z=K,t.substr(K,3)===le?(Z=le,K+=3):(Z=n,Ne===0&&ge(yt)),Z===n&&(t.substr(K,3)===c?(Z=c,K+=3):(Z=n,Ne===0&&ge(Ft)),Z===n&&(t.substr(K,7)===re?(Z=re,K+=7):(Z=n,Ne===0&&ge(Lt)),Z===n&&(t.charCodeAt(K)===42?(Z=xe,K++):(Z=n,Ne===0&&ge(En))))),Z!==n?(rn(),X=Dn(),X===n&&(X=null),z=ys(Z,X)):(K=z,z=n),Ne--,z===n&&(Z=n,Ne===0&&ge(at)),z}function rn(){var z,Z;for(Ne++,z=[],Z=t.charAt(K),Y.test(Z)?K++:(Z=n,Ne===0&&ge(Qt));Z!==n;)z.push(Z),Z=t.charAt(K),Y.test(Z)?K++:(Z=n,Ne===0&&ge(Qt));return Ne--,Z=n,Ne===0&&ge(Yt),z}if(In=u(),e.peg$library)return{peg$result:In,peg$currPos:K,peg$FAILED:n,peg$maxFailExpected:An,peg$maxFailPos:Jt};if(In!==n&&K===t.length)return In;throw In!==n&&K<t.length&&ge(ie()),Bt(An,Jt<t.length?t.charAt(Jt):null,Jt<t.length?Qe(Jt,Jt+1):Qe(Jt,Jt))}const nm=0xffffffffffffffffn;function n0(t,e){return(t<<e|t>>64n-e)&0xffffffffffffffffn}function G1(t,e){return t*e&nm}function C3(t){return function(){let e=BigInt(t&nm),n=BigInt(t>>64n&nm);const r=G1(n0(G1(e,5n),7n),9n);return n^=e,e=(n0(e,24n)^n^n<<16n)&nm,n=n0(n,37n),t=n<<64n|e,r}}const fg=C3(0xa187eb39cdcaed8f31c4b365b102e01en),k3=Array.from({length:2},()=>Array.from({length:6},()=>Array.from({length:128},()=>fg()))),S3=Array.from({length:8},()=>fg()),N3=Array.from({length:16},()=>fg()),s0=fg(),Ws="w",Pr="b",ts="p",Q0="n",sm="b",Ed="r",Yo="q",ds="k",r0="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";class Wp{color;from;to;piece;captured;promotion;flags;san;lan;before;after;constructor(e,n){const{color:r,piece:a,from:u,to:h,flags:m,captured:y,promotion:x}=n,k=Ss(u),T=Ss(h);this.color=r,this.piece=a,this.from=k,this.to=T,this.san=e._moveToSan(n,e._moves({legal:!0})),this.lan=k+T,this.before=e.fen(),e._makeMove(n),this.after=e.fen(),e._undoMove(),this.flags="";for(const S in vt)vt[S]&m&&(this.flags+=Qa[S]);y&&(this.captured=y),x&&(this.promotion=x,this.lan+=x)}isCapture(){return this.flags.indexOf(Qa.CAPTURE)>-1}isPromotion(){return this.flags.indexOf(Qa.PROMOTION)>-1}isEnPassant(){return this.flags.indexOf(Qa.EP_CAPTURE)>-1}isKingsideCastle(){return this.flags.indexOf(Qa.KSIDE_CASTLE)>-1}isQueensideCastle(){return this.flags.indexOf(Qa.QSIDE_CASTLE)>-1}isBigPawn(){return this.flags.indexOf(Qa.BIG_PAWN)>-1}}const Rs=-1,Qa={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q",NULL_MOVE:"-"},vt={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64,NULL_MOVE:128},Y0={Event:"?",Site:"?",Date:"????.??.??",Round:"?",White:"?",Black:"?",Result:"*"},E3={WhiteTitle:null,BlackTitle:null,WhiteElo:null,BlackElo:null,WhiteUSCF:null,BlackUSCF:null,WhiteNA:null,BlackNA:null,WhiteType:null,BlackType:null,EventDate:null,EventSponsor:null,Section:null,Stage:null,Board:null,Opening:null,Variation:null,SubVariation:null,ECO:null,NIC:null,Time:null,UTCTime:null,UTCDate:null,TimeControl:null,SetUp:null,FEN:null,Termination:null,Annotator:null,Mode:null,PlyCount:null},T3={...Y0,...E3},gt={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},i0={b:[16,32,17,15],w:[-16,-32,-17,-15]},Q1={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},I3=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],j3=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],P3={p:1,n:2,b:4,r:8,q:16,k:32},A3="pnbrqkPNBRQK",Y1=[Q0,sm,Ed,Yo],R3=7,$3=6,M3=1,O3=0,qp={[ds]:vt.KSIDE_CASTLE,[Yo]:vt.QSIDE_CASTLE},Ko={w:[{square:gt.a1,flag:vt.QSIDE_CASTLE},{square:gt.h1,flag:vt.KSIDE_CASTLE}],b:[{square:gt.a8,flag:vt.QSIDE_CASTLE},{square:gt.h8,flag:vt.KSIDE_CASTLE}]},L3={b:M3,w:$3},o0="--";function sl(t){return t>>4}function Jd(t){return t&15}function bk(t){return"0123456789".indexOf(t)!==-1}function Ss(t){const e=Jd(t),n=sl(t);return"abcdefgh".substring(e,e+1)+"87654321".substring(n,n+1)}function kd(t){return t===Ws?Pr:Ws}function D3(t){const e=t.split(/\s+/);if(e.length!==6)return{ok:!1,error:"Invalid FEN: must contain six space-delimited fields"};const n=parseInt(e[5],10);if(isNaN(n)||n<=0)return{ok:!1,error:"Invalid FEN: move number must be a positive integer"};const r=parseInt(e[4],10);if(isNaN(r)||r<0)return{ok:!1,error:"Invalid FEN: half move counter number must be a non-negative integer"};if(!/^(-|[abcdefgh][36])$/.test(e[3]))return{ok:!1,error:"Invalid FEN: en-passant square is invalid"};if(/[^kKqQ-]/.test(e[2]))return{ok:!1,error:"Invalid FEN: castling availability is invalid"};if(!/^(w|b)$/.test(e[1]))return{ok:!1,error:"Invalid FEN: side-to-move is invalid"};const a=e[0].split("/");if(a.length!==8)return{ok:!1,error:"Invalid FEN: piece data does not contain 8 '/'-delimited rows"};for(let h=0;h<a.length;h++){let m=0,y=!1;for(let x=0;x<a[h].length;x++)if(bk(a[h][x])){if(y)return{ok:!1,error:"Invalid FEN: piece data is invalid (consecutive number)"};m+=parseInt(a[h][x],10),y=!0}else{if(!/^[prnbqkPRNBQK]$/.test(a[h][x]))return{ok:!1,error:"Invalid FEN: piece data is invalid (invalid piece)"};m+=1,y=!1}if(m!==8)return{ok:!1,error:"Invalid FEN: piece data is invalid (too many squares in rank)"}}if(e[3][1]=="3"&&e[1]=="w"||e[3][1]=="6"&&e[1]=="b")return{ok:!1,error:"Invalid FEN: illegal en-passant square"};const u=[{color:"white",regex:/K/g},{color:"black",regex:/k/g}];for(const{color:h,regex:m}of u){if(!m.test(e[0]))return{ok:!1,error:`Invalid FEN: missing ${h} king`};if((e[0].match(m)||[]).length>1)return{ok:!1,error:`Invalid FEN: too many ${h} kings`}}return Array.from(a[0]+a[7]).some(h=>h.toUpperCase()==="P")?{ok:!1,error:"Invalid FEN: some pawns are on the edge rows"}:{ok:!0}}function F3(t,e){const n=t.from,r=t.to,a=t.piece;let u=0,h=0,m=0;for(let y=0,x=e.length;y<x;y++){const k=e[y].from,T=e[y].to,S=e[y].piece;a===S&&n!==k&&r===T&&(u++,sl(n)===sl(k)&&h++,Jd(n)===Jd(k)&&m++)}return u>0?h>0&&m>0?Ss(n):m>0?Ss(n).charAt(1):Ss(n).charAt(0):""}function Go(t,e,n,r,a,u=void 0,h=vt.NORMAL){const m=sl(r);if(a===ts&&(m===R3||m===O3))for(let y=0;y<Y1.length;y++){const x=Y1[y];t.push({color:e,from:n,to:r,piece:a,captured:u,promotion:x,flags:h|vt.PROMOTION})}else t.push({color:e,from:n,to:r,piece:a,captured:u,flags:h})}function X1(t){let e=t.charAt(0);return e>="a"&&e<="h"?t.match(/[a-h]\d.*[a-h]\d/)?void 0:ts:(e=e.toLowerCase(),e==="o"?ds:e)}function a0(t){return t.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}class xt{_board=new Array(128);_turn=Ws;_header={};_kings={w:Rs,b:Rs};_epSquare=-1;_halfMoves=0;_moveNumber=0;_history=[];_comments={};_castling={w:0,b:0};_hash=0n;_positionCount=new Map;constructor(e=r0,{skipValidation:n=!1}={}){this.load(e,{skipValidation:n})}clear({preserveHeaders:e=!1}={}){this._board=new Array(128),this._kings={w:Rs,b:Rs},this._turn=Ws,this._castling={w:0,b:0},this._epSquare=Rs,this._halfMoves=0,this._moveNumber=1,this._history=[],this._comments={},this._header=e?this._header:{...T3},this._hash=this._computeHash(),this._positionCount=new Map,this._header.SetUp=null,this._header.FEN=null}load(e,{skipValidation:n=!1,preserveHeaders:r=!1}={}){let a=e.split(/\s+/);if(a.length>=2&&a.length<6){const m=["-","-","0","1"];e=a.concat(m.slice(-(6-a.length))).join(" ")}if(a=e.split(/\s+/),!n){const{ok:m,error:y}=D3(e);if(!m)throw new Error(y)}const u=a[0];let h=0;this.clear({preserveHeaders:r});for(let m=0;m<u.length;m++){const y=u.charAt(m);if(y==="/")h+=8;else if(bk(y))h+=parseInt(y,10);else{const x=y<"a"?Ws:Pr;this._put({type:y.toLowerCase(),color:x},Ss(h)),h++}}this._turn=a[1],a[2].indexOf("K")>-1&&(this._castling.w|=vt.KSIDE_CASTLE),a[2].indexOf("Q")>-1&&(this._castling.w|=vt.QSIDE_CASTLE),a[2].indexOf("k")>-1&&(this._castling.b|=vt.KSIDE_CASTLE),a[2].indexOf("q")>-1&&(this._castling.b|=vt.QSIDE_CASTLE),this._epSquare=a[3]==="-"?Rs:gt[a[3]],this._halfMoves=parseInt(a[4],10),this._moveNumber=parseInt(a[5],10),this._hash=this._computeHash(),this._updateSetup(e),this._incPositionCount()}fen({forceEnpassantSquare:e=!1}={}){let n=0,r="";for(let h=gt.a8;h<=gt.h1;h++){if(this._board[h]){n>0&&(r+=n,n=0);const{color:m,type:y}=this._board[h];r+=m===Ws?y.toUpperCase():y.toLowerCase()}else n++;h+1&136&&(n>0&&(r+=n),h!==gt.h1&&(r+="/"),n=0,h+=8)}let a="";this._castling[Ws]&vt.KSIDE_CASTLE&&(a+="K"),this._castling[Ws]&vt.QSIDE_CASTLE&&(a+="Q"),this._castling[Pr]&vt.KSIDE_CASTLE&&(a+="k"),this._castling[Pr]&vt.QSIDE_CASTLE&&(a+="q"),a=a||"-";let u="-";if(this._epSquare!==Rs)if(e)u=Ss(this._epSquare);else{const h=this._epSquare+(this._turn===Ws?16:-16),m=[h+1,h-1];for(const y of m){if(y&136)continue;const x=this._turn;if(this._board[y]?.color===x&&this._board[y]?.type===ts){this._makeMove({color:x,from:y,to:this._epSquare,piece:ts,captured:ts,flags:vt.EP_CAPTURE});const k=!this._isKingAttacked(x);if(this._undoMove(),k){u=Ss(this._epSquare);break}}}}return[r,this._turn,a,u,this._halfMoves,this._moveNumber].join(" ")}_pieceKey(e){if(!this._board[e])return 0n;const{color:n,type:r}=this._board[e],a={w:0,b:1}[n],u={p:0,n:1,b:2,r:3,q:4,k:5}[r];return k3[a][u][e]}_epKey(){return this._epSquare===Rs?0n:S3[this._epSquare&7]}_castlingKey(){const e=this._castling.w>>5|this._castling.b>>3;return N3[e]}_computeHash(){let e=0n;for(let n=gt.a8;n<=gt.h1;n++){if(n&136){n+=7;continue}this._board[n]&&(e^=this._pieceKey(n))}return e^=this._epKey(),e^=this._castlingKey(),this._turn==="b"&&(e^=s0),e}_updateSetup(e){this._history.length>0||(e!==r0?(this._header.SetUp="1",this._header.FEN=e):(this._header.SetUp=null,this._header.FEN=null))}reset(){this.load(r0)}get(e){return this._board[gt[e]]}findPiece(e){const n=[];for(let r=gt.a8;r<=gt.h1;r++){if(r&136){r+=7;continue}!this._board[r]||this._board[r]?.color!==e.color||this._board[r].color===e.color&&this._board[r].type===e.type&&n.push(Ss(r))}return n}put({type:e,color:n},r){return this._put({type:e,color:n},r)?(this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),!0):!1}_set(e,n){this._hash^=this._pieceKey(e),this._board[e]=n,this._hash^=this._pieceKey(e)}_put({type:e,color:n},r){if(A3.indexOf(e.toLowerCase())===-1||!(r in gt))return!1;const a=gt[r];if(e==ds&&!(this._kings[n]==Rs||this._kings[n]==a))return!1;const u=this._board[a];return u&&u.type===ds&&(this._kings[u.color]=Rs),this._set(a,{type:e,color:n}),e===ds&&(this._kings[n]=a),!0}_clear(e){this._hash^=this._pieceKey(e),delete this._board[e]}remove(e){const n=this.get(e);return this._clear(gt[e]),n&&n.type===ds&&(this._kings[n.color]=Rs),this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),n}_updateCastlingRights(){this._hash^=this._castlingKey();const e=this._board[gt.e1]?.type===ds&&this._board[gt.e1]?.color===Ws,n=this._board[gt.e8]?.type===ds&&this._board[gt.e8]?.color===Pr;(!e||this._board[gt.a1]?.type!==Ed||this._board[gt.a1]?.color!==Ws)&&(this._castling.w&=-65),(!e||this._board[gt.h1]?.type!==Ed||this._board[gt.h1]?.color!==Ws)&&(this._castling.w&=-33),(!n||this._board[gt.a8]?.type!==Ed||this._board[gt.a8]?.color!==Pr)&&(this._castling.b&=-65),(!n||this._board[gt.h8]?.type!==Ed||this._board[gt.h8]?.color!==Pr)&&(this._castling.b&=-33),this._hash^=this._castlingKey()}_updateEnPassantSquare(){if(this._epSquare===Rs)return;const e=this._epSquare+(this._turn===Ws?-16:16),n=this._epSquare+(this._turn===Ws?16:-16),r=[n+1,n-1];if(this._board[e]!==null||this._board[this._epSquare]!==null||this._board[n]?.color!==kd(this._turn)||this._board[n]?.type!==ts){this._hash^=this._epKey(),this._epSquare=Rs;return}const a=u=>!(u&136)&&this._board[u]?.color===this._turn&&this._board[u]?.type===ts;r.some(a)||(this._hash^=this._epKey(),this._epSquare=Rs)}_attacked(e,n,r){const a=[];for(let u=gt.a8;u<=gt.h1;u++){if(u&136){u+=7;continue}if(this._board[u]===void 0||this._board[u].color!==e)continue;const h=this._board[u],m=u-n;if(m===0)continue;const y=m+119;if(I3[y]&P3[h.type]){if(h.type===ts){if(m>0&&h.color===Ws||m<=0&&h.color===Pr)if(r)a.push(Ss(u));else return!0;continue}if(h.type==="n"||h.type==="k")if(r){a.push(Ss(u));continue}else return!0;const x=j3[y];let k=u+x,T=!1;for(;k!==n;){if(this._board[k]!=null){T=!0;break}k+=x}if(!T)if(r){a.push(Ss(u));continue}else return!0}}return r?a:!1}attackers(e,n){return n?this._attacked(n,gt[e],!0):this._attacked(this._turn,gt[e],!0)}_isKingAttacked(e){const n=this._kings[e];return n===-1?!1:this._attacked(kd(e),n)}hash(){return this._hash.toString(16)}isAttacked(e,n){return this._attacked(n,gt[e])}isCheck(){return this._isKingAttacked(this._turn)}inCheck(){return this.isCheck()}isCheckmate(){return this.isCheck()&&this._moves().length===0}isStalemate(){return!this.isCheck()&&this._moves().length===0}isInsufficientMaterial(){const e={b:0,n:0,r:0,q:0,k:0,p:0},n=[];let r=0,a=0;for(let u=gt.a8;u<=gt.h1;u++){if(a=(a+1)%2,u&136){u+=7;continue}const h=this._board[u];h&&(e[h.type]=h.type in e?e[h.type]+1:1,h.type===sm&&n.push(a),r++)}if(r===2)return!0;if(r===3&&(e[sm]===1||e[Q0]===1))return!0;if(r===e[sm]+2){let u=0;const h=n.length;for(let m=0;m<h;m++)u+=n[m];if(u===0||u===h)return!0}return!1}isThreefoldRepetition(){return this._getPositionCount(this._hash)>=3}isDrawByFiftyMoves(){return this._halfMoves>=100}isDraw(){return this.isDrawByFiftyMoves()||this.isStalemate()||this.isInsufficientMaterial()||this.isThreefoldRepetition()}isGameOver(){return this.isCheckmate()||this.isDraw()}moves({verbose:e=!1,square:n=void 0,piece:r=void 0}={}){const a=this._moves({square:n,piece:r});return e?a.map(u=>new Wp(this,u)):a.map(u=>this._moveToSan(u,a))}_moves({legal:e=!0,piece:n=void 0,square:r=void 0}={}){const a=r?r.toLowerCase():void 0,u=n?.toLowerCase(),h=[],m=this._turn,y=kd(m);let x=gt.a8,k=gt.h1,T=!1;if(a)if(a in gt)x=k=gt[a],T=!0;else return[];for(let R=x;R<=k;R++){if(R&136){R+=7;continue}if(!this._board[R]||this._board[R].color===y)continue;const{type:O}=this._board[R];let D;if(O===ts){if(u&&u!==O)continue;D=R+i0[m][0],this._board[D]||(Go(h,m,R,D,ts),D=R+i0[m][1],L3[m]===sl(R)&&!this._board[D]&&Go(h,m,R,D,ts,void 0,vt.BIG_PAWN));for(let q=2;q<4;q++)D=R+i0[m][q],!(D&136)&&(this._board[D]?.color===y?Go(h,m,R,D,ts,this._board[D].type,vt.CAPTURE):D===this._epSquare&&Go(h,m,R,D,ts,ts,vt.EP_CAPTURE))}else{if(u&&u!==O)continue;for(let q=0,he=Q1[O].length;q<he;q++){const ce=Q1[O][q];for(D=R;D+=ce,!(D&136);){if(!this._board[D])Go(h,m,R,D,O);else{if(this._board[D].color===m)break;Go(h,m,R,D,O,this._board[D].type,vt.CAPTURE);break}if(O===Q0||O===ds)break}}}}if((u===void 0||u===ds)&&(!T||k===this._kings[m])){if(this._castling[m]&vt.KSIDE_CASTLE){const R=this._kings[m],O=R+2;!this._board[R+1]&&!this._board[O]&&!this._attacked(y,this._kings[m])&&!this._attacked(y,R+1)&&!this._attacked(y,O)&&Go(h,m,this._kings[m],O,ds,void 0,vt.KSIDE_CASTLE)}if(this._castling[m]&vt.QSIDE_CASTLE){const R=this._kings[m],O=R-2;!this._board[R-1]&&!this._board[R-2]&&!this._board[R-3]&&!this._attacked(y,this._kings[m])&&!this._attacked(y,R-1)&&!this._attacked(y,O)&&Go(h,m,this._kings[m],O,ds,void 0,vt.QSIDE_CASTLE)}}if(!e||this._kings[m]===-1)return h;const S=[];for(let R=0,O=h.length;R<O;R++)this._makeMove(h[R]),this._isKingAttacked(m)||S.push(h[R]),this._undoMove();return S}move(e,{strict:n=!1}={}){let r=null;if(typeof e=="string")r=this._moveFromSan(e,n);else if(e===null)r=this._moveFromSan(o0,n);else if(typeof e=="object"){const u=this._moves();for(let h=0,m=u.length;h<m;h++)if(e.from===Ss(u[h].from)&&e.to===Ss(u[h].to)&&(!("promotion"in u[h])||e.promotion===u[h].promotion)){r=u[h];break}}if(!r)throw typeof e=="string"?new Error(`Invalid move: ${e}`):new Error(`Invalid move: ${JSON.stringify(e)}`);if(this.isCheck()&&r.flags&vt.NULL_MOVE)throw new Error("Null move not allowed when in check");const a=new Wp(this,r);return this._makeMove(r),this._incPositionCount(),a}_push(e){this._history.push({move:e,kings:{b:this._kings.b,w:this._kings.w},turn:this._turn,castling:{b:this._castling.b,w:this._castling.w},epSquare:this._epSquare,halfMoves:this._halfMoves,moveNumber:this._moveNumber})}_movePiece(e,n){this._hash^=this._pieceKey(e),this._board[n]=this._board[e],delete this._board[e],this._hash^=this._pieceKey(n)}_makeMove(e){const n=this._turn,r=kd(n);if(this._push(e),e.flags&vt.NULL_MOVE){n===Pr&&this._moveNumber++,this._halfMoves++,this._turn=r,this._epSquare=Rs;return}if(this._hash^=this._epKey(),this._hash^=this._castlingKey(),e.captured&&(this._hash^=this._pieceKey(e.to)),this._movePiece(e.from,e.to),e.flags&vt.EP_CAPTURE&&(this._turn===Pr?this._clear(e.to-16):this._clear(e.to+16)),e.promotion&&(this._clear(e.to),this._set(e.to,{type:e.promotion,color:n})),this._board[e.to].type===ds){if(this._kings[n]=e.to,e.flags&vt.KSIDE_CASTLE){const a=e.to-1,u=e.to+1;this._movePiece(u,a)}else if(e.flags&vt.QSIDE_CASTLE){const a=e.to+1,u=e.to-2;this._movePiece(u,a)}this._castling[n]=0}if(this._castling[n]){for(let a=0,u=Ko[n].length;a<u;a++)if(e.from===Ko[n][a].square&&this._castling[n]&Ko[n][a].flag){this._castling[n]^=Ko[n][a].flag;break}}if(this._castling[r]){for(let a=0,u=Ko[r].length;a<u;a++)if(e.to===Ko[r][a].square&&this._castling[r]&Ko[r][a].flag){this._castling[r]^=Ko[r][a].flag;break}}if(this._hash^=this._castlingKey(),e.flags&vt.BIG_PAWN){let a;n===Pr?a=e.to-16:a=e.to+16,!(e.to-1&136)&&this._board[e.to-1]?.type===ts&&this._board[e.to-1]?.color===r||!(e.to+1&136)&&this._board[e.to+1]?.type===ts&&this._board[e.to+1]?.color===r?(this._epSquare=a,this._hash^=this._epKey()):this._epSquare=Rs}else this._epSquare=Rs;e.piece===ts?this._halfMoves=0:e.flags&(vt.CAPTURE|vt.EP_CAPTURE)?this._halfMoves=0:this._halfMoves++,n===Pr&&this._moveNumber++,this._turn=r,this._hash^=s0}undo(){const e=this._hash,n=this._undoMove();if(n){const r=new Wp(this,n);return this._decPositionCount(e),r}return null}_undoMove(){const e=this._history.pop();if(e===void 0)return null;this._hash^=this._epKey(),this._hash^=this._castlingKey();const n=e.move;this._kings=e.kings,this._turn=e.turn,this._castling=e.castling,this._epSquare=e.epSquare,this._halfMoves=e.halfMoves,this._moveNumber=e.moveNumber,this._hash^=this._epKey(),this._hash^=this._castlingKey(),this._hash^=s0;const r=this._turn,a=kd(r);if(n.flags&vt.NULL_MOVE)return n;if(this._movePiece(n.to,n.from),n.piece&&(this._clear(n.from),this._set(n.from,{type:n.piece,color:r})),n.captured)if(n.flags&vt.EP_CAPTURE){let u;r===Pr?u=n.to-16:u=n.to+16,this._set(u,{type:ts,color:a})}else this._set(n.to,{type:n.captured,color:a});if(n.flags&(vt.KSIDE_CASTLE|vt.QSIDE_CASTLE)){let u,h;n.flags&vt.KSIDE_CASTLE?(u=n.to+1,h=n.to-1):(u=n.to-2,h=n.to+1),this._movePiece(h,u)}return n}pgn({newline:e=`
`,maxWidth:n=0}={}){const r=[];let a=!1;for(const S in this._header)this._header[S]&&r.push(`[${S} "${this._header[S]}"]`+e),a=!0;a&&this._history.length&&r.push(e);const u=S=>{const R=this._comments[this.fen()];if(typeof R<"u"){const O=S.length>0?" ":"";S=`${S}${O}{${R}}`}return S},h=[];for(;this._history.length>0;)h.push(this._undoMove());const m=[];let y="";for(h.length===0&&m.push(u(""));h.length>0;){y=u(y);const S=h.pop();if(!S)break;if(!this._history.length&&S.color==="b"){const R=`${this._moveNumber}. ...`;y=y?`${y} ${R}`:R}else S.color==="w"&&(y.length&&m.push(y),y=this._moveNumber+".");y=y+" "+this._moveToSan(S,this._moves({legal:!0})),this._makeMove(S)}if(y.length&&m.push(u(y)),m.push(this._header.Result||"*"),n===0)return r.join("")+m.join(" ");const x=function(){return r.length>0&&r[r.length-1]===" "?(r.pop(),!0):!1},k=function(S,R){for(const O of R.split(" "))if(O){if(S+O.length>n){for(;x();)S--;r.push(e),S=0}r.push(O),S+=O.length,r.push(" "),S++}return x()&&S--,S};let T=0;for(let S=0;S<m.length;S++){if(T+m[S].length>n&&m[S].includes("{")){T=k(T,m[S]);continue}T+m[S].length>n&&S!==0?(r[r.length-1]===" "&&r.pop(),r.push(e),T=0):S!==0&&(r.push(" "),T++),r.push(m[S]),T+=m[S].length}return r.join("")}header(...e){for(let n=0;n<e.length;n+=2)typeof e[n]=="string"&&typeof e[n+1]=="string"&&(this._header[e[n]]=e[n+1]);return this._header}setHeader(e,n){return this._header[e]=n??Y0[e]??null,this.getHeaders()}removeHeader(e){return e in this._header?(this._header[e]=Y0[e]||null,!0):!1}getHeaders(){const e={};for(const[n,r]of Object.entries(this._header))r!==null&&(e[n]=r);return e}loadPgn(e,{strict:n=!1,newlineChar:r=`\r?
`}={}){r!==`\r?
`&&(e=e.replace(new RegExp(r,"g"),`
`));const a=b3(e);this.reset();const u=a.headers;let h="";for(const x in u)x.toLowerCase()==="fen"&&(h=u[x]),this.header(x,u[x]);if(!n)h&&this.load(h,{preserveHeaders:!0});else if(u.SetUp==="1"){if(!("FEN"in u))throw new Error("Invalid PGN: FEN tag must be supplied with SetUp tag");this.load(u.FEN,{preserveHeaders:!0})}let m=a.root;for(;m;){if(m.move){const x=this._moveFromSan(m.move,n);if(x==null)throw new Error(`Invalid move in PGN: ${m.move}`);this._makeMove(x),this._incPositionCount()}m.comment!==void 0&&(this._comments[this.fen()]=m.comment),m=m.variations[0]}const y=a.result;y&&Object.keys(this._header).length&&this._header.Result!==y&&this.setHeader("Result",y)}_moveToSan(e,n){let r="";if(e.flags&vt.KSIDE_CASTLE)r="O-O";else if(e.flags&vt.QSIDE_CASTLE)r="O-O-O";else{if(e.flags&vt.NULL_MOVE)return o0;if(e.piece!==ts){const a=F3(e,n);r+=e.piece.toUpperCase()+a}e.flags&(vt.CAPTURE|vt.EP_CAPTURE)&&(e.piece===ts&&(r+=Ss(e.from)[0]),r+="x"),r+=Ss(e.to),e.promotion&&(r+="="+e.promotion.toUpperCase())}return this._makeMove(e),this.isCheck()&&(this.isCheckmate()?r+="#":r+="+"),this._undoMove(),r}_moveFromSan(e,n=!1){let r=a0(e);if(n||(r==="0-0"?r="O-O":r==="0-0-0"&&(r="O-O-O")),r==o0)return{color:this._turn,from:0,to:0,piece:"k",flags:vt.NULL_MOVE};let a=X1(r),u=this._moves({legal:!0,piece:a});for(let S=0,R=u.length;S<R;S++)if(r===a0(this._moveToSan(u[S],u)))return u[S];if(n)return null;let h,m,y,x,k,T=!1;if(m=r.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/),m?(h=m[1],y=m[2],x=m[3],k=m[4],y.length==1&&(T=!0)):(m=r.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/),m&&(h=m[1],y=m[2],x=m[3],k=m[4],y.length==1&&(T=!0))),a=X1(r),u=this._moves({legal:!0,piece:h||a}),!x)return null;for(let S=0,R=u.length;S<R;S++)if(y){if((!h||h.toLowerCase()==u[S].piece)&&gt[y]==u[S].from&&gt[x]==u[S].to&&(!k||k.toLowerCase()==u[S].promotion))return u[S];if(T){const O=Ss(u[S].from);if((!h||h.toLowerCase()==u[S].piece)&&gt[x]==u[S].to&&(y==O[0]||y==O[1])&&(!k||k.toLowerCase()==u[S].promotion))return u[S]}}else if(r===a0(this._moveToSan(u[S],u)).replace("x",""))return u[S];return null}ascii(){let e=`   +------------------------+
`;for(let n=gt.a8;n<=gt.h1;n++){if(Jd(n)===0&&(e+=" "+"87654321"[sl(n)]+" |"),this._board[n]){const r=this._board[n].type,u=this._board[n].color===Ws?r.toUpperCase():r.toLowerCase();e+=" "+u+" "}else e+=" . ";n+1&136&&(e+=`|
`,n+=8)}return e+=`   +------------------------+
`,e+="     a  b  c  d  e  f  g  h",e}perft(e){const n=this._moves({legal:!1});let r=0;const a=this._turn;for(let u=0,h=n.length;u<h;u++)this._makeMove(n[u]),this._isKingAttacked(a)||(e-1>0?r+=this.perft(e-1):r++),this._undoMove();return r}setTurn(e){return this._turn==e?!1:(this.move("--"),!0)}turn(){return this._turn}board(){const e=[];let n=[];for(let r=gt.a8;r<=gt.h1;r++)this._board[r]==null?n.push(null):n.push({square:Ss(r),type:this._board[r].type,color:this._board[r].color}),r+1&136&&(e.push(n),n=[],r+=8);return e}squareColor(e){if(e in gt){const n=gt[e];return(sl(n)+Jd(n))%2===0?"light":"dark"}return null}history({verbose:e=!1}={}){const n=[],r=[];for(;this._history.length>0;)n.push(this._undoMove());for(;;){const a=n.pop();if(!a)break;e?r.push(new Wp(this,a)):r.push(this._moveToSan(a,this._moves())),this._makeMove(a)}return r}_getPositionCount(e){return this._positionCount.get(e)??0}_incPositionCount(){this._positionCount.set(this._hash,(this._positionCount.get(this._hash)??0)+1)}_decPositionCount(e){const n=this._positionCount.get(e)??0;n===1?this._positionCount.delete(e):this._positionCount.set(e,n-1)}_pruneComments(){const e=[],n={},r=a=>{a in this._comments&&(n[a]=this._comments[a])};for(;this._history.length>0;)e.push(this._undoMove());for(r(this.fen());;){const a=e.pop();if(!a)break;this._makeMove(a),r(this.fen())}this._comments=n}getComment(){return this._comments[this.fen()]}setComment(e){this._comments[this.fen()]=e.replace("{","[").replace("}","]")}deleteComment(){return this.removeComment()}removeComment(){const e=this._comments[this.fen()];return delete this._comments[this.fen()],e}getComments(){return this._pruneComments(),Object.keys(this._comments).map(e=>({fen:e,comment:this._comments[e]}))}deleteComments(){return this.removeComments()}removeComments(){return this._pruneComments(),Object.keys(this._comments).map(e=>{const n=this._comments[e];return delete this._comments[e],{fen:e,comment:n}})}setCastlingRights(e,n){for(const a of[ds,Yo])n[a]!==void 0&&(n[a]?this._castling[e]|=qp[a]:this._castling[e]&=~qp[a]);this._updateCastlingRights();const r=this.getCastlingRights(e);return(n[ds]===void 0||n[ds]===r[ds])&&(n[Yo]===void 0||n[Yo]===r[Yo])}getCastlingRights(e){return{[ds]:(this._castling[e]&qp[ds])!==0,[Yo]:(this._castling[e]&qp[Yo])!==0}}moveNumber(){return this._moveNumber}}const Ck="/assets/Mac%20Cursor%20Open%20Hand-C_Ak_Ehz.png",Fm="/assets/Mac%20Cursor%20Closed%20Hand-DIpKCVw4.png",kk="/assets/The%20South%20Pawn-BbpenvYx.png",Sk="/assets/The%20South%20Bishop-DRbm-kYq.png",U3={opening:["Welcome to the board. Don't blink-you'll miss your chance.","The South Knight arrives. Let's see if you survive more than ten moves.","I hope you brought a plan. You'll need more than hope to beat me.","I don't take prisoners. Make your first move count.","The game begins. Step carefully-I strike from angles you can't see."],neutral:["Your move reveals more than you think.","I see through your strategy like glass.","That square belongs to me now.","You're playing checkers-I'm playing war.","The board is shrinking for you.","Pressure makes diamonds-or it breaks players.","Every move you make is another chance for me to punish you.","You're opening doors you won't be able to close."],weak:["You sure about that?","I've seen better moves in the pawn section.","That move screams panic.","I smelled that blunder from the opening.","Your pieces look uncomfortable.","Bold. Wrong, but bold.","That's the kind of move I feed on."],strong:["Impressive. But you won't keep that up.","A good move-finally.","Even the sun shines on a pawn some days.","I felt that one. Let's see what else you've got.","Alright, you earned my attention."],attack:["I warned you-I strike from the side.","Your king looks lonely. Let me help.","Check is just the beginning.","I'm not here to trade. I'm here to crush.","You opened the door. I'm walking through."],sacrifice:["A little chaos never hurt me.","I don't need pieces. I need initiative.","Sacrifices are the language of the brave.","I'm all-in. Try to keep up."],endgame:["This board belongs to me now.","Your king is running out of places to hide.","No more tricks. Just consequences.","Every move brings you closer to checkmate.","I already see the end. Do you?"],win:["Game over. Welcome to the South.","Checkmate. Remember the name-South Knight.","Another challenger falls.","You played well. I played better.","That's how a knight ends a battle."],defeat:["Well played. Even warriors fall.","You earned that one. Respect.","I'll be back-stronger.","Good game. Don't get comfortable."]},Ki={opening:["Small? Me? Watch closely. I become anything I want on the 8th rank.","I may start as a pawn but I dont plan on staying one.","Everyone underestimates the pawnperfect. Makes my victories feel better.","Lets see what youve prepared. Im curious. Curious and ready."],neutral:["I only need one square. One step. One chance. Then I take the whole board.","You think you stopped me? Cute. I have seven more brothers.","Ah, strategy I like watching you try.","Move aside, big pieces. Let the future queen through.","Every file is a battlefield, and Im built for war."],capture:["Out of my way. The throne is calling.","Another one falls. My path gets clearer.","Tiny? Yes. Harmless? No."],blunder:["Hmm that didnt look right. Whatever. Still winning.","Oh? Was that bad? I learn by doing and you learn by losing.","Mistake? I call it improvisation."],winning:["This board feels small or maybe Im just too strong.","I told you: underestimate the pawn, overpay in losses.","Look at thatone step closer to greatness."],endgame:["Only a few of us remain. Perfect. Less noise while I rise.","Endgame? Thats where pawns become monsters.","One square. One dream. One crown."],win:["From pawn to ruler. Story of my life.","I warned youI dont stay weak for long.","This board is mine now. Next opponent.","Promotion achieved. Checkmate delivered."],defeat:["Even kings fall. Ill rise again.","You won this one but my ambition doesnt die.","A setback? Hardly. I start every game reborn."]},B3={opening:["The diagonals are mine to command. Shall we begin?","Lets see if you can navigate the subtleties of long-range warfare.","Be carefulmy influence often arrives before I do.","A single diagonal can decide a game. I intend to control them all."],neutral:["Your position is developing in interestingly exploitable ways.","Long-term pressure is my specialty. I hope youre patient.","I see lines you havent even imagined yet.","A bishop doesnt rush. We wait, and then we strike.","Every square you weaken becomes my invitation."],attack:["Elegant. Precise. Expected.","You left that diagonal open? Ill make use of it.","Ah, a weakness. How thoughtful of you.","Ill take initiative from here.","Feel that tension? Thats me, tightening the diagonals.","You're running out of safe squares.","Your king seems uncomfortable. Shall I assist with that?","Pressure is a language, and I speak it fluently.","Removed. Efficiently.","One less obstacle between us.","Control the diagonals, control the game."],sacrifice:["Hmm that may not have been ideal. But the game continues.","Even vision can blur. Lets correct the course.","Curious. I misjudged that plan. Lets see how you answer."],endgame:["Fewer pieces clearer diagonals.","Now we see who truly understands structure.","Precision matters most in the end."],win:["The diagonals favor me today.","Your position collapses exactly as predicted.","Order restored. The board is mine once again.","All lines converged to this moment. Checkmate.","A beautiful finish. I hope you took notes.","Strategy triumphs again."],defeat:["Even masters misjudge a position. I will adjust.","Youve gained the advantage for now.","A strategic setback, nothing more.","Even the wisest fall. I will return sharper.","A rare miscalculation. Well played.","I concede for now."]},Gi=(t,e)=>{if(t==="pawn")switch(e){case"opening":return Ki.opening;case"neutral":return Ki.neutral;case"attack":return[...Ki.capture,...Ki.winning];case"sacrifice":return Ki.blunder;case"endgame":return Ki.endgame;case"win":return Ki.win;case"defeat":return Ki.defeat;default:return Ki.neutral}else if(t==="bishop")return B3[e]||[];return U3[e]||[]},tl={knight:{id:"knight",name:"The South Knight",avatar:Xd,skill:20,depth:20,label:"2500 Elo",difficulty:"2500 Elo"},bishop:{id:"bishop",name:"The South Bishop",avatar:Sk,skill:10,depth:12,label:"1500 Elo",difficulty:"1500 Elo"},pawn:{id:"pawn",name:"The South Pawn",avatar:kk,skill:2,depth:5,label:"800 Elo",difficulty:"800 Elo"}},Vp=[tl.knight,tl.bishop,tl.pawn],J1=()=>({pawn:{losingMode:!1,lastEvalCp:0,lastMateThreat:!1},bishop:{losingMode:!1,lastEvalCp:0,lastMateThreat:!1},knight:{losingMode:!1,lastEvalCp:0,lastMateThreat:!1}});function Qi(t,e){return Math.floor(Math.random()*(e-t+1))+t}function Z1(t){const e=t.trim().split(/\s+/),n=e.indexOf("bestmove");if(n===-1||!e[n+1])return null;const r=e[n+1];if(r.length<4)return null;const a=r.slice(0,2),u=r.slice(2,4),h=r[4];return{from:a,to:u,promotion:h||void 0}}function z3(){const{user:t}=$r(),e=j.useRef(new xt),n=j.useRef(e.current.fen()),r=j.useRef(null),a=j.useRef({value:0}),u=j.useRef(null),h=j.useRef({gameId:0,entries:[]}),[m,y]=j.useState(!1),[x,k]=j.useState("w"),[T,S]=j.useState(""),[R,O]=j.useState(""),[D,q]=j.useState(e.current.fen()),[he,ce]=j.useState(null),[C,le]=j.useState(null),[c,re]=j.useState("Engine loading..."),[xe,je]=j.useState(!1),[Fe,Ze]=j.useState("Booting Stockfish..."),[st,Re]=j.useState(!1),[Ae,ue]=j.useState("w"),[pe,$e]=j.useState([]),Y=j.useRef({value:0}),[J,Se]=j.useState([]),de=j.useRef({value:!1}),[$,ee]=j.useState(new Set),[Pe,Ee]=j.useState(null),[G,ae]=j.useState(null),[Ue,qe]=j.useState([]),[et,ot]=j.useState(!1),[bt,nn]=j.useState(!1),hn=ai(t?.boardTheme).colors,{key:Dt,pieces:Mn}=j.useMemo(()=>Br(t?.pieceTheme),[t?.pieceTheme]),[Be,Pt]=j.useState(!1),[Wt,On]=j.useState(Vp[0].id),sn=Vp.find(W=>W.id===Wt)||Vp[0],qt=j.useRef(Wt),ln=j.useRef(J1()),[zn,Wn]=j.useState(null),[Ts,qn]=j.useState([]);j.useEffect(()=>{qt.current=Wt,ln.current[Wt]={losingMode:!1,lastEvalCp:0,lastMateThreat:!1}},[Wt]);const cn=W=>{typeof document>"u"||(document.body.style.cursor=W?`url(${Fm}) 8 8, grabbing`:"")};j.useEffect(()=>()=>{cn(!1)},[]),j.useEffect(()=>{const W=()=>cn(!1);return window.addEventListener("mouseup",W),window.addEventListener("dragend",W),()=>{window.removeEventListener("mouseup",W),window.removeEventListener("dragend",W)}},[]);const Ln=W=>{if(de.current.value)return;de.current.value=!0;const ie=W==="win"?150:W==="loss"?75:112;t&&aw(t.id,ie,{source:`practice_${W}`})},ns=W=>W?W.color==="w"?Mn.w[W.type]:Mn.b[W.type]:null,ne=W=>!W||W.type!=="p"?"":Dt==="chesscom"?W.color==="w"?"scale-110":"scale-90":Dt==="freestyle"&&W.color==="b"?"scale-110":"",at=(W,ie)=>{const se="abcdefgh"[Ae==="w"?ie:7-ie],ke=Ae==="w"?8-W:W+1;return`${se}${ke}`},yt=j.useMemo(()=>{const ie=new xt(D).board();return Ae==="w"?ie:ie.slice().reverse().map(se=>se.slice().reverse())},[D,Ae]),Ft=j.useMemo(()=>he?new xt(D).moves({square:he,verbose:!0}):[],[D,he]),Lt=j.useMemo(()=>Ts.reduce((W,ie,se)=>(se%2===0?W.push({num:W.length+1,white:ie,black:""}):W[W.length-1].black=ie,W),[]),[Ts]),En=W=>{$e(W?[W]:[])},Yt=(W,ie)=>{const se=ie?Gi(qt.current,ie):W;if(!se.length)return;const ke=se[Math.floor(Math.random()*se.length)];En(ke)},Qt=(W,ie)=>{const se=Y.current.value;se>0&&se%5===0&&Yt(W,ie)},Xt=(W,ie)=>{const se=at(W,ie);ee(ke=>{const Qe=new Set(ke);return Qe.has(se)?Qe.delete(se):Qe.add(se),Qe})},Tn=(W,ie)=>{const se=at(W,ie);Ee({row:W,col:ie,square:se}),ae(null),ot(!1)},gs=(W,ie,se)=>{if(!Pe||se!==2)return;const ke=at(W,ie);if(Pe.square===ke){ot(!1),ae(null);return}ot(!0),ae({row:W,col:ie,square:ke})},Vn=()=>{Pe&&et&&G?(qe(W=>[...W,{start:Pe,end:G}]),nn(!0)):Pe&&!et&&(Xt(Pe.row,Pe.col),nn(!0)),ot(!1),Ee(null),ae(null)},Sn=(W,ie)=>{const se=new xt(W),ke={p:1,n:3,b:3,r:5,q:9,k:0};let Qe=0;return se.board().forEach(ge=>ge.forEach(Bt=>{if(!Bt)return;const Nt=ke[Bt.type];Qe+=Bt.color===ie?Nt:-Nt})),Qe},Is=W=>{const ie=n.current,se=ie?new xt(ie):new xt;if(Ts.forEach(ke=>{try{se.move(ke,{sloppy:!0})}catch{}}),W&&se.fen()!==W)try{return new xt(W)}catch{return se}return se},vs=W=>W.filter(ie=>ie&&ie.move).map(ie=>({...ie})).sort((ie,se)=>(se?.score??-999999)-(ie?.score??-999999)),Hn=W=>{const ie=vs(W.entries),se=ie[0];if(!se)return{move:null,bestScore:0,mateThreat:!1,aboutToLose:!1};const ke=se.score??0,Qe=se.type==="mate"&&se.score<0,ge=Qe||ke<=-500||W.materialBalance<=-5;if(W.botState.losingMode||ge)return{move:se,bestScore:ke,mateThreat:Qe,aboutToLose:ge};const Nt=300,Rt=ie.filter((ut,Ct)=>{if(Ct===0||ut.type==="mate"&&ut.score<0)return!1;const kt=(se.score??0)-(ut.score??0);return kt>=60&&kt<=Nt}),lt=ie.filter((ut,Ct)=>Ct>0&&!(ut.type==="mate"&&ut.score<0));let nt=Rt.length?Rt[Qi(0,Rt.length-1)]:null;return!nt&&lt.length&&(nt=lt[Qi(0,lt.length-1)]),nt?(se.score??0)-(nt.score??0)>Nt&&(nt=ie.find((kt,Vt)=>Vt>0&&(se.score??0)-(kt.score??0)<=Nt&&!(kt.type==="mate"&&kt.score<0))||se):nt=se,{move:nt,bestScore:ke,mateThreat:Qe,aboutToLose:!1}},Kn=W=>{const ie=vs(W.entries),se=ie[0];if(!se)return{move:null,bestScore:0,mateThreat:!1,aboutToLose:!1};const ke=se.score??0,Qe=se.type==="mate"&&se.score<0,ge=Qe||ke<=-400||W.materialBalance<=-3;if(W.botState.losingMode||ge)return{move:se,bestScore:ke,mateThreat:Qe,aboutToLose:ge};const Nt=ie.filter((Ct,kt)=>{const Vt=(se.score??0)-(Ct.score??0);return kt===0||Vt<=150&&!(Ct.type==="mate"&&Ct.score<0)}),Rt=ie.filter((Ct,kt)=>{if(kt===0||Ct.type==="mate"&&Ct.score<0)return!1;const Vt=(se.score??0)-(Ct.score??0);return Vt>150&&Vt<=300});let lt=null;return Math.random()<.75&&Nt.length?lt=Nt[Qi(0,Nt.length-1)]:Rt.length?lt=Rt[Qi(0,Rt.length-1)]:Nt.length&&(lt=Nt[Qi(0,Nt.length-1)]),lt||(lt=se),((se.score??0)-(lt?.score??se.score??0)>350||lt?.type==="mate"&&lt.score<0)&&(lt=Nt[0]||se),{move:lt,bestScore:ke,mateThreat:Qe,aboutToLose:!1}},Hs=W=>{const ie=vs(W.entries),se=ie[0];if(!se)return{move:null,bestScore:0,mateThreat:!1,aboutToLose:!1};const ke=se.score??0,Qe=se.type==="mate"&&se.score<0,ge=Qe&&ke<0,Bt=ie.find((lt,nt)=>nt>0&&!(lt.type==="mate"&&lt.score<0)),Nt=[se];return Bt&&(se.score??0)-(Bt.score??se.score??0)<=35&&Nt.push(Bt),{move:Nt[Qi(0,Nt.length-1)],bestScore:ke,mateThreat:Qe,aboutToLose:ge}},ys=(W,ie)=>W==="pawn"?Hn(ie):W==="bishop"?Kn(ie):Hs(ie),K=(W,ie)=>{const se=ie.includes(" w ")?"b":"w",ke=Sn(ie,se),Qe=ln.current[W];return W==="pawn"?Qe.losingMode||Qe.lastMateThreat||Qe.lastEvalCp<=-500||ke<=-5?22:Qi(4,6):W==="bishop"?Qe.losingMode||Qe.lastMateThreat||Qe.lastEvalCp<=-400||ke<=-3?22:Qi(10,14):Qi(18,22)};j.useEffect(()=>{if(typeof Worker>"u"){Ze("Workers are not supported in this browser."),re("Engine unavailable in this browser.");return}const ie=[typeof SharedArrayBuffer=="function"&&crossOriginIsolated?"/stockfish/stockfish.js":null,"/stockfish/stockfish-lite-single.js","/stockfish/stockfish-asm.js"].filter(Boolean),se=lt=>new Worker(lt);let ke=null;const Qe=()=>{ke&&(window.clearTimeout(ke),ke=null),ke=window.setTimeout(()=>{Ze(lt=>`${lt} (no response yet, trying fallback...)`),Nt()},4e3)},ge=se(ie[0]);Ze(`Loading engine from ${ie[0]}...`),r.current=ge;let Bt=0;const Nt=()=>{const lt=Bt+1;if(lt>=ie.length){Ze("Engine failed to load."),re("Engine unavailable. Check console for details."),je(!1);return}r.current?.terminate(),Bt=lt;const nt=ie[lt];Ze(`Retrying with fallback engine (${nt}).`);const ut=se(nt);r.current=ut,ut.onmessage=ge.onmessage,ut.onerror=ge.onerror,ut.postMessage("uci"),ut.postMessage("isready"),Qe()},Rt=lt=>{const nt=typeof lt.data=="string"?lt.data:typeof lt.data?.data=="string"?lt.data.data:"";if(nt){if(nt.includes(" multipv ")){const ut=u.current,Ct=nt.match(/multipv\s+(\d+).*?score\s+(cp|mate)\s+(-?\d+).*?\spv\s+([a-h][1-8][a-h][1-8][qrbn]?)/i);if(ut&&Ct){const kt=Math.max(1,parseInt(Ct[1],10))-1,Vt=Ct[3],$t=Ct[4],Xn=Math.random()*5*(Math.random()<.5?-1:1),wn=parseInt(Vt,10)+Xn,ss=Ct[2]==="mate"?"mate":"cp",Dn=ss==="mate"?wn>=0?1e5-Math.abs(wn):-1e5+Math.abs(wn):wn,ws=[...h.current.gameId===ut.gameId?h.current.entries:[]];ws[kt]={move:$t,score:Dn,type:ss},h.current={gameId:ut.gameId,entries:ws}}}if(nt==="uciok"){Ze("Engine online. Initialising..."),Qe();return}if(nt==="readyok"){je(!0),Ze("Stockfish ready. Start a game to play."),re("Ready to play."),ke&&(window.clearTimeout(ke),ke=null);return}if(nt.startsWith("bestmove")){Re(!1),Ze("Bot moved.");const ut=u.current;if(!ut||ut.gameId!==a.current.value)return;const Ct=h.current;let kt=null;if(Ct.gameId===ut.gameId&&Ct.entries.length){const jn=qt.current,ws=ut.fen.includes(" w ")?"b":"w",rs=Sn(ut.fen,ws),Kt=ys(jn,{entries:Ct.entries,moveNumber:Y.current.value+1,materialBalance:rs,botState:ln.current[jn]});Kt.move&&(kt=Z1(`bestmove ${Kt.move.move}`));const rn=ln.current[jn],z=jn==="pawn"&&rn.losingMode&&!Kt.aboutToLose&&Kt.bestScore>-300&&!Kt.mateThreat&&rs>-4,Z=jn==="bishop"&&rn.losingMode&&!Kt.aboutToLose&&Kt.bestScore>-200&&!Kt.mateThreat&&rs>-2,X=jn==="pawn"?Kt.aboutToLose?!0:z?!1:rn.losingMode:jn==="bishop"?Kt.aboutToLose?!0:Z?!1:rn.losingMode:!1;ln.current[jn]={losingMode:X,lastEvalCp:Kt.bestScore,lastMateThreat:Kt.mateThreat}}if(kt||(kt=Z1(nt)),!kt){re("Bot could not find a move.");return}let Vt=Is(ut.fen);const $t=ut.fen.includes(" w ")?"b":"w",Xn=Sn(ut.fen,$t);let wn=null;try{wn=Vt.move({from:kt.from,to:kt.to,promotion:kt.promotion||"q"})}catch{wn=null}if(!wn)try{Vt=new xt(ut.fen),wn=Vt.move({from:kt.from,to:kt.to,promotion:kt.promotion||"q"})}catch{wn=null}if(!wn){re("Bot produced an invalid move.");return}e.current=Vt,q(Vt.fen()),ce(null),le(null),Se([kt.from,kt.to]),wn?.san&&qn(jn=>[...jn,wn.san]);const ss=Sn(Vt.fen(),$t),Dn=ss-Xn;Y.current.value+=1,Y.current.value===1&&Yt([],"opening"),Vt.isCheckmate()?(Yt(Gi(qt.current,"win"),"win"),Ln("loss")):Vt.isDraw()?(Ln("draw"),re("Draw. Your move.")):(Vt.isCheck()?Qt(Gi(qt.current,"attack"),"attack"):Dn<=-1?Qt(Gi(qt.current,"sacrifice"),"sacrifice"):Dn>=1?Qt(Gi(qt.current,"attack"),"attack"):Vt.board().flat().filter(Boolean).length<=10&&ss>1?Qt(Gi(qt.current,"endgame"),"endgame"):Qt(Gi(qt.current,"neutral"),"neutral"),re(Vt.isCheck()?"Your move (check).":"Your move.")),u.current=null}}};return ge.onmessage=Rt,ge.onerror=lt=>{console.error("Stockfish worker error",lt);const nt=ie[Bt];Ze(`Engine failed to load from ${nt}. If on localhost, keep the Vite dev server running so the file is served.`),re("Engine unavailable. Trying fallback..."),je(!1),Nt()},ge.postMessage("uci"),ge.postMessage("isready"),Qe(),()=>{ke&&window.clearTimeout(ke),ge.terminate()}},[]);const yn=W=>{try{const ie=W.trim().split(/\s+/),se=parseInt(ie[5],10);return Number.isFinite(se)?se:1}catch{return 1}},Jt=W=>{if(!r.current||!xe){re("Engine is not ready yet.");return}const ie=tl[qt.current]||tl.knight,se=yn(W);u.current={fen:W,gameId:a.current.value,fullmove:se},h.current={gameId:a.current.value,entries:[]},Re(!0),Ze(`Thinking (${ie.label})...`),r.current.postMessage("stop"),r.current.postMessage(`setoption name Skill Level value ${ie.skill}`),r.current.postMessage("setoption name MultiPV value 5"),r.current.postMessage(`position fen ${W}`);const ke=K(qt.current,W);r.current.postMessage(`go depth ${ke}`)},An=()=>{try{const W=e.current.pgn(),ie=new Blob([W],{type:"application/x-chess-pgn"}),se=URL.createObjectURL(ie),ke=document.createElement("a");ke.href=se,ke.download=`practice-${Date.now()}.pgn`,document.body.appendChild(ke),ke.click(),document.body.removeChild(ke),setTimeout(()=>URL.revokeObjectURL(se),2e3)}catch(W){console.warn("Failed to download PGN",W),re("Could not download PGN right now.")}},Ne=()=>{if(!xe){re("Engine still loading. Please wait a moment.");return}O(""),a.current.value+=1,Y.current.value=0,ln.current=J1();let W="";const ie=T.trim();if(ie)try{W=new xt(ie).fen()}catch{O("Invalid FEN. Please check the format.");return}const se=W?new xt(W):new xt;n.current=se.fen(),e.current=se,q(se.fen()),ce(null),le(null),Se([]),qn([]),Wn(null),de.current.value=!1,ue(x),Re(!1),re(x==="b"?"Bot thinking...":"Your move."),y(!1),u.current=null,r.current?.postMessage("ucinewgame");const ke=tl[qt.current]||tl.knight;r.current?.postMessage(`setoption name Skill Level value ${ke.skill}`),r.current?.postMessage(`setoption name Skill Level Probability value ${Math.min(100,ke.skill*5)}`),Yt(Gi(qt.current,"opening"),"opening"),x==="b"&&window.setTimeout(()=>Jt(se.fen()),250)},In=(W,ie)=>{Ee(null),ae(null),qe([]),ee(new Set);const se=at(W,ie),ke=new xt(D);if(ke.turn()!==x)return;if(he===se){ce(null);return}const Qe=ke.get(se);if(he){At(he,se);return}Qe&&Qe.color===ke.turn()&&ce(se)},At=(W,ie,se)=>{const ke=Is(D);if(ke.turn()!==x)return;if(Sn(D,x),W===ie){ce(null),le(null);return}let Qe=null;try{const Bt=ke.moves({square:W,verbose:!0}).find(lt=>lt.to===ie);if(Bt?.flags?.includes("p")&&!se){Wn({from:W,to:ie}),re("Choose promotion piece."),ce(null),le(null);return}const Rt=se||Bt?.promotion||"q";Qe=ke.move({from:W,to:ie,promotion:Rt})}catch{Qe=null}if(!Qe){ce(null);return}if(e.current=ke,q(ke.fen()),ce(null),Se([W,ie]),Wn(null),Qe?.san&&qn(ge=>[...ge,Qe.san]),Sn(ke.fen(),x),re(ke.isCheckmate()?"You delivered mate!":ke.isCheck()?"Bot in check. Bot thinking...":"Bot thinking..."),ke.isGameOver()){ke.isCheckmate()?(Yt(Gi(qt.current,"defeat"),"defeat"),Ln("win")):ke.isDraw()&&Ln("draw");return}Jt(ke.fen())};return j.useEffect(()=>{const W=new xt(D);W.isGameOver()&&(W.isCheckmate()?re(W.turn()===x?"You are checkmated.":"You delivered checkmate!"):re("Game over."))},[D,x]),d.jsxs(qr,{children:[d.jsxs("div",{className:"flex flex-col gap-4 text-white",children:[d.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:d.jsxs("div",{children:[d.jsxs("div",{className:"text-xl font-bold flex items-center gap-2",children:[d.jsx(gE,{className:"h-5 w-5 text-emerald-300"}),"Practice vs Bot"]}),d.jsx("div",{className:"text-sm text-white/60",children:"Choose your color, then play on a live board."})]})}),d.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-[minmax(360px,1fr)_320px] gap-4 items-start",children:[d.jsx("div",{className:"relative",children:d.jsxs("div",{className:"relative block pl-6 sm:pl-8 pb-6 sm:pb-8 w-full max-w-[840px] mx-auto",children:[d.jsx("div",{className:"rounded-[28px] overflow-hidden border border-white/10 shadow-[0_20px_60px_rgba(0,0,0,0.45)] w-full",style:{backgroundColor:hn.dark},children:d.jsxs("div",{className:"relative grid grid-cols-8 grid-rows-8 w-full max-w-[840px] aspect-square mx-auto",children:[yt.map((W,ie)=>W.map((se,ke)=>{const Qe=at(ie,ke),ge=(ie+ke)%2===0,Bt=he===Qe,Nt=Ft.some(nt=>nt.to===Qe),Rt=J.includes(Qe),lt=$.has(Qe);return d.jsxs("button",{onClick:()=>In(ie,ke),draggable:!!se,onDragStart:nt=>{const ut=new xt(D),Ct=at(ie,ke),kt=ut.get(Ct);kt&&kt.color===ut.turn()&&ut.turn()===x?(le(Ct),nt.dataTransfer?.setData("text/plain",Ct)):nt.preventDefault()},onDragOver:nt=>{C&&nt.preventDefault()},onDrop:nt=>{nt.preventDefault();const ut=C||nt.dataTransfer?.getData("text/plain"),Ct=at(ie,ke);ut&&At(ut,Ct),le(null),cn(!1)},onDragEnd:()=>{le(null),cn(!1)},onContextMenu:nt=>{if(nt.preventDefault(),bt){nn(!1);return}!Pe&&!et&&Xt(ie,ke)},onMouseDown:nt=>{nt.button===2?(nt.preventDefault(),cn(!0),Tn(ie,ke)):nt.button===0&&se&&cn(!0)},onMouseEnter:nt=>gs(ie,ke,nt.buttons),onMouseMove:nt=>gs(ie,ke,nt.buttons),onMouseUp:nt=>{nt.button===2&&(nt.preventDefault(),Vn(),cn(!1))},className:`w-full h-full flex items-center justify-center text-2xl font-semibold relative overflow-hidden ${Bt?"ring-2 ring-pink-400":""} ${se?"cursor-piece":"cursor-auto"}`,style:{backgroundColor:lt?"#ef4444":ge?hn.light:hn.dark,...se?{"--cursor-open":`url(${Ck}) 8 8, grab`,"--cursor-closed":`url(${Fm}) 8 8, grabbing`}:{}},children:[Rt&&!lt&&d.jsx("div",{className:"absolute inset-0 bg-yellow-400/50 pointer-events-none z-0"}),Nt&&d.jsx("div",{className:"absolute inset-0 z-20 pointer-events-none flex items-center justify-center",children:d.jsx("div",{className:"h-3 w-3 rounded-full bg-pink-400/80"})}),se?d.jsx("img",{src:ns(se)||"",alt:"",className:`relative z-10 w-full h-full object-contain p-1 ${ne(se)}`}):null]},`${ie}-${ke}`)})),Pe&&G&&d.jsxs("svg",{className:"absolute inset-0 pointer-events-none",viewBox:"0 0 100 100",children:[d.jsx("defs",{children:d.jsx("marker",{id:"arrowhead-practice-current",markerWidth:"4",markerHeight:"4",refX:"2",refY:"2",orient:"auto",children:d.jsx("path",{d:"M0,0 L0,4 L4,2 z",fill:"rgba(234,179,8,0.8)"})})}),(()=>{const W=(ke,Qe)=>({x:(Qe+.5)/8*100,y:(ke+.5)/8*100}),ie=W(Pe.row,Pe.col),se=W(G.row,G.col);return d.jsx("line",{x1:ie.x,y1:ie.y,x2:se.x,y2:se.y,stroke:"rgba(234,179,8,0.8)",strokeWidth:"1",markerEnd:"url(#arrowhead-practice-current)"})})()]}),Ue.map((W,ie)=>d.jsxs("svg",{className:"absolute inset-0 pointer-events-none",viewBox:"0 0 100 100",children:[d.jsx("defs",{children:d.jsx("marker",{id:`arrowhead-practice-${ie}`,markerWidth:"4",markerHeight:"4",refX:"2",refY:"2",orient:"auto",children:d.jsx("path",{d:"M0,0 L0,4 L4,2 z",fill:"rgba(234,179,8,0.8)"})})}),(()=>{const se=(ge,Bt)=>({x:(Bt+.5)/8*100,y:(ge+.5)/8*100}),ke=se(W.start.row,W.start.col),Qe=se(W.end.row,W.end.col);return d.jsx("line",{x1:ke.x,y1:ke.y,x2:Qe.x,y2:Qe.y,stroke:"rgba(234,179,8,0.8)",strokeWidth:"1",markerEnd:`url(#arrowhead-practice-${ie})`})})()]},`arrow-${ie}`))]})}),d.jsx("div",{className:"pointer-events-none absolute left-0 top-0 bottom-6 grid grid-rows-8 text-xs font-semibold text-white/80",children:(Ae==="w"?Array.from({length:8},(W,ie)=>8-ie):Array.from({length:8},(W,ie)=>ie+1)).map(W=>d.jsx("span",{className:"flex items-center justify-end pr-2",children:W},`rank-${W}`))}),d.jsx("div",{className:"pointer-events-none absolute left-6 right-0 bottom-0 grid grid-cols-8 text-xs font-semibold text-white/80",children:(Ae==="w"?"abcdefgh".split(""):"hgfedcba".split("")).map(W=>d.jsx("span",{className:"text-center pt-1",children:W},`file-${W}`))})]})}),d.jsxs("div",{className:"flex flex-col gap-4",children:[d.jsxs("div",{className:"rounded-2xl bg-slate-900 border border-white/10 text-white p-4 shadow-xl space-y-3",children:[d.jsxs("div",{className:"w-full flex flex-col items-center gap-3",children:[d.jsx("div",{className:"w-24 h-24 rounded-2xl overflow-hidden border border-white/10 bg-white/5 shadow-lg",children:d.jsx("img",{src:sn.avatar,alt:"Bot avatar",className:"w-full h-full object-cover"})}),d.jsx("div",{className:"text-sm text-white/70",children:sn.name})]}),d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("div",{className:"font-semibold",children:"Session"}),d.jsx("div",{className:"flex items-center gap-2 text-xs text-white/70",children:d.jsxs("span",{className:"flex items-center gap-1",children:[d.jsx(um,{className:"h-4 w-4"}),x==="w"?"White":"Black"]})})]}),d.jsxs("div",{className:"rounded-xl bg-white/5 border border-white/10 p-3 text-sm text-white/80 min-h-[64px]",children:[d.jsx("div",{className:"font-semibold text-white",children:c}),pe.length?d.jsx("div",{className:"mt-2 space-y-1",children:pe.map((W,ie)=>d.jsx("div",{className:"leading-relaxed text-white/80",children:W},`${W}-${ie}`))}):d.jsx("div",{className:"mt-1 text-white/60",children:"Awaiting moves..."})]}),d.jsxs("div",{className:"flex gap-2",children:[d.jsx(Le,{variant:"ghost",className:"w-full",onClick:()=>Pt(!0),children:"Choose Bot"}),d.jsx(Le,{variant:"outline",className:"w-full",onClick:()=>y(!0),children:"New Game"})]})]}),d.jsxs("div",{className:"rounded-2xl bg-slate-900 border border-white/10 p-4 shadow-xl space-y-3",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("div",{className:"font-semibold",children:"Moves"}),d.jsxs(Le,{variant:"ghost",size:"sm",onClick:An,className:"gap-2",children:[d.jsx(iy,{className:"h-4 w-4"}),"PGN"]})]}),d.jsx("div",{className:"rounded-xl border border-white/10 bg-white/5 p-3 max-h-60 overflow-y-auto text-sm text-white/80",children:Lt.length===0?d.jsx("div",{className:"text-white/60 text-sm",children:"No moves yet."}):d.jsx("div",{className:"space-y-1",children:Lt.map(W=>d.jsxs("div",{className:"flex gap-2",children:[d.jsxs("span",{className:"text-white/60 w-8 shrink-0",children:[W.num,"."]}),d.jsx("span",{className:"w-20",children:W.white}),d.jsx("span",{className:"w-20",children:W.black})]},W.num))})})]})]})]})]}),Be&&d.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 px-4",children:d.jsxs("div",{className:"w-full max-w-md rounded-2xl bg-slate-900 text-white border border-white/10 shadow-2xl",children:[d.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-white/10",children:[d.jsxs("div",{children:[d.jsx("div",{className:"text-lg font-semibold",children:"Choose Bot"}),d.jsx("div",{className:"text-xs text-white/60",children:"Pick who you want to spar with."})]}),d.jsx("button",{className:"p-2 rounded-full hover:bg-white/10 text-white/70",onClick:()=>Pt(!1),"aria-label":"Close",children:d.jsx(nr,{className:"h-4 w-4"})})]}),d.jsx("div",{className:"p-5 space-y-3",children:Vp.map(W=>d.jsxs("button",{onClick:()=>{On(W.id),Pt(!1)},className:`w-full flex items-center gap-3 rounded-xl border px-3 py-3 text-left ${W.id===Wt?"border-pink-400 bg-white/10":"border-white/10 bg-white/5 hover:bg-white/10"}`,children:[d.jsx("div",{className:"h-12 w-12 rounded-lg overflow-hidden border border-white/10 bg-white/5",children:d.jsx("img",{src:W.avatar,alt:W.name,className:"h-full w-full object-cover"})}),d.jsxs("div",{children:[d.jsx("div",{className:"font-semibold text-white",children:W.name}),d.jsx("div",{className:"text-xs text-white/60",children:W.difficulty||W.label})]})]},W.id))})]})}),m&&d.jsx("div",{className:"fixed inset-0 z-40 flex items-center justify-center bg-black/70 px-4",children:d.jsxs("div",{className:"w-full max-w-md rounded-2xl bg-slate-900 text-white border border-white/10 shadow-2xl",children:[d.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-white/10",children:[d.jsxs("div",{children:[d.jsx("div",{className:"text-lg font-semibold",children:"Start Practice Game"}),d.jsx("div",{className:"text-xs text-white/60",children:"Pick your color and bot level."})]}),d.jsx("button",{className:"p-2 rounded-full hover:bg-white/10 text-white/70",onClick:()=>y(!1),"aria-label":"Close",children:d.jsx(nr,{className:"h-4 w-4"})})]}),d.jsxs("div",{className:"p-5 space-y-4",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx("div",{className:"text-sm text-white/80",children:"Your color"}),d.jsx("div",{className:"flex gap-2",children:["w","b"].map(W=>d.jsx("button",{onClick:()=>k(W),className:`flex-1 rounded-xl border px-3 py-3 text-sm ${x===W?"border-pink-400 bg-white/10":"border-white/10 bg-white/5"}`,children:W==="w"?"White":"Black"},W))})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx("div",{className:"text-sm text-white/80",children:"Custom starting position (FEN)"}),d.jsx("textarea",{value:T,onChange:W=>S(W.target.value),placeholder:"Optional: paste FEN to start from a specific position",className:"w-full rounded-xl border border-white/10 bg-white/5 px-3 py-2 text-sm text-white placeholder:text-white/40 focus:outline-none focus:ring-2 focus:ring-pink-400",rows:2}),R&&d.jsx("div",{className:"text-xs text-amber-300",children:R})]}),d.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2",children:[d.jsx(Le,{variant:"outline",onClick:()=>y(!1),children:"Cancel"}),d.jsx(Le,{onClick:Ne,disabled:!xe,children:xe?"Start":"Engine loading..."})]})]})]})}),zn&&d.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 px-4",children:d.jsxs("div",{className:"w-full max-w-sm rounded-2xl bg-slate-900 text-white border border-white/10 shadow-2xl",children:[d.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-white/10",children:[d.jsxs("div",{children:[d.jsx("div",{className:"text-lg font-semibold",children:"Choose promotion"}),d.jsx("div",{className:"text-xs text-white/60",children:"Select the piece to promote your pawn."})]}),d.jsx("button",{className:"p-2 rounded-full hover:bg-white/10 text-white/70",onClick:()=>Wn(null),"aria-label":"Close",children:d.jsx(nr,{className:"h-4 w-4"})})]}),d.jsxs("div",{className:"p-5 grid grid-cols-2 gap-3",children:[["q","r","b","n"].map(W=>d.jsxs(Le,{variant:"outline",className:"w-full",onClick:()=>{zn&&At(zn.from,zn.to,W)},children:["Promote to ",W==="q"?"Queen":W==="r"?"Rook":W==="b"?"Bishop":"Knight"]},W)),d.jsx(Le,{variant:"ghost",className:"w-full col-span-2",onClick:()=>Wn(null),children:"Cancel"})]})]})})]})}function W3(){return d.jsx("div",{className:"min-h-screen bg-slate-950 text-white flex items-center justify-center",children:d.jsxs("div",{className:"text-center space-y-2",children:[d.jsx("div",{className:"text-3xl font-semibold",children:"404"}),d.jsx("p",{className:"text-white/70",children:"Page not found"})]})})}var Td={exports:{}},q3=Td.exports,e_;function V3(){return e_||(e_=1,(function(t,e){(function(n,r){r(e)})(q3,(function(n){var r=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof ex<"u"?ex:typeof self<"u"?self:{};function a(O){return O&&O.__esModule&&Object.prototype.hasOwnProperty.call(O,"default")?O.default:O}var u={exports:{}};(function(O){(function(D,q){O.exports&&(O.exports=q())})(r,function(){function D(C,le){function c(){this.constructor=C}c.prototype=le.prototype,C.prototype=new c}function q(C,le,c,re){var xe=Error.call(this,C);return Object.setPrototypeOf&&Object.setPrototypeOf(xe,q.prototype),xe.expected=le,xe.found=c,xe.location=re,xe.name="SyntaxError",xe}D(q,Error);function he(C,le,c){return c=c||" ",C.length>le?C:(le-=C.length,c+=c.repeat(le),C+c.slice(0,le))}q.prototype.format=function(C){var le="Error: "+this.message;if(this.location){var c=null,re;for(re=0;re<C.length;re++)if(C[re].source===this.location.source){c=C[re].text.split(/\r\n|\n|\r/g);break}var xe=this.location.start,je=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(xe):xe,Fe=this.location.source+":"+je.line+":"+je.column;if(c){var Ze=this.location.end,st=he("",je.line.toString().length," "),Re=c[xe.line-1],Ae=xe.line===Ze.line?Ze.column:Re.length+1,ue=Ae-xe.column||1;le+=`
 --> `+Fe+`
`+st+` |
`+je.line+" | "+Re+`
`+st+" | "+he("",xe.column-1," ")+he("",ue,"^")}else le+=`
 at `+Fe}return le},q.buildMessage=function(C,le){var c={literal:function(Re){return'"'+xe(Re.text)+'"'},class:function(Re){var Ae=Re.parts.map(function(ue){return Array.isArray(ue)?je(ue[0])+"-"+je(ue[1]):je(ue)});return"["+(Re.inverted?"^":"")+Ae.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(Re){return Re.description}};function re(Re){return Re.charCodeAt(0).toString(16).toUpperCase()}function xe(Re){return Re.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(Ae){return"\\x0"+re(Ae)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(Ae){return"\\x"+re(Ae)})}function je(Re){return Re.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(Ae){return"\\x0"+re(Ae)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(Ae){return"\\x"+re(Ae)})}function Fe(Re){return c[Re.type](Re)}function Ze(Re){var Ae=Re.map(Fe),ue,pe;if(Ae.sort(),Ae.length>0){for(ue=1,pe=1;ue<Ae.length;ue++)Ae[ue-1]!==Ae[ue]&&(Ae[pe]=Ae[ue],pe++);Ae.length=pe}switch(Ae.length){case 1:return Ae[0];case 2:return Ae[0]+" or "+Ae[1];default:return Ae.slice(0,-1).join(", ")+", or "+Ae[Ae.length-1]}}function st(Re){return Re?'"'+xe(Re)+'"':"end of input"}return"Expected "+Ze(C)+" but "+st(le)+" found."};function ce(C,le){le=le!==void 0?le:{};var c={},re=le.grammarSource,xe={pgn:vd,tags:fw,game:Ap,games:Pk},je=vd,Fe="\uFEFF",Ze="Event",st="event",Re="Site",Ae="site",ue="Date",pe="date",$e="Round",Y="round",J="White",Se="white",de="Black",$="black",ee="Result",Pe="result",Ee="WhiteTitle",G="Whitetitle",ae="whitetitle",Ue="whiteTitle",qe="BlackTitle",et="Blacktitle",ot="blacktitle",bt="blackTitle",nn="WhiteELO",hn="WhiteElo",Dt="Whiteelo",Mn="whiteelo",Be="whiteElo",Pt="BlackELO",Wt="BlackElo",On="Blackelo",sn="blackelo",qt="blackElo",ln="WhiteUSCF",zn="WhiteUscf",Wn="Whiteuscf",Ts="whiteuscf",qn="whiteUscf",cn="BlackUSCF",Ln="BlackUscf",ns="Blackuscf",ne="blackuscf",at="blackUscf",yt="WhiteNA",Ft="WhiteNa",Lt="Whitena",En="whitena",Yt="whiteNa",Qt="whiteNA",Xt="BlackNA",Tn="BlackNa",gs="Blackna",Vn="blackna",Sn="blackNA",Is="blackNa",vs="WhiteType",Hn="Whitetype",Kn="whitetype",Hs="whiteType",ys="BlackType",K="Blacktype",yn="blacktype",Jt="blackType",An="EventDate",Ne="Eventdate",In="eventdate",At="eventDate",W="EventSponsor",ie="Eventsponsor",se="eventsponsor",ke="eventSponsor",Qe="Section",ge="section",Bt="Stage",Nt="stage",Rt="Board",lt="board",nt="Opening",ut="opening",Ct="Variation",kt="variation",Vt="SubVariation",$t="Subvariation",Xn="subvariation",wn="subVariation",ss="ECO",Dn="Eco",jn="eco",ws="NIC",rs="Nic",Kt="nic",rn="Time",z="time",Z="UTCTime",X="UTCtime",tt="UtcTime",Ye="Utctime",V="utctime",ye="utcTime",Ie="UTCDate",Me="UTCdate",He="UtcDate",Zt="Utcdate",zt="utcdate",Ls="utcDate",br="TimeControl",Hr="Timecontrol",Cr="timecontrol",Mt="timeControl",li="SetUp",pa="Setup",Pi="setup",ma="setUp",ga="FEN",va="Fen",po="fen",ci="Termination",kr="termination",ar="Annotator",lr="annotator",cr="Mode",Kr="mode",Sr="PlyCount",ya="Plycount",wa="plycount",ui="plyCount",A="Variant",B="variant",te="WhiteRatingDiff",fe="BlackRatingDiff",Oe="WhiteFideId",dt="BlackFideId",xn="WhiteTeam",is="BlackTeam",Fn="Clock",ft="WhiteClock",pn="BlackClock",en='"',Nn="\\",St=".",tn=":",js="/",Ai="B",gl="W",pf="N",xa="?",mo="-",vl="+",Ds="*",Ri="1-0",yl="0-1",go="1/2-1/2",mf="=",wl="%csl",xl="%cal",$i="%",_a="%eval",Vc="[%",gf="}",_l=",",hg="Y",Hc="G",pg="R",mg="O",gg="C",vg="{",yg="[",vf="]",wg=";",yf="clk",wf="egt",xf="emt",bl="mct",xg="(",_g=")",_f=" ",bf="e.p.",Cf="O-O-O",kf="O-O",bg="@",Sf="Z0",Cl="+-",Nf="$$$",Cg="#",Kc="$",vo="!!",Ef="??",Gc="!?",Qc="?!",Tf="!",If="",jf="",yo="",kg="",Sg="",Ng="",Pf="",Af="",ba="",Ca="",Rf="-+",kl="",Eg="",$f="",Yc="",Xc="",Mf="D",Jc="x",Mi=/^[ \t\n\r]/,Of=/^[\n\r]/,Lf=/^[\-a-zA-Z0-9_.]/,Tg=/^[^"\\\r\n]/,di=/^[0-9?]/,Ks=/^[0-9]/,ur=/^[^\n\r]/,ka=/^[RNBQKP]/,Df=/^[RNBQ]/,Ff=/^[a-h]/,Uf=/^[1-8]/,Bf=L("\uFEFF",!1),Zc=L("Event",!1),Ig=L("event",!1),jg=L("Site",!1),wo=L("site",!1),eu=L("Date",!1),Sa=L("date",!1),tu=L("Round",!1),zf=L("round",!1),Sl=L("White",!1),xo=L("white",!1),nu=L("Black",!1),Wf=L("black",!1),Nl=L("Result",!1),qf=L("result",!1),Vf=L("WhiteTitle",!1),Hf=L("Whitetitle",!1),Kf=L("whitetitle",!1),Gf=L("whiteTitle",!1),Qf=L("BlackTitle",!1),fi=L("Blacktitle",!1),su=L("blacktitle",!1),ru=L("blackTitle",!1),Pg=L("WhiteELO",!1),Ag=L("WhiteElo",!1),Na=L("Whiteelo",!1),Rg=L("whiteelo",!1),Yf=L("whiteElo",!1),Xf=L("BlackELO",!1),mn=L("BlackElo",!1),iu=L("Blackelo",!1),El=L("blackelo",!1),Ea=L("blackElo",!1),Jf=L("WhiteUSCF",!1),ou=L("WhiteUscf",!1),Ta=L("Whiteuscf",!1),Tl=L("whiteuscf",!1),_o=L("whiteUscf",!1),Zf=L("BlackUSCF",!1),$g=L("BlackUscf",!1),Mg=L("Blackuscf",!1),eh=L("blackuscf",!1),Il=L("blackUscf",!1),jl=L("WhiteNA",!1),au=L("WhiteNa",!1),lu=L("Whitena",!1),cu=L("whitena",!1),uu=L("whiteNa",!1),Og=L("whiteNA",!1),th=L("BlackNA",!1),Lg=L("BlackNa",!1),Dg=L("Blackna",!1),du=L("blackna",!1),hi=L("blackNA",!1),nh=L("blackNa",!1),bo=L("WhiteType",!1),Mr=L("Whitetype",!1),Ia=L("whitetype",!1),Gr=L("whiteType",!1),fu=L("BlackType",!1),Fg=L("Blacktype",!1),Ug=L("blacktype",!1),Oi=L("blackType",!1),ja=L("EventDate",!1),Co=L("Eventdate",!1),Pl=L("eventdate",!1),hu=L("eventDate",!1),ko=L("EventSponsor",!1),pi=L("Eventsponsor",!1),gn=L("eventsponsor",!1),un=L("eventSponsor",!1),mi=L("Section",!1),xs=L("section",!1),Fs=L("Stage",!1),Li=L("stage",!1),So=L("Board",!1),Us=L("board",!1),Al=L("Opening",!1),sh=L("opening",!1),rh=L("Variation",!1),Rl=L("variation",!1),ih=L("SubVariation",!1),Qr=L("Subvariation",!1),$l=L("subvariation",!1),pu=L("subVariation",!1),oh=L("ECO",!1),Bg=L("Eco",!1),gi=L("eco",!1),No=L("NIC",!1),Eo=L("Nic",!1),Ml=L("nic",!1),Ol=L("Time",!1),dr=L("time",!1),fr=L("UTCTime",!1),Di=L("UTCtime",!1),Yr=L("UtcTime",!1),Xr=L("Utctime",!1),Fi=L("utctime",!1),ah=L("utcTime",!1),mu=L("UTCDate",!1),gu=L("UTCdate",!1),Gs=L("UtcDate",!1),Qs=L("Utcdate",!1),_n=L("utcdate",!1),Nr=L("utcDate",!1),lh=L("TimeControl",!1),ch=L("Timecontrol",!1),vu=L("timecontrol",!1),yu=L("timeControl",!1),uh=L("SetUp",!1),Ll=L("Setup",!1),dh=L("setup",!1),To=L("setUp",!1),wu=L("FEN",!1),zg=L("Fen",!1),Pa=L("fen",!1),Dl=L("Termination",!1),fh=L("termination",!1),hh=L("Annotator",!1),Io=L("annotator",!1),ph=L("Mode",!1),Fl=L("mode",!1),Ul=L("PlyCount",!1),jo=L("Plycount",!1),xu=L("plycount",!1),_u=L("plyCount",!1),bu=L("Variant",!1),Cu=L("variant",!1),Po=L("WhiteRatingDiff",!1),hr=L("BlackRatingDiff",!1),Ui=L("WhiteFideId",!1),ku=L("BlackFideId",!1),mh=L("WhiteTeam",!1),Jr=L("BlackTeam",!1),vi=L("Clock",!1),Su=L("WhiteClock",!1),gh=L("BlackClock",!1),Or=uw("whitespace"),Ys=wt([" ","	",`
`,"\r"],!1,!1),Aa=wt([`
`,"\r"],!1,!1),Nu=wt(["-",["a","z"],["A","Z"],["0","9"],"_","."],!1,!1),Bi=L('"',!1),vh=wt(['"',"\\","\r",`
`],!0,!1),Ao=L("\\",!1),os=wt([["0","9"],"?"],!1,!1),yi=L(".",!1),as=wt([["0","9"]],!1,!1),pr=L(":",!1),Ra=L("/",!1),zi=L("B",!1),yh=L("W",!1),Eu=L("N",!1),bn=L("?",!1),Ro=L("-",!1),$a=L("+",!1),Bl=L("*",!1),zl=L("1-0",!1),Tu=L("0-1",!1),Wi=L("1/2-1/2",!1),vn=L("=",!1),Gn=L("%csl",!1),Jn=L("%cal",!1),$o=L("%",!1),Ma=L("%eval",!1),Oa=L("[%",!1),wh=L("}",!1),ls=Ei(),Wl=wt([`
`,"\r"],!0,!1),Mo=L(",",!1),Iu=L("Y",!1),Lr=L("G",!1),mr=L("R",!1),La=L("O",!1),ju=L("C",!1),Pu=L("{",!1),xh=L("[",!1),_h=L("]",!1),bh=L(";",!1),Ch=L("clk",!1),kh=L("egt",!1),Sh=L("emt",!1),Nh=L("mct",!1),Eh=L("(",!1),Da=L(")",!1),Th=uw("integer"),Fa=L(" ",!1),ql=L("e.p.",!1),Ih=L("O-O-O",!1),Au=L("O-O",!1),jh=L("@",!1),Ph=L("Z0",!1),Ru=L("+-",!1),Ah=L("$$$",!1),$u=L("#",!1),Rh=L("$",!1),$h=L("!!",!1),Mh=L("??",!1),Wg=L("!?",!1),Oh=L("?!",!1),qg=L("!",!1),Vg=L("",!1),Lh=L("",!1),Dh=L("",!1),Fh=L("",!1),Vl=L("",!1),Hg=L("",!1),Kg=L("",!1),Gg=L("",!1),Er=L("",!1),Mu=L("",!1),Hl=L("-+",!1),Uh=L("",!1),Bh=L("",!1),zh=L("",!1),Ou=L("",!1),Oo=L("",!1),Lu=L("D",!1),Du=wt(["R","N","B","Q","K","P"],!1,!1),Qg=wt(["R","N","B","Q"],!1,!1),Wh=wt([["a","h"]],!1,!1),qh=wt([["1","8"]],!1,!1),Fu=L("x",!1),Uu=function(o,g){return g},Vh=function(o,g){return[o].concat(g)},Yg=function(o){return o},Bs=function(o,g,b){var _=Mp;return Mp=[],{tags:o,gameComment:g,moves:b,messages:_}},_s=function(o,g){return g},Hh=function(o,g){var b={};return[o].concat(g).forEach(function(_){b[_.name]=_.value}),b},Kh=function(o){return o===null?{}:(o.messages=Mp,o)},Gh=function(o){return o},Qh=function(o){return{name:"Event",value:o}},Yh=function(o){return{name:"Site",value:o}},Bu=function(o){return{name:"Date",value:o}},Xh=function(o){return{name:"Round",value:o}},zu=function(o){return{name:"WhiteTitle",value:o}},Jh=function(o){return{name:"BlackTitle",value:o}},Zh=function(o){return{name:"WhiteElo",value:o}},Wu=function(o){return{name:"BlackElo",value:o}},qu=function(o){return{name:"WhiteUSCF",value:o}},ep=function(o){return{name:"BlackUSCF",value:o}},Vu=function(o){return{name:"WhiteNA",value:o}},Kl=function(o){return{name:"BlackNA",value:o}},Xg=function(o){return{name:"WhiteType",value:o}},tp=function(o){return{name:"BlackType",value:o}},Hu=function(o){return{name:"White",value:o}},np=function(o){return{name:"Black",value:o}},Gl=function(o){return{name:"Result",value:o}},Zr=function(o){return{name:"EventDate",value:o}},Jg=function(o){return{name:"EventSponsor",value:o}},sp=function(o){return{name:"Section",value:o}},Ku=function(o){return{name:"Stage",value:o}},rp=function(o){return{name:"Board",value:o}},ip=function(o){return{name:"Opening",value:o}},Ua=function(o){return{name:"Variation",value:o}},bs=function(o){return{name:"SubVariation",value:o}},Zg=function(o){return{name:"ECO",value:o}},ev=function(o){return{name:"NIC",value:o}},Ql=function(o){return{name:"Time",value:o}},Cs=function(o){return{name:"UTCTime",value:o}},tv=function(o){return{name:"UTCDate",value:o}},ze=function(o){return{name:"TimeControl",value:o}},Lo=function(o){return{name:"SetUp",value:o}},Gu=function(o){return{name:"FEN",value:o}},op=function(o){return{name:"Termination",value:o}},nv=function(o){return{name:"Annotator",value:o}},Ba=function(o){return{name:"Mode",value:o}},Yl=function(o){return{name:"PlyCount",value:o}},Qu=function(o){return{name:"Variant",value:o}},ap=function(o){return{name:"WhiteRatingDiff",value:o}},lp=function(o){return{name:"BlackRatingDiff",value:o}},cp=function(o){return{name:"WhiteFideId",value:o}},Yu=function(o){return{name:"BlackFideId",value:o}},Xu=function(o){return{name:"WhiteTeam",value:o}},cs=function(o){return{name:"BlackTeam",value:o}},Tr=function(o){return{name:"Clock",value:o}},wi=function(o){return{name:"WhiteClock",value:o}},up=function(o){return{name:"BlackClock",value:o}},dp=function(o,g){return yr({key:o,value:g,message:`Format of tag: "${o}" not correct: "${g}"`}),{name:o,value:g}},Ir=function(o,g){return yr({key:o,value:g,message:`Tag: "${o}" not known: "${g}"`}),{name:o,value:g}},fp=function(o){return o.join("")},Dr=function(o){return o.map(g=>g.char||g).join("")},sv=function(){return{type:"char",char:"\\"}},hp=function(){return{type:"char",char:'"'}},pp=function(o){return o},mp=function(o,g,b){return{value:""+o.join("")+"."+g.join("")+"."+b.join(""),year:Ga(o),month:Ga(g),day:Ga(b)}},gp=function(o,g,b,_){let U=o.join("")+":"+g.join("")+":"+b.join(""),oe=0;return _&&(U=U+"."+_,yr({message:`Unusual use of millis in time: ${U}`}),Ga(_)),{value:U,hour:Ga(o),minute:Ga(g),second:Ga(b),millis:oe}},rv=function(o){return o.join("")},Xl=function(o){return o},Ju=function(o,g){return o+"/"+g},gr=function(o){return o},Ut=function(o){return o},Zn=function(o){return o||(yr({message:"Tag TimeControl has to have a value"}),"")},Rn=function(o,g){return g},us=function(o,g){let b=[o].concat(g);return b.value=b.map(_=>_.value).join(":"),b},Xs=function(o){return o},Do=function(){return{kind:"unknown",value:"?"}},Qn=function(){return{kind:"unlimited",value:"-"}},za=function(o,g,b){return{kind:"movesInSecondsIncrement",moves:o,seconds:g,increment:b,value:""+o+"/"+g+"+"+b}},qi=function(o,g){return{kind:"movesInSeconds",moves:o,seconds:g,value:""+o+"/"+g}},Jl=function(o,g){return{kind:"increment",seconds:o,increment:g,value:""+o+"+"+g}},Zu=function(o){return{kind:"suddenDeath",seconds:o,value:""+o}},Wa=function(o){return{kind:"hourglass",seconds:o,value:"*"+o}},zs=function(o){return o},ed=function(o){return o},Fo=function(o){return o},ei=function(o){return o},Zl=function(o){return o},td=function(o){return o},xi=function(){return 0},ec=function(){return yr({message:'Use "-" for an unknown value'}),0},_i=function(o){return Pv(o)},tc=function(o,g,b,_,U,oe,we,We){var _t=We||[],on={};return on.moveNumber=g,on.notation=b,oe&&(on.commentAfter=oe.comment),o&&(on.commentMove=o.comment),U&&(on.drawOffer=!0),on.variations=we||[],on.nag=_||null,_t.unshift(on),on.commentDiag=oe,_t},qa=function(o){return o},nd=function(o){return[o]},Va=function(o,g){return g},nc=function(o,g){return Vo([o].concat(g))},Ps=function(){},bi=function(o){return o},jr=function(o){return{comment:o}},As=function(o,g){return g},vp=function(o,g){return Vo([{colorFields:o}].concat(g[0]))},sc=function(o,g){return g},sd=function(o,g){return Vo([{colorArrows:o}].concat(g[0]))},yp=function(o,g,b){return b},Ci=function(o,g,b){var _={};return _[o]=g,Vo([_].concat(b[0]))},rd=function(o,g,b){return b},id=function(o,g,b){var _={};return _[o]=g,Vo([_].concat(b[0]))},ki=function(o,g){return g},od=function(o,g){var b={};return b.eval=parseFloat(o),Vo([b].concat(g[0]))},Si=function(o,g,b){return b},wp=function(o,g,b){var _={};return _[o]=g.join(""),Vo([_].concat(b[0]))},ad=function(o,g){return g},ld=function(o,g){return g.length>0?Vo([{comment:Zw(o.join(""))}].concat(Jw(g[0]))):{comment:o.join("")}},rc=function(o){return o},iv=function(o){return o},ov=function(o){return o.join("")},xp=function(o,g){var b=[];b.push(o);for(var _=0;_<g.length;_++)b.push(g[_][2]);return b},_p=function(o,g){return o+g},Vi=function(o,g){var b=[];b.push(o);for(var _=0;_<g.length;_++)b.push(g[_][2]);return b},av=function(o,g,b){return o+g+b},Uo=function(){return"Y"},bp=function(){return"G"},Pn=function(){return"R"},lv=function(){return"B"},Cp=function(){return"O"},cv=function(){return"C"},uv=function(o,g){return o+g},kp=function(){return"clk"},Sp=function(){return"egt"},dv=function(){return"emt"},vr=function(){return"mct"},cd=function(o,g,b,_){let U=g;return o?U=o+U:yr({message:"Hours and minutes missing"}),o&&(o.match(/:/g)||[]).length==2&&o.search(":")==2&&yr({message:"Only 1 digit for hours normally used"}),b?U+=b:yr({message:"Only 2 digit for seconds normally used"}),_&&(yr({message:"Unusual use of millis in clock value"}),U+="."+_),U},fv=function(o,g,b){let _=g;return o?_=o+_:yr({message:"Hours and minutes missing"}),o&&(o.match(/:/g)||[]).length==2&&o.search(":")==1&&yr({message:"Only 2 digits for hours normally used"}),b?_+=b:yr({message:"Only 2 digit for seconds normally used"}),_},Ni=function(o,g){return g?o+g:(yr({message:"No hours found"}),o)},ic=function(o,g){let b=o;return g?b+=g+":":b+=":",b},Hi=function(o,g){let b=o;return g?b+=g+":":(b+=":",yr({message:"Only 2 digits for minutes normally used"})),b},oc=function(o){return o},ud=function(o,g){var b=g||[];return b.unshift(o),b},dd=function(o){return o},hv=function(o){return Pv(o)},fd=function(){return""},pv=function(o,g,b,_,U,oe,we){var We={};return We.fig=o||null,We.disc=g||null,We.strike=b||null,We.col=_,We.row=U,We.check=we||null,We.promotion=oe,We.notation=(o||"")+(g||"")+(b||"")+_+U+(oe||"")+(we||""),We},Np=function(o,g,b,_,U,oe,we,We){var _t={};return _t.fig=o||null,_t.strike=_=="x"?_:null,_t.col=U,_t.row=oe,_t.notation=(o&&o!=="P"?o:"")+g+b+(_=="x"?_:"-")+U+oe+(we||"")+(We||""),_t.check=We||null,_t.promotion=we,_t},Ep=function(o,g,b,_,U,oe){var we={};return we.fig=o||null,we.strike=g||null,we.col=b,we.row=_,we.check=oe||null,we.promotion=U,we.notation=(o||"")+(g||"")+b+_+(U||"")+(oe||""),we},ac=function(o){var g={};return g.notation="O-O-O"+(o||""),g.check=o||null,g},lc=function(o){var g={};return g.notation="O-O"+(o||""),g.check=o||null,g},Tp=function(o,g,b){var _={};return _.fig=o,_.drop=!0,_.col=g,_.row=b,_.notation=o+"@"+g+b,_},hd=function(){var o={};return o.notation="Z0",o},mv=function(o){return o[1]},Ip=function(o){return o[1]},pd=function(o){return"="+o},cc=function(o,g){var b=g||[];return b.unshift(o),b},md=function(o){return"$"+o},uc=function(){return"$3"},jp=function(){return"$4"},gv=function(){return"$5"},dc=function(){return"$6"},vv=function(){return"$1"},Ha=function(){return"$2"},yv=function(){return"$3"},fc=function(){return"$4"},s=function(){return"$5"},i=function(){return"$6"},l=function(){return"$7"},p=function(){return"$10"},v=function(){return"$13"},w=function(){return"$14"},N=function(){return"$15"},M=function(){return"$16"},F=function(){return"$17"},Q=function(){return"$18"},ve=function(){return"$19"},be=function(){return"$22"},me=function(){return"$32"},De=function(){return"$36"},Ve=function(){return"$40"},Xe=function(){return"$132"},$n=function(){return"$220"},f=0,E=0,H=[{line:1,column:1}],_e=0,Je=[],I=0,rt;if("startRule"in le){if(!(le.startRule in xe))throw new Error(`Can't start parsing from rule "`+le.startRule+'".');je=xe[le.startRule]}function ht(){return xv(E,f)}function L(o,g){return{type:"literal",text:o,ignoreCase:g}}function wt(o,g,b){return{type:"class",parts:o,inverted:g,ignoreCase:b}}function Ei(){return{type:"any"}}function wv(){return{type:"end"}}function uw(o){return{type:"other",description:o}}function dw(o){var g=H[o],b;if(g)return g;for(b=o-1;!H[b];)b--;for(g=H[b],g={line:g.line,column:g.column};b<o;)C.charCodeAt(b)===10?(g.line++,g.column=1):g.column++,b++;return H[o]=g,g}function xv(o,g,b){var _=dw(o),U=dw(g),oe={source:re,start:{offset:o,line:_.line,column:_.column},end:{offset:g,line:U.line,column:U.column}};return oe}function P(o){f<_e||(f>_e&&(_e=f,Je=[]),Je.push(o))}function jk(o,g,b){return new q(q.buildMessage(o,g),o,g,b)}function Pp(){var o;return C.charCodeAt(f)===65279?(o=Fe,f++):(o=c,I===0&&P(Bf)),o}function Pk(){var o,g,b,_,U,oe;if(o=f,Pp(),Ce(),g=f,b=Ap(),b!==c){for(_=[],U=f,Ce(),oe=Ap(),oe!==c?(E=U,U=Uu(b,oe)):(f=U,U=c);U!==c;)_.push(U),U=f,Ce(),oe=Ap(),oe!==c?(E=U,U=Uu(b,oe)):(f=U,U=c);E=g,g=Vh(b,_)}else f=g,g=c;return g===c&&(g=null),E=o,o=Yg(g),o}function Ap(){var o,g,b,_;return o=f,Pp(),g=fw(),b=kv(),b===c&&(b=null),_=vd(),_!==c?(E=o,o=Bs(g,b,_)):(f=o,o=c),o}function fw(){var o,g,b,_,U,oe;if(o=f,Pp(),Ce(),g=f,b=_v(),b!==c){for(_=[],U=f,Ce(),oe=_v(),oe!==c?(E=U,U=_s(b,oe)):(f=U,U=c);U!==c;)_.push(U),U=f,Ce(),oe=_v(),oe!==c?(E=U,U=_s(b,oe)):(f=U,U=c);E=g,g=Hh(b,_)}else f=g,g=c;return g===c&&(g=null),b=Ce(),E=o,o=Kh(g),o}function _v(){var o,g,b,_;return o=f,g=Ka(),g!==c?(Ce(),b=Ak(),b!==c?(Ce(),_=Bo(),_!==c?(E=o,o=Gh(b)):(f=o,o=c)):(f=o,o=c)):(f=o,o=c),o}function Ak(){var o,g,b,_,U;return o=f,g=Rk(),g!==c?(b=Ce(),_=Ht(),_!==c?(E=o,o=Qh(_)):(f=o,o=c)):(f=o,o=c),o===c&&(o=f,g=$k(),g!==c?(b=Ce(),_=Ht(),_!==c?(E=o,o=Yh(_)):(f=o,o=c)):(f=o,o=c),o===c&&(o=f,g=pw(),g!==c?(b=Ce(),_=bv(),_!==c?(E=o,o=Bu(_)):(f=o,o=c)):(f=o,o=c),o===c&&(o=f,g=Mk(),g!==c?(b=Ce(),_=Ht(),_!==c?(E=o,o=Xh(_)):(f=o,o=c)):(f=o,o=c),o===c&&(o=f,g=Dk(),g!==c?(b=Ce(),_=Ht(),_!==c?(E=o,o=zu(_)):(f=o,o=c)):(f=o,o=c),o===c&&(o=f,g=Fk(),g!==c?(b=Ce(),_=Ht(),_!==c?(E=o,o=Jh(_)):(f=o,o=c)):(f=o,o=c),o===c&&(o=f,g=gw(),g!==c?(b=Ce(),_=Lw(),_!==c?(E=o,o=Zh(_)):(f=o,o=c)):(f=o,o=c),o===c&&(o=f,g=vw(),g!==c?(b=Ce(),_=Lw(),_!==c?(E=o,o=Wu(_)):(f=o,o=c)):(f=o,o=c),o===c&&(o=f,g=yw(),g!==c?(b=Ce(),_=gd(),_!==c?(E=o,o=qu(_)):(f=o,o=c)):(f=o,o=c),o===c&&(o=f,g=ww(),g!==c?(b=Ce(),_=gd(),_!==c?(E=o,o=ep(_)):(f=o,o=c)):(f=o,o=c),o===c&&(o=f,g=Uk(),g!==c?(b=Ce(),_=Ht(),_!==c?(E=o,o=Vu(_)):(f=o,o=c)):(f=o,o=c),o===c&&(o=f,g=Bk(),g!==c?(b=Ce(),_=Ht(),_!==c?(E=o,o=Kl(_)):(f=o,o=c)):(f=o,o=c),o===c&&(o=f,g=zk(),g!==c?(b=Ce(),_=Ht(),_!==c?(E=o,o=Xg(_)):(f=o,o=c)):(f=o,o=c),o===c&&(o=f,g=Wk(),g!==c?(b=Ce(),_=Ht(),_!==c?(E=o,o=tp(_)):(f=o,o=c)):(f=o,o=c),o===c&&(o=f,g=Ok(),g!==c?(b=Ce(),_=Ht(),_!==c?(E=o,o=Hu(_)):(f=o,o=c)):(f=o,o=c),o===c&&(o=f,g=Lk(),g!==c?(b=Ce(),_=Ht(),_!==c?(E=o,o=np(_)):(f=o,o=c)):(f=o,o=c),o===c&&(o=f,g=mw(),g!==c?(b=Ce(),_=vS(),_!==c?(E=o,o=Gl(_)):(f=o,o=c)):(f=o,o=c),o===c&&(o=f,g=xw(),g!==c?(b=Ce(),_=bv(),_!==c?(E=o,o=Zr(_)):(f=o,o=c)):(f=o,o=c),o===c&&(o=f,g=qk(),g!==c?(b=Ce(),_=Ht(),_!==c?(E=o,o=Jg(_)):(f=o,o=c)):(f=o,o=c),o===c&&(o=f,g=Vk(),g!==c?(b=Ce(),_=Ht(),_!==c?(E=o,o=sp(_)):(f=o,o=c)):(f=o,o=c),o===c&&(o=f,g=Hk(),g!==c?(b=Ce(),_=Ht(),_!==c?(E=o,o=Ku(_)):(f=o,o=c)):(f=o,o=c),o===c&&(o=f,g=_w(),g!==c?(b=Ce(),_=gd(),_!==c?(E=o,o=rp(_)):(f=o,o=c)):(f=o,o=c),o===c&&(o=f,g=Kk(),g!==c?(b=Ce(),_=Ht(),_!==c?(E=o,o=ip(_)):(f=o,o=c)):(f=o,o=c),o===c&&(o=f,g=Gk(),g!==c?(b=Ce(),_=Ht(),_!==c?(E=o,o=Ua(_)):(f=o,o=c)):(f=o,o=c),o===c&&(o=f,g=Qk(),g!==c?(b=Ce(),_=Ht(),_!==c?(E=o,o=bs(_)):(f=o,o=c)):(f=o,o=c),o===c&&(o=f,g=Yk(),g!==c?(b=Ce(),_=Ht(),_!==c?(E=o,o=Zg(_)):(f=o,o=c)):(f=o,o=c),o===c&&(o=f,g=Xk(),g!==c?(b=Ce(),_=Ht(),_!==c?(E=o,o=ev(_)):(f=o,o=c)):(f=o,o=c),o===c&&(o=f,g=bw(),g!==c?(b=Ce(),_=Aw(),_!==c?(E=o,o=Ql(_)):(f=o,o=c)):(f=o,o=c),o===c&&(o=f,g=Cw(),g!==c?(b=Ce(),_=Aw(),_!==c?(E=o,o=Cs(_)):(f=o,o=c)):(f=o,o=c),o===c&&(o=f,g=kw(),g!==c?(b=Ce(),_=bv(),_!==c?(E=o,o=tv(_)):(f=o,o=c)):(f=o,o=c),o===c&&(o=f,g=Sw(),g!==c?(b=Ce(),_=mS(),_!==c?(E=o,o=ze(_)):(f=o,o=c)):(f=o,o=c),o===c&&(o=f,g=Jk(),g!==c?(b=Ce(),_=Ht(),_!==c?(E=o,o=Lo(_)):(f=o,o=c)):(f=o,o=c),o===c&&(o=f,g=Zk(),g!==c?(b=Ce(),_=Ht(),_!==c?(E=o,o=Gu(_)):(f=o,o=c)):(f=o,o=c),o===c&&(o=f,g=eS(),g!==c?(b=Ce(),_=Ht(),_!==c?(E=o,o=op(_)):(f=o,o=c)):(f=o,o=c),o===c&&(o=f,g=tS(),g!==c?(b=Ce(),_=Ht(),_!==c?(E=o,o=nv(_)):(f=o,o=c)):(f=o,o=c),o===c&&(o=f,g=nS(),g!==c?(b=Ce(),_=Ht(),_!==c?(E=o,o=Ba(_)):(f=o,o=c)):(f=o,o=c),o===c&&(o=f,g=Nw(),g!==c?(b=Ce(),_=gd(),_!==c?(E=o,o=Yl(_)):(f=o,o=c)):(f=o,o=c),o===c&&(o=f,g=sS(),g!==c?(b=Ce(),_=Ht(),_!==c?(E=o,o=Qu(_)):(f=o,o=c)):(f=o,o=c),o===c&&(o=f,g=rS(),g!==c?(b=Ce(),_=Ht(),_!==c?(E=o,o=ap(_)):(f=o,o=c)):(f=o,o=c),o===c&&(o=f,g=iS(),g!==c?(b=Ce(),_=Ht(),_!==c?(E=o,o=lp(_)):(f=o,o=c)):(f=o,o=c),o===c&&(o=f,g=oS(),g!==c?(b=Ce(),_=Ht(),_!==c?(E=o,o=cp(_)):(f=o,o=c)):(f=o,o=c),o===c&&(o=f,g=aS(),g!==c?(b=Ce(),_=Ht(),_!==c?(E=o,o=Yu(_)):(f=o,o=c)):(f=o,o=c),o===c&&(o=f,g=lS(),g!==c?(b=Ce(),_=Ht(),_!==c?(E=o,o=Xu(_)):(f=o,o=c)):(f=o,o=c),o===c&&(o=f,g=cS(),g!==c?(b=Ce(),_=Ht(),_!==c?(E=o,o=cs(_)):(f=o,o=c)):(f=o,o=c),o===c&&(o=f,g=Ew(),g!==c?(b=Ce(),_=fS(),_!==c?(E=o,o=Tr(_)):(f=o,o=c)):(f=o,o=c),o===c&&(o=f,g=Tw(),g!==c?(b=Ce(),_=$w(),_!==c?(E=o,o=wi(_)):(f=o,o=c)):(f=o,o=c),o===c&&(o=f,g=Iw(),g!==c?(b=Ce(),_=$w(),_!==c?(E=o,o=up(_)):(f=o,o=c)):(f=o,o=c),o===c&&(o=f,g=f,I++,b=hw(),I--,b!==c?(f=g,g=void 0):g=c,g!==c?(b=Rp(),_=Ce(),U=Ht(),U!==c?(E=o,o=dp(b,U)):(f=o,o=c)):(f=o,o=c),o===c&&(o=f,g=f,I++,b=hw(),I--,b===c?g=void 0:(f=g,g=c),g!==c?(b=Rp(),_=Ce(),U=Ht(),U!==c?(E=o,o=Ir(b,U)):(f=o,o=c)):(f=o,o=c))))))))))))))))))))))))))))))))))))))))))))))))),o}function hw(){var o;return o=pw(),o===c&&(o=gw(),o===c&&(o=vw(),o===c&&(o=yw(),o===c&&(o=ww(),o===c&&(o=mw(),o===c&&(o=xw(),o===c&&(o=_w(),o===c&&(o=bw(),o===c&&(o=Cw(),o===c&&(o=kw(),o===c&&(o=Sw(),o===c&&(o=Nw(),o===c&&(o=Ew(),o===c&&(o=Tw(),o===c&&(o=Iw()))))))))))))))),o}function Rk(){var o;return C.substr(f,5)===Ze?(o=Ze,f+=5):(o=c,I===0&&P(Zc)),o===c&&(C.substr(f,5)===st?(o=st,f+=5):(o=c,I===0&&P(Ig))),o}function $k(){var o;return C.substr(f,4)===Re?(o=Re,f+=4):(o=c,I===0&&P(jg)),o===c&&(C.substr(f,4)===Ae?(o=Ae,f+=4):(o=c,I===0&&P(wo))),o}function pw(){var o;return C.substr(f,4)===ue?(o=ue,f+=4):(o=c,I===0&&P(eu)),o===c&&(C.substr(f,4)===pe?(o=pe,f+=4):(o=c,I===0&&P(Sa))),o}function Mk(){var o;return C.substr(f,5)===$e?(o=$e,f+=5):(o=c,I===0&&P(tu)),o===c&&(C.substr(f,5)===Y?(o=Y,f+=5):(o=c,I===0&&P(zf))),o}function Ok(){var o;return C.substr(f,5)===J?(o=J,f+=5):(o=c,I===0&&P(Sl)),o===c&&(C.substr(f,5)===Se?(o=Se,f+=5):(o=c,I===0&&P(xo))),o}function Lk(){var o;return C.substr(f,5)===de?(o=de,f+=5):(o=c,I===0&&P(nu)),o===c&&(C.substr(f,5)===$?(o=$,f+=5):(o=c,I===0&&P(Wf))),o}function mw(){var o;return C.substr(f,6)===ee?(o=ee,f+=6):(o=c,I===0&&P(Nl)),o===c&&(C.substr(f,6)===Pe?(o=Pe,f+=6):(o=c,I===0&&P(qf))),o}function Dk(){var o;return C.substr(f,10)===Ee?(o=Ee,f+=10):(o=c,I===0&&P(Vf)),o===c&&(C.substr(f,10)===G?(o=G,f+=10):(o=c,I===0&&P(Hf)),o===c&&(C.substr(f,10)===ae?(o=ae,f+=10):(o=c,I===0&&P(Kf)),o===c&&(C.substr(f,10)===Ue?(o=Ue,f+=10):(o=c,I===0&&P(Gf))))),o}function Fk(){var o;return C.substr(f,10)===qe?(o=qe,f+=10):(o=c,I===0&&P(Qf)),o===c&&(C.substr(f,10)===et?(o=et,f+=10):(o=c,I===0&&P(fi)),o===c&&(C.substr(f,10)===ot?(o=ot,f+=10):(o=c,I===0&&P(su)),o===c&&(C.substr(f,10)===bt?(o=bt,f+=10):(o=c,I===0&&P(ru))))),o}function gw(){var o;return C.substr(f,8)===nn?(o=nn,f+=8):(o=c,I===0&&P(Pg)),o===c&&(C.substr(f,8)===hn?(o=hn,f+=8):(o=c,I===0&&P(Ag)),o===c&&(C.substr(f,8)===Dt?(o=Dt,f+=8):(o=c,I===0&&P(Na)),o===c&&(C.substr(f,8)===Mn?(o=Mn,f+=8):(o=c,I===0&&P(Rg)),o===c&&(C.substr(f,8)===Be?(o=Be,f+=8):(o=c,I===0&&P(Yf)))))),o}function vw(){var o;return C.substr(f,8)===Pt?(o=Pt,f+=8):(o=c,I===0&&P(Xf)),o===c&&(C.substr(f,8)===Wt?(o=Wt,f+=8):(o=c,I===0&&P(mn)),o===c&&(C.substr(f,8)===On?(o=On,f+=8):(o=c,I===0&&P(iu)),o===c&&(C.substr(f,8)===sn?(o=sn,f+=8):(o=c,I===0&&P(El)),o===c&&(C.substr(f,8)===qt?(o=qt,f+=8):(o=c,I===0&&P(Ea)))))),o}function yw(){var o;return C.substr(f,9)===ln?(o=ln,f+=9):(o=c,I===0&&P(Jf)),o===c&&(C.substr(f,9)===zn?(o=zn,f+=9):(o=c,I===0&&P(ou)),o===c&&(C.substr(f,9)===Wn?(o=Wn,f+=9):(o=c,I===0&&P(Ta)),o===c&&(C.substr(f,9)===Ts?(o=Ts,f+=9):(o=c,I===0&&P(Tl)),o===c&&(C.substr(f,9)===qn?(o=qn,f+=9):(o=c,I===0&&P(_o)))))),o}function ww(){var o;return C.substr(f,9)===cn?(o=cn,f+=9):(o=c,I===0&&P(Zf)),o===c&&(C.substr(f,9)===Ln?(o=Ln,f+=9):(o=c,I===0&&P($g)),o===c&&(C.substr(f,9)===ns?(o=ns,f+=9):(o=c,I===0&&P(Mg)),o===c&&(C.substr(f,9)===ne?(o=ne,f+=9):(o=c,I===0&&P(eh)),o===c&&(C.substr(f,9)===at?(o=at,f+=9):(o=c,I===0&&P(Il)))))),o}function Uk(){var o;return C.substr(f,7)===yt?(o=yt,f+=7):(o=c,I===0&&P(jl)),o===c&&(C.substr(f,7)===Ft?(o=Ft,f+=7):(o=c,I===0&&P(au)),o===c&&(C.substr(f,7)===Lt?(o=Lt,f+=7):(o=c,I===0&&P(lu)),o===c&&(C.substr(f,7)===En?(o=En,f+=7):(o=c,I===0&&P(cu)),o===c&&(C.substr(f,7)===Yt?(o=Yt,f+=7):(o=c,I===0&&P(uu)),o===c&&(C.substr(f,7)===Qt?(o=Qt,f+=7):(o=c,I===0&&P(Og))))))),o}function Bk(){var o;return C.substr(f,7)===Xt?(o=Xt,f+=7):(o=c,I===0&&P(th)),o===c&&(C.substr(f,7)===Tn?(o=Tn,f+=7):(o=c,I===0&&P(Lg)),o===c&&(C.substr(f,7)===gs?(o=gs,f+=7):(o=c,I===0&&P(Dg)),o===c&&(C.substr(f,7)===Vn?(o=Vn,f+=7):(o=c,I===0&&P(du)),o===c&&(C.substr(f,7)===Sn?(o=Sn,f+=7):(o=c,I===0&&P(hi)),o===c&&(C.substr(f,7)===Is?(o=Is,f+=7):(o=c,I===0&&P(nh))))))),o}function zk(){var o;return C.substr(f,9)===vs?(o=vs,f+=9):(o=c,I===0&&P(bo)),o===c&&(C.substr(f,9)===Hn?(o=Hn,f+=9):(o=c,I===0&&P(Mr)),o===c&&(C.substr(f,9)===Kn?(o=Kn,f+=9):(o=c,I===0&&P(Ia)),o===c&&(C.substr(f,9)===Hs?(o=Hs,f+=9):(o=c,I===0&&P(Gr))))),o}function Wk(){var o;return C.substr(f,9)===ys?(o=ys,f+=9):(o=c,I===0&&P(fu)),o===c&&(C.substr(f,9)===K?(o=K,f+=9):(o=c,I===0&&P(Fg)),o===c&&(C.substr(f,9)===yn?(o=yn,f+=9):(o=c,I===0&&P(Ug)),o===c&&(C.substr(f,9)===Jt?(o=Jt,f+=9):(o=c,I===0&&P(Oi))))),o}function xw(){var o;return C.substr(f,9)===An?(o=An,f+=9):(o=c,I===0&&P(ja)),o===c&&(C.substr(f,9)===Ne?(o=Ne,f+=9):(o=c,I===0&&P(Co)),o===c&&(C.substr(f,9)===In?(o=In,f+=9):(o=c,I===0&&P(Pl)),o===c&&(C.substr(f,9)===At?(o=At,f+=9):(o=c,I===0&&P(hu))))),o}function qk(){var o;return C.substr(f,12)===W?(o=W,f+=12):(o=c,I===0&&P(ko)),o===c&&(C.substr(f,12)===ie?(o=ie,f+=12):(o=c,I===0&&P(pi)),o===c&&(C.substr(f,12)===se?(o=se,f+=12):(o=c,I===0&&P(gn)),o===c&&(C.substr(f,12)===ke?(o=ke,f+=12):(o=c,I===0&&P(un))))),o}function Vk(){var o;return C.substr(f,7)===Qe?(o=Qe,f+=7):(o=c,I===0&&P(mi)),o===c&&(C.substr(f,7)===ge?(o=ge,f+=7):(o=c,I===0&&P(xs))),o}function Hk(){var o;return C.substr(f,5)===Bt?(o=Bt,f+=5):(o=c,I===0&&P(Fs)),o===c&&(C.substr(f,5)===Nt?(o=Nt,f+=5):(o=c,I===0&&P(Li))),o}function _w(){var o;return C.substr(f,5)===Rt?(o=Rt,f+=5):(o=c,I===0&&P(So)),o===c&&(C.substr(f,5)===lt?(o=lt,f+=5):(o=c,I===0&&P(Us))),o}function Kk(){var o;return C.substr(f,7)===nt?(o=nt,f+=7):(o=c,I===0&&P(Al)),o===c&&(C.substr(f,7)===ut?(o=ut,f+=7):(o=c,I===0&&P(sh))),o}function Gk(){var o;return C.substr(f,9)===Ct?(o=Ct,f+=9):(o=c,I===0&&P(rh)),o===c&&(C.substr(f,9)===kt?(o=kt,f+=9):(o=c,I===0&&P(Rl))),o}function Qk(){var o;return C.substr(f,12)===Vt?(o=Vt,f+=12):(o=c,I===0&&P(ih)),o===c&&(C.substr(f,12)===$t?(o=$t,f+=12):(o=c,I===0&&P(Qr)),o===c&&(C.substr(f,12)===Xn?(o=Xn,f+=12):(o=c,I===0&&P($l)),o===c&&(C.substr(f,12)===wn?(o=wn,f+=12):(o=c,I===0&&P(pu))))),o}function Yk(){var o;return C.substr(f,3)===ss?(o=ss,f+=3):(o=c,I===0&&P(oh)),o===c&&(C.substr(f,3)===Dn?(o=Dn,f+=3):(o=c,I===0&&P(Bg)),o===c&&(C.substr(f,3)===jn?(o=jn,f+=3):(o=c,I===0&&P(gi)))),o}function Xk(){var o;return C.substr(f,3)===ws?(o=ws,f+=3):(o=c,I===0&&P(No)),o===c&&(C.substr(f,3)===rs?(o=rs,f+=3):(o=c,I===0&&P(Eo)),o===c&&(C.substr(f,3)===Kt?(o=Kt,f+=3):(o=c,I===0&&P(Ml)))),o}function bw(){var o;return C.substr(f,4)===rn?(o=rn,f+=4):(o=c,I===0&&P(Ol)),o===c&&(C.substr(f,4)===z?(o=z,f+=4):(o=c,I===0&&P(dr))),o}function Cw(){var o;return C.substr(f,7)===Z?(o=Z,f+=7):(o=c,I===0&&P(fr)),o===c&&(C.substr(f,7)===X?(o=X,f+=7):(o=c,I===0&&P(Di)),o===c&&(C.substr(f,7)===tt?(o=tt,f+=7):(o=c,I===0&&P(Yr)),o===c&&(C.substr(f,7)===Ye?(o=Ye,f+=7):(o=c,I===0&&P(Xr)),o===c&&(C.substr(f,7)===V?(o=V,f+=7):(o=c,I===0&&P(Fi)),o===c&&(C.substr(f,7)===ye?(o=ye,f+=7):(o=c,I===0&&P(ah))))))),o}function kw(){var o;return C.substr(f,7)===Ie?(o=Ie,f+=7):(o=c,I===0&&P(mu)),o===c&&(C.substr(f,7)===Me?(o=Me,f+=7):(o=c,I===0&&P(gu)),o===c&&(C.substr(f,7)===He?(o=He,f+=7):(o=c,I===0&&P(Gs)),o===c&&(C.substr(f,7)===Zt?(o=Zt,f+=7):(o=c,I===0&&P(Qs)),o===c&&(C.substr(f,7)===zt?(o=zt,f+=7):(o=c,I===0&&P(_n)),o===c&&(C.substr(f,7)===Ls?(o=Ls,f+=7):(o=c,I===0&&P(Nr))))))),o}function Sw(){var o;return C.substr(f,11)===br?(o=br,f+=11):(o=c,I===0&&P(lh)),o===c&&(C.substr(f,11)===Hr?(o=Hr,f+=11):(o=c,I===0&&P(ch)),o===c&&(C.substr(f,11)===Cr?(o=Cr,f+=11):(o=c,I===0&&P(vu)),o===c&&(C.substr(f,11)===Mt?(o=Mt,f+=11):(o=c,I===0&&P(yu))))),o}function Jk(){var o;return C.substr(f,5)===li?(o=li,f+=5):(o=c,I===0&&P(uh)),o===c&&(C.substr(f,5)===pa?(o=pa,f+=5):(o=c,I===0&&P(Ll)),o===c&&(C.substr(f,5)===Pi?(o=Pi,f+=5):(o=c,I===0&&P(dh)),o===c&&(C.substr(f,5)===ma?(o=ma,f+=5):(o=c,I===0&&P(To))))),o}function Zk(){var o;return C.substr(f,3)===ga?(o=ga,f+=3):(o=c,I===0&&P(wu)),o===c&&(C.substr(f,3)===va?(o=va,f+=3):(o=c,I===0&&P(zg)),o===c&&(C.substr(f,3)===po?(o=po,f+=3):(o=c,I===0&&P(Pa)))),o}function eS(){var o;return C.substr(f,11)===ci?(o=ci,f+=11):(o=c,I===0&&P(Dl)),o===c&&(C.substr(f,11)===kr?(o=kr,f+=11):(o=c,I===0&&P(fh))),o}function tS(){var o;return C.substr(f,9)===ar?(o=ar,f+=9):(o=c,I===0&&P(hh)),o===c&&(C.substr(f,9)===lr?(o=lr,f+=9):(o=c,I===0&&P(Io))),o}function nS(){var o;return C.substr(f,4)===cr?(o=cr,f+=4):(o=c,I===0&&P(ph)),o===c&&(C.substr(f,4)===Kr?(o=Kr,f+=4):(o=c,I===0&&P(Fl))),o}function Nw(){var o;return C.substr(f,8)===Sr?(o=Sr,f+=8):(o=c,I===0&&P(Ul)),o===c&&(C.substr(f,8)===ya?(o=ya,f+=8):(o=c,I===0&&P(jo)),o===c&&(C.substr(f,8)===wa?(o=wa,f+=8):(o=c,I===0&&P(xu)),o===c&&(C.substr(f,8)===ui?(o=ui,f+=8):(o=c,I===0&&P(_u))))),o}function sS(){var o;return C.substr(f,7)===A?(o=A,f+=7):(o=c,I===0&&P(bu)),o===c&&(C.substr(f,7)===B?(o=B,f+=7):(o=c,I===0&&P(Cu))),o}function rS(){var o;return C.substr(f,15)===te?(o=te,f+=15):(o=c,I===0&&P(Po)),o}function iS(){var o;return C.substr(f,15)===fe?(o=fe,f+=15):(o=c,I===0&&P(hr)),o}function oS(){var o;return C.substr(f,11)===Oe?(o=Oe,f+=11):(o=c,I===0&&P(Ui)),o}function aS(){var o;return C.substr(f,11)===dt?(o=dt,f+=11):(o=c,I===0&&P(ku)),o}function lS(){var o;return C.substr(f,9)===xn?(o=xn,f+=9):(o=c,I===0&&P(mh)),o}function cS(){var o;return C.substr(f,9)===is?(o=is,f+=9):(o=c,I===0&&P(Jr)),o}function Ew(){var o;return C.substr(f,5)===Fn?(o=Fn,f+=5):(o=c,I===0&&P(vi)),o}function Tw(){var o;return C.substr(f,10)===ft?(o=ft,f+=10):(o=c,I===0&&P(Su)),o}function Iw(){var o;return C.substr(f,10)===pn?(o=pn,f+=10):(o=c,I===0&&P(gh)),o}function Ce(){var o,g;for(I++,o=[],Mi.test(C.charAt(f))?(g=C.charAt(f),f++):(g=c,I===0&&P(Ys));g!==c;)o.push(g),Mi.test(C.charAt(f))?(g=C.charAt(f),f++):(g=c,I===0&&P(Ys));return I--,g=c,I===0&&P(Or),o}function hc(){var o,g;if(o=[],Mi.test(C.charAt(f))?(g=C.charAt(f),f++):(g=c,I===0&&P(Ys)),g!==c)for(;g!==c;)o.push(g),Mi.test(C.charAt(f))?(g=C.charAt(f),f++):(g=c,I===0&&P(Ys));else o=c;return o}function uS(){var o,g;if(o=[],Of.test(C.charAt(f))?(g=C.charAt(f),f++):(g=c,I===0&&P(Aa)),g!==c)for(;g!==c;)o.push(g),Of.test(C.charAt(f))?(g=C.charAt(f),f++):(g=c,I===0&&P(Aa));else o=c;return o}function Rp(){var o,g,b;for(o=f,g=[],Lf.test(C.charAt(f))?(b=C.charAt(f),f++):(b=c,I===0&&P(Nu));b!==c;)g.push(b),Lf.test(C.charAt(f))?(b=C.charAt(f),f++):(b=c,I===0&&P(Nu));return E=o,g=fp(g),o=g,o}function ks(){var o;return C.charCodeAt(f)===34?(o=en,f++):(o=c,I===0&&P(Bi)),o}function Ht(){var o,g,b,_,U;if(o=f,C.charCodeAt(f)===34?(g=en,f++):(g=c,I===0&&P(Bi)),g!==c){for(Pw(),b=[],_=jw();_!==c;)b.push(_),_=jw();_=Pw(),C.charCodeAt(f)===34?(U=en,f++):(U=c,I===0&&P(Bi)),U!==c?(E=o,o=Dr(b)):(f=o,o=c)}else f=o,o=c;return o}function jw(){var o,g,b,_;return Tg.test(C.charAt(f))?(o=C.charAt(f),f++):(o=c,I===0&&P(vh)),o===c&&(o=f,g=dS(),g!==c?(b=f,C.charCodeAt(f)===92?(_=Nn,f++):(_=c,I===0&&P(Ao)),_!==c&&(E=b,_=sv()),b=_,b===c&&(b=f,C.charCodeAt(f)===34?(_=en,f++):(_=c,I===0&&P(Bi)),_!==c&&(E=b,_=hp()),b=_),b!==c?(E=o,o=pp(b)):(f=o,o=c)):(f=o,o=c)),o}function Pw(){var o,g;for(I++,o=[],Mi.test(C.charAt(f))?(g=C.charAt(f),f++):(g=c,I===0&&P(Ys));g!==c;)o.push(g),Mi.test(C.charAt(f))?(g=C.charAt(f),f++):(g=c,I===0&&P(Ys));return I--,g=c,I===0&&P(Or),o}function dS(){var o;return C.charCodeAt(f)===92?(o=Nn,f++):(o=c,I===0&&P(Ao)),o}function bv(){var o,g,b,_,U,oe,we,We,_t;return o=f,g=ks(),g!==c?(b=f,di.test(C.charAt(f))?(_=C.charAt(f),f++):(_=c,I===0&&P(os)),_!==c?(di.test(C.charAt(f))?(U=C.charAt(f),f++):(U=c,I===0&&P(os)),U!==c?(di.test(C.charAt(f))?(oe=C.charAt(f),f++):(oe=c,I===0&&P(os)),oe!==c?(di.test(C.charAt(f))?(we=C.charAt(f),f++):(we=c,I===0&&P(os)),we!==c?(_=[_,U,oe,we],b=_):(f=b,b=c)):(f=b,b=c)):(f=b,b=c)):(f=b,b=c),b!==c?(C.charCodeAt(f)===46?(_=St,f++):(_=c,I===0&&P(yi)),_!==c?(U=f,di.test(C.charAt(f))?(oe=C.charAt(f),f++):(oe=c,I===0&&P(os)),oe!==c?(di.test(C.charAt(f))?(we=C.charAt(f),f++):(we=c,I===0&&P(os)),we!==c?(oe=[oe,we],U=oe):(f=U,U=c)):(f=U,U=c),U!==c?(C.charCodeAt(f)===46?(oe=St,f++):(oe=c,I===0&&P(yi)),oe!==c?(we=f,di.test(C.charAt(f))?(We=C.charAt(f),f++):(We=c,I===0&&P(os)),We!==c?(di.test(C.charAt(f))?(_t=C.charAt(f),f++):(_t=c,I===0&&P(os)),_t!==c?(We=[We,_t],we=We):(f=we,we=c)):(f=we,we=c),we!==c?(We=ks(),We!==c?(E=o,o=mp(b,U,we)):(f=o,o=c)):(f=o,o=c)):(f=o,o=c)):(f=o,o=c)):(f=o,o=c)):(f=o,o=c)):(f=o,o=c),o}function Aw(){var o,g,b,_,U,oe,we,We,_t;if(o=f,g=ks(),g!==c){if(b=[],Ks.test(C.charAt(f))?(_=C.charAt(f),f++):(_=c,I===0&&P(as)),_!==c)for(;_!==c;)b.push(_),Ks.test(C.charAt(f))?(_=C.charAt(f),f++):(_=c,I===0&&P(as));else b=c;if(b!==c)if(C.charCodeAt(f)===58?(_=tn,f++):(_=c,I===0&&P(pr)),_!==c){if(U=[],Ks.test(C.charAt(f))?(oe=C.charAt(f),f++):(oe=c,I===0&&P(as)),oe!==c)for(;oe!==c;)U.push(oe),Ks.test(C.charAt(f))?(oe=C.charAt(f),f++):(oe=c,I===0&&P(as));else U=c;if(U!==c)if(C.charCodeAt(f)===58?(oe=tn,f++):(oe=c,I===0&&P(pr)),oe!==c){if(we=[],Ks.test(C.charAt(f))?(We=C.charAt(f),f++):(We=c,I===0&&P(as)),We!==c)for(;We!==c;)we.push(We),Ks.test(C.charAt(f))?(We=C.charAt(f),f++):(We=c,I===0&&P(as));else we=c;we!==c?(We=Rw(),We===c&&(We=null),_t=ks(),_t!==c?(E=o,o=gp(b,U,we,We)):(f=o,o=c)):(f=o,o=c)}else f=o,o=c;else f=o,o=c}else f=o,o=c;else f=o,o=c}else f=o,o=c;return o}function Rw(){var o,g,b,_;if(o=f,C.charCodeAt(f)===46?(g=St,f++):(g=c,I===0&&P(yi)),g!==c){if(b=[],Ks.test(C.charAt(f))?(_=C.charAt(f),f++):(_=c,I===0&&P(as)),_!==c)for(;_!==c;)b.push(_),Ks.test(C.charAt(f))?(_=C.charAt(f),f++):(_=c,I===0&&P(as));else b=c;b!==c?(E=o,o=rv(b)):(f=o,o=c)}else f=o,o=c;return o}function fS(){var o,g,b,_;return o=f,g=ks(),g!==c?(b=hS(),b!==c?(_=ks(),_!==c?(E=o,o=Xl(b)):(f=o,o=c)):(f=o,o=c)):(f=o,o=c),o}function hS(){var o,g,b,_;return o=f,g=pS(),g!==c?(C.charCodeAt(f)===47?(b=js,f++):(b=c,I===0&&P(Ra)),b!==c?(_=Mw(),_!==c?(E=o,o=Ju(g,_)):(f=o,o=c)):(f=o,o=c)):(f=o,o=c),o}function pS(){var o;return C.charCodeAt(f)===66?(o=Ai,f++):(o=c,I===0&&P(zi)),o===c&&(C.charCodeAt(f)===87?(o=gl,f++):(o=c,I===0&&P(yh)),o===c&&(C.charCodeAt(f)===78?(o=pf,f++):(o=c,I===0&&P(Eu)))),o}function $w(){var o,g,b,_;return o=f,g=ks(),g!==c?(b=Mw(),b!==c?(_=ks(),_!==c?(E=o,o=gr(b)):(f=o,o=c)):(f=o,o=c)):(f=o,o=c),o}function Mw(){var o,g;return o=f,g=Ww(),g!==c&&(E=o,g=Ut(g)),o=g,o}function mS(){var o,g,b,_;return o=f,g=ks(),g!==c?(b=gS(),_=ks(),_!==c?(E=o,o=Zn(b)):(f=o,o=c)):(f=o,o=c),o}function gS(){var o,g,b,_,U,oe,we;if(o=f,g=f,b=Cv(),b!==c){for(_=[],U=f,C.charCodeAt(f)===58?(oe=tn,f++):(oe=c,I===0&&P(pr)),oe!==c?(we=Cv(),we!==c?(E=U,U=Rn(b,we)):(f=U,U=c)):(f=U,U=c);U!==c;)_.push(U),U=f,C.charCodeAt(f)===58?(oe=tn,f++):(oe=c,I===0&&P(pr)),oe!==c?(we=Cv(),we!==c?(E=U,U=Rn(b,we)):(f=U,U=c)):(f=U,U=c);E=g,g=us(b,_)}else f=g,g=c;return g===c&&(g=null),E=o,g=Xs(g),o=g,o}function Cv(){var o,g,b,_,U,oe;return o=f,C.charCodeAt(f)===63?(g=xa,f++):(g=c,I===0&&P(bn)),g!==c&&(E=o,g=Do()),o=g,o===c&&(o=f,C.charCodeAt(f)===45?(g=mo,f++):(g=c,I===0&&P(Ro)),g!==c&&(E=o,g=Qn()),o=g,o===c&&(o=f,g=ti(),g!==c?(C.charCodeAt(f)===47?(b=js,f++):(b=c,I===0&&P(Ra)),b!==c?(_=ti(),_!==c?(C.charCodeAt(f)===43?(U=vl,f++):(U=c,I===0&&P($a)),U!==c?(oe=ti(),oe!==c?(E=o,o=za(g,_,oe)):(f=o,o=c)):(f=o,o=c)):(f=o,o=c)):(f=o,o=c)):(f=o,o=c),o===c&&(o=f,g=ti(),g!==c?(C.charCodeAt(f)===47?(b=js,f++):(b=c,I===0&&P(Ra)),b!==c?(_=ti(),_!==c?(E=o,o=qi(g,_)):(f=o,o=c)):(f=o,o=c)):(f=o,o=c),o===c&&(o=f,g=ti(),g!==c?(C.charCodeAt(f)===43?(b=vl,f++):(b=c,I===0&&P($a)),b!==c?(_=ti(),_!==c?(E=o,o=Jl(g,_)):(f=o,o=c)):(f=o,o=c)):(f=o,o=c),o===c&&(o=f,g=ti(),g!==c&&(E=o,g=Zu(g)),o=g,o===c&&(o=f,C.charCodeAt(f)===42?(g=Ds,f++):(g=c,I===0&&P(Bl)),g!==c?(b=ti(),b!==c?(E=o,o=Wa(b)):(f=o,o=c)):(f=o,o=c))))))),o}function vS(){var o,g,b,_;return o=f,g=ks(),g!==c?(b=Ow(),b!==c?(_=ks(),_!==c?(E=o,o=zs(b)):(f=o,o=c)):(f=o,o=c)):(f=o,o=c),o}function Ow(){var o,g;return o=f,C.substr(f,3)===Ri?(g=Ri,f+=3):(g=c,I===0&&P(zl)),g!==c&&(E=o,g=ed(g)),o=g,o===c&&(o=f,C.substr(f,3)===yl?(g=yl,f+=3):(g=c,I===0&&P(Tu)),g!==c&&(E=o,g=Fo(g)),o=g,o===c&&(o=f,C.substr(f,7)===go?(g=go,f+=7):(g=c,I===0&&P(Wi)),g!==c&&(E=o,g=ei(g)),o=g,o===c&&(o=f,C.charCodeAt(f)===42?(g=Ds,f++):(g=c,I===0&&P(Bl)),g!==c&&(E=o,g=Zl(g)),o=g))),o}function Lw(){var o,g,b,_;return o=f,g=gd(),g!==c&&(E=o,g=td(g)),o=g,o===c&&(o=f,g=ks(),g!==c?(C.charCodeAt(f)===45?(b=mo,f++):(b=c,I===0&&P(Ro)),b!==c?(_=ks(),_!==c?(E=o,o=xi()):(f=o,o=c)):(f=o,o=c)):(f=o,o=c),o===c&&(o=f,g=ks(),g!==c?(b=ks(),b!==c?(E=o,o=ec()):(f=o,o=c)):(f=o,o=c))),o}function gd(){var o,g,b,_;if(o=f,g=ks(),g!==c){if(b=[],Ks.test(C.charAt(f))?(_=C.charAt(f),f++):(_=c,I===0&&P(as)),_!==c)for(;_!==c;)b.push(_),Ks.test(C.charAt(f))?(_=C.charAt(f),f++):(_=c,I===0&&P(as));else b=c;b!==c?(_=ks(),_!==c?(E=o,o=_i(b)):(f=o,o=c)):(f=o,o=c)}else f=o,o=c;return o}function vd(){var o,g,b,_,U,oe,we,We,_t,on;return o=f,Pp(),g=Ce(),b=kv(),b===c&&(b=null),Ce(),_=IS(),_===c&&(_=null),Ce(),U=jS(),U!==c?(Ce(),oe=Yw(),oe===c&&(oe=null),we=yS(),we===c&&(we=null),Ce(),We=kv(),We===c&&(We=null),Ce(),_t=Vw(),_t===c&&(_t=null),on=vd(),on===c&&(on=null),E=o,o=tc(b,_,U,oe,we,We,_t,on)):(f=o,o=c),o===c&&(o=f,Ce(),g=wS(),g!==c?(b=Ce(),E=o,o=qa(g)):(f=o,o=c)),o}function yS(){var o,g,b,_;return o=f,g=Hw(),g!==c?(C.charCodeAt(f)===61?(b=mf,f++):(b=c,I===0&&P(vn)),b!==c?(_=Kw(),_!==c?(g=[g,b,_],o=g):(f=o,o=c)):(f=o,o=c)):(f=o,o=c),o}function wS(){var o,g;return o=f,g=Ow(),g!==c&&(E=o,g=nd(g)),o=g,o}function kv(){var o,g,b,_,U;if(o=f,g=Sv(),g!==c){for(b=[],_=f,Ce(),U=Sv(),U!==c?(E=_,_=Va(g,U)):(f=_,_=c);_!==c;)b.push(_),_=f,Ce(),U=Sv(),U!==c?(E=_,_=Va(g,U)):(f=_,_=c);E=o,o=nc(g,b)}else f=o,o=c;return o}function Sv(){var o,g,b,_;return o=f,g=Bw(),g!==c?(b=zw(),b!==c?(E=o,o=Ps()):(f=o,o=c)):(f=o,o=c),o===c&&(o=f,g=Bw(),g!==c?(b=Js(),b!==c?(_=zw(),_!==c?(E=o,o=bi(b)):(f=o,o=c)):(f=o,o=c)):(f=o,o=c),o===c&&(o=f,g=xS(),g!==c&&(E=o,g=jr(g)),o=g)),o}function Js(){var o,g,b,_,U,oe,we,We,_t,on,Et,it,es;if(o=f,g=Ce(),b=Ka(),b!==c)if(C.substr(f,4)===wl?(_=wl,f+=4):(_=c,I===0&&P(Gn)),_!==c)if(U=hc(),U!==c)if(oe=_S(),oe===c&&(oe=null),we=Ce(),We=Bo(),We!==c){for(_t=Ce(),on=[],Et=f,it=Js(),it!==c&&(E=Et,it=As(oe,it)),Et=it;Et!==c;)on.push(Et),Et=f,it=Js(),it!==c&&(E=Et,it=As(oe,it)),Et=it;E=o,o=vp(oe,on)}else f=o,o=c;else f=o,o=c;else f=o,o=c;else f=o,o=c;if(o===c){if(o=f,g=Ce(),b=Ka(),b!==c)if(C.substr(f,4)===xl?(_=xl,f+=4):(_=c,I===0&&P(Jn)),_!==c)if(U=hc(),U!==c)if(oe=bS(),oe===c&&(oe=null),we=Ce(),We=Bo(),We!==c){for(_t=Ce(),on=[],Et=f,it=Js(),it!==c&&(E=Et,it=sc(oe,it)),Et=it;Et!==c;)on.push(Et),Et=f,it=Js(),it!==c&&(E=Et,it=sc(oe,it)),Et=it;E=o,o=sd(oe,on)}else f=o,o=c;else f=o,o=c;else f=o,o=c;else f=o,o=c;if(o===c){if(o=f,g=Ce(),b=Ka(),b!==c)if(C.charCodeAt(f)===37?(_=$i,f++):(_=c,I===0&&P($o)),_!==c)if(U=kS(),U!==c)if(oe=hc(),oe!==c)if(we=Ww(),we!==c)if(We=Ce(),_t=Bo(),_t!==c){for(on=Ce(),Et=[],it=f,es=Js(),es!==c&&(E=it,es=yp(U,we,es)),it=es;it!==c;)Et.push(it),it=f,es=Js(),es!==c&&(E=it,es=yp(U,we,es)),it=es;E=o,o=Ci(U,we,Et)}else f=o,o=c;else f=o,o=c;else f=o,o=c;else f=o,o=c;else f=o,o=c;else f=o,o=c;if(o===c){if(o=f,g=Ce(),b=Ka(),b!==c)if(C.charCodeAt(f)===37?(_=$i,f++):(_=c,I===0&&P($o)),_!==c)if(U=SS(),U!==c)if(oe=hc(),oe!==c)if(we=NS(),we!==c)if(We=Ce(),_t=Bo(),_t!==c){for(on=Ce(),Et=[],it=f,es=Js(),es!==c&&(E=it,es=rd(U,we,es)),it=es;it!==c;)Et.push(it),it=f,es=Js(),es!==c&&(E=it,es=rd(U,we,es)),it=es;E=o,o=id(U,we,Et)}else f=o,o=c;else f=o,o=c;else f=o,o=c;else f=o,o=c;else f=o,o=c;else f=o,o=c;if(o===c){if(o=f,g=Ce(),b=Ka(),b!==c)if(C.substr(f,5)===_a?(_=_a,f+=5):(_=c,I===0&&P(Ma)),_!==c)if(U=hc(),U!==c)if(oe=Rp(),we=Ce(),We=Bo(),We!==c){for(_t=Ce(),on=[],Et=f,it=Js(),it!==c&&(E=Et,it=ki(oe,it)),Et=it;Et!==c;)on.push(Et),Et=f,it=Js(),it!==c&&(E=Et,it=ki(oe,it)),Et=it;E=o,o=od(oe,on)}else f=o,o=c;else f=o,o=c;else f=o,o=c;else f=o,o=c;if(o===c){if(o=f,g=Ce(),b=Ka(),b!==c)if(C.charCodeAt(f)===37?(_=$i,f++):(_=c,I===0&&P($o)),_!==c)if(U=Rp(),oe=hc(),oe!==c){if(we=[],We=Fw(),We!==c)for(;We!==c;)we.push(We),We=Fw();else we=c;if(we!==c)if(We=Bo(),We!==c){for(_t=Ce(),on=[],Et=f,it=Js(),it!==c&&(E=Et,it=Si(U,we,it)),Et=it;Et!==c;)on.push(Et),Et=f,it=Js(),it!==c&&(E=Et,it=Si(U,we,it)),Et=it;E=o,o=wp(U,we,on)}else f=o,o=c;else f=o,o=c}else f=o,o=c;else f=o,o=c;else f=o,o=c;if(o===c){if(o=f,g=[],b=Dw(),b!==c)for(;b!==c;)g.push(b),b=Dw();else g=c;if(g!==c){for(b=[],_=f,U=Ce(),oe=Js(),oe!==c?(E=_,_=ad(g,oe)):(f=_,_=c);_!==c;)b.push(_),_=f,U=Ce(),oe=Js(),oe!==c?(E=_,_=ad(g,oe)):(f=_,_=c);E=o,o=ld(g,b)}else f=o,o=c}}}}}}return o}function Dw(){var o,g,b,_;return o=f,g=f,I++,C.substr(f,2)===Vc?(b=Vc,f+=2):(b=c,I===0&&P(Oa)),I--,b===c?g=void 0:(f=g,g=c),g!==c?(b=f,I++,C.charCodeAt(f)===125?(_=gf,f++):(_=c,I===0&&P(wh)),I--,_===c?b=void 0:(f=b,b=c),b!==c?(C.length>f?(_=C.charAt(f),f++):(_=c,I===0&&P(ls)),_!==c?(E=o,o=rc(_)):(f=o,o=c)):(f=o,o=c)):(f=o,o=c),o}function Fw(){var o,g,b;return o=f,g=f,I++,b=Bo(),I--,b===c?g=void 0:(f=g,g=c),g!==c?(C.length>f?(b=C.charAt(f),f++):(b=c,I===0&&P(ls)),b!==c?(E=o,o=iv(b)):(f=o,o=c)):(f=o,o=c),o}function xS(){var o,g,b,_;if(o=f,g=CS(),g!==c){for(b=[],ur.test(C.charAt(f))?(_=C.charAt(f),f++):(_=c,I===0&&P(Wl));_!==c;)b.push(_),ur.test(C.charAt(f))?(_=C.charAt(f),f++):(_=c,I===0&&P(Wl));_=uS(),_!==c?(E=o,o=ov(b)):(f=o,o=c)}else f=o,o=c;return o}function _S(){var o,g,b,_,U,oe,we;if(o=f,g=Nv(),g!==c){for(Ce(),b=[],_=f,C.charCodeAt(f)===44?(U=_l,f++):(U=c,I===0&&P(Mo)),U!==c?(oe=Ce(),we=Nv(),we!==c?(U=[U,oe,we],_=U):(f=_,_=c)):(f=_,_=c);_!==c;)b.push(_),_=f,C.charCodeAt(f)===44?(U=_l,f++):(U=c,I===0&&P(Mo)),U!==c?(oe=Ce(),we=Nv(),we!==c?(U=[U,oe,we],_=U):(f=_,_=c)):(f=_,_=c);E=o,o=xp(g,b)}else f=o,o=c;return o}function Nv(){var o,g,b;return o=f,g=Uw(),g!==c?(b=Tv(),b!==c?(E=o,o=_p(g,b)):(f=o,o=c)):(f=o,o=c),o}function bS(){var o,g,b,_,U,oe,we;if(o=f,g=Ev(),g!==c){for(Ce(),b=[],_=f,C.charCodeAt(f)===44?(U=_l,f++):(U=c,I===0&&P(Mo)),U!==c?(oe=Ce(),we=Ev(),we!==c?(U=[U,oe,we],_=U):(f=_,_=c)):(f=_,_=c);_!==c;)b.push(_),_=f,C.charCodeAt(f)===44?(U=_l,f++):(U=c,I===0&&P(Mo)),U!==c?(oe=Ce(),we=Ev(),we!==c?(U=[U,oe,we],_=U):(f=_,_=c)):(f=_,_=c);E=o,o=Vi(g,b)}else f=o,o=c;return o}function Ev(){var o,g,b,_;return o=f,g=Uw(),g!==c?(b=Tv(),b!==c?(_=Tv(),_!==c?(E=o,o=av(g,b,_)):(f=o,o=c)):(f=o,o=c)):(f=o,o=c),o}function Uw(){var o,g;return o=f,C.charCodeAt(f)===89?(g=hg,f++):(g=c,I===0&&P(Iu)),g!==c&&(E=o,g=Uo()),o=g,o===c&&(o=f,C.charCodeAt(f)===71?(g=Hc,f++):(g=c,I===0&&P(Lr)),g!==c&&(E=o,g=bp()),o=g,o===c&&(o=f,C.charCodeAt(f)===82?(g=pg,f++):(g=c,I===0&&P(mr)),g!==c&&(E=o,g=Pn()),o=g,o===c&&(o=f,C.charCodeAt(f)===66?(g=Ai,f++):(g=c,I===0&&P(zi)),g!==c&&(E=o,g=lv()),o=g,o===c&&(o=f,C.charCodeAt(f)===79?(g=mg,f++):(g=c,I===0&&P(La)),g!==c&&(E=o,g=Cp()),o=g,o===c&&(o=f,C.charCodeAt(f)===67?(g=gg,f++):(g=c,I===0&&P(ju)),g!==c&&(E=o,g=cv()),o=g))))),o}function Tv(){var o,g,b;return o=f,g=Wo(),g!==c?(b=qo(),b!==c?(E=o,o=uv(g,b)):(f=o,o=c)):(f=o,o=c),o}function Bw(){var o;return C.charCodeAt(f)===123?(o=vg,f++):(o=c,I===0&&P(Pu)),o}function zw(){var o;return C.charCodeAt(f)===125?(o=gf,f++):(o=c,I===0&&P(wh)),o}function Ka(){var o;return C.charCodeAt(f)===91?(o=yg,f++):(o=c,I===0&&P(xh)),o}function Bo(){var o;return C.charCodeAt(f)===93?(o=vf,f++):(o=c,I===0&&P(_h)),o}function CS(){var o;return C.charCodeAt(f)===59?(o=wg,f++):(o=c,I===0&&P(bh)),o}function kS(){var o,g;return o=f,C.substr(f,3)===yf?(g=yf,f+=3):(g=c,I===0&&P(Ch)),g!==c&&(E=o,g=kp()),o=g,o===c&&(o=f,C.substr(f,3)===wf?(g=wf,f+=3):(g=c,I===0&&P(kh)),g!==c&&(E=o,g=Sp()),o=g,o===c&&(o=f,C.substr(f,3)===xf?(g=xf,f+=3):(g=c,I===0&&P(Sh)),g!==c&&(E=o,g=dv()),o=g)),o}function SS(){var o,g;return o=f,C.substr(f,3)===bl?(g=bl,f+=3):(g=c,I===0&&P(Nh)),g!==c&&(E=o,g=vr()),o=g,o}function Ww(){var o,g,b,_,U;return o=f,g=qw(),g===c&&(g=null),b=zo(),b!==c?(_=zo(),_===c&&(_=null),U=Rw(),U===c&&(U=null),E=o,o=cd(g,b,_,U)):(f=o,o=c),o}function NS(){var o,g,b,_;return o=f,g=qw(),g===c&&(g=null),b=zo(),b!==c?(_=zo(),_===c&&(_=null),E=o,o=fv(g,b,_)):(f=o,o=c),o}function qw(){var o,g,b;return o=f,g=ES(),g!==c?(b=TS(),b===c&&(b=null),E=o,o=Ni(g,b)):(f=o,o=c),o}function ES(){var o,g,b,_;return o=f,g=zo(),g!==c?(b=zo(),b===c&&(b=null),C.charCodeAt(f)===58?(_=tn,f++):(_=c,I===0&&P(pr)),_!==c?(E=o,o=ic(g,b)):(f=o,o=c)):(f=o,o=c),o}function TS(){var o,g,b,_;return o=f,g=zo(),g!==c?(b=zo(),b===c&&(b=null),C.charCodeAt(f)===58?(_=tn,f++):(_=c,I===0&&P(pr)),_!==c?(E=o,o=Hi(g,b)):(f=o,o=c)):(f=o,o=c),o}function zo(){var o,g;return o=f,Ks.test(C.charAt(f))?(g=C.charAt(f),f++):(g=c,I===0&&P(as)),g!==c&&(E=o,g=oc(g)),o=g,o}function Vw(){var o,g,b,_,U;return o=f,g=Hw(),g!==c?(b=vd(),b!==c?(_=Kw(),_!==c?(Ce(),U=Vw(),U===c&&(U=null),E=o,o=ud(b,U)):(f=o,o=c)):(f=o,o=c)):(f=o,o=c),o}function Hw(){var o;return C.charCodeAt(f)===40?(o=xg,f++):(o=c,I===0&&P(Eh)),o}function Kw(){var o;return C.charCodeAt(f)===41?(o=_g,f++):(o=c,I===0&&P(Da)),o}function IS(){var o,g,b,_,U;if(o=f,g=ti(),g!==c){for(b=[],_=Qw();_!==c;)b.push(_),_=Qw();for(_=[],U=Gw();U!==c;)_.push(U),U=Gw();E=o,o=dd(g)}else f=o,o=c;return o}function Gw(){var o;return C.charCodeAt(f)===46?(o=St,f++):(o=c,I===0&&P(yi)),o}function ti(){var o,g,b;if(I++,o=f,g=[],Ks.test(C.charAt(f))?(b=C.charAt(f),f++):(b=c,I===0&&P(as)),b!==c)for(;b!==c;)g.push(b),Ks.test(C.charAt(f))?(b=C.charAt(f),f++):(b=c,I===0&&P(as));else g=c;return g!==c&&(E=o,g=hv(g)),o=g,I--,o===c&&(g=c,I===0&&P(Th)),o}function Qw(){var o,g,b;if(o=f,g=[],C.charCodeAt(f)===32?(b=_f,f++):(b=c,I===0&&P(Fa)),b!==c)for(;b!==c;)g.push(b),C.charCodeAt(f)===32?(b=_f,f++):(b=c,I===0&&P(Fa));else g=c;return g!==c&&(E=o,g=fd()),o=g,o}function jS(){var o,g,b,_,U,oe,we,We,_t;return o=f,g=$p(),g===c&&(g=null),b=f,I++,_=AS(),I--,_!==c?(f=b,b=void 0):b=c,b!==c?(_=Xw(),_!==c?(U=jv(),U===c&&(U=null),oe=Wo(),oe!==c?(we=qo(),we!==c?(We=Iv(),We===c&&(We=null),_t=yd(),_t===c&&(_t=null),Ce(),C.substr(f,4)===bf?f+=4:I===0&&P(ql),E=o,o=pv(g,_,U,oe,we,We,_t)):(f=o,o=c)):(f=o,o=c)):(f=o,o=c)):(f=o,o=c),o===c&&(o=f,g=$p(),g===c&&(g=null),b=Wo(),b!==c?(_=qo(),_!==c?(U=$S(),U===c&&(U=null),oe=Wo(),oe!==c?(we=qo(),we!==c?(We=Iv(),We===c&&(We=null),_t=yd(),_t===c&&(_t=null),E=o,o=Np(g,b,_,U,oe,we,We,_t)):(f=o,o=c)):(f=o,o=c)):(f=o,o=c)):(f=o,o=c),o===c&&(o=f,g=$p(),g===c&&(g=null),b=jv(),b===c&&(b=null),_=Wo(),_!==c?(U=qo(),U!==c?(oe=Iv(),oe===c&&(oe=null),we=yd(),we===c&&(we=null),E=o,o=Ep(g,b,_,U,oe,we)):(f=o,o=c)):(f=o,o=c),o===c&&(o=f,C.substr(f,5)===Cf?(g=Cf,f+=5):(g=c,I===0&&P(Ih)),g!==c?(b=yd(),b===c&&(b=null),E=o,o=ac(b)):(f=o,o=c),o===c&&(o=f,C.substr(f,3)===kf?(g=kf,f+=3):(g=c,I===0&&P(Au)),g!==c?(b=yd(),b===c&&(b=null),E=o,o=lc(b)):(f=o,o=c),o===c&&(o=f,g=$p(),g!==c?(C.charCodeAt(f)===64?(b=bg,f++):(b=c,I===0&&P(jh)),b!==c?(_=Wo(),_!==c?(U=qo(),U!==c?(E=o,o=Tp(g,_,U)):(f=o,o=c)):(f=o,o=c)):(f=o,o=c)):(f=o,o=c),o===c&&(o=f,C.substr(f,2)===Sf?(g=Sf,f+=2):(g=c,I===0&&P(Ph)),g!==c&&(E=o,g=hd()),o=g)))))),o}function yd(){var o,g,b,_;return o=f,g=f,b=f,I++,C.substr(f,2)===Cl?(_=Cl,f+=2):(_=c,I===0&&P(Ru)),I--,_===c?b=void 0:(f=b,b=c),b!==c?(C.charCodeAt(f)===43?(_=vl,f++):(_=c,I===0&&P($a)),_!==c?(b=[b,_],g=b):(f=g,g=c)):(f=g,g=c),g!==c&&(E=o,g=mv(g)),o=g,o===c&&(o=f,g=f,b=f,I++,C.substr(f,3)===Nf?(_=Nf,f+=3):(_=c,I===0&&P(Ah)),I--,_===c?b=void 0:(f=b,b=c),b!==c?(C.charCodeAt(f)===35?(_=Cg,f++):(_=c,I===0&&P($u)),_!==c?(b=[b,_],g=b):(f=g,g=c)):(f=g,g=c),g!==c&&(E=o,g=Ip(g)),o=g),o}function Iv(){var o,g;return o=f,C.charCodeAt(f)===61?f++:I===0&&P(vn),g=RS(),g!==c?(E=o,o=pd(g)):(f=o,o=c),o}function Yw(){var o,g,b;return o=f,g=PS(),g!==c?(Ce(),b=Yw(),b===c&&(b=null),E=o,o=cc(g,b)):(f=o,o=c),o}function PS(){var o,g,b;return o=f,C.charCodeAt(f)===36?(g=Kc,f++):(g=c,I===0&&P(Rh)),g!==c?(b=ti(),b!==c?(E=o,o=md(b)):(f=o,o=c)):(f=o,o=c),o===c&&(o=f,C.substr(f,2)===vo?(g=vo,f+=2):(g=c,I===0&&P($h)),g!==c&&(E=o,g=uc()),o=g,o===c&&(o=f,C.substr(f,2)===Ef?(g=Ef,f+=2):(g=c,I===0&&P(Mh)),g!==c&&(E=o,g=jp()),o=g,o===c&&(o=f,C.substr(f,2)===Gc?(g=Gc,f+=2):(g=c,I===0&&P(Wg)),g!==c&&(E=o,g=gv()),o=g,o===c&&(o=f,C.substr(f,2)===Qc?(g=Qc,f+=2):(g=c,I===0&&P(Oh)),g!==c&&(E=o,g=dc()),o=g,o===c&&(o=f,C.charCodeAt(f)===33?(g=Tf,f++):(g=c,I===0&&P(qg)),g!==c&&(E=o,g=vv()),o=g,o===c&&(o=f,C.charCodeAt(f)===63?(g=xa,f++):(g=c,I===0&&P(bn)),g!==c&&(E=o,g=Ha()),o=g,o===c&&(o=f,C.charCodeAt(f)===8252?(g=If,f++):(g=c,I===0&&P(Vg)),g!==c&&(E=o,g=yv()),o=g,o===c&&(o=f,C.charCodeAt(f)===8263?(g=jf,f++):(g=c,I===0&&P(Lh)),g!==c&&(E=o,g=fc()),o=g,o===c&&(o=f,C.charCodeAt(f)===8265?(g=yo,f++):(g=c,I===0&&P(Dh)),g!==c&&(E=o,g=s()),o=g,o===c&&(o=f,C.charCodeAt(f)===8264?(g=kg,f++):(g=c,I===0&&P(Fh)),g!==c&&(E=o,g=i()),o=g,o===c&&(o=f,C.charCodeAt(f)===9633?(g=Sg,f++):(g=c,I===0&&P(Vl)),g!==c&&(E=o,g=l()),o=g,o===c&&(o=f,C.charCodeAt(f)===61?(g=mf,f++):(g=c,I===0&&P(vn)),g!==c&&(E=o,g=p()),o=g,o===c&&(o=f,C.charCodeAt(f)===8734?(g=Ng,f++):(g=c,I===0&&P(Hg)),g!==c&&(E=o,g=v()),o=g,o===c&&(o=f,C.charCodeAt(f)===10866?(g=Pf,f++):(g=c,I===0&&P(Kg)),g!==c&&(E=o,g=w()),o=g,o===c&&(o=f,C.charCodeAt(f)===10865?(g=Af,f++):(g=c,I===0&&P(Gg)),g!==c&&(E=o,g=N()),o=g,o===c&&(o=f,C.charCodeAt(f)===177?(g=ba,f++):(g=c,I===0&&P(Er)),g!==c&&(E=o,g=M()),o=g,o===c&&(o=f,C.charCodeAt(f)===8723?(g=Ca,f++):(g=c,I===0&&P(Mu)),g!==c&&(E=o,g=F()),o=g,o===c&&(o=f,C.substr(f,2)===Cl?(g=Cl,f+=2):(g=c,I===0&&P(Ru)),g!==c&&(E=o,g=Q()),o=g,o===c&&(o=f,C.substr(f,2)===Rf?(g=Rf,f+=2):(g=c,I===0&&P(Hl)),g!==c&&(E=o,g=ve()),o=g,o===c&&(o=f,C.charCodeAt(f)===10752?(g=kl,f++):(g=c,I===0&&P(Uh)),g!==c&&(E=o,g=be()),o=g,o===c&&(o=f,C.charCodeAt(f)===10227?(g=Eg,f++):(g=c,I===0&&P(Bh)),g!==c&&(E=o,g=me()),o=g,o===c&&(o=f,C.charCodeAt(f)===8594?(g=$f,f++):(g=c,I===0&&P(zh)),g!==c&&(E=o,g=De()),o=g,o===c&&(o=f,C.charCodeAt(f)===8593?(g=Yc,f++):(g=c,I===0&&P(Ou)),g!==c&&(E=o,g=Ve()),o=g,o===c&&(o=f,C.charCodeAt(f)===8646?(g=Xc,f++):(g=c,I===0&&P(Oo)),g!==c&&(E=o,g=Xe()),o=g,o===c&&(o=f,C.charCodeAt(f)===68?(g=Mf,f++):(g=c,I===0&&P(Lu)),g!==c&&(E=o,g=$n()),o=g))))))))))))))))))))))))),o}function Xw(){var o;return o=Wo(),o===c&&(o=qo()),o}function AS(){var o,g,b,_,U;return o=f,g=Xw(),g!==c?(b=jv(),b===c&&(b=null),_=Wo(),_!==c?(U=qo(),U!==c?(g=[g,b,_,U],o=g):(f=o,o=c)):(f=o,o=c)):(f=o,o=c),o}function $p(){var o;return ka.test(C.charAt(f))?(o=C.charAt(f),f++):(o=c,I===0&&P(Du)),o}function RS(){var o;return Df.test(C.charAt(f))?(o=C.charAt(f),f++):(o=c,I===0&&P(Qg)),o}function Wo(){var o;return Ff.test(C.charAt(f))?(o=C.charAt(f),f++):(o=c,I===0&&P(Wh)),o}function qo(){var o;return Uf.test(C.charAt(f))?(o=C.charAt(f),f++):(o=c,I===0&&P(qh)),o}function jv(){var o;return C.charCodeAt(f)===120?(o=Jc,f++):(o=c,I===0&&P(Fu)),o}function $S(){var o;return C.charCodeAt(f)===120?(o=Jc,f++):(o=c,I===0&&P(Fu)),o===c&&(C.charCodeAt(f)===45?(o=mo,f++):(o=c,I===0&&P(Ro))),o}var Mp=[];function yr(o){var g=Object.assign(o,ht());return Mp.push(g),g}function Pv(o){return parseInt(o.join(""),10)}function Ga(o){return o.join("").match(/\?/)?o.join(""):Pv(o)}function Vo(o){var g={};return o.forEach(function(b){for(var _ in b)Array.isArray(b[_])?g[_]=g[_]?g[_].concat(b[_]):b[_]:g[_]=g[_]?Zw(g[_])+" "+Jw(b[_]):b[_]}),g}function Jw(o){if(typeof o!="string")return o;var g=/^\s+/;return o.replace(g,"")}function Zw(o){if(typeof o!="string")return o;var g=/\s+$/;return o.replace(g,"")}if(rt=je(),rt!==c&&f===C.length)return rt;throw rt!==c&&f<C.length&&P(wv()),jk(Je,_e<C.length?C.charAt(_e):null,_e<C.length?xv(_e,_e+1):xv(_e,_e))}return{SyntaxError:q,parse:ce}})})(u);var h=u.exports,m=a(h);function y(O,D){return!D||D.startRule==="games"?T(O,D):x(O,D)}function x(O,D={startRule:"game"}){O=O.trim();let q=m.parse(O,D),he={moves:[],messages:[]};if(D.startRule==="pgn"){let ce=q;he.moves=ce}else if(D.startRule==="tags"){let ce=q;he.tags=ce}else he=q;return k(he,O,D)}function k(O,D,q){function he(C){if(q.startRule!=="tags"){let le=C.moves[C.moves.length-1];if(typeof le=="string"&&(C.moves.pop(),C.tags)){let c=C.tags.Result;c&&le!==c&&C.messages.push({key:"Result",value:c,message:"Result in tags is different to result in SAN"}),C.tags.Result=le}}return C}function ce(C){function le(c){function re(st){return st.split(/\s+/)[1]}function xe(st,Re){function Ae(ue){return ue==="w"?"b":"w"}return st.turn=Re,st.variations&&st.variations.forEach(function(ue){let pe=Re;ue.forEach($e=>pe=xe($e,pe))}),Ae(Re)}let Fe=q.fen||c.tags&&c.tags.FEN||"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",Ze=re(Fe);return c.moves.forEach(st=>Ze=xe(st,Ze)),c}return C.moves?le(C):C}return ce(he(O))}function T(O,D={startRule:"games"}){function q(le){if(!Array.isArray(le))return[];if(le.length===0)return le;let c=le.pop();return(c.tags!==void 0||c.moves.length>0)&&le.push(c),le}function he(le,c,re={startRule:"games"}){return q(le)}const ce=Object.assign({startRule:"games"},D);let C=m.parse(O,ce);return C?(he(C,O,ce),C.forEach(le=>{k(le,O,ce)}),C):[]}const S=(O,D=`
`)=>O.replace(/\r?\n/g,D);function R(O,D={startRule:"games"}){let q=S(O).split(`

`),he=[],ce={tags:"",pgn:"",all:""};return q.forEach(function(C){if(C.startsWith("["))ce.tags=C;else if(C){ce.pgn=C;let le=ce.tags?ce.tags+`

`+ce.pgn:ce.pgn;ce.all=le,he.push(ce),ce={tags:"",pgn:"",all:""}}}),he}n.parse=y,n.parseGame=x,n.parseGames=T,n.split=R,Object.defineProperty(n,"__esModule",{value:!0})}))})(Td,Td.exports)),Td.exports}var H3=V3();function Nk(t){const e=t.trim(),n=e.startsWith("http")?e:`https://${e}`;try{return new URL(n)}catch{return null}}function K3(t){if(!t)return null;const e=t.searchParams.get("t")??t.searchParams.get("start");if(!e)return null;const n=Number(e);if(Number.isFinite(n)&&n>=0)return Math.floor(n);const r=e.match(/(?:(\d+)h)?(?:(\d+)m)?(?:(\d+)s?)?/i);if(!r)return null;const[,a,u,h]=r,m=Number(a)||0,y=Number(u)||0,x=Number(h)||0,k=m*3600+y*60+x;return k>0?k:null}function Hp(t){if(!t)return null;const e=t.trim().replace(/[^-\w]/g,"");return e?e.length>11?e.slice(0,11):e:null}function G3(t){const e=Nk(t),n=K3(e)??void 0,r=e?.hostname.replace(/^www\./,"")||"",a=e?.pathname.split("/").filter(Boolean)||[];if(r==="youtu.be"&&a[0]){const m=Hp(a[0]);if(m)return{id:m,startSeconds:n}}if(r.endsWith("youtube.com")||r.endsWith("youtube-nocookie.com")){const m=Hp(e?.searchParams.get("v"));if(m)return{id:m,startSeconds:n};if(a.length>=2&&["embed","shorts","live","v"].includes(a[0])){const y=Hp(a[1]);if(y)return{id:y,startSeconds:n}}}const u=t.match(/(?:v=|youtu\.be\/|embed\/|shorts\/|live\/)([\w-]{6,})/i),h=Hp(u?.[1]);return h?{id:h,startSeconds:n}:null}function t_(t){if(!t)return null;const e=t.trim();if(!e)return null;const n=G3(e);if(n){const r=new URLSearchParams({rel:"0",modestbranding:"1"});return typeof n.startSeconds=="number"&&r.set("start",String(n.startSeconds)),{type:"youtube",src:`https://www.youtube-nocookie.com/embed/${n.id}?${r.toString()}`}}return{type:"html5",src:e}}function rm(t,e){try{return t.move(e,{sloppy:!0})}catch{return null}}function Ek(t){const e=t.trim().split(/\s+/);for(;e.length<6;)e.length===0?e.push(""):e.length===1?e.push("w"):e.length===2?e.push("KQkq"):e.length===3?e.push("-"):e.push(e.length===4?"0":"1");const[n,r,a,u,h,m]=e.slice(0,6),y=r?.toLowerCase()==="b"?"b":"w",x=/^(K?Q?k?q?|-)$/i.test(a)?a:"-",k=/^([a-h][36]|-)$/i.test(u)?u:"-",T=Number.isFinite(Number(h))?String(Number(h)):"0",S=Number.isFinite(Number(m))&&Number(m)>0?String(Number(m)):"1";return[n,y,x||"-",k||"-",T,S].join(" ")}function X0(t){if(!t)return null;try{const e=new xt;return e.load(t)===!1?null:e.fen()}catch{return null}}function gc(t){if(t)try{return new xt(t)}catch{}return new xt}function Qo(t){const e=t?Ek(t):null;return X0(e)||new xt().fen()}function n_(t){const n=[t?.fen,t?.FEN,t?.startFen,t?.startFEN,t?.boardFen,t?.fenString,t?.position,t?.puzzleFen,t?.quizQuestions?.[0]?.fen,t?.quizQuestions?.[0]?.FEN,t?.quizQuestions?.[0]?.startFen,t?.quizQuestions?.[0]?.startFEN,t?.quizQuestions?.[0]?.fenString,t?.quizQuestions?.[0]?.position,t?.questions?.[0]?.fen,t?.questions?.[0]?.FEN,t?.questions?.[0]?.startFen,t?.questions?.[0]?.startFEN,t?.questions?.[0]?.fenString,t?.questions?.[0]?.position].find(r=>typeof r=="string"&&r.trim().length>0);return n?Ek(n):null}function Q3(t){return t.replace(/\s+/g," ").trim()}function Y3(t){return t.split(/\r?\n/).filter(e=>!e.trim().startsWith("[")).join(" ").replace(/;.*/g,"")}function X3(t){let e="",n=0;for(let r=0;r<t.length;r++){const a=t[r];if(a==="("){n++;continue}if(a===")"){n>0&&n--;continue}n===0&&(e+=a)}return e}function J3(t){return t.split(/\s+/).filter(Boolean)}function s_(t){let e=t.replace(/\u2026/g,"...");return e=e.replace(/^\d+\.(\.\.)?/,""),e=e.replace(/[!?+#]+$/g,""),/^\$?\d+$/.test(e.trim())?"":e.trim()}function r_(t){return/^\d+\.+$/.test(t)||/^\d+\.\.\.$/.test(t)}function i_(t){return t==="1-0"||t==="0-1"||t==="1/2-1/2"||t==="*"}function Z3(t,e){const n=Qo(e),r=()=>gc(n);try{const u=H3.parse(t,{startRule:"games",sloppy:!0})?.[0];if(!u?.moves)return{mainline:[],rootVariations:[],variationMap:{}};const h={},m=(k,T,S)=>{const R=[];return k.forEach(O=>{const D=T.fen(),he=(O?.notation?.notation||O?.move?.notation||O?.san||(typeof O?.move=="string"?O.move:"")||"")?.toString().trim();if(!he)return;const ce=O.variations?.map(c=>m(c,new xt(T.fen())))||[];ce.length&&(h[D]=ce,S&&S(ce));const C=rm(T,he);if(!C)return;const le={san:C.san,from:C.from,to:C.to,fen:T.fen(),comment:(O.commentAfter||O.comment||O.commentBefore||"").trim()||null,variations:ce.length?ce:[]};R.push(le)}),R},y=[],x=m(u.moves,r(),k=>y.push(...k));return u.variations?.length&&u.variations.forEach(k=>{y.push(m(k,r()))}),{mainline:x,rootVariations:y,variationMap:h}}catch{return{mainline:[],rootVariations:[],variationMap:{}}}}const o_=[{label:"P",color:"w",type:"p"},{label:"N",color:"w",type:"n"},{label:"B",color:"w",type:"b"},{label:"R",color:"w",type:"r"},{label:"Q",color:"w",type:"q"},{label:"K",color:"w",type:"k"},{label:"P",color:"b",type:"p"},{label:"N",color:"b",type:"n"},{label:"B",color:"b",type:"b"},{label:"R",color:"b",type:"r"},{label:"Q",color:"b",type:"q"},{label:"K",color:"b",type:"k"},{label:"",color:"w",type:"empty"}];function a_({id:t}){const{user:e}=$r(),n=ai(e?.boardTheme).colors,{key:r,pieces:a}=j.useMemo(()=>Br(e?.pieceTheme),[e?.pieceTheme]),u=!!e?.isAdmin,h=j.useRef(new xt),m=j.useRef(null),[y,x]=j.useState(h.current.fen()),[k,T]=j.useState([]),[S,R]=j.useState(null),[O,D]=j.useState("w"),[q]=j.useState(!1),[he,ce]=j.useState(o_[0]),[C,le]=j.useState(!1),[c,re]=j.useState(null),[xe,je]=j.useState({}),[Fe,Ze]=j.useState(t||""),[st,Re]=j.useState(null),[Ae,ue]=j.useState(!1),[pe,$e]=j.useState(null),[Y,J]=j.useState(null),[Se,de]=j.useState(!1),[$,ee]=j.useState(null),[Pe,Ee]=j.useState(null),[G,ae]=j.useState(-1),[Ue,qe]=j.useState(null),[et,ot]=j.useState(null),[bt,nn]=j.useState(!1),[hn,Dt]=j.useState(null),[Mn,Be]=j.useState([]),[Pt,Wt]=j.useState(null),[On,sn]=j.useState(null),[qt,ln]=j.useState(!1),[zn,Wn]=j.useState(!1),[Ts,qn]=j.useState([]),[cn,Ln]=j.useState({}),[ns,ne]=j.useState({}),[at,yt]=j.useState({}),[Ft,Lt]=j.useState(null),[En,Yt]=j.useState(!1),[Qt,Xt]=j.useState(0),[Tn,gs]=j.useState(0),[Vn,Sn]=j.useState(!1),[Is,vs]=j.useState(1),[Hn,Kn]=j.useState(!1),[Hs,ys]=j.useState(new Set),[K,yn]=j.useState(null),[Jt,An]=j.useState(null),[Ne,In]=j.useState([]),[At,W]=j.useState(!1),[ie,se]=j.useState(!1),[ke,Qe]=j.useState([]),[ge,Bt]=j.useState(new Set),Nt="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",Rt=A=>{typeof document>"u"||(document.body.style.cursor=A?`url(${Fm}) 8 8, grabbing`:"")};j.useEffect(()=>()=>{Rt(!1)},[]),j.useEffect(()=>{const A=()=>Rt(!1);return window.addEventListener("mouseup",A),window.addEventListener("dragend",A),()=>{window.removeEventListener("mouseup",A),window.removeEventListener("dragend",A)}},[]),j.useEffect(()=>{const A=()=>Rt(!1);return window.addEventListener("mouseup",A),window.addEventListener("dragend",A),()=>{window.removeEventListener("mouseup",A),window.removeEventListener("dragend",A)}},[]);const lt=j.useMemo(()=>{const B=new xt(y).board();return O==="w"?B:B.slice().reverse().map(te=>te.slice().reverse())},[y,O]),nt=G===-1||G===k.length-1,ut=O==="w"?"abcdefgh".split(""):"hgfedcba".split(""),Ct=O==="w"?Array.from({length:8},(A,B)=>8-B):Array.from({length:8},(A,B)=>B+1),kt=j.useMemo(()=>S?new xt(y).moves({square:S,verbose:!0}):[],[y,S]),Vt=A=>A?A.color==="w"?a.w[A.type]:a.b[A.type]:null,$t=A=>!A||A.type!=="p"?"":r==="chesscom"?A.color==="w"?"scale-110":"scale-90":r==="freestyle"&&A.color==="b"?"scale-110":"",Xn=(A,B)=>{const te="abcdefgh"[O==="w"?B:7-B],fe=O==="w"?8-A:A+1;return`${te}${fe}`},wn=(A,B)=>{if(yn(null),An(null),In([]),ys(new Set),$?.type==="quiz")return;const te=Xn(A,B);if(q){const dt=new xt;dt.load(y),he.type==="empty"?dt.remove(te):dt.put({color:he.color,type:he.type},te),x(dt.fen());return}if(S===te){R(null);return}const fe=new xt(y),Oe=fe.get(te);if(S){ss(S,te);return}Oe&&Oe.color===fe.turn()&&R(te)},ss=(A,B)=>{if($?.type==="quiz"||$?.type==="study"){R(null),re(null),Rt(!1);return}if(q)return;if(!nt){R(null),re(null),Rt(!1);return}const te=new xt(y),fe=te.move({from:A,to:B,promotion:"q"});if(fe){const Oe=te.fen();h.current=te,T(dt=>{const xn=[...dt,{san:fe.san,from:fe.from,to:fe.to,fen:Oe}];return ae(xn.length-1),Ee(Oe),xn}),x(Oe)}R(null)},Dn=j.useMemo(()=>{const A=[];return k.forEach((B,te)=>{const fe=Math.floor(te/2);A[fe]||(A[fe]={}),te%2===0?A[fe].white=B:A[fe].black=B}),A},[k]),jn=A=>{x(A.fen),R(null),re(null);const B=k.findIndex(te=>te.fen===A.fen&&te.from===A.from&&te.to===A.to);B>=0&&ae(B),Ee(A.fen)};j.useEffect(()=>{Fe||(ue(!0),hf("course-london").then(A=>{Ze(A?.id||"course-london"),ue(!1)}))},[Fe]),j.useEffect(()=>{if(!Fe)return;ue(!0);const A=x4(Fe,B=>{Re(B),ue(!1)});return()=>A()},[Fe]),j.useEffect(()=>{let A=!1;return(async()=>{if(!(!e||!Fe))try{const te=await mk(e.id,Fe);if(A)return;Bt(new Set(te?.completedLessonIds||[]))}catch{A||Bt(new Set)}})(),()=>{A=!0}},[e?.id,Fe]),j.useEffect(()=>{Y?Y.type!=="video"&&qe(null):(qe(null),ot(null))},[Y]);const ws=j.useMemo(()=>st?.chapters?Object.values(st.chapters).sort((A,B)=>A.index-B.index):[],[st]),rs=A=>{je(B=>({...B,[A]:!B[A]}))},Kt=async()=>{!u||!Fe||$e({mode:"create",title:"",index:ws.length})},rn=async A=>{!u||!Fe||!window.confirm("Delete this chapter and its subsections?")||await Q4(Fe,A)},z=async(A,B)=>{!u||!Fe||!window.confirm("Delete this subsection?")||await Z4(Fe,A,B)},Z=async(A,B)=>{if(!u||!Fe)return;const te=st?.chapters?.[A],fe=te?.subsections;if(!te||!fe)return;const Oe=Object.values(fe).sort((St,tn)=>(St.index??0)-(tn.index??0)),dt=Oe.findIndex(St=>St.id===B);if(dt===-1)return;const xn=Oe.map((St,tn)=>`${tn+1}. ${St.title||St.id}`).join(`
`),is=window.prompt(`Current order (top to bottom):
${xn}
Enter new position for "${Oe[dt].title}":`,String(dt+1));if(is==null)return;const Fn=Number.parseInt(is.trim(),10);if(!Number.isFinite(Fn))return;const ft=Math.min(Math.max(Fn,1),Oe.length);if(ft===dt+1)return;const pn=[...Oe],[en]=pn.splice(dt,1);pn.splice(ft-1,0,en);const Nn=pn.map(St=>St.id);try{const St=await J4(Fe,A,Nn);St&&Re(tn=>{const js=tn,Ai=js?.chapters?.[A];return!js||!Ai?tn:{...js,chapters:{...js.chapters,[A]:{...Ai,subsections:St}}}})}catch(St){console.warn("Failed to reorder subsections",St),window.alert("Could not reorder subsections. Please try again.")}},X=async A=>{!e||!Fe||A.type!=="quiz"&&(ge.has(A.id)||(Bt(B=>new Set(B).add(A.id)),await G0(e.id,Fe,A.id,A.type)))},tt=(A,B)=>{Lt(null);const te=Qo(B);x(te);try{let{mainline:fe,variationMap:Oe}=Z3(A,te);if(!fe.length){const Fn=[A];for(const ft of Fn){const pn=gc(te);if(pn.loadPgn(ft,{sloppy:!0})){const en=pn.history({verbose:!0}),Nn=[],St=gc(te);en.forEach(tn=>{St.move(tn),Nn.push({san:tn.san,from:tn.from,to:tn.to,fen:St.fen(),comment:tn.comment||null,variations:[]})}),fe=Nn,Oe={};break}}}if(!fe.length){const Fn=J3(A),ft=gc(te),pn=[];Fn.forEach(en=>{if(en==="("||en===")"||typeof en=="object")return;const Nn=s_(en);if(!Nn||i_(Nn)||r_(Nn))return;const St=rm(ft,Nn);St&&pn.push({san:St.san,from:St.from,to:St.to,fen:ft.fen(),comment:null,variations:[]})}),pn.length&&(fe=pn,Oe={})}if(!fe.length){const ft=Q3(X3(Y3(A))).replace(/\{[^}]*\}/g,"").split(/\s+/).filter(Boolean),pn=gc(te),en=[];ft.forEach(Nn=>{const St=s_(Nn);if(!St||i_(St)||r_(St))return;const tn=rm(pn,St);tn&&en.push({san:tn.san,from:tn.from,to:tn.to,fen:pn.fen(),comment:null,variations:[]})}),en.length&&(fe=en,Oe={})}if(!fe.length){Lt("Could not load this PGN, falling back to empty board."),qn([]),Ln({}),ne({}),yt({}),T([]),ae(-1),Ee(null),x(te),R(null),re(null);return}const dt=Fn=>{const ft={},pn={},en=gc(te);return Fn.forEach((Nn,St)=>{const tn=en.fen();ft[tn]=Nn,pn[tn]=St,rm(en,Nn.san)}),{map:ft,idxMap:pn}},{map:xn,idxMap:is}=dt(fe);qn(fe),Ln(Oe),ne(xn),yt(is),T(fe),ae(-1),Ee(null),x(te),R(null),re(null),Lt(null)}catch(fe){console.warn("Failed to load PGN",fe),qn([]),Ln({}),ne({}),yt({}),T([]),ae(-1),Ee(null),x(te),Lt("Could not load this PGN. Try another file or share the PGN text.")}R(null),re(null)},Ye=A=>{if(ee(A),A.type==="study"){Be([]),Wt(null),Dt(null),Lt(null);const B=Qo(A.fen);x(B),A.pgn?tt(A.pgn,B):(T([]),qn([]),Ln({}),ne({}),yt({}),ae(-1),Ee(null),R(null),re(null));return}if(A.type==="quiz"){const B=n_(A),te=X0(B)||new xt().fen();x(te);const fe=A.questions||[];Be(fe.map(()=>"")),Wt(null),sn(null),Wn(!1),ln(!1),R(null),re(null),T([]),qn([]),ae(-1),Ee(null),Lt(null),Dt(A.trainerNote?.trim()||null);return}else x(new xt().fen()),Be([]),Wt(null),sn(null),Wn(!1),ln(!1),R(null),re(null),T([]),qn([]),ae(-1),Ee(null),Lt(null),Dt(A.type==="video"&&A.trainerNote?.trim()||null)};j.useEffect(()=>{if($?.type!=="quiz")return;const A=n_($),B=X0(A)||new xt().fen();x(B),R(null),re(null)},[$]),j.useEffect(()=>{if($?.type!=="study")return;const A=Qo($.fen);if(!k.length){ae(-1),Ee(null),x(A);return}const B=G>=0?k[G].fen:A;cn[B]?.length},[k,G,cn,x,$]),j.useEffect(()=>{if(!$){Dt(null);return}if($.type==="study"){if(G>=0&&k[G]){const A=k[G].comment?.trim();Dt(A||null)}else Dt(null);return}if($.type==="video"||$.type==="quiz"){const A=$.trainerNote?.trim();Dt(A||null);return}Dt(null)},[$,G,k]),j.useEffect(()=>{if($?.type!=="study"){Qe([]);return}if(G<0||!k.length){Qe([]);return}const A=k[G];Qe(A?[A.from,A.to]:[])},[$,G,k]);const V=()=>{if(!k.length)return;const A=G===-1?k.length-1:Math.max(0,G-1);ae(A),Ee(k[A].fen),x(k[A].fen),R(null),re(null)},ye=()=>{if(!k.length)return;const A=$?.type==="study"?Qo($.fen):new xt().fen(),B=G>=0?k[G].fen:A;if(cn[B]?.length)return;const te=G===-1?0:Math.min(k.length-1,G+1);ae(te),Ee(k[te].fen),x(k[te].fen),R(null),re(null)},Ie=$?.type!=="video",Me=$?.type!=="video",He=t_($?.videoUrl),Zt=$?.type==="video",zt=Zt&&$.videoUrl?.trim()||"",Ls=j.useMemo(()=>{if(!zt)return"No video link provided yet.";if(zt.startsWith("data:"))return"Embedded video file (data URL)";const A=Nk(zt);if(A){if(A.hostname.replace(/^www\./,"").includes("youtube"))return"Video ready";const B=A.hostname.replace(/^www\./,""),te=A.pathname&&A.pathname!=="/"?A.pathname:"";return`Source: ${B}${te}`}return zt.length>80?`${zt.slice(0,80)}...`:zt},[zt]),br=!!zt&&He?.type!=="youtube";He?.type==="html5"||He?.type==="youtube"||He?.type;const Hr=He?He.type==="html5"?"Custom player using your hosted video file.":null:zt?"We couldn't read this link. Use a direct MP4/WEBM/HLS URL or a YouTube link.":"No video URL yet. Add one from the section editor to start playback.",Cr=(A,B)=>{const te=Xn(A,B);ys(fe=>{const Oe=new Set(fe);return Oe.has(te)?Oe.delete(te):Oe.add(te),Oe})},Mt=(A,B)=>{const te=Xn(A,B);yn({row:A,col:B,square:te}),An(null),W(!1)},li=(A,B,te)=>{if(!K||te!==2)return;const fe=Xn(A,B);if(K.square===fe){W(!1),An(null);return}W(!0),An({row:A,col:B,square:fe})},pa=()=>{K&&At&&Jt?(In(A=>[...A,{start:K,end:Jt}]),se(!0)):K&&!At&&(Cr(K.row,K.col),se(!0)),W(!1),yn(null),An(null)},Pi=()=>{Yt(!1),Xt(0),gs(0),Sn(!1),Kn(!1),vs(1),m.current&&(m.current.currentTime=0,m.current.pause())};j.useEffect(()=>{if(!Zt){Pi();return}He?.type==="html5"&&Pi()},[Zt,zt,He]),j.useEffect(()=>{if(He?.type!=="html5")return;const A=m.current;A&&(A.volume=Is,A.muted=Hn)},[Is,Hn,He]);const ma=()=>{if(He?.type!=="html5")return;const A=m.current;A&&(A.paused?A.play():A.pause())},ga=()=>{const A=m.current;!A||Vn||Xt(A.currentTime||0)},va=()=>{const A=m.current;A&&gs(A.duration||0)},po=A=>{const B=m.current;Xt(A),B&&(B.currentTime=A)},ci=A=>{const B=m.current,te=Math.min(1,Math.max(0,A));vs(te),B&&(B.volume=te,Kn(te===0))},kr=()=>{const A=m.current;if(!A)return;const B=!Hn;Kn(B),A.muted=B,!B&&A.volume===0&&ci(.5)},ar=A=>{if(!Number.isFinite(A))return"0:00";const B=Math.max(0,Math.floor(A)),te=Math.floor(B/60),fe=B%60;return`${te}:${fe.toString().padStart(2,"0")}`},lr=j.useMemo(()=>{if($?.type!=="study")return[];const A=Qo($.fen),B=G>=0?k[G].fen:A;return cn[B]||[]},[G,$,k,cn]),cr=j.useMemo(()=>{if($?.type!=="quiz")return null;const A=$.questions||[];if(A.length){const te=A[0];if(te?.options?.length){const Oe=typeof te.correctIndex=="number"&&te.correctIndex>=0?te.correctIndex:0;return{...te,correctIndex:Oe}}const fe=A.map((Oe,dt)=>Oe?.prompt||`Option ${dt+1}`).filter(Boolean);if(fe.length){const Oe=A.findIndex(dt=>typeof dt?.correctIndex=="number"&&dt.correctIndex>=0);return{id:te?.id||"derived",prompt:te?.prompt||"Select the correct option",options:fe,correctIndex:Oe>=0?Oe:0}}}const B=$.quizQuestions||[];return B.length?{id:"legacy",prompt:"Select the correct option",options:B.map((te,fe)=>te.prompt||`Option ${fe+1}`),correctIndex:0}:null},[$]),Kr=j.useMemo(()=>{if($?.type!=="study")return null;const A=Qo($.fen),B=G>=0?k[G].fen:A;return ns[B]||null},[G,$,k,ns]),Sr=$?.type==="study"&&lr.length>0,ya=A=>{const B=$?.type==="study"?Qo($.fen):new xt().fen();if(A&&A.length){const dt=G+1,xn=dt>=0?k.slice(0,dt):[],is=[...xn,...A];T(is);const Fn=xn.length,ft=is[Fn]?.fen||B;ae(Fn),Ee(ft),x(ft),R(null),re(null);return}const te=G>=0?k[G].fen:B,fe=ns[te],Oe=at[te];fe!=null&&Oe!=null&&(T(Ts),ae(Oe),Ee(fe.fen),x(fe.fen)),R(null),re(null)},wa=()=>{if($?.type!=="study"||!$.pgn)return;const A=new Blob([$.pgn],{type:"application/x-chess-pgn"}),B=URL.createObjectURL(A),te=document.createElement("a"),fe=($.title||"study").replace(/[^a-z0-9-_]+/gi,"_");te.href=B,te.download=`${fe||"study"}.pgn`,document.body.appendChild(te),te.click(),document.body.removeChild(te),setTimeout(()=>URL.revokeObjectURL(B),2e3)},ui=async()=>{if($?.type!=="quiz"||!cr)return;if(Pt==null){sn("Pick an option first.");return}if(!(Pt===(cr.correctIndex??0))){sn("Not quite. Try again.");return}if(!e){sn("Sign in to earn XP for this quiz.");return}if(!Fe){sn("Course not loaded yet. Try again.");return}if(zn){sn("XP already awarded for this quiz.");return}try{ln(!0),await G0(e.id,Fe,$.id,$.type),Wn(!0),sn("Correct! XP awarded.")}catch(B){console.warn("Failed to award XP for quiz",B),sn("Could not award XP right now. Please try again.")}finally{ln(!1)}};return d.jsxs(qr,{children:[d.jsxs("div",{className:"flex flex-col xl:flex-row items-start gap-4 xl:gap-6",children:[Me&&d.jsxs("div",{className:"w-full xl:min-w-[240px] xl:max-w-[280px] rounded-2xl bg-slate-900 border border-white/10 text-white shadow-xl",children:[d.jsxs("div",{className:"p-4",children:[d.jsx("div",{className:"font-semibold text-lg",children:$?.type==="quiz"?"Options":"Moves"}),d.jsx("div",{className:"text-xs text-white/60 mb-2",children:$?.type==="study"&&Ft?Ft:$?.type==="quiz"?"Answer the questions below":"Played so far"})]}),d.jsx("div",{className:"max-h-[480px] overflow-auto px-4 pb-4",children:$?.type==="quiz"?d.jsx("div",{className:"space-y-3",children:cr?d.jsxs("div",{className:"space-y-3",children:[d.jsx("div",{className:"text-sm text-white/70 whitespace-pre-wrap",children:"Select the correct option"}),cr.options?.map((A,B)=>d.jsxs("label",{className:"flex items-center gap-3 rounded-lg border border-white/10 bg-white/5 px-3 py-2 text-sm text-white/90 hover:border-pink-400",children:[d.jsx("input",{type:"radio",name:"quiz-option",className:"h-4 w-4 text-pink-500",checked:Pt===B,onChange:()=>{Wt(B),Be(te=>{const fe=[...te];return fe[0]=A,fe}),sn(null)}}),d.jsx("span",{children:A||`Option ${B+1}`})]},`${cr.id||"opt"}-${B}`)),d.jsxs("div",{className:"pt-1",children:[d.jsx(Le,{size:"sm",className:"w-full justify-center",disabled:Pt==null||qt,onClick:ui,children:qt?"Submitting...":"Submit"}),On&&d.jsx("div",{className:"mt-2 text-xs text-white/80","aria-live":"polite",children:On})]})]}):d.jsx("div",{className:"text-xs text-white/60",children:"No options available."})}):$?.type==="study"&&Sr?d.jsxs("div",{className:"space-y-2",children:[Kr&&d.jsxs("button",{className:"w-full text-left rounded-lg bg-white/10 hover:bg-white/20 text-white px-3 py-2 text-sm",onClick:()=>ya(null),children:["Mainline: ",Kr.san]}),lr.map((A,B)=>d.jsxs("button",{className:"w-full text-left rounded-lg border border-white/10 hover:border-pink-400 text-white px-3 py-2 text-sm",onClick:()=>ya(A),children:["Variation ",B+1,": ",A[0]?.san||"Line"]},`variation-${B}`))]}):d.jsxs(d.Fragment,{children:[Dn.length===0&&d.jsx("div",{className:"text-white/50 text-sm",children:"No moves yet. Start playing."}),Dn.map((A,B)=>d.jsxs("div",{className:"grid grid-cols-[32px_1fr_1fr] items-center gap-2 sm:gap-3 text-xs sm:text-sm py-1",children:[d.jsxs("div",{className:"text-white/50",children:[B+1,"."]}),d.jsx("button",{className:`text-left text-white rounded-md px-2 py-1 ${Pe===A.white?.fen?"bg-white/10":""} ${A.white?"hover:text-pink-300":"text-white/50"}`,disabled:!A.white,onClick:()=>A.white&&jn(A.white),children:A.white?.san||"-"}),d.jsx("button",{className:`text-left text-white rounded-md px-2 py-1 ${Pe===A.black?.fen?"bg-white/10":""} ${A.black?"hover:text-pink-300":"text-white/50"}`,disabled:!A.black,onClick:()=>A.black&&jn(A.black),children:A.black?.san||""})]},B))]})})]}),d.jsxs("div",{className:"flex-1",children:[d.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-3",children:[d.jsxs("div",{children:[d.jsx("div",{className:"text-xl font-bold text-white",children:st?.title||"Course"}),d.jsx("div",{className:"text-sm text-white/60",children:st?.description||"Live course layout"})]}),d.jsx("div",{className:"flex items-center gap-2 w-full sm:w-auto",children:d.jsxs(Le,{variant:"ghost",className:"bg-white/5 hover:bg-white/10 w-full sm:w-auto",onClick:()=>le(!0),children:[d.jsx(uE,{className:"h-5 w-5 mr-2"}),"Chapters"]})})]}),d.jsxs("div",{className:"grid grid-cols-1 2xl:grid-cols-[minmax(720px,1.4fr)_minmax(280px,0.6fr)] gap-4 2xl:gap-6 items-start",children:[d.jsxs("div",{className:"relative",children:[d.jsx("div",{className:"relative block pl-6 sm:pl-8 pb-6 sm:pb-8 w-full max-w-[1200px] 2xl:max-w-[1400px] mx-auto",children:$?.type==="video"?d.jsxs("div",{className:"w-full rounded-[28px] overflow-hidden border border-white/10 bg-slate-900/80 shadow-[0_20px_60px_rgba(0,0,0,0.45)]",children:[d.jsxs("div",{className:"flex flex-col gap-3 px-6 py-5 border-b border-white/10 sm:flex-row sm:items-center sm:justify-between",children:[d.jsxs("div",{className:"space-y-1",children:[d.jsx("div",{className:"text-[11px] uppercase tracking-[0.2em] text-white/50",children:"Video subsection"}),d.jsx("div",{className:"text-2xl font-bold text-white leading-tight",children:$.title||"Video lesson"}),Hr&&d.jsx("div",{className:"text-sm text-white/60",children:Hr})]}),d.jsx("div",{className:"flex items-center gap-2"})]}),d.jsxs("div",{className:"relative bg-black",children:[He?.type==="blocked"&&d.jsxs("div",{className:"aspect-video w-full flex flex-col items-center justify-center gap-3 px-6 text-center text-white/80",children:[d.jsx("div",{className:"text-lg font-semibold text-white",children:"Link not playable"}),d.jsx("p",{className:"text-sm text-white/60 max-w-xl",children:He.reason}),zt&&d.jsx("div",{className:"text-xs text-white/50 break-all max-w-lg bg-white/5 border border-white/10 px-3 py-2 rounded-lg",children:zt}),d.jsx("div",{className:"text-xs text-white/60",children:"Use a YouTube link or a direct MP4/WEBM/HLS URL to play here."})]}),He?.type==="youtube"&&d.jsx("div",{className:"relative w-full",children:d.jsx("iframe",{src:He.src,title:$.title||"Video lesson",className:"w-full aspect-video",loading:"lazy",referrerPolicy:"origin-when-cross-origin",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",allowFullScreen:!0},He.src)}),He?.type==="html5"&&d.jsxs("div",{className:"relative w-full",children:[d.jsx("video",{ref:m,src:He.src,className:"w-full aspect-video object-contain bg-black",playsInline:!0,onLoadedMetadata:va,onTimeUpdate:ga,onEnded:()=>Yt(!1),onPause:()=>Yt(!1),onPlay:()=>Yt(!0),muted:Hn,crossOrigin:"anonymous"},He.src),d.jsxs("div",{className:"absolute inset-x-0 bottom-0 flex flex-col gap-3 bg-gradient-to-t from-black/80 via-black/50 to-transparent px-4 pb-4 pt-6",children:[d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("button",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-white/10 text-white hover:bg-white/20",onClick:ma,"aria-label":En?"Pause":"Play",children:En?d.jsx(mE,{className:"h-5 w-5"}):d.jsx(F_,{className:"h-5 w-5"})}),d.jsxs("div",{className:"flex items-center gap-2 text-xs text-white/80 min-w-[110px]",children:[d.jsx("span",{children:ar(Qt)}),d.jsx("span",{className:"text-white/40",children:"/"}),d.jsx("span",{children:ar(Tn)})]}),d.jsx("div",{className:"flex-1",children:d.jsx("input",{type:"range",min:0,max:Math.max(Tn||0,.1),step:"0.1",value:Math.min(Qt,Tn||0),onChange:A=>po(Number(A.target.value)),onMouseDown:()=>Sn(!0),onMouseUp:()=>Sn(!1),onTouchStart:()=>Sn(!0),onTouchEnd:()=>Sn(!1),className:"w-full accent-pink-400"})})]}),d.jsxs("div",{className:"flex items-center justify-between gap-3 text-white/80 text-xs",children:[d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("button",{className:"flex h-9 w-9 items-center justify-center rounded-full bg-white/10 text-white hover:bg-white/20",onClick:kr,"aria-label":Hn?"Unmute":"Mute",children:Hn||Is===0?d.jsx(EE,{className:"h-5 w-5"}):d.jsx(NE,{className:"h-5 w-5"})}),d.jsx("input",{type:"range",min:0,max:1,step:.05,value:Is,onChange:A=>ci(Number(A.target.value)),className:"w-28 accent-pink-400"})]}),d.jsx("div",{className:"flex items-center gap-2",children:d.jsx("span",{className:"rounded-full bg-white/10 border border-white/10 px-3 py-1 text-[11px] uppercase tracking-[0.15em] text-white/70",children:"Custom player"})})]})]}),d.jsxs("div",{className:"absolute left-4 top-4 flex items-center gap-2 rounded-full border border-white/10 bg-black/70 px-3 py-1 text-xs text-white/80",children:[d.jsx("span",{className:"h-2 w-2 rounded-full bg-emerald-400"}),"Playing hosted video"]})]}),!He&&d.jsxs("div",{className:"aspect-video w-full flex flex-col items-center justify-center gap-3 px-6 text-center text-white/70",children:[d.jsx("div",{className:"text-lg font-semibold text-white",children:"No video ready"}),d.jsx("p",{className:"text-sm text-white/60 max-w-xl",children:"Add a direct MP4/WEBM/HLS link, a YouTube link, or upload a video file from the section editor to start playback."})]})]}),d.jsxs("div",{className:"flex flex-col gap-2 px-6 py-4 border-t border-white/10 sm:flex-row sm:items-center sm:justify-between",children:[d.jsxs("div",{className:"flex items-center gap-2 text-sm text-white/70",children:[d.jsx("span",{className:`h-2 w-2 rounded-full ${He?"bg-emerald-400":"bg-amber-400"}`}),Ls]}),br&&d.jsx("div",{className:"text-xs text-white/50 break-all max-w-full sm:max-w-[320px]",children:zt})]})]}):d.jsxs(d.Fragment,{children:[d.jsx("div",{className:"rounded-[28px] overflow-hidden border border-white/10 shadow-[0_20px_60px_rgba(0,0,0,0.45)] w-full",style:{backgroundColor:n.dark},children:d.jsxs("div",{className:"relative grid grid-cols-8 grid-rows-8 w-full max-w-[1200px] 2xl:max-w-[1400px] aspect-square mx-auto",children:[lt.map((A,B)=>A.map((te,fe)=>{const Oe=Xn(B,fe),dt=(B+fe)%2===0,xn=S===Oe,is=kt.some(ft=>ft.to===Oe),Fn=ke.includes(Oe);return d.jsxs("button",{onClick:()=>wn(B,fe),draggable:!q&&!!te,onDragStart:ft=>{if(q||!te)return;const pn=new xt(y),en=Xn(B,fe),Nn=pn.get(en);if($?.type==="quiz"){ft.preventDefault();return}if($?.type==="study"){ft.preventDefault(),Rt(!1);return}if(!nt){ft.preventDefault(),Rt(!1);return}if(Nn&&Nn.color===pn.turn()){if(re(en),ft.dataTransfer?.setData("text/plain",en),ft.dataTransfer){const St=new Image;St.src=Nt,ft.dataTransfer.setDragImage(St,0,0)}Rt(!0)}else ft.preventDefault()},onDragOver:ft=>{$?.type!=="quiz"&&!q&&c&&ft.preventDefault()},onDrop:ft=>{if(q||$?.type==="quiz"||$?.type==="study")return;ft.preventDefault();const pn=c||ft.dataTransfer?.getData("text/plain"),en=Xn(B,fe);pn&&ss(pn,en),re(null),Rt(!1)},onDragEnd:()=>{re(null),Rt(!1)},onContextMenu:ft=>{if(ft.preventDefault(),ie){se(!1);return}!K&&!At&&Cr(B,fe)},onMouseDown:ft=>{ft.button===2?(ft.preventDefault(),Mt(B,fe)):ft.button===0&&te&&($?.type==="study"||!nt?Rt(!1):Rt(!0))},onMouseEnter:ft=>li(B,fe,ft.buttons),onMouseMove:ft=>li(B,fe,ft.buttons),onMouseUp:ft=>{ft.button===2?(ft.preventDefault(),pa()):ft.button===0&&Rt(!1)},className:`w-full h-full flex items-center justify-center text-2xl font-semibold relative overflow-hidden ${xn?"ring-2 ring-pink-400":""} ${te?"cursor-piece":"cursor-auto"}`,style:{backgroundColor:Hs.has(Oe)?"#ef4444":dt?n.light:n.dark,...te?{"--cursor-open":`url(${Ck}) 8 8, grab`,"--cursor-closed":`url(${Fm}) 8 8, grabbing`}:{}},"data-has-piece":!!te,"data-square":Oe,"data-piece":te?`${te.color}${te.type}`:"","data-test":"board-square",children:[Fn&&d.jsx("div",{className:"absolute inset-0 bg-yellow-400/50 pointer-events-none z-0"}),is&&d.jsx("div",{className:"absolute inset-0 z-20 pointer-events-none flex items-center justify-center",children:d.jsx("div",{className:"h-3 w-3 rounded-full bg-pink-400/80"})}),te?d.jsx("img",{src:Vt(te)||"",alt:"",className:`relative z-10 w-full h-full object-contain p-1 ${$t(te)}`}):null]},`${B}-${fe}`)})),K&&Jt&&d.jsxs("svg",{className:"absolute inset-0 pointer-events-none",viewBox:"0 0 100 100",children:[d.jsx("defs",{children:d.jsx("marker",{id:"arrowhead-lesson-current",markerWidth:"4",markerHeight:"4",refX:"2",refY:"2",orient:"auto",children:d.jsx("path",{d:"M0,0 L0,4 L4,2 z",fill:"rgba(234,179,8,0.8)"})})}),(()=>{const A=(fe,Oe)=>({x:(Oe+.5)/8*100,y:(fe+.5)/8*100}),B=A(K.row,K.col),te=A(Jt.row,Jt.col);return d.jsx("line",{x1:B.x,y1:B.y,x2:te.x,y2:te.y,stroke:"rgba(234,179,8,0.8)",strokeWidth:"1",markerEnd:"url(#arrowhead-lesson-current)"})})()]}),Ne.map((A,B)=>d.jsxs("svg",{className:"absolute inset-0 pointer-events-none",viewBox:"0 0 100 100",children:[d.jsx("defs",{children:d.jsx("marker",{id:`arrowhead-lesson-${B}`,markerWidth:"4",markerHeight:"4",refX:"2",refY:"2",orient:"auto",children:d.jsx("path",{d:"M0,0 L0,4 L4,2 z",fill:"rgba(234,179,8,0.8)"})})}),(()=>{const te=(dt,xn)=>({x:(xn+.5)/8*100,y:(dt+.5)/8*100}),fe=te(A.start.row,A.start.col),Oe=te(A.end.row,A.end.col);return d.jsx("line",{x1:fe.x,y1:fe.y,x2:Oe.x,y2:Oe.y,stroke:"rgba(234,179,8,0.8)",strokeWidth:"1",markerEnd:`url(#arrowhead-lesson-${B})`})})()]},`arrow-${B}`)),Ne.map((A,B)=>d.jsxs("svg",{className:"absolute inset-0 pointer-events-none",viewBox:"0 0 100 100",children:[d.jsx("defs",{children:d.jsx("marker",{id:`arrowhead-lesson-${B}`,markerWidth:"4",markerHeight:"4",refX:"2",refY:"2",orient:"auto",children:d.jsx("path",{d:"M0,0 L0,4 L4,2 z",fill:"rgba(234,179,8,0.8)"})})}),(()=>{const te=(dt,xn)=>({x:(xn+.5)/8*100,y:(dt+.5)/8*100}),fe=te(A.start.row,A.start.col),Oe=te(A.end.row,A.end.col);return d.jsx("line",{x1:fe.x,y1:fe.y,x2:Oe.x,y2:Oe.y,stroke:"rgba(234,179,8,0.8)",strokeWidth:"1",markerEnd:`url(#arrowhead-lesson-${B})`})})()]},`arrow-${B}`))]})}),d.jsx("div",{className:"pointer-events-none absolute left-0 top-0 bottom-6 grid grid-rows-8 text-xs font-semibold text-white/80",children:Ct.map(A=>d.jsx("span",{className:"flex items-center justify-end pr-2",children:A},`rank-${A}`))}),d.jsx("div",{className:"pointer-events-none absolute left-6 right-0 bottom-0 grid grid-cols-8 text-xs font-semibold text-white/80",children:ut.map(A=>d.jsx("span",{className:"text-center pt-1",children:A},`file-${A}`))})]})}),Ie&&d.jsxs("div",{className:"mt-3 flex items-center gap-2 text-white",children:[d.jsxs("div",{className:"flex rounded-full bg-white/10 p-1",children:[d.jsx("button",{className:`px-3 py-1 rounded-full text-sm ${O==="w"?"bg-white text-slate-900 font-semibold":"text-white/80"}`,onClick:()=>D("w"),children:"W"}),d.jsx("button",{className:`px-3 py-1 rounded-full text-sm ${O==="b"?"bg-white text-slate-900 font-semibold":"text-white/80"}`,onClick:()=>D("b"),children:"B"})]}),d.jsxs("div",{className:"flex items-center gap-1",children:[d.jsx("button",{className:"p-2 rounded-full bg-white/10 hover:bg-white/20 text-white","aria-label":"Prev move",onClick:V,children:d.jsx(O_,{className:"h-4 w-4"})}),d.jsx("button",{className:"p-2 rounded-full bg-white/10 hover:bg-white/20 text-white","aria-label":"Next move",onClick:ye,children:d.jsx(nE,{className:"h-4 w-4"})}),$?.type==="study"&&$.pgn&&d.jsx("button",{className:"p-2 rounded-full bg-white/10 hover:bg-white/20 text-white","aria-label":"Download PGN",onClick:wa,children:d.jsx(iy,{className:"h-4 w-4"})})]})]}),q&&d.jsx("div",{className:"mt-3 flex flex-wrap gap-2 text-white",children:o_.map(A=>d.jsx("button",{onClick:()=>ce(A),className:`px-2 py-1 rounded-md border text-xs ${he===A?"bg-pink-500 text-white border-pink-500":"bg-white/5 border-white/10"}`,children:A.label},`${A.label}-${A.type}`))})]}),d.jsx("div",{className:"space-y-3",children:hn&&d.jsxs("div",{className:"rounded-xl bg-slate-900 border border-white/10 text-white p-4 shadow-lg",children:[d.jsx("div",{className:"font-semibold mb-2",children:"Trainer Note"}),d.jsx("p",{className:"text-sm text-white/80 whitespace-pre-wrap",children:hn})]})})]})]})]}),C&&d.jsxs("div",{className:"fixed inset-0 z-30 flex",children:[d.jsx("div",{className:"flex-1 bg-black/50",onClick:()=>le(!1)}),d.jsxs("div",{className:"w-full max-w-md h-full bg-slate-900 text-white border-l border-white/10 shadow-2xl overflow-y-auto",children:[d.jsxs("div",{className:"p-5 border-b border-white/10 flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("div",{className:"text-xl font-bold",children:st?.title||"Course"}),d.jsx("div",{className:"text-sm text-white/60",children:"Select a chapter or drill"})]}),d.jsx("button",{className:"p-2 rounded-full hover:bg-white/10",onClick:()=>le(!1),"aria-label":"Close navigation",children:d.jsx(nr,{className:"h-4 w-4"})})]}),d.jsxs("div",{className:"p-4 space-y-3",children:[u&&d.jsx(Le,{variant:"outline",size:"sm",onClick:Kt,className:"w-full justify-center",children:"Add chapter"}),Ae&&d.jsx("div",{className:"text-white/70 text-sm",children:"Loading chapters..."}),!Ae&&ws.length===0&&d.jsx("div",{className:"text-white/60 text-sm",children:"No chapters yet."}),ws.map(A=>{const B=xe[A.id],te=Object.values(A.subsections||{}).sort((fe,Oe)=>(fe.index??0)-(Oe.index??0));return d.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/5 hover:border-pink-400",children:[d.jsxs("div",{className:"p-3 flex items-center justify-between gap-2",children:[d.jsxs("div",{children:[d.jsx("div",{className:"text-sm font-semibold",children:A.title}),d.jsxs("div",{className:"text-xs text-white/60",children:["Items: ",te.length]})]}),d.jsxs("div",{className:"flex items-center gap-2",children:[u&&d.jsxs(d.Fragment,{children:[d.jsx(Le,{size:"sm",variant:"ghost",onClick:()=>J({chapterId:A.id,mode:"create",type:"video",title:"",videoUrl:"",pgn:"",fen:"",quizQuestions:[{id:"q1",prompt:""}],correctQuestionIndex:1,trainerNote:""}),"aria-label":"Add subsection",children:d.jsx(Dd,{className:"h-4 w-4"})}),d.jsx(Le,{size:"sm",variant:"ghost",onClick:()=>rn(A.id),"aria-label":"Delete chapter",children:d.jsx(oy,{className:"h-4 w-4"})})]}),d.jsx(Le,{size:"sm",variant:"outline",onClick:()=>rs(A.id),children:B?"Close":"Open"})]})]}),B&&d.jsxs("div",{className:"bg-white/10 border-t border-white/10",children:[te.map(fe=>d.jsxs("div",{className:"flex items-center justify-between px-4 py-2 text-sm text-white/80 hover:bg-white/10 cursor-pointer",onClick:()=>Ye(fe),children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"h-2 w-2 rounded-full bg-white/40"}),d.jsx("span",{className:"capitalize text-white/60",children:fe.type}),d.jsx("span",{children:fe.title})]}),d.jsxs("div",{className:"flex items-center gap-2",children:[!u&&(fe.type==="video"||fe.type==="study")&&(ge.has(fe.id)?d.jsx("span",{className:"text-emerald-300 text-xs font-semibold",children:"Completed"}):d.jsx(Le,{size:"sm",variant:"outline",onClick:Oe=>{Oe.stopPropagation(),X(fe)},children:"Complete"})),u&&d.jsx(Le,{size:"sm",variant:"ghost",onClick:Oe=>{Oe.stopPropagation(),Z(A.id,fe.id)},"aria-label":"Reorder subsection",children:d.jsx(Dd,{className:"h-4 w-4"})}),u&&d.jsx(Le,{size:"sm",variant:"ghost",onClick:Oe=>{Oe.stopPropagation(),z(A.id,fe.id)},children:"Delete"})]})]},`${A.id}-${fe.id}`)),te.length===0&&d.jsx("div",{className:"px-4 py-2 text-xs text-white/60",children:"No subsections yet."})]})]},A.id)})]})]})]}),pe&&d.jsx("div",{className:"fixed inset-0 z-40 flex items-center justify-center bg-black/70 px-4",children:d.jsxs("div",{className:"w-full max-w-md rounded-2xl bg-slate-900 text-white border border-white/10 shadow-2xl",children:[d.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-white/10",children:[d.jsxs("div",{children:[d.jsx("div",{className:"text-lg font-semibold",children:pe.mode==="create"?"Add chapter":"Edit chapter"}),d.jsx("div",{className:"text-xs text-white/60",children:"Admin-only"})]}),d.jsx("button",{className:"p-2 rounded-full hover:bg-white/10 text-white/70",onClick:()=>$e(null),"aria-label":"Close",children:d.jsx(nr,{className:"h-4 w-4"})})]}),d.jsxs("div",{className:"p-5 space-y-4",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx("label",{className:"text-sm text-white/80",children:"Title"}),d.jsx("input",{value:pe.title,onChange:A=>$e(B=>B&&{...B,title:A.target.value}),className:"w-full rounded-xl border border-white/10 bg-white/5 px-3 py-3 text-sm outline-none focus:ring-2 focus:ring-pink-400",placeholder:"Chapter title"})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx("label",{className:"text-sm text-white/80",children:"Order"}),d.jsx("input",{type:"number",value:pe.index,onChange:A=>$e(B=>B&&{...B,index:Number(A.target.value)}),className:"w-full rounded-xl border border-white/10 bg-white/5 px-3 py-3 text-sm outline-none focus:ring-2 focus:ring-pink-400",min:0}),d.jsx("div",{className:"text-xs text-white/60",children:"Lower numbers appear first."})]}),d.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2",children:[d.jsx(Le,{variant:"outline",onClick:()=>$e(null),children:"Cancel"}),d.jsx(Le,{onClick:async()=>{!Fe||!pe.title.trim()||(pe.mode==="create"?await G4(Fe,pe.title.trim(),pe.index):pe.chapter&&await Y4(Fe,pe.chapter.id,{title:pe.title.trim(),index:pe.index}),$e(null))},children:"Save"})]})]})]})}),Y&&d.jsx("div",{className:"fixed inset-0 z-40 flex items-center justify-center bg-black/70 px-4",children:d.jsxs("div",{className:"w-full max-w-md rounded-2xl bg-slate-900 text-white border border-white/10 shadow-2xl",children:[d.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-white/10",children:[d.jsxs("div",{children:[d.jsx("div",{className:"text-lg font-semibold",children:"Add subsection"}),d.jsx("div",{className:"text-xs text-white/60",children:"Admin-only"})]}),d.jsx("button",{className:"p-2 rounded-full hover:bg-white/10 text-white/70",onClick:()=>J(null),"aria-label":"Close",children:d.jsx(nr,{className:"h-4 w-4"})})]}),d.jsxs("div",{className:"p-5 space-y-4",children:[d.jsxs("div",{className:"space-y-2",children:[d.jsx("label",{className:"text-sm text-white/80",children:"Type"}),d.jsxs("div",{className:"relative",children:[d.jsxs("button",{type:"button",onClick:()=>de(A=>!A),className:"w-full rounded-xl border border-white/10 bg-white/5 px-3 py-3 text-sm outline-none hover:border-white/20 flex items-center justify-between capitalize",children:[d.jsx("span",{children:Y.type}),d.jsx("span",{className:"text-xs text-white/60",children:Se?"Hide":"Show"})]}),Se&&d.jsx("div",{className:"absolute z-20 mt-2 w-full rounded-2xl bg-slate-800 border border-white/10 shadow-2xl overflow-hidden",children:["video","study","quiz"].map(A=>d.jsx("button",{onClick:()=>{J(B=>B&&{...B,type:A}),de(!1)},className:"w-full text-left px-4 py-2 text-sm text-white hover:bg-white/10 capitalize",children:A},A))})]})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx("label",{className:"text-sm text-white/80",children:"Title"}),d.jsx("input",{value:Y.title,onChange:A=>J(B=>B&&{...B,title:A.target.value}),className:"w-full rounded-xl border border-white/10 bg-white/5 px-3 py-3 text-sm outline-none focus:ring-2 focus:ring-pink-400",placeholder:"Subsection title"})]}),Y.type==="video"&&d.jsxs("div",{className:"space-y-2",children:[d.jsxs("label",{className:"text-sm text-white/80 flex items-center justify-between",children:[d.jsx("span",{children:"Video URL or Upload"}),d.jsx("span",{className:"text-xs text-white/60",children:"No size limit"})]}),d.jsx("input",{value:Y.videoUrl,onChange:A=>J(B=>B&&{...B,videoUrl:A.target.value}),className:"w-full rounded-xl border border-white/10 bg-white/5 px-3 py-3 text-sm outline-none focus:ring-2 focus:ring-pink-400",placeholder:"https://..."}),d.jsx("input",{type:"file",accept:"video/*",onChange:A=>{const B=A.target.files?.[0];if(!B)return;qe(null);const te=new FileReader;te.onerror=()=>qe("Could not read the video file. Try again or use a hosted link instead."),te.onload=fe=>{const Oe=fe.target?.result;typeof Oe=="string"?J(dt=>dt&&{...dt,videoUrl:Oe}):qe("Could not process the video file. Please try another file or a URL.")};try{te.readAsDataURL(B)}catch{qe("Video is too large to inline here. Please host it (e.g., MP4 link) and paste the URL.")}},className:"w-full text-sm text-white/80 file:mr-3 file:rounded-lg file:border-none file:bg-white/10 file:px-3 file:py-2 file:text-white hover:file:bg-white/20"}),Ue&&d.jsx("div",{className:"text-xs text-red-300",children:Ue}),d.jsxs("div",{className:"space-y-2",children:[d.jsx("label",{className:"text-sm text-white/80",children:"Trainer note (optional)"}),d.jsx("textarea",{value:Y.trainerNote,onChange:A=>J(B=>B&&{...B,trainerNote:A.target.value}),className:"w-full rounded-xl border border-white/10 bg-white/5 px-3 py-3 text-sm outline-none focus:ring-2 focus:ring-pink-400",rows:2,placeholder:"Message to show in Trainer Note during this video"})]})]}),Y.type==="study"&&d.jsxs("div",{className:"space-y-2",children:[d.jsxs("label",{className:"text-sm text-white/80 flex items-center justify-between",children:[d.jsx("span",{children:"PGN"}),d.jsx("span",{className:"text-xs text-white/60",children:"Paste or upload PGN"})]}),d.jsx("textarea",{value:Y.pgn,onChange:A=>J(B=>B&&{...B,pgn:A.target.value}),className:"w-full rounded-xl border border-white/10 bg-white/5 px-3 py-3 text-sm outline-none focus:ring-2 focus:ring-pink-400",rows:3,placeholder:"Paste PGN"}),d.jsx("input",{type:"file",accept:".pgn,text/plain",onChange:A=>{const B=A.target.files?.[0];if(!B)return;const te=new FileReader;te.onload=fe=>{const Oe=fe.target?.result;typeof Oe=="string"&&J(dt=>dt&&{...dt,pgn:Oe})},te.readAsText(B)},className:"w-full text-sm text-white/80 file:mr-3 file:rounded-lg file:border-none file:bg-white/10 file:px-3 file:py-2 file:text-white hover:file:bg-white/20"}),d.jsxs("div",{className:"space-y-2",children:[d.jsx("label",{className:"text-sm text-white/80",children:"Starting position (FEN)"}),d.jsx("input",{value:Y.fen,onChange:A=>J(B=>B&&{...B,fen:A.target.value}),className:"w-full rounded-xl border border-white/10 bg-white/5 px-3 py-3 text-sm outline-none focus:ring-2 focus:ring-pink-400",placeholder:"e.g. rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1"})]})]}),Y.type==="quiz"&&d.jsxs(d.Fragment,{children:[d.jsxs("div",{className:"space-y-2",children:[d.jsxs("label",{className:"text-sm text-white/80 flex items-center justify-between gap-2",children:[d.jsx("span",{children:"Options"}),d.jsxs("button",{type:"button",onClick:()=>J(A=>A&&{...A,quizQuestions:[...A.quizQuestions,{id:`q${A.quizQuestions.length+1}`,prompt:""}]}),className:"inline-flex items-center gap-1 rounded-md bg-white/10 px-2 py-1 text-xs hover:bg-white/20",children:[d.jsx(w0,{className:"h-3 w-3"}),"Add"]})]}),d.jsx("div",{className:"space-y-3",children:Y.quizQuestions.map((A,B)=>d.jsx("textarea",{value:A.prompt,onChange:te=>J(fe=>fe&&{...fe,quizQuestions:fe.quizQuestions.map((Oe,dt)=>dt===B?{...Oe,prompt:te.target.value}:Oe)}),className:"w-full rounded-xl border border-white/10 bg-white/5 px-3 py-3 text-sm outline-none focus:ring-2 focus:ring-pink-400",rows:2,placeholder:`Option ${B+1}`},A.id))})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx("label",{className:"text-sm text-white/80",children:"FEN"}),d.jsx("input",{value:Y.fen,onChange:A=>J(B=>B&&{...B,fen:A.target.value}),className:"w-full rounded-xl border border-white/10 bg-white/5 px-3 py-3 text-sm outline-none focus:ring-2 focus:ring-pink-400",placeholder:"e.g. rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1"})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx("label",{className:"text-sm text-white/80",children:"Correct option number"}),d.jsx("input",{type:"number",min:1,value:Y.correctQuestionIndex,onChange:A=>J(B=>B&&{...B,correctQuestionIndex:Number(A.target.value)||1}),className:"w-full rounded-xl border border-white/10 bg-white/5 px-3 py-3 text-sm outline-none focus:ring-2 focus:ring-pink-400",placeholder:"Enter the question number (e.g. 1)"})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx("label",{className:"text-sm text-white/80",children:"Trainer note (optional)"}),d.jsx("textarea",{value:Y.trainerNote,onChange:A=>J(B=>B&&{...B,trainerNote:A.target.value}),className:"w-full rounded-xl border border-white/10 bg-white/5 px-3 py-3 text-sm outline-none focus:ring-2 focus:ring-pink-400",rows:2,placeholder:"Message to show in Trainer Note during this quiz"})]})]}),d.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2",children:[d.jsx(Le,{variant:"outline",onClick:()=>J(null),children:"Cancel"}),d.jsx(Le,{disabled:bt,onClick:async()=>{if(!Y)return;if(ot(null),!Fe){ot("Course is still loading. Try again in a moment.");return}const A=Y.title.trim();if(!A){ot("Add a title for this subsection.");return}const B=Y.trainerNote.trim();let te=null;if(Y.type==="video"){const fe=Y.videoUrl.trim();if(!fe){ot("Add a video link or upload a file before saving.");return}const Oe=t_(fe);if(!Oe){ot("Video link is not valid. Use a direct MP4/WEBM/HLS URL or YouTube link.");return}if(Oe.type==="blocked"){ot(Oe.reason||"This video link cannot be played here.");return}if(fe.startsWith("data:")&&fe.length>4e6){ot("Video is too large to inline. Please host it (e.g., MP4 link) and paste the URL.");return}te={id:"",type:"video",title:A,videoUrl:fe,...B?{trainerNote:B}:{}}}else if(Y.type==="study"){const fe=Y.fen.trim();te={id:"",type:"study",title:A,pgn:Y.pgn.trim(),...fe?{fen:fe}:{}}}else{const fe=Y.quizQuestions.map(xn=>xn.prompt.trim()),Oe=Math.max(0,Math.min(fe.length-1,Y.correctQuestionIndex-1)),dt=[{id:"q1",prompt:"Select the correct option",options:fe,correctIndex:Oe}];te={id:"",type:"quiz",title:A,fen:Y.fen.trim()||void 0,...B?{trainerNote:B}:{},questions:dt}}if(te)try{nn(!0),await X4(Fe,Y.chapterId,te),J(null),de(!1)}catch(fe){console.error("Failed to save subsection",fe),ot("Could not save. Check your connection and try again.")}finally{nn(!1)}},children:bt?"Saving...":"Save"})]}),et&&d.jsx("div",{className:"text-xs text-red-300 pt-1 text-right",children:et})]})]})})]})}function e$(){const{user:t,logout:e,setUser:n}=$r(),[r,a]=j.useState(()=>t?.chessUsername?t.chessUsername:t?.displayName?t.displayName:t?.email?t.email.split("@")[0]:"YourUsername"),[u,h]=j.useState(!1),[m,y]=j.useState(""),[x,k]=j.useState("idle"),[T,S]=j.useState(null),[R,O]=j.useState(null),[D,q]=j.useState(!1),[he,ce]=j.useState(()=>ai(t?.boardTheme).key),[C,le]=j.useState(()=>Br(t?.pieceTheme).key),[c,re]=j.useState(!1),[xe,je]=j.useState([]),[Fe,Ze]=j.useState(!1),[st,Re]=j.useState(null),[Ae,ue]=j.useState(!1),[pe,$e]=j.useState(!1),[Y,J]=j.useState(""),[Se,de]=j.useState(t?.groupName||""),[$,ee]=j.useState([]),[Pe,Ee]=j.useState(""),[G,ae]=j.useState(!1),[Ue,qe]=j.useState(""),[et,ot]=j.useState(""),bt="k5rr/5R2/8/2p1P1p1/1p2Q3/1P6/K2p4/3b4 w - - 0 1",nn=j.useMemo(()=>i$(bt),[]),hn=j.useMemo(()=>Br(C).pieces,[C]);j.useEffect(()=>{t?.chessUsername?a(t.chessUsername):t?.displayName?a(t.displayName):t?.email&&a(t.email.split("@")[0])},[t]),j.useEffect(()=>{ce(ai(t?.boardTheme).key)},[t?.boardTheme]),j.useEffect(()=>{le(Br(t?.pieceTheme).key)},[t?.pieceTheme]);const Dt=!!t?.groupId&&t?.accountType==="group",Mn=Dt&&t?.groupRole==="admin";j.useEffect(()=>{de(t?.groupName||"")},[t?.groupName]),j.useEffect(()=>{pe&&Dt&&Yd(t?.groupId).then(ne=>ee(ne)).catch(()=>ee([]))},[pe,Dt,t?.groupId]);const Be=async ne=>{const at=await fetch(`https://api.chess.com/pub/player/${encodeURIComponent(ne)}/games/archives`);if(!at.ok)throw new Error("Could not read game archives for this user.");const Ft=(await at.json()).archives||[],Lt=Ft[Ft.length-1];if(!Lt)return[];const En=await fetch(Lt);if(!En.ok)return[];const Yt=await En.json(),Qt={};return(Yt.games||[]).slice(-50).forEach(Xt=>{const Tn=Xt?.opening||Xt?.eco||Xt?.eco_url;if(!Tn||typeof Tn!="string")return;const gs=Tn.toLowerCase();Qt[gs]=(Qt[gs]||0)+1}),Object.entries(Qt).sort((Xt,Tn)=>Tn[1]-Xt[1]).slice(0,3).map(([Xt])=>Xt)},Pt=(ne,at)=>{const yt=at.map(Lt=>({id:Lt.id,title:Lt.title.toLowerCase(),course:Lt})),Ft=[];return ne.forEach(Lt=>{const En=Lt.toLowerCase().split(/[^a-z]+/).filter(Boolean),Yt=En[0]||Lt.toLowerCase(),Qt=yt.find(Xt=>Xt.title.includes(Yt)||En.some(Tn=>Tn.length>3&&Xt.title.includes(Tn))||Yt.includes("sicilian")&&Xt.title.includes("dragon"));Qt&&!Ft.includes(Qt.id)&&Ft.push(Qt.id)}),!Ft.length&&at.length&&Ft.push(at[0].id),Ft.slice(0,3)},Wt=j.useMemo(()=>r,[r]),On=async ne=>{if(t){Re(ne);try{await t3(t.id,ne),je(at=>at.filter(yt=>yt.course.id!==ne))}finally{Re(null)}}},sn=()=>{ue(!0),Ee(""),J(""),de(t?.groupName||"")},qt=async()=>{ae(!0),Ee("");try{const ne=await B4();ne&&n(ne),ue(!1),$e(!1)}catch(ne){Ee(ne?.message||"Could not leave the group.")}finally{ae(!1)}},ln=async()=>{if(!Y.trim()){Ee("Enter the #1234 code to join.");return}ae(!0),Ee("");try{const ne=await pk(Y.trim());ne?.profile&&(n(ne.profile),ue(!1))}catch(ne){Ee(ne?.message||"Could not join that group.")}finally{ae(!1)}},zn=async()=>{if(!Se.trim()){Ee("Name your group first.");return}ae(!0),Ee("");try{const ne=await hk(Se.trim());ne?.profile&&(n(ne.profile),ue(!1))}catch(ne){Ee(ne?.message||"Could not create the group.")}finally{ae(!1)}},Wn=async()=>{if(!Se.trim()){Ee("Enter a name for your group.");return}ae(!0),Ee("");try{const ne=await z4(t||null,Se.trim());ne&&t&&n({...t,groupName:ne.name})}catch(ne){Ee(ne?.message||"Could not rename the group.")}finally{ae(!1)}},Ts=async()=>{if(Ue!=="DELETE"){Ee('Type "DELETE" to confirm.');return}ae(!0),Ee("");try{const ne=await q4(t||null);ne&&n(ne),$e(!1)}catch(ne){Ee(ne?.message||"Could not delete the group.")}finally{ae(!1)}},qn=async ne=>{if(t){ae(!0),Ee("");try{const at=await W4(t,ne);ee(at)}catch(at){Ee(at?.message||"Could not remove that member.")}finally{ae(!1)}}},cn=$.filter(ne=>{const at=et.trim().toLowerCase();return at?(ne.displayName||ne.email||"").toLowerCase().includes(at):!0}),Ln=[{key:"switch-account",title:"Switch Account",description:Dt?`Currently in ${t?.groupName||"a group"} (${t?.groupCode||"no code yet"})`:"Personal account active. Join or create a group to collaborate.",accent:"bg-indigo-700",icon:ZN,action:{type:"button",label:Dt?"Leave or change":"Create or Join",variant:"outline",onClick:sn}},...Mn?[{key:"manage-group",title:"Manage Group",description:"Invite or remove members, rename the group, or delete it entirely.",accent:"bg-emerald-700",icon:kE,action:{type:"button",label:"Manage Group",variant:"outline",onClick:()=>{Ee(""),qe(""),$e(!0),Yd(t?.groupId).then(ne=>ee(ne)).catch(()=>ee([]))}}}]:[],{key:"logout",title:"Log Out",description:"Sign out from PawnPoint on this device.",accent:"bg-emerald-600",icon:y0,action:{type:"button",label:"Log Out",variant:"outline",onClick:()=>e()}},{key:"chess",title:"Chess.com Account",description:"Your account is connected with the following chess.com username:",highlight:Wt,accent:"bg-emerald-700",icon:ay,action:{type:"button",label:"Change Account",variant:"outline",onClick:()=>{y(r||""),S(null),O(null),k("idle"),h(!0)}}},{key:"board",title:"Board and Theme Customization",description:"Customize your chessboard and chess pieces.",accent:"bg-emerald-700",icon:cE,action:{type:"button",label:"Set up Preferences",variant:"outline",onClick:()=>{q(!0)}}},{key:"reset",title:"Reset Progress",description:"Choose which courses to reset",accent:"bg-emerald-700",icon:vE,action:{type:"button",label:"Reset Progress",variant:"outline",onClick:async()=>{if(t){re(!0),Ze(!0);try{const[ne,at]=await Promise.all([Dm(),e3(t.id)]),yt=Object.entries(at||{}).map(([Ft,Lt])=>{const En=ne.find(Qt=>Qt.id===Ft);if(!En)return null;const Yt=Lt.progressPercent??Lt.percent??0;return Yt<=0?null:{course:En,percent:Yt}}).filter(Boolean);je(yt)}finally{Ze(!1)}}}}},{key:"email",title:"Change Email",description:`Your account is registered with: ${t?.email||"unknown"}`,accent:"bg-emerald-700",icon:D_,action:{type:"button",label:"Change Email",variant:"outline",onClick:()=>{}}},{key:"delete",title:"Delete Account",description:"Important: Deleting your account will permanently remove all your progress and data.",accent:"bg-rose-700",icon:wE,danger:!0,action:{type:"button",label:"Delete Account",variant:"outline",onClick:()=>{}}}],ns=async()=>{const at=m.trim().toLowerCase();if(!at){S("Enter a chess.com username.");return}k("loading"),S(null),O(null);try{const yt=await fetch(`https://api.chess.com/pub/player/${encodeURIComponent(at)}`);if(!yt.ok)throw new Error("User not found on chess.com");const Ft=await yt.json(),Lt={username:Ft.username,name:Ft.name,followers:Ft.followers,country:Ft.country,lastOnline:Ft.last_online,status:Ft.status,title:Ft.title,avatar:Ft.avatar};O(Lt),k("success")}catch(yt){k("error"),S(yt?.message||"Could not find that user. Check the spelling and try again.")}};return d.jsxs(qr,{children:[d.jsxs("div",{className:"w-full max-w-4xl mx-auto px-3 sm:px-4 pb-16",children:[d.jsx("h1",{className:"text-2xl font-bold text-white mb-6",children:"Settings"}),d.jsx("div",{className:"rounded-3xl bg-slate-900/90 border border-white/10 shadow-2xl overflow-hidden",children:d.jsx("div",{className:"divide-y divide-white/5",children:Ln.map(ne=>{const at=ne.icon;return d.jsxs("div",{className:"flex flex-col gap-4 px-5 py-4 sm:flex-row sm:items-center sm:justify-between hover:bg-white/5",children:[d.jsxs("div",{className:"flex items-start gap-4",children:[d.jsx("div",{className:`h-12 w-12 shrink-0 rounded-full border border-white/10 flex items-center justify-center text-white ${ne.accent}`,children:d.jsx(at,{className:"h-6 w-6"})}),d.jsxs("div",{className:"space-y-1",children:[d.jsx("div",{className:"text-lg font-semibold text-white",children:ne.title}),d.jsx("div",{className:"text-sm text-white/70 leading-snug",children:ne.description}),ne.highlight&&d.jsx("div",{className:"text-sm font-semibold text-emerald-300",children:ne.highlight})]})]}),d.jsx("div",{className:"w-full sm:w-[180px] flex justify-start sm:justify-end",children:(()=>{const yt=ne.action;return yt.type==="button"?d.jsx(Le,{variant:yt.variant??"outline",className:`w-full sm:w-[180px] min-w-[180px] h-11 justify-center whitespace-nowrap ${ne.danger?"border-rose-300 text-rose-100 hover:bg-rose-500/20":""}`,onClick:yt.onClick,children:yt.label}):yt.type==="toggle"?d.jsx("button",{className:`relative inline-flex h-7 w-12 items-center rounded-full transition ${yt.value?"bg-emerald-500":"bg-white/20"}`,onClick:()=>yt.onToggle(!yt.value),disabled:yt.disabled,"aria-pressed":yt.value,children:d.jsx("span",{className:`inline-block h-5 w-5 transform rounded-full bg-white shadow transition ${yt.value?"translate-x-6":"translate-x-1"}`})}):d.jsx("div",{className:"rounded-full bg-slate-600 text-white/80 px-4 py-2 text-sm select-none",children:yt.label})})()})]},ne.key)})})})]}),Ae&&d.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 px-4",children:d.jsxs("div",{className:"w-full max-w-xl rounded-3xl bg-slate-900 text-white border border-white/10 shadow-2xl p-6 space-y-4",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("div",{className:"text-lg font-semibold",children:"Switch Account"}),d.jsx("div",{className:"text-sm text-white/70",children:"Personal accounts keep data to yourself. Groups share courses and leaderboards only with members."})]}),d.jsx("button",{className:"h-10 w-10 rounded-full bg-white/10 flex items-center justify-center hover:bg-white/20",onClick:()=>{ue(!1),Ee("")},"aria-label":"Close",children:"X"})]}),Pe&&d.jsx("div",{className:"rounded-xl border border-amber-400/40 bg-amber-400/10 text-amber-100 px-3 py-2 text-sm",children:Pe}),Dt?d.jsxs("div",{className:"space-y-3",children:[d.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/5 p-4 space-y-2",children:[d.jsx("div",{className:"text-sm text-white/70",children:"Current group"}),d.jsx("div",{className:"text-lg font-semibold",children:t?.groupName||"Unnamed group"}),d.jsxs("div",{className:"text-xs text-white/60",children:["Code: ",t?.groupCode||"N/A"]})]}),d.jsx(Le,{variant:"outline",className:"w-full justify-center",onClick:qt,disabled:G,children:G?"Leaving...":"Leave group and use personal account"})]}):d.jsxs("div",{className:"space-y-4",children:[d.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/5 p-4",children:[d.jsx("div",{className:"text-sm font-semibold",children:"Personal account"}),d.jsx("div",{className:"text-xs text-white/70",children:"You are currently using a personal account."})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx("label",{className:"text-sm text-white/80",children:"Join a group with code"}),d.jsx("input",{value:Y,onChange:ne=>J(ne.target.value),className:"w-full rounded-xl border border-white/10 bg-white/5 px-3 py-3 text-sm outline-none focus:ring-2 focus:ring-emerald-400",placeholder:"#1234"}),d.jsx(Le,{className:"w-full justify-center",onClick:ln,disabled:G,children:G?"Joining...":"Join Group"})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx("label",{className:"text-sm text-white/80",children:"Create a new group"}),d.jsx("input",{value:Se,onChange:ne=>de(ne.target.value),className:"w-full rounded-xl border border-white/10 bg-white/5 px-3 py-3 text-sm outline-none focus:ring-2 focus:ring-emerald-400",placeholder:"Team Knights"}),d.jsx(Le,{className:"w-full justify-center",onClick:zn,disabled:G,children:G?"Creating...":"Create Group"})]})]})]})}),pe&&d.jsx("div",{className:"fixed inset-0 z-50 flex items-start justify-center bg-black/70 px-4 py-10 overflow-y-auto",children:d.jsxs("div",{className:"w-full max-w-4xl rounded-3xl bg-slate-900 text-white border border-white/10 shadow-2xl p-6 space-y-5",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("div",{className:"text-xl font-semibold",children:"Manage Group"}),d.jsx("div",{className:"text-sm text-white/70",children:"Only members in this group can see these courses and leaderboards."})]}),d.jsx("button",{className:"h-10 w-10 rounded-full bg-white/10 flex items-center justify-center hover:bg-white/20",onClick:()=>{$e(!1),Ee("")},"aria-label":"Close",children:"X"})]}),Pe&&d.jsx("div",{className:"rounded-xl border border-amber-400/40 bg-amber-400/10 text-amber-100 px-3 py-2 text-sm",children:Pe}),d.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[d.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/5 p-4 space-y-3",children:[d.jsx("div",{className:"text-sm text-white/70",children:"Group name"}),d.jsx("input",{value:Se,onChange:ne=>de(ne.target.value),className:"w-full rounded-xl border border-white/10 bg-slate-900 px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-emerald-400",placeholder:"Team Knights"}),d.jsx(Le,{variant:"outline",onClick:Wn,disabled:G,children:G?"Saving...":"Rename Group"}),d.jsxs("div",{className:"text-xs text-white/60",children:["Code: ",t?.groupCode||"No code yet"," (share this to invite)"]})]}),d.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/5 p-4 space-y-3",children:[d.jsxs("div",{className:"flex items-center justify-between text-sm font-semibold",children:[d.jsx("span",{children:"Members"}),d.jsxs("span",{className:"text-white/60 text-xs",children:[$.length," total"]})]}),d.jsx("input",{value:et,onChange:ne=>ot(ne.target.value),placeholder:"Search members",className:"w-full rounded-xl border border-white/10 bg-slate-900 px-3 py-2 text-sm text-white outline-none focus:ring-2 focus:ring-emerald-400"}),cn.length===0?d.jsx("div",{className:"text-xs text-white/60",children:"No members listed yet."}):d.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto pr-1",children:cn.map(ne=>d.jsxs("div",{className:"flex items-center justify-between rounded-lg border border-white/10 bg-slate-900 px-3 py-2 text-sm",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("div",{className:"h-8 w-8 rounded-full bg-white/10 flex items-center justify-center uppercase",children:(ne.displayName||ne.email||"U").slice(0,2)}),d.jsxs("div",{children:[d.jsx("div",{className:"font-semibold",children:ne.displayName||"Member"}),d.jsx("div",{className:"text-xs text-white/60",children:ne.role==="admin"?"Admin":"Member"})]})]}),ne.id!==t?.id&&d.jsx(Le,{variant:"ghost",size:"sm",onClick:()=>qn(ne.id),disabled:G,children:"Remove"})]},ne.id))})]})]}),d.jsxs("div",{className:"rounded-xl border border-rose-400/30 bg-rose-500/10 p-4 space-y-2",children:[d.jsxs("div",{className:"flex items-center gap-2 text-rose-100",children:[d.jsx(CE,{className:"h-4 w-4"}),d.jsx("div",{className:"font-semibold",children:"Delete group"})]}),d.jsx("div",{className:"text-xs text-white/70",children:"Deleting will remove the group, its private courses, and leaderboard visibility for all members."}),d.jsx("input",{value:Ue,onChange:ne=>qe(ne.target.value),placeholder:'Type "DELETE" to confirm',className:"w-full rounded-xl border border-white/10 bg-slate-900 px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-rose-400"}),d.jsx(Le,{variant:"outline",onClick:Ts,disabled:G,children:G?"Deleting...":"Delete group"})]})]})}),u&&d.jsx("div",{className:"fixed inset-0 z-40 flex items-center justify-center bg-black/70 px-4",children:d.jsxs("div",{className:"w-full max-w-md rounded-3xl bg-slate-900 text-white border border-white/10 shadow-2xl relative",children:[d.jsx("button",{className:"absolute right-3 top-3 text-white/70 hover:text-white",onClick:()=>h(!1),"aria-label":"Close",children:""}),d.jsxs("div",{className:"px-6 py-6 space-y-4",children:[d.jsxs("div",{children:[d.jsx("div",{className:"text-xl font-bold",children:"Change your Chess.com account"}),d.jsx("div",{className:"text-sm text-white/70 mt-1",children:"We will use this information to:"})]}),d.jsx("div",{className:"space-y-2 text-sm text-white/80",children:["Recommend you the best courses to study","Analyze your games and tell you where you make mistakes","Break down your chess skills and what to improve"].map((ne,at)=>d.jsxs("div",{className:"flex items-start gap-2",children:[d.jsx(ry,{className:"h-4 w-4 text-emerald-400 mt-0.5"}),d.jsx("span",{children:ne})]},at))}),d.jsxs("div",{className:"space-y-2",children:[d.jsx("label",{className:"text-xs uppercase tracking-[0.08em] text-white/50",children:"Chess.com username"}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("input",{value:m,onChange:ne=>y(ne.target.value),className:"w-full rounded-xl border border-white/10 bg-white/5 px-3 py-3 text-sm outline-none focus:ring-2 focus:ring-emerald-400",placeholder:"Chess.com username",onKeyDown:ne=>{ne.key==="Enter"&&(ne.preventDefault(),ns())}}),d.jsx(Le,{variant:"outline",className:"whitespace-nowrap",onClick:ns,disabled:x==="loading",children:x==="loading"?"Searching...":"Link"})]}),T&&d.jsx("div",{className:"text-xs text-rose-300",children:T}),x==="success"&&R&&d.jsxs("div",{className:"rounded-xl border border-emerald-400/40 bg-emerald-500/10 px-3 py-3 text-sm space-y-1",children:[d.jsxs("div",{className:"font-semibold text-emerald-200 flex items-center gap-2",children:[d.jsx("span",{className:"h-2 w-2 rounded-full bg-emerald-400"}),R.username]}),R.title&&d.jsxs("div",{className:"text-white/80",children:["Title: ",R.title]}),d.jsx("div",{className:"text-white/70",children:t$(R.lastOnline)||"Activity data unavailable"})]})]}),d.jsx("div",{className:"pt-2",children:d.jsx(Le,{className:"w-full justify-center",onClick:async()=>{if(x!=="success"||!R){await ns();return}try{k("loading");const ne=m.trim(),at=R.username.toLowerCase(),yt=await Be(at),Ft=await Dm(),Lt=Pt(yt,Ft);r3(Lt,ne||R.username),a(ne||R.username);const En=await M4(ne||R.username);En&&n(En),k("success"),h(!1)}catch(ne){k("error"),S(ne?.message||"Could not fetch openings to build recommendations.")}},children:x==="success"?"Save account":x==="loading"?"Working...":"Continue"})})]})]})}),D&&d.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 px-4",children:d.jsxs("div",{className:"w-full max-w-4xl rounded-3xl bg-slate-900 text-white border border-white/10 shadow-2xl",children:[d.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-white/10",children:[d.jsx("div",{className:"text-lg font-semibold",children:"Board customization"}),d.jsx("button",{className:"text-white/70 hover:text-white",onClick:()=>q(!1),"aria-label":"Close",children:d.jsx(nr,{className:"h-5 w-5"})})]}),d.jsxs("div",{className:"p-5 space-y-6",children:[d.jsxs("div",{className:"rounded-2xl bg-slate-800/70 border border-white/10 p-4",children:[d.jsx("div",{className:"text-white mb-3 font-semibold",children:"Active Piece: White Queen"}),d.jsx("div",{className:"flex flex-col gap-3 items-center",children:d.jsx("div",{className:"relative inline-block",children:d.jsx("div",{className:"grid grid-cols-8 grid-rows-8 w-full max-w-[320px] sm:max-w-[360px] mx-auto aspect-square overflow-hidden rounded-xl border border-white/10",children:nn.map(ne=>d.jsxs("div",{className:"relative flex items-center justify-center text-xs font-semibold",style:{background:ne.isLight?Kp[he]?.light||Kp.brown.light:Kp[he]?.dark||Kp.brown.dark,color:"#111"},children:[ne.isHighlight&&d.jsx("div",{className:"absolute inset-0",style:{backgroundColor:r$,opacity:.8}}),ne.piece&&d.jsx("img",{src:o$(ne.piece,hn),alt:"",className:`relative z-10 h-[36px] w-[36px] object-contain ${C==="freestyle"?"p-1":""} ${a$(C,ne.piece)}`,draggable:!1}),ne.coord&&d.jsx("div",{className:"absolute left-1 bottom-1 text-[10px] text-black/70",children:ne.coord})]},ne.name))})})})]}),d.jsxs("div",{className:"grid md:grid-cols-2 gap-4 text-sm text-white",children:[d.jsx(l_,{label:"Board",value:he,onChange:ne=>ce(ne),options:n$}),d.jsx(l_,{label:"Pieces",value:C,onChange:ne=>le(ne),options:s$})]}),d.jsx("div",{className:"flex justify-end",children:d.jsx(Le,{className:"px-6",onClick:async()=>{const ne=ai(he).key,at=Br(C).key,yt=await L4(ne,at);yt&&n(yt),q(!1)},children:"Save"})})]})]})}),c&&d.jsx("div",{className:"fixed inset-0 z-40 flex items-start justify-center bg-black/60 px-4 py-10 overflow-y-auto",children:d.jsxs("div",{className:"w-full max-w-5xl rounded-2xl bg-slate-900 text-white border border-white/10 shadow-2xl p-6 space-y-4",children:[d.jsxs("button",{className:"flex items-center gap-2 text-sm text-white/70",onClick:()=>re(!1),children:[d.jsx(O_,{className:"h-4 w-4"}),"Back"]}),d.jsx("div",{className:"text-2xl font-bold",children:"Reset Progress"}),Fe?d.jsx("div",{className:"text-white/70 text-sm",children:"Loading your courses"}):xe.length===0?d.jsx("div",{className:"text-white/70 text-sm",children:"You have no courses with earned XP to reset."}):d.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:xe.map(({course:ne,percent:at})=>d.jsxs("div",{className:"rounded-xl border border-white/10 bg-slate-800/60 p-4 flex items-center gap-4",children:[d.jsx("div",{className:"h-14 w-14 rounded-xl overflow-hidden bg-white/5 flex items-center justify-center",children:d.jsx("img",{src:ne.thumbnailUrl,alt:ne.title,className:"h-full w-full object-cover"})}),d.jsxs("div",{className:"flex-1 space-y-2",children:[d.jsx("div",{className:"font-semibold text-white",children:ne.title}),d.jsxs("div",{className:"flex items-center gap-2 text-xs text-white/70",children:[d.jsx("div",{className:"flex-1 h-2 rounded-full bg-white/10 overflow-hidden",children:d.jsx("div",{className:"h-full bg-emerald-400",style:{width:`${Math.min(100,Math.max(0,at))}%`}})}),d.jsxs("span",{className:"font-semibold text-white",children:[at,"%"]})]})]}),d.jsx(Le,{variant:"outline",className:"min-w-[88px]",disabled:st===ne.id,onClick:()=>On(ne.id),children:st===ne.id?"Resetting...":"Reset"})]},ne.id))})]})})]})}function t$(t){if(!t)return null;const e=Date.now()/1e3-t;return e<3600?"Active recently":e<86400?"Active today":`Active ${Math.floor(e/86400)}d ago`}const n$=Object.keys($m).map(t=>({label:t.charAt(0).toUpperCase()+t.slice(1),value:t})),s$=Object.keys(V0).map(t=>({label:t.charAt(0).toUpperCase()+t.slice(1),value:t})),Kp=$m,r$="#f3cd4b";function i$(t){const e=t.split(" ")[0].split("/"),n=[];e.forEach((a,u)=>{let h=0;a.split("").forEach(m=>{if(/[1-8]/.test(m)){const y=Number(m);for(let x=0;x<y;x++){const k=`${"abcdefgh"[h]}${8-u}`;n.push({name:k,piece:null,isLight:(h+u)%2===0,coord:k}),h++}}else{const y=`${"abcdefgh"[h]}${8-u}`;n.push({name:y,piece:m,isLight:(h+u)%2===0,coord:y}),h++}})});const r=["d3","e2","e5","f3"];return n.map(a=>({...a,isHighlight:r.includes(a.name)}))}function l_({label:t,value:e,onChange:n,options:r}){return d.jsxs("div",{className:"space-y-1",children:[d.jsx("div",{className:"text-white/80 text-sm",children:t}),d.jsxs("div",{className:"relative",children:[d.jsxs("button",{className:"w-full flex items-center justify-between rounded-xl bg-slate-800 border border-white/10 px-3 py-3 text-white text-sm",children:[d.jsx("span",{children:r.find(a=>a.value===e)?.label||e}),d.jsx(tE,{className:"h-4 w-4 text-white/60"})]}),d.jsx("select",{className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",value:e,onChange:a=>n(a.target.value),children:r.map(a=>d.jsx("option",{value:a.value,children:a.label},a.value))})]})]})}function o$(t,e){if(!t||t.length===0)return"";const n=t===t.toUpperCase(),r=t.toLowerCase();return n?e.w[r]:e.b[r]}function a$(t,e){if(!e||e.toLowerCase()!=="p")return"";const n=e===e.toUpperCase();return t==="chesscom"?n?"scale-110":"scale-90":t==="freestyle"&&!n?"scale-110":""}const Tk="/assets/Advent%20Calendar-J5ITks2v.png",im="/assets/Christmas%20Pawn-D_bCmMDk.png",Ik="/assets/Gift-ueUQQsya.png",l$="/assets/Grinch%20pfp-zl_ex9Kh.png",c$="/assets/Mistletoe%20pfp-BFt_2ImS.png",u$="/assets/Rook%20pfp-CqClYD4h.png",d$="/assets/Santa%20pfp-DfWqBBWO.png",f$="/assets/Snowman%20pfp-J9IJC07F.png",h$="/assets/Tree%20pfp-BT-iifK4.png",Gp=[{label:"Gift Box",value:Ik},{label:"Christmas Pawn",value:im},{label:"Advent Banner",value:Tk},{label:"Grinch",value:l$},{label:"Mistletoe",value:c$},{label:"Rook",value:u$},{label:"Santa",value:d$},{label:"Snowman",value:f$},{label:"Tree",value:h$}],c_=["Emerald King","Sapphire Queen","Ruby Rook","Amber Bishop","Onyx Knight","Ivory Pawn"];function p$(){const{user:t,setUser:e}=$r(),[n,r]=j.useState(u_()),a=j.useMemo(()=>24-Math.max(0,n.days),[n.days]),[u,h]=j.useState({}),[m,y]=j.useState(!1),[x,k]=j.useState(null),[T,S]=j.useState({}),[R,O]=j.useState({type:"pfp",value:Gp[0].value}),[D,q]=j.useState(null),[he,ce]=j.useState(()=>{try{const ue=localStorage.getItem("advent_unlocked_videos");return ue?JSON.parse(ue):{}}catch{return{}}}),[C,le]=j.useState(()=>{try{const ue=localStorage.getItem("advent_claimed_days");return ue?new Set(JSON.parse(ue)):new Set}catch{return new Set}});j.useEffect(()=>{const ue=setInterval(()=>r(u_()),1e3);return()=>clearInterval(ue)},[]),j.useEffect(()=>{(async()=>{try{const pe=await or(Ke(Ge,"adventGifts"));pe.exists()&&S(pe.val())}catch(pe){console.warn("Failed to load advent gifts",pe)}})()},[]);const c=t?.totalXp??0,re=t?.pawns??0,xe=Math.floor(c/25),je=!!t?.isAdmin,Fe=(ue,pe)=>pe?.type==="video"?he[ue]||pe.value:"",Ze=ue=>{ue&&window.open(ue,"_blank","noopener,noreferrer")},st=ue=>{le(pe=>{if(pe.has(ue))return pe;const $e=new Set(pe);return $e.add(ue),localStorage.setItem("advent_claimed_days",JSON.stringify(Array.from($e))),$e})},Re=async(ue,pe)=>{if(!t)return;let $e=pe;try{const Y=await n3(t.id,pe);Y&&e(Y),pe.type==="video"&&pe.value&&ce(J=>{const Se={...J,[ue]:pe.value};return localStorage.setItem("advent_unlocked_videos",JSON.stringify(Se)),Se}),$e=pe.type==="video"?{...pe,value:Fe(ue,pe)}:pe}catch(Y){console.warn("Failed to unlock gift",Y)}finally{st(ue),q({day:ue,gift:$e})}},Ae=async(ue,pe,$e)=>{if(!t)return;const Y=$e||T[ue]||{type:"pawns",value:pe};if(C.has(ue)){h(de=>({...de,[ue]:!0})),q({day:ue,gift:Y.type==="video"?{...Y,value:Fe(ue,Y)}:Y});return}if((t.pawns||0)<pe){alert("Not enough pawns to unlock this reward.");return}const J=(t.pawns||0)-pe,Se={...t,pawns:J};e(Se),localStorage.setItem("pawnpoint_user",JSON.stringify(Se));try{await qs(Ke(Ge,`users/${t.id}`),Se)}catch(de){console.warn("Failed to update pawns after purchase",de)}h(de=>({...de,[ue]:!0})),await Re(ue,Y)};return d.jsx(qr,{children:d.jsxs("div",{className:"relative w-full min-h-screen overflow-hidden",children:[d.jsx("div",{className:"fixed inset-0 -z-10",style:{backgroundImage:`url(${wk})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"}}),d.jsxs("div",{className:"relative flex flex-col items-center gap-6 px-4 pb-12 pt-12",children:[d.jsxs("div",{className:"absolute right-4 top-4 flex items-center gap-2 rounded-full bg-white/10 border border-white/15 px-4 py-2 text-white shadow-lg",children:[d.jsx("img",{src:im,alt:"Pawn counter",className:"h-6 w-6 object-contain"}),d.jsxs("div",{className:"text-sm font-semibold",children:[re," Pawns"]})]}),d.jsx("div",{className:"w-full max-w-5xl flex flex-col gap-3",children:d.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3 sm:gap-4 text-center sm:text-left",children:[d.jsx("img",{src:im,alt:"Christmas Pawn",className:"h-16 w-16 object-contain mx-auto sm:mx-0"}),d.jsxs("div",{className:"text-white space-y-1",children:[d.jsx("div",{className:"text-lg font-semibold",children:"Welcome to the Pawn Point Advent Calendar!"}),d.jsx("div",{className:"text-sm text-white/80 leading-relaxed",children:"Every day leading up to Christmas, you can open a new tile and unlock a special holiday-themed cosmetic, surprise reward, or limited-edition item. Check back daily to discover what the South Knight has prepared for youyour festive journey begins now!"})]})]})}),d.jsxs("div",{className:"w-full max-w-5xl rounded-3xl bg-slate-900 border border-white/10 shadow-2xl overflow-hidden relative mx-auto",children:[d.jsx("img",{src:Tk,alt:"Advent Calendar",className:"w-full h-full object-contain"}),d.jsx("div",{className:"absolute inset-3 sm:inset-4 grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 grid-rows-4 gap-2 sm:gap-1.5 p-1 pointer-events-none",children:Array.from({length:24}).map((ue,pe)=>{const $e=pe+1,Y=$e<=a,J=u[$e]||C.has($e),Se=$e*10,de=T[$e];return d.jsxs("div",{className:`reward-card relative rounded-lg bg-black/45 backdrop-blur-sm border border-white/10 flex flex-col items-center justify-center gap-2 text-white font-semibold text-sm pointer-events-auto transition-transform duration-500 ${J?"rotate-y-180":""}`,style:{transformStyle:"preserve-3d"},onClick:()=>{J||(Y||je)&&(h($=>({...$,[$e]:!0})),de&&Re($e,de))},children:[je&&d.jsx("button",{className:"absolute right-1.5 top-1.5 h-7 w-7 rounded-full bg-white/20 hover:bg-white/30 flex items-center justify-center",onClick:$=>{$.stopPropagation(),k($e),O(T[$e]||{type:"pfp",value:Gp[0].value})},"aria-label":"Edit gift",children:d.jsx(Dd,{className:"h-4 w-4"})}),J?d.jsxs("div",{className:"flex flex-col items-center justify-center gap-3 w-full h-full bg-gradient-to-br from-[#3b0b47] via-[#4c0c58] to-[#2b0a38] rounded-lg relative p-2 text-center",style:{transform:"rotateY(180deg)"},children:[d.jsx("button",{className:"absolute right-2 top-2 text-white/80 hover:text-white text-sm",onClick:$=>{$.preventDefault(),$.stopPropagation(),h(ee=>({...ee,[$e]:!1}))},"aria-label":"Close reward",children:""}),d.jsx("img",{src:Ik,alt:"Gift",className:"h-20 w-20 md:h-24 md:w-24 object-contain drop-shadow-[0_12px_24px_rgba(255,180,80,0.75)] animate-bounce"}),d.jsxs("div",{className:"space-y-1 text-xs text-white/80",children:[d.jsx("div",{className:"font-semibold text-sm text-white",children:"Reward"}),d.jsx("button",{type:"button",className:"inline-flex items-center justify-center rounded-full bg-gradient-to-r from-amber-300 to-orange-500 px-4 py-1.5 text-xs font-semibold text-[#2b0b38] shadow-md hover:shadow-lg",onClick:async $=>{$.preventDefault(),$.stopPropagation(),!(!Y&&!je)&&await Ae($e,Se,de)},children:`${Se} Pawns`}),de&&d.jsxs("div",{className:"text-[11px] text-white/80",children:["Unlocked: ",d_(de)]}),de?.type==="video"&&Fe($e,de)&&d.jsx(Le,{size:"sm",className:"mt-1 bg-emerald-500 text-slate-900 hover:bg-emerald-400",onClick:$=>{$.preventDefault(),$.stopPropagation(),Ze(Fe($e,de))},children:"Watch Video"})]})]}):d.jsxs("div",{className:"flex flex-col items-center gap-2 py-3 px-2",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[Y?d.jsx(dE,{className:"h-4 w-4 text-emerald-300"}):d.jsx(L_,{className:"h-4 w-4 text-white/80"}),d.jsx("span",{children:$e})]}),(Y||je)&&d.jsx("button",{type:"button",className:"text-xs px-2 py-1 rounded-md bg-emerald-500 hover:bg-emerald-400 text-black font-semibold relative z-10",onClick:async $=>{$.preventDefault(),$.stopPropagation(),!(!Y&&!je)&&await Ae($e,Se,de)},children:"Redeem"}),de&&je&&d.jsxs("div",{className:"text-[10px] text-white/70 flex items-center gap-1",children:[d.jsx(ry,{className:"h-3 w-3 text-emerald-300"}),d.jsx("span",{children:d_(de)})]})]})]},pe)})})]}),d.jsx("button",{type:"button",className:"mt-2 inline-flex items-center justify-center rounded-xl bg-emerald-500 px-5 py-2 text-sm font-semibold text-slate-900 shadow-lg hover:bg-emerald-400 focus:outline-none focus:ring-2 focus:ring-emerald-300",onClick:()=>y(!0),children:"Cash in XP"})]}),m&&d.jsx("div",{className:"fixed inset-0 z-30 flex items-center justify-center bg-black/60 px-4",children:d.jsxs("div",{className:"w-full max-w-md rounded-2xl bg-slate-900 text-white border border-white/10 shadow-2xl p-6 space-y-4",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("div",{className:"text-lg font-semibold",children:"Cash in XP"}),d.jsx("div",{className:"text-sm text-white/70",children:"Convert your XP into Pawns (25 XP = 1 Pawn)"})]}),d.jsx("button",{className:"h-9 w-9 rounded-full bg-white/10 hover:bg-white/20 flex items-center justify-center",onClick:()=>y(!1),"aria-label":"Close",children:""})]}),d.jsxs("div",{className:"space-y-3",children:[d.jsxs("div",{className:"flex items-center justify-between rounded-xl bg-white/5 border border-white/10 px-4 py-3",children:[d.jsx("div",{className:"text-sm text-white/70",children:"Your XP"}),d.jsxs("div",{className:"text-lg font-semibold text-white",children:[c," XP"]})]}),d.jsxs("div",{className:"flex items-center justify-between rounded-xl bg-white/5 border border-white/10 px-4 py-3",children:[d.jsxs("div",{className:"flex items-center gap-2 text-sm text-white/70",children:[d.jsx("img",{src:im,alt:"Pawn",className:"h-6 w-6 object-contain"}),d.jsx("span",{children:"Pawns you can claim"})]}),d.jsx("div",{className:"text-lg font-semibold text-white",children:xe})]})]}),d.jsx("div",{className:"text-xs text-white/60",children:"Pawns are calculated from your current XP. Check back after earning more XP to claim additional Pawns."}),d.jsxs("div",{className:"flex justify-between items-center gap-3",children:[d.jsx("button",{className:"rounded-lg bg-amber-400 px-4 py-2 text-sm font-semibold text-slate-900 hover:bg-amber-300 disabled:opacity-50 disabled:cursor-not-allowed",disabled:!t||xe<=0,onClick:async()=>{if(!t||xe<=0)return;const ue=await k4(t.id);ue&&e(pe=>pe&&{...pe,pawns:(pe.pawns||0)+ue.pawnsAdded,totalXp:ue.remainingXp,level:Math.floor(ue.remainingXp/100)+1})},children:"Claim Now!"}),d.jsx("button",{className:"rounded-lg bg-emerald-500 px-4 py-2 text-sm font-semibold text-slate-900 hover:bg-emerald-400",onClick:()=>y(!1),children:"Close"})]})]})}),x!==null&&je&&d.jsx("div",{className:"fixed inset-0 z-40 flex items-start justify-center bg-black/60 px-4 py-10 overflow-y-auto",children:d.jsxs("div",{className:"w-full max-w-2xl rounded-2xl bg-slate-900 text-white border border-white/10 shadow-2xl p-6 space-y-4",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsxs("div",{className:"text-lg font-semibold",children:["Edit Gift for Day ",x]}),d.jsx("div",{className:"text-sm text-white/70",children:"Choose what users receive when they open this tile."})]}),d.jsx("button",{className:"h-9 w-9 rounded-full bg-white/10 hover:bg-white/20 flex items-center justify-center",onClick:()=>k(null),"aria-label":"Close gift editor",children:"-"})]}),d.jsxs("div",{className:"grid sm:grid-cols-2 gap-3 text-sm",children:[d.jsxs("label",{className:"flex items-center gap-2 rounded-xl border border-white/10 bg-white/5 px-3 py-2 cursor-pointer",children:[d.jsx("input",{type:"radio",name:"gift-type",checked:R.type==="pfp",onChange:()=>O({type:"pfp",value:Gp[0].value}),className:"accent-emerald-400"}),d.jsx(lE,{className:"h-4 w-4 text-emerald-300"}),d.jsx("span",{children:"Profile Picture"})]}),d.jsxs("label",{className:"flex items-center gap-2 rounded-xl border border-white/10 bg-white/5 px-3 py-2 cursor-pointer",children:[d.jsx("input",{type:"radio",name:"gift-type",checked:R.type==="tagline",onChange:()=>O({type:"tagline",value:""}),className:"accent-emerald-400"}),d.jsx(_E,{className:"h-4 w-4 text-emerald-300"}),d.jsx("span",{children:"Special Tagline"})]}),d.jsxs("label",{className:"flex items-center gap-2 rounded-xl border border-white/10 bg-white/5 px-3 py-2 cursor-pointer",children:[d.jsx("input",{type:"radio",name:"gift-type",checked:R.type==="piece",onChange:()=>O({type:"piece",value:c_[0]}),className:"accent-emerald-400"}),d.jsx(iE,{className:"h-4 w-4 text-emerald-300"}),d.jsx("span",{children:"Chess Piece Cosmetic"})]}),d.jsxs("label",{className:"flex items-center gap-2 rounded-xl border border-white/10 bg-white/5 px-3 py-2 cursor-pointer",children:[d.jsx("input",{type:"radio",name:"gift-type",checked:R.type==="video",onChange:()=>O({type:"video",value:""}),className:"accent-emerald-400"}),d.jsx(SE,{className:"h-4 w-4 text-emerald-300"}),d.jsx("span",{children:"Video"})]})]}),R.type==="pfp"&&d.jsxs("div",{className:"space-y-2",children:[d.jsx("div",{className:"text-sm text-white/70",children:"Select profile picture"}),d.jsx("div",{className:"grid grid-cols-3 gap-3",children:Gp.map(ue=>d.jsxs("button",{className:`relative rounded-xl border px-2 py-2 bg-white/5 hover:bg-white/10 ${R.value===ue.value?"border-emerald-400 ring-2 ring-emerald-300/60":"border-white/10"}`,onClick:()=>O({type:"pfp",value:ue.value}),children:[d.jsx("img",{src:ue.value,alt:ue.label,className:"h-16 w-full object-cover rounded-lg"}),d.jsx("div",{className:"mt-1 text-xs text-white/80 text-center",children:ue.label})]},ue.value))})]}),R.type==="tagline"&&d.jsxs("div",{className:"space-y-2",children:[d.jsx("div",{className:"text-sm text-white/70",children:"Custom tagline"}),d.jsx("input",{className:"w-full rounded-xl bg-white/5 border border-white/10 px-3 py-2 text-sm text-white focus:outline-none focus:ring-2 focus:ring-emerald-400",placeholder:'e.g. "The Calculator"',value:R.value,onChange:ue=>O({type:"tagline",value:ue.target.value})})]}),R.type==="piece"&&d.jsxs("div",{className:"space-y-2",children:[d.jsx("div",{className:"text-sm text-white/70",children:"Select chess piece cosmetic"}),d.jsx("div",{className:"grid grid-cols-2 gap-2",children:c_.map(ue=>d.jsx("button",{className:`rounded-xl border px-3 py-2 text-left text-sm ${R.value===ue?"border-emerald-400 bg-emerald-400/10":"border-white/10 bg-white/5"}`,onClick:()=>O({type:"piece",value:ue}),children:ue},ue))})]}),R.type==="video"&&d.jsxs("div",{className:"space-y-2",children:[d.jsx("div",{className:"text-sm text-white/70",children:"Video URL (MP4 or stream link)"}),d.jsx("input",{className:"w-full rounded-xl bg-white/5 border border-white/10 px-3 py-2 text-sm text-white focus:outline-none focus:ring-2 focus:ring-emerald-400",placeholder:"https://...",value:R.value,onChange:ue=>O({type:"video",value:ue.target.value})})]}),d.jsxs("div",{className:"flex justify-end gap-2",children:[d.jsx(Le,{variant:"ghost",onClick:()=>k(null),children:"Cancel"}),d.jsx(Le,{onClick:()=>{x!==null&&(S(ue=>({...ue,[x]:R})),(async()=>{try{await qs(Ke(Ge,`adventGifts/${x}`),R)}catch(ue){console.warn("Failed to persist gift config",ue)}finally{k(null)}})())},children:"Save Gift"})]})]})}),D&&d.jsx("div",{className:"fixed inset-0 z-40 flex items-center justify-center bg-black/70 px-4",children:d.jsxs("div",{className:"w-full max-w-lg rounded-2xl bg-slate-900 text-white border border-white/10 shadow-2xl p-6 space-y-4",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsxs("div",{className:"text-lg font-semibold",children:["You unlocked Day ",D.day]}),d.jsx("div",{className:"text-sm text-white/70",children:"Enjoy your new reward!"})]}),d.jsx("button",{className:"h-9 w-9 rounded-full bg-white/10 hover:bg-white/20 flex items-center justify-center",onClick:()=>q(null),"aria-label":"Close",children:"-"})]}),D.gift.type==="pfp"&&d.jsxs("div",{className:"space-y-3 text-sm",children:[d.jsx("div",{className:"text-white/80",children:"Profile Picture unlocked."}),d.jsx("img",{src:D.gift.value,alt:"Unlocked avatar",className:"h-32 w-32 rounded-full object-cover border border-white/10 shadow-lg mx-auto"}),d.jsx("div",{className:"text-white/70 text-sm text-center",children:"Equip it from My Profile."})]}),D.gift.type==="tagline"&&d.jsxs("div",{className:"space-y-3 text-sm",children:[d.jsx("div",{className:"text-white/80",children:"New tagline unlocked:"}),d.jsx("div",{className:"rounded-xl bg-white/5 border border-white/10 px-4 py-3 text-center text-emerald-200 font-semibold",children:D.gift.value||"New Tagline"}),d.jsx("div",{className:"text-white/70 text-sm text-center",children:"Manage taglines in My Profile."})]}),D.gift.type==="video"&&d.jsxs("div",{className:"space-y-3 text-sm",children:[d.jsx("div",{className:"text-white/80",children:"Video unlocked:"}),D.gift.value?d.jsx(Le,{className:"bg-emerald-500 text-slate-900 hover:bg-emerald-400",onClick:()=>Ze(D.gift.value),children:"Watch Video"}):d.jsx("div",{className:"text-white/60",children:"No video URL provided."}),d.jsx("div",{className:"text-white/70 text-sm text-center",children:"You can rewatch from this tile anytime."})]}),D.gift.type==="piece"&&d.jsxs("div",{className:"space-y-3 text-sm",children:[d.jsx("div",{className:"text-white/80",children:"Chess set unlocked:"}),d.jsx("div",{className:"rounded-xl bg-white/5 border border-white/10 px-4 py-3 text-center text-emerald-200 font-semibold",children:D.gift.value||"New Chess Set"}),d.jsx("div",{className:"text-white/70 text-sm text-center",children:"Available in Board Customisation."})]}),d.jsx("div",{className:"flex justify-end",children:d.jsx(Le,{onClick:()=>q(null),children:"Close"})})]})})]})})}function u_(){const t=new Date,e=new Date(t.getFullYear(),11,25,0,0,0),n=t.getTime()+t.getTimezoneOffset()*6e4,r=7200*1e3,a=n+r,u=e.getTime()-a,h=Math.max(0,Math.floor(u/1e3)),m=Math.floor(h/86400),y=Math.floor(h%86400/3600),x=Math.floor(h%3600/60),k=h%60;return{days:m,hours:y,minutes:x,seconds:k}}function d_(t){switch(t.type){case"pfp":return"Profile Picture";case"tagline":return t.value?`Tagline: ${t.value}`:"Tagline";case"piece":return t.value||"Chess Piece";case"video":return"Video Reward";case"pawns":return`${t.value} Pawns`;default:return"Reward"}}const m$="/assets/Snowflake%20Background-Cas1sPFf.png";function g$(){const{user:t,setUser:e}=$r(),[,n]=ua(),[r,a]=j.useState(!1),[u,h]=j.useState(t?.avatarUrl||Xd),{data:m}=Ld({queryKey:["profile",t?.id],enabled:!!t,queryFn:()=>vk(t)}),y=t?.totalXp||0,x=t?.level||1,k=t?.streak||0;t?.unlockedPfps;const T=t?.unlockedTaglines||[],[S,R]=j.useState(t?.taglinesEnabled??!0),[O,D]=j.useState(t?.selectedTagline||""),q=t?.accountType==="group"&&!!t?.groupId,he=q&&t?.groupRole==="admin",ce=[{id:"south",label:"South Knight",url:Xd}],C=c=>{if(h(c),t){const re={...t,avatarUrl:c};localStorage.setItem("pawnpoint_user",JSON.stringify(re)),e(re),ms(Ke(Ge,`users/${t.id}`),{avatarUrl:c}).catch(xe=>console.warn("Failed to persist avatar to Firebase",xe))}a(!1)},le=c=>{const re=new FileReader;re.onload=xe=>{const je=xe.target?.result;typeof je=="string"&&C(je)},re.readAsDataURL(c)};return j.useEffect(()=>{t?.avatarUrl&&h(t.avatarUrl),R(t?.taglinesEnabled??!0),D(t?.selectedTagline||"")},[t?.avatarUrl,t?.taglinesEnabled,t?.selectedTagline]),j.useEffect(()=>{if(!O&&T.length){const c=T[0];D(c)}},[T,O]),t?d.jsx(qr,{children:d.jsxs("div",{className:"flex flex-col gap-6",children:[d.jsxs("div",{className:"relative overflow-hidden rounded-3xl border border-white/10 bg-slate-900 shadow-2xl",children:[d.jsx("img",{src:m$,alt:"",className:"absolute inset-0 h-full w-full object-cover opacity-50 pointer-events-none"}),d.jsxs("div",{className:"relative z-10 flex flex-col lg:flex-row lg:items-center gap-6 p-6",children:[d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsxs("div",{className:"relative h-24 w-24 rounded-full overflow-hidden border-4 border-white/40 shadow-lg",children:[d.jsx("img",{src:u,alt:"Avatar",className:"h-full w-full object-cover"}),d.jsx("button",{onClick:()=>a(!0),className:"absolute bottom-1 right-1 h-8 w-8 rounded-full bg-white/80 text-slate-900 flex items-center justify-center shadow-lg hover:bg-white transition","aria-label":"Change profile picture",children:d.jsx(Dd,{className:"h-4 w-4"})})]}),d.jsxs("div",{className:"space-y-1 text-white",children:[d.jsx("div",{className:"text-2xl font-bold",children:t.chessUsername||t.displayName}),S&&O&&d.jsx("div",{className:"text-xs text-white/70 max-w-xs overflow-hidden text-ellipsis whitespace-nowrap",children:O}),d.jsx("div",{className:"text-sm text-white/80",children:t.email}),d.jsxs("div",{className:"text-sm text-white/70",children:["Member since"," ",t.createdAt?new Date(t.createdAt).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}):"your start date"]}),d.jsxs("div",{className:"text-sm text-white/70",children:["Chess.com: ",t.chessUsername||"Not linked"]}),q&&d.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-sm text-white/80",children:[d.jsx("span",{className:"rounded-full bg-white/10 px-2 py-1",children:t.groupName||"Group member"}),he&&t.groupCode&&d.jsxs("span",{className:"rounded-full bg-emerald-500/20 border border-emerald-300/40 px-2 py-1 text-emerald-100",children:["Group Code: ",t.groupCode]})]})]})]}),d.jsxs("div",{className:"flex-1 flex flex-wrap items-center gap-3 justify-start lg:justify-end",children:[d.jsxs("div",{className:"rounded-full bg-cyan-500/20 text-cyan-100 border border-cyan-400/40 px-3 py-1 text-sm",children:["Current Streak: ",k," days"]}),d.jsx(Le,{variant:"outline",onClick:()=>n("/settings"),children:"Settings"}),d.jsx(Le,{variant:"ghost",onClick:()=>n("/dashboard"),children:"Back to Dashboard"})]})]})]}),d.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[d.jsx(io,{children:d.jsxs(oo,{className:"flex items-center gap-3 py-4",children:[d.jsx("div",{className:"h-11 w-11 rounded-xl bg-emerald-500/20 border border-emerald-400/40 flex items-center justify-center text-emerald-200 font-semibold",children:"XP"}),d.jsxs("div",{children:[d.jsx("div",{className:"text-xl font-bold text-white",children:y}),d.jsx("div",{className:"text-sm text-white/70",children:"Total XP"})]})]})}),d.jsx(io,{children:d.jsxs(oo,{className:"flex items-center gap-3 py-4",children:[d.jsx("div",{className:"h-11 w-11 rounded-xl bg-indigo-500/20 border border-indigo-400/40 flex items-center justify-center text-indigo-200 font-semibold",children:"Lv"}),d.jsxs("div",{children:[d.jsx("div",{className:"text-xl font-bold text-white",children:x}),d.jsx("div",{className:"text-sm text-white/70",children:"Level"})]})]})})]}),r&&d.jsx("div",{className:"fixed inset-0 z-40 flex items-center justify-center bg-black/70 px-4",children:d.jsxs("div",{className:"w-full max-w-3xl rounded-2xl bg-slate-900 text-white border border-white/10 shadow-2xl p-6 space-y-4",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("div",{className:"text-xl font-semibold",children:"Change Profile Picture"}),d.jsx("div",{className:"text-sm text-white/70",children:"Select the picture you want to use for your profile"})]}),d.jsx("button",{className:"h-10 w-10 rounded-full bg-white/10 flex items-center justify-center hover:bg-white/20 transition",onClick:()=>a(!1),"aria-label":"Close",children:d.jsx(nr,{className:"h-5 w-5"})})]}),d.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:ce.map(c=>{const re=u===c.url;return d.jsxs("button",{onClick:()=>C(c.url),className:`relative rounded-full p-1 border aspect-square ${re?"border-emerald-400 ring-2 ring-emerald-400/60":"border-transparent"} hover:border-white/30 transition`,style:{width:"6rem",height:"6rem"},children:[d.jsx("img",{src:c.url,alt:c.label,className:"h-full w-full rounded-full object-cover"}),re&&d.jsx("div",{className:"absolute inset-0 rounded-full border-2 border-emerald-300 pointer-events-none"})]},c.id)})}),d.jsx("div",{className:"flex items-center gap-3",children:d.jsxs("label",{className:"inline-flex items-center px-3 py-2 rounded-xl border border-white/10 bg-white/5 text-sm cursor-pointer hover:border-white/20",children:[d.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:c=>{const re=c.target.files?.[0];re&&le(re)}}),"Upload custom photo"]})}),d.jsx("div",{className:"flex justify-end",children:d.jsx(Le,{variant:"outline",onClick:()=>a(!1),children:"Close"})})]})})]})}):null}const l0={knight:{id:"knight",name:"The South Knight",avatar:Xd,skill:20,depth:20,label:"2500 Elo",difficulty:"2500 Elo"},bishop:{id:"bishop",name:"The South Bishop",avatar:Sk,skill:10,depth:12,label:"1500 Elo",difficulty:"1500 Elo"},pawn:{id:"pawn",name:"The South Pawn",avatar:kk,skill:2,depth:5,label:"800 Elo",difficulty:"800 Elo"}},c0=[l0.knight,l0.bishop,l0.pawn],u0=()=>({pawn:{losingMode:!1,lastEvalCp:0,lastMateThreat:!1},bishop:{losingMode:!1,lastEvalCp:0,lastMateThreat:!1},knight:{losingMode:!1,lastEvalCp:0,lastMateThreat:!1}}),xr={rapid:{label:"Rapid",initial:600,increment:0,subtitle:"10 | 0"},blitz:{label:"Blitz",initial:180,increment:2,subtitle:"3 | 2"}},f_=t=>{const e=Math.max(0,Math.floor(t)),n=Math.floor(e/60),r=e%60;return`${n.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}`};function v$(){const{user:t,setUser:e}=$r(),n=j.useRef(new xt),r=j.useRef(n.current.fen()),a=j.useRef(null),u=j.useRef({value:0}),h=j.useRef(null);j.useRef({gameId:0,entries:[]});const[m,y]=j.useState(!1),[x,k]=j.useState("w"),[T,S]=j.useState(""),[R,O]=j.useState(""),[D,q]=j.useState(n.current.fen()),[he,ce]=j.useState(null),[C,le]=j.useState(null),[c,re]=j.useState("Engine loading..."),[xe,je]=j.useState(!1),[Fe,Ze]=j.useState("Booting Stockfish..."),[st,Re]=j.useState(!1),[Ae,ue]=j.useState("w"),[pe,$e]=j.useState("rapid"),[Y,J]=j.useState(xr.rapid.initial),[Se,de]=j.useState(xr.rapid.initial),$=j.useRef(xr.rapid.initial),ee=j.useRef(xr.rapid.initial),Pe=j.useRef(null),Ee=j.useRef(null),G=j.useRef("w"),[ae,Ue]=j.useState("idle"),qe=j.useRef("idle"),et=j.useRef(null),ot=j.useRef(null),[bt,nn]=j.useState(null),[hn,Dt]=j.useState(t?.onlineRating??1e3),[Mn,Be]=j.useState(0),Pt=j.useRef({value:!1}),[Wt,On]=j.useState([]),sn=j.useRef({value:0}),[qt,ln]=j.useState([]),zn=j.useRef({value:!1}),[Wn,Ts]=j.useState(new Set),[qn,cn]=j.useState(null),[Ln,ns]=j.useState(null),[ne,at]=j.useState([]),[yt,Ft]=j.useState(!1),[Lt,En]=j.useState(!1),Yt=ai(t?.boardTheme).colors,{key:Qt,pieces:Xt}=j.useMemo(()=>Br(t?.pieceTheme),[t?.pieceTheme]),[Tn,gs]=j.useState(!1),[Vn,Sn]=j.useState(c0[0].id);c0.find(V=>V.id===Vn)||c0[0];const Is=j.useRef(Vn),vs=j.useRef(u0()),[Hn,Kn]=j.useState(null),[Hs,ys]=j.useState([]),[K,yn]=j.useState(!1),[Jt,An]=j.useState(""),[Ne,In]=j.useState(""),[At,W]=j.useState(!1),[ie,se]=j.useState(null),[ke,Qe]=j.useState(""),[ge,Bt]=j.useState(null);j.useEffect(()=>{Is.current=Vn,vs.current[Vn]={losingMode:!1,lastEvalCp:0,lastMateThreat:!1}},[Vn]);const Nt=V=>{typeof document>"u"||(document.body.style.cursor="")};j.useEffect(()=>()=>{Nt()},[]),j.useEffect(()=>{const V=()=>Nt();return window.addEventListener("mouseup",V),window.addEventListener("dragend",V),()=>{window.removeEventListener("mouseup",V),window.removeEventListener("dragend",V)}},[]),j.useEffect(()=>{qe.current=ae},[ae]),j.useEffect(()=>{if(!t)return;const V=dk(t.id,ye=>se(ye));return()=>V?.()},[t?.id]),j.useEffect(()=>{ae!=="playing"&&Ct(pe)},[pe,ae]),j.useEffect(()=>{typeof t?.onlineRating=="number"&&Dt(t.onlineRating)},[t?.onlineRating]),j.useEffect(()=>()=>{ot.current?.(),et.current&&window.clearTimeout(et.current)},[]),j.useEffect(()=>{if(!t)return;const V=localStorage.getItem("pawnpoint_pending_match");if(V)try{const ye=JSON.parse(V);ye?.matchId&&H1(ye.matchId).then(Ie=>{if(!Ie||!Ie.players[t.id])return;Bt(Ie.id);const Me=Ie.players[t.id].color,He=Object.values(Ie.players).find(Zt=>Zt.id!==t.id);He&&(nn({name:He.name,rating:He.rating}),re(`Matched with ${He.name} (${He.rating}). You are ${Me==="w"?"White":"Black"}.`),Ue("playing"),X(Me))})}finally{localStorage.removeItem("pawnpoint_pending_match")}},[t?.id]),j.useEffect(()=>()=>{Pe.current&&window.clearInterval(Pe.current),et.current&&window.clearTimeout(et.current)},[]);const Rt=V=>{if(zn.current.value)return;zn.current.value=!0;const ye=V==="win"?150:V==="loss"?75:112;t&&aw(t.id,ye,{source:`practice_${V}`})},lt=(V,ye,Ie)=>{const Me=Math.abs(ye-Ie),He=Me<=35?{win:8,draw:0,loss:8}:Me<=50?{win:9,draw:1,loss:8}:Me<=70?{win:10,draw:2,loss:7}:{win:12,draw:4,loss:3};if(V==="win")return{selfDelta:He.win,oppDelta:-He.win};if(V==="loss")return{selfDelta:-He.loss,oppDelta:He.loss};if(He.draw===0)return{selfDelta:0,oppDelta:0};const Zt=ye<Ie,zt=He.draw;return Zt?{selfDelta:zt,oppDelta:-zt}:{selfDelta:-zt,oppDelta:zt}},nt=async V=>{if(!bt)return;const{selfDelta:ye,oppDelta:Ie}=lt(V,hn,bt.rating);Be(ye);const Me=Math.max(0,Math.round(hn+ye)),He=Math.max(0,Math.round(bt.rating+Ie));if(Dt(Me),nn({...bt,rating:He}),t?.id)try{const Zt=await O4(t.id,Me);Zt&&e(Zt)}catch{}},ut=(V,ye)=>{if(Pt.current.value)return;Pt.current.value=!0,Ue("complete");const Ie=V==="win"?"You win":V==="loss"?"You lose":"Draw";re(ye?`${Ie}: ${ye}`:Ie),kt(),a.current?.postMessage("stop"),nt(V),Rt(V)},Ct=V=>{const ye=xr[V];J(ye.initial),de(ye.initial),$.current=ye.initial,ee.current=ye.initial},kt=()=>{Pe.current&&(window.clearInterval(Pe.current),Pe.current=null)},Vt=V=>{const ye=V===x;ut(ye?"loss":"win",ye?"You ran out of time.":"Opponent flagged.")},$t=V=>{kt(),G.current=V,Ee.current=performance.now(),Pe.current=window.setInterval(()=>{if(qe.current!=="playing")return;const ye=performance.now(),Ie=(ye-(Ee.current||ye))/1e3;if(Ee.current=ye,V===x){const Me=Math.max(0,$.current-Ie);$.current=Me,J(Me),Me<=0&&Vt(x)}else{const Me=Math.max(0,ee.current-Ie);ee.current=Me,de(Me),Me<=0&&Vt(x==="w"?"b":"w")}},200)},Xn=V=>{const ye=xr[pe].increment;if(ye)if(V===x){const Ie=$.current+ye;$.current=Ie,J(Ie)}else{const Ie=ee.current+ye;ee.current=Ie,de(Ie)}},wn=V=>V?V.color==="w"?Xt.w[V.type]:Xt.b[V.type]:null,ss=V=>!V||V.type!=="p"?"":Qt==="chesscom"?V.color==="w"?"scale-110":"scale-90":Qt==="freestyle"&&V.color==="b"?"scale-110":"",Dn=(V,ye)=>{const Ie="abcdefgh"[Ae==="w"?ye:7-ye],Me=Ae==="w"?8-V:V+1;return`${Ie}${Me}`},jn=j.useMemo(()=>{const ye=new xt(D).board();return Ae==="w"?ye:ye.slice().reverse().map(Ie=>Ie.slice().reverse())},[D,Ae]),ws=j.useMemo(()=>he?new xt(D).moves({square:he,verbose:!0}):[],[D,he]),rs=j.useMemo(()=>Hs.reduce((V,ye,Ie)=>(Ie%2===0?V.push({num:V.length+1,white:ye,black:""}):V[V.length-1].black=ye,V),[]),[Hs]),Kt=(V,ye)=>{const Ie=new xt(V),Me={p:1,n:3,b:3,r:5,q:9,k:0};let He=0;return Ie.board().forEach(Zt=>Zt.forEach(zt=>{if(!zt)return;const Ls=Me[zt.type];He+=zt.color===ye?Ls:-Ls})),He},rn=V=>{const ye=r.current,Ie=ye?new xt(ye):new xt;if(Hs.forEach(Me=>{try{Ie.move(Me,{sloppy:!0})}catch{}}),V&&Ie.fen()!==V)try{return new xt(V)}catch{return Ie}return Ie};j.useEffect(()=>{Ze("Online play uses live opponents only."),je(!0),re("Ready to play.")},[]);const z=()=>{try{const V=n.current.pgn(),ye=new Blob([V],{type:"application/x-chess-pgn"}),Ie=URL.createObjectURL(ye),Me=document.createElement("a");Me.href=Ie,Me.download=`practice-${Date.now()}.pgn`,document.body.appendChild(Me),Me.click(),document.body.removeChild(Me),setTimeout(()=>URL.revokeObjectURL(Ie),2e3)}catch(V){console.warn("Failed to download PGN",V),re("Could not download PGN right now.")}},Z=async()=>{if(!xe){re("Engine still loading. Please wait a moment.");return}if(!t){re("Sign in to find a match.");return}Pt.current.value=!1,a.current?.postMessage("stop"),nn(null),Pe.current&&window.clearInterval(Pe.current),et.current&&window.clearTimeout(et.current),ot.current?.(),Ue("searching"),re(`Waiting for another ${xr[pe].label} player...`),ys([]),ln([]),Kn(null),sn.current.value=0,vs.current=u0();try{const V=await I4(pe,t);if(V.status==="matched"){const ye=V.color==="w"?"w":"b";nn({name:V.opponent.name,rating:V.opponent.rating}),re(`Matched with ${V.opponent.name} (${V.opponent.rating}). You are ${ye==="w"?"White":"Black"}.`),X(ye);return}ot.current=j4(t.id,async ye=>{if(!ye)return;et.current&&(window.clearTimeout(et.current),et.current=null),ot.current?.(),ot.current=null;const Ie=await H1(ye);if(!Ie||!Ie.players[t.id])return;const Me=Ie.players[t.id].color,He=Object.values(Ie.players).find(Zt=>Zt.id!==t.id);He&&(nn({name:He.name,rating:He.rating}),xr[pe]||$e(Ie.timeControl),re(`Matched with ${He.name} (${He.rating}). You are ${Me==="w"?"White":"Black"}.`),X(Me))}),et.current=window.setTimeout(()=>{ot.current?.(),ot.current=null,P4(pe,t.id).catch(()=>{}),Ue("idle"),re("Try again later or switch time control.")},120*1e3)}catch(V){re(V?.message||"Could not start matchmaking."),Ue("idle")}},X=V=>{if(!xe){re("Engine still loading. Please wait a moment.");return}O(""),Be(0),u.current.value+=1,sn.current.value=0,vs.current=u0(),Pt.current.value=!1,Ue("playing");let ye="";const Ie=T.trim();if(Ie)try{ye=new xt(Ie).fen()}catch{O("Invalid FEN. Please check the format.");return}const Me=ye?new xt(ye):new xt;r.current=Me.fen(),n.current=Me,q(Me.fen()),ce(null),le(null),ln([]),ys([]),Kn(null),Ct(pe),zn.current.value=!1;const He=V||x;k(He),ue(He),Re(!1),re(He==="b"?"Opponent thinking...":"Your move."),y(!1),h.current=null,a.current?.postMessage("ucinewgame"),$t("w")},tt=(V,ye)=>{if(ae!=="playing"||!bt||!ge)return;cn(null),ns(null),at([]),Ts(new Set);const Ie=Dn(V,ye),Me=new xt(D);if(Me.turn()!==x)return;if(he===Ie){ce(null);return}const He=Me.get(Ie);if(he){Ye(he,Ie);return}He&&He.color===Me.turn()&&ce(Ie)},Ye=async(V,ye,Ie)=>{if(ae!=="playing"||!bt||!ge)return;const Me=rn(D);if(Me.turn()!==x)return;const He=Me.turn();if(Kt(D,x),V===ye){ce(null),le(null);return}let Zt=null;try{const Ls=Me.moves({square:V,verbose:!0}).find(Cr=>Cr.to===ye);if(Ls?.flags?.includes("p")&&!Ie){Kn({from:V,to:ye}),re("Choose promotion piece."),ce(null),le(null);return}const Hr=Ie||Ls?.promotion||"q";Zt=Me.move({from:V,to:ye,promotion:Hr})}catch{Zt=null}if(!Zt){ce(null);return}if(Xn(He),n.current=Me,q(Me.fen()),ce(null),ln([V,ye]),Kn(null),Zt?.san&&ys(zt=>[...zt,Zt.san]),re(Me.isCheckmate()?"You delivered mate!":Me.isCheck()?"Opponent in check. Opponent thinking...":"Opponent thinking..."),Me.isGameOver()){Me.isCheckmate()?ut("win","Checkmate"):Me.isDraw()&&ut("draw","Drawn position");return}$t(Me.turn());try{await A4(ge,{from:V,to:ye,promotion:Ie,san:Zt?.san||`${V}-${ye}`,fen:Me.fen(),by:t?.id||"unknown",ts:Date.now()})}catch{}};return j.useEffect(()=>{const V=new xt(D);Pt.current.value||V.isGameOver()&&(V.isCheckmate()?re(V.turn()===x?"You are checkmated.":"You delivered checkmate!"):re("Game over."))},[D,x]),j.useEffect(()=>{if(!ge)return;const V=R4(ge,ye=>{const Ie=new xt;if(ye.forEach(Me=>{try{Ie.move({from:Me.from,to:Me.to,promotion:Me.promotion||"q"})}catch{}}),q(Ie.fen()),ys(ye.map(Me=>Me.san).filter(Boolean).map(String)),ye.length){const Me=ye[ye.length-1];ln([Me.from,Me.to])}else ln([]);ce(null),Kn(null),$t(Ie.turn())});return()=>V()},[ge]),d.jsxs(qr,{children:[d.jsxs("div",{className:"flex flex-col gap-4 text-white",children:[d.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[d.jsxs("div",{children:[d.jsxs("div",{className:"text-xl font-bold flex items-center gap-2",children:[d.jsx(Px,{className:"h-5 w-5 text-emerald-300"}),"Play Online"]}),d.jsx("div",{className:"text-sm text-white/60",children:"Pick a time control and start an online match."})]}),d.jsxs("div",{className:"flex items-center gap-2 text-sm text-white/70",children:[d.jsx(um,{className:"h-4 w-4"}),d.jsxs("span",{children:["Rating ",hn,Mn?` (${Mn>0?"+":""}${Mn})`:""]})]})]}),d.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-[minmax(520px,1fr)_360px] gap-6 items-start",children:[d.jsx("div",{className:"space-y-4",children:d.jsxs("div",{className:"p-2",children:[d.jsxs("div",{className:"flex items-center justify-between mb-3 text-xs sm:text-sm text-white/70",children:[d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsxs("div",{className:"flex items-center gap-2 rounded-xl border border-white/10 bg-white/5 px-3 py-2",children:[d.jsx("span",{className:"font-semibold text-white",children:"You"}),d.jsx("span",{className:"text-white/60",children:x==="w"?"White":"Black"}),d.jsxs("span",{className:"flex items-center gap-1 text-emerald-300 font-semibold",children:[d.jsx(jx,{className:"h-4 w-4"}),f_(Y)]})]}),d.jsxs("div",{className:"text-white/70",children:[xr[pe].label," (",xr[pe].subtitle,")"]})]}),d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsxs("div",{className:"flex flex-col text-right",children:[d.jsx("span",{className:"font-semibold text-white",children:bt?.name||"Searching..."}),d.jsx("span",{className:"text-[11px] text-white/60",children:bt?`Rating ${bt.rating}`:"Waiting for opponent"})]}),d.jsxs("div",{className:"flex items-center gap-2 rounded-xl border border-white/10 bg-white/5 px-3 py-2",children:[d.jsx("span",{className:"text-white/60",children:x==="w"?"Black":"White"}),d.jsxs("span",{className:"flex items-center gap-1 text-amber-300 font-semibold",children:[d.jsx(jx,{className:"h-4 w-4"}),f_(Se)]})]})]})]}),d.jsx("div",{className:"relative grid grid-cols-8 grid-rows-8 w-full max-w-[840px] aspect-square mx-auto overflow-hidden shadow-2xl rounded-3xl",children:jn.map((V,ye)=>V.map((Ie,Me)=>{const He=Dn(ye,Me),zt=(ye+Me)%2===0?Yt.light:Yt.dark,Ls=he===He,br=qt.includes(He),Hr=ws.some(li=>li.to===He),Cr=Wn.has(He),Mt=wn(Ie);return d.jsxs("div",{onClick:()=>tt(ye,Me),className:"relative select-none",style:{backgroundColor:zt},children:[br&&d.jsx("div",{className:"absolute inset-0 ring-2 ring-amber-300/70 pointer-events-none"}),Ls&&d.jsx("div",{className:"absolute inset-0 ring-2 ring-emerald-300/70 pointer-events-none"}),Cr&&d.jsx("div",{className:"absolute inset-0 border-2 border-red-400/70 pointer-events-none"}),Hr&&d.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:d.jsx("span",{className:"h-3 w-3 rounded-full bg-emerald-300/80"})}),Mt&&d.jsx("img",{src:Mt,alt:"",className:`absolute inset-0 h-full w-full object-contain ${ss(Ie)}`,draggable:!1})]},He)}))})]})}),d.jsxs("div",{className:"relative space-y-3",children:[d.jsxs("div",{className:"rounded-2xl bg-slate-900 border border-white/10 shadow-xl p-4 space-y-3",children:[d.jsx("div",{className:"grid grid-cols-2 gap-2",children:["rapid","blitz"].map(V=>{const ye=pe===V;return d.jsxs("button",{disabled:ae==="searching"||ae==="playing",onClick:()=>$e(V),className:`w-full rounded-xl border px-3 py-3 text-left ${ye?"border-pink-400 bg-white/10":"border-white/10 bg-white/5 hover:bg-white/10"}`,children:[d.jsx("div",{className:"font-semibold text-white",children:xr[V].label}),d.jsx("div",{className:"text-xs text-white/60",children:xr[V].subtitle})]},V)})}),d.jsxs("div",{className:"rounded-xl bg-white/5 border border-white/10 p-3 text-sm text-white/80 min-h-[64px]",children:[d.jsxs("div",{className:"font-semibold text-white flex items-center gap-2",children:[ae==="searching"?d.jsx(Ax,{className:"h-4 w-4 animate-spin"}):null,d.jsx("span",{children:c})]}),d.jsx("div",{className:"mt-2 text-xs text-white/60",children:ae==="searching"?`Waiting for another ${xr[pe].label} player...`:bt?`Opponent: ${bt.name} (${bt.rating})`:"Tap Find Match to start."})]}),d.jsxs("div",{className:"flex gap-2",children:[d.jsx(Le,{className:"w-full gap-2",onClick:Z,disabled:ae==="searching"||ae==="playing"||!xe,children:ae==="searching"?d.jsxs(d.Fragment,{children:[d.jsx(Ax,{className:"h-4 w-4 animate-spin"}),"Searching..."]}):d.jsxs(d.Fragment,{children:[d.jsx(Px,{className:"h-4 w-4"}),"Find Match"]})}),d.jsxs(Le,{className:"w-full gap-2",variant:"outline",onClick:()=>{yn(!0),In("")},disabled:ae==="searching"||ae==="playing",children:[d.jsx(um,{className:"h-4 w-4"}),"Play a Friend"]})]})]}),d.jsxs("div",{className:"rounded-2xl bg-slate-900 border border-white/10 p-3 shadow-xl space-y-3",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("div",{className:"font-semibold",children:"Moves"}),d.jsxs(Le,{variant:"ghost",size:"sm",onClick:z,className:"gap-2",children:[d.jsx(iy,{className:"h-4 w-4"}),"PGN"]})]}),d.jsx("div",{className:"rounded-xl border border-white/10 bg-white/5 p-3 max-h-60 overflow-y-auto text-sm text-white/80",children:rs.length===0?d.jsx("div",{className:"text-white/60 text-sm",children:"No moves yet."}):d.jsx("div",{className:"space-y-1",children:rs.map(V=>d.jsxs("div",{className:"flex gap-2",children:[d.jsxs("span",{className:"text-white/60 w-8 shrink-0",children:[V.num,"."]}),d.jsx("span",{className:"w-20",children:V.white}),d.jsx("span",{className:"w-20",children:V.black})]},V.num))})})]})]})]})]}),K&&d.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 px-4",children:d.jsxs("div",{className:"w-full max-w-md rounded-2xl bg-slate-900 text-white border border-white/10 shadow-2xl p-6 space-y-4",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("div",{className:"text-lg font-semibold",children:"Play a friend"}),d.jsx("div",{className:"text-xs text-white/60",children:"Enter your friend's chess.com username to send a challenge for the current time control."})]}),d.jsx("button",{className:"p-2 rounded-full hover:bg-white/10 text-white/70",onClick:()=>yn(!1),children:d.jsx(nr,{className:"h-4 w-4"})})]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx("label",{className:"text-xs uppercase tracking-[0.08em] text-white/50",children:"Chess.com username"}),d.jsx("input",{value:Jt,onChange:V=>An(V.target.value),className:"w-full rounded-xl border border-white/10 bg-white/5 px-3 py-3 text-sm outline-none focus:ring-2 focus:ring-emerald-400",placeholder:"friend_username"})]}),Ne&&d.jsx("div",{className:"text-sm text-red-200 bg-red-500/10 border border-red-400/40 rounded-xl px-3 py-2",children:Ne}),d.jsxs("div",{className:"flex justify-end gap-2",children:[d.jsx(Le,{variant:"outline",onClick:()=>yn(!1),children:"Cancel"}),d.jsx(Le,{onClick:async()=>{if(!t){In("Sign in first.");return}In(""),W(!0);try{await $4(Jt,t,pe),yn(!1),re("Challenge sent. Waiting for your friend to accept.")}catch(V){In(V?.message||"Could not send challenge.")}finally{W(!1)}},disabled:At,children:At?"Sending...":`Challenge (${xr[pe].subtitle})`})]})]})}),ie&&d.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 px-4",children:d.jsxs("div",{className:"w-full max-w-md rounded-2xl bg-slate-900 text-white border border-white/10 shadow-2xl p-6 space-y-4",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("div",{className:"text-lg font-semibold",children:"Incoming challenge"}),d.jsxs("div",{className:"text-xs text-white/60",children:[ie.fromName," challenged you to ",ie.timeControl.toUpperCase(),"."]})]}),d.jsx("button",{className:"p-2 rounded-full hover:bg-white/10 text-white/70",onClick:async()=>{!t||!ie||(await Lm(t.id,ie.id),se(null))},children:d.jsx(nr,{className:"h-4 w-4"})})]}),ke&&d.jsx("div",{className:"text-sm text-red-200 bg-red-500/10 border border-red-400/40 rounded-xl px-3 py-2",children:ke}),d.jsxs("div",{className:"flex justify-end gap-2",children:[d.jsx(Le,{variant:"outline",onClick:async()=>{!t||!ie||(await Lm(t.id,ie.id),se(null))},children:"Decline"}),d.jsx(Le,{onClick:async()=>{if(!(!t||!ie))try{const V=await fk(ie,t);if(se(null),V&&V.players[t.id]){const ye=V.players[t.id].color,Ie=Object.values(V.players).find(Me=>Me.id!==t.id);Ie&&($e(ie.timeControl||pe),nn({name:Ie.name,rating:Ie.rating}),re(`Matched with ${Ie.name} (${Ie.rating}). You are ${ye==="w"?"White":"Black"}.`),Ue("playing"),X(ye))}}catch(V){Qe(V?.message||"Could not accept challenge.")}},children:"Accept"})]})]})}),Hn&&d.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 px-4",children:d.jsxs("div",{className:"w-full max-w-sm rounded-2xl bg-slate-900 text-white border border-white/10 shadow-2xl",children:[d.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-white/10",children:[d.jsxs("div",{children:[d.jsx("div",{className:"text-lg font-semibold",children:"Choose promotion"}),d.jsx("div",{className:"text-xs text-white/60",children:"Select the piece to promote your pawn."})]}),d.jsx("button",{className:"p-2 rounded-full hover:bg-white/10 text-white/70",onClick:()=>Kn(null),"aria-label":"Close",children:d.jsx(nr,{className:"h-4 w-4"})})]}),d.jsxs("div",{className:"p-5 grid grid-cols-2 gap-3",children:[["q","r","b","n"].map(V=>d.jsxs(Le,{variant:"outline",className:"w-full",onClick:()=>{Hn&&Ye(Hn.from,Hn.to,V)},children:["Promote to ",V==="q"?"Queen":V==="r"?"Rook":V==="b"?"Bishop":"Knight"]},V)),d.jsx(Le,{variant:"ghost",className:"w-full col-span-2",onClick:()=>Kn(null),children:"Cancel"})]})]})})]})}function Yi({children:t}){const{user:e,loading:n}=$r(),[,r]=ua(),a=!n&&!e;return j.useEffect(()=>{a&&r("/login")},[a,r]),n?d.jsx("div",{className:"min-h-screen flex items-center justify-center bg-slate-950 text-white/70",children:"Loading..."}):a?d.jsx("div",{className:"min-h-screen flex items-center justify-center bg-slate-950 text-white/70",children:"Redirecting to login..."}):t}function y$(){return d.jsxs(QN,{children:[d.jsx(Zs,{path:"/",component:IE}),d.jsx(Zs,{path:"/login",component:()=>d.jsx(K1,{mode:"login"})}),d.jsx(Zs,{path:"/signup",component:()=>d.jsx(K1,{mode:"signup"})}),d.jsx(Zs,{path:"/dashboard",children:()=>d.jsx(Yi,{children:d.jsx(f3,{})})}),d.jsx(Zs,{path:"/courses",children:()=>d.jsx(Yi,{children:d.jsx(h3,{})})}),d.jsx(Zs,{path:"/courses/:id",children:t=>d.jsx(Yi,{children:d.jsx(m3,{id:t.id})})}),d.jsx(Zs,{path:"/lesson",children:()=>d.jsx(Yi,{children:d.jsx(a_,{})})}),d.jsx(Zs,{path:"/lesson/:id",children:t=>d.jsx(Yi,{children:d.jsx(a_,{id:t.id})})}),d.jsx(Zs,{path:"/leaderboard",children:()=>d.jsx(Yi,{children:d.jsx(g3,{})})}),d.jsx(Zs,{path:"/advent",children:()=>d.jsx(Yi,{children:d.jsx(p$,{})})}),d.jsx(Zs,{path:"/practice",component:z3}),d.jsx(Zs,{path:"/play-online",component:v$}),d.jsx(Zs,{path:"/profile",children:()=>d.jsx(Yi,{children:d.jsx(g$,{})})}),d.jsx(Zs,{path:"/settings",children:()=>d.jsx(Yi,{children:d.jsx(e$,{})})}),d.jsx(Zs,{component:W3})]})}function w$(){return d.jsx(u3,{children:d.jsx(y$,{})})}const x$=new mN({defaultOptions:{queries:{refetchOnWindowFocus:!1,staleTime:1e3*60*5}}});HS.createRoot(document.getElementById("root")).render(d.jsx(p_.StrictMode,{children:d.jsx(gN,{client:x$,children:d.jsx(w$,{})})}));
